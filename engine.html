<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆæœŸè´¢åŠ¡ç³»ç»ŸåŸå‹ - è´¢åŠ¡æ¨¡å— (å¸ƒå±€ä¿®æ­£ç‰ˆ)</title>
    <style>
        /* -----------------------
           1. å…¨å±€åŠåŸºç¡€å¸ƒå±€æ ·å¼
           ----------------------- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7f6;
            color: #333;
        }

        /* å¤´éƒ¨å¯¼èˆªæ  */
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 20px;
            font-size: 20px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* ä¸»ä½“å¸ƒå±€ï¼šä¾§è¾¹æ  + å†…å®¹åŒº */
        .main-container {
            display: flex;
            /* ç¡®ä¿ä¾§è¾¹æ å’Œå†…å®¹åŒºå¹¶æ’ */
            height: calc(100vh - 60px);
        }

        /* ä¾§è¾¹æ /ä¸»èœå•å®¹å™¨ */
        .sidebar {
            width: 240px;
            background-color: #ffffff;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
            overflow-y: auto;
            padding-top: 10px;
            border-right: 1px solid #eee;
            /* ä¿è¯å®ƒå›ºå®šåœ¨å·¦ä¾§ */
            flex-shrink: 0; 
        }

        /* å†…å®¹åŒº */
        .content-area {
            flex-grow: 1;
            /* ç¡®ä¿å æ®å‰©ä½™æ‰€æœ‰ç©ºé—´ */
            padding: 20px;
            overflow-y: auto;
        }

        /* ç›®å½•æœç´¢æ¡†æ ·å¼ */
        #menuSearch {
            width: calc(100% - 40px);
            padding: 8px 10px;
            margin: 0 20px 10px 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            transition: border-color 0.2s;
        }

        #menuSearch:focus {
            border-color: #3498db;
            outline: none;
        }

        /* -----------------------
           2. èœå•é¡¹åŠäº¤äº’æ ·å¼
           ----------------------- */
        .menu-group-title {
            padding: 10px 20px;
            font-size: 14px;
            font-weight: bold;
            color: #7f8c8d;
            margin-top: 10px;
            text-transform: uppercase;
        }

        /* ä¸»èœå•é¡¹æ ·å¼ (ä¸€çº§/äºŒçº§) */
        .menu-item {
            padding: 12px 20px 12px 20px;
            cursor: pointer;
            font-size: 15px;
            transition: background-color 0.2s, color 0.2s;
            border-left: 3px solid transparent;
            position: relative;
        }

        .menu-item:hover {
            background-color: #ecf0f1;
        }

        /* æ¿€æ´»çŠ¶æ€ */
        .menu-item.active,
        .sub-menu-item.active {
            background-color: #ecf0f1;
            color: #3498db !important;
            border-left: 3px solid #3498db;
        }

        /* æŠ˜å /å±•å¼€å›¾æ ‡ */
        .menu-item.collapsed:after {
            content: "â–¼";
            float: right;
            font-size: 10px;
            margin-top: 2px;
            color: #999;
            transition: transform 0.3s;
        }

        .menu-item.expanded:after {
            content: "â–²";
            float: right;
            font-size: 10px;
            margin-top: 2px;
            color: #3498db;
        }


        /* å­èœå•å®¹å™¨ */
        .sub-menu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
            background-color: #f7f9fa;
            padding-left: 15px;
        }

        /* å­èœå•é¡¹æ ·å¼ (ä¸‰çº§) */
        .sub-menu-item {
            padding: 10px 20px 10px 15px;
            cursor: pointer;
            font-size: 14px;
            color: #555;
            transition: background-color 0.2s;
            border-left: 3px solid transparent;
            display: block;
        }

        .sub-menu-item:hover {
            background-color: #e0e7e9;
        }

        /* -----------------------
           3. å†…å®¹åŒºå¡ç‰‡/è¡¨æ ¼æ ·å¼ 
           ----------------------- */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .kpi-card {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
        }

        .kpi-value {
            font-size: 36px;
            font-weight: bold;
            color: #2980b9;
            margin-top: 5px;
        }

        .kpi-title {
            font-size: 14px;
            color: #7f8c8d;
            text-transform: uppercase;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        .data-table th {
            background-color: #f7f9fa;
            font-weight: bold;
            color: #555;
        }

        .btn-primary {
            background-color: #3498db;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }
    </style>
</head>

<body>

    <div class="header">
        <div>ğŸ’° è´¢åŠ¡ç®¡ç†ç³»ç»Ÿ</div>
        <div>
            <span style="font-size: 14px;">æ¬¢è¿, ç®¡ç†å‘˜ | é€€å‡º</span>
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar">

            <input type="text" id="menuSearch" placeholder="æœç´¢ç›®å½•..." onkeyup="filterMenu()">

            <div class="menu-group-title">æ ¸å¿ƒä»ªè¡¨ç›˜</div>
            <div class="menu-item active" onclick="loadContent('Dashboard', this)">æ¦‚è§ˆ/ä»ªè¡¨ç›˜</div>

            <div class="menu-group-title">è´¢åŠ¡ç®¡ç†</div>

            <div class="menu-item collapsed" onclick="toggleSubMenu(this)">ç»“ç®—ç®¡ç†</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('SettlementWaybill', this)">è¿å•ç»“ç®—</div>
                <div class="sub-menu-item" onclick="loadContent('SettlementTrunk', this)">å¹²çº¿æ‰¹æ¬¡ç»“ç®—</div>
                <div class="sub-menu-item" onclick="loadContent('SettlementShortHaul', this)">çŸ­é€”æ‰¹æ¬¡ç»“ç®—</div>
                <div class="sub-menu-item" onclick="loadContent('SettlementRuleConfig', this)">è®¡è´¹è§„åˆ™é…ç½®</div>
            </div>

            <div class="menu-item collapsed" onclick="toggleSubMenu(this)">å¯¹è´¦ç®¡ç†</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('ReconSite', this)">ç½‘ç‚¹å¯¹è´¦</div>
                <div class="sub-menu-item" onclick="loadContent('ReconCustomer', this)">å®¢æˆ·å¯¹è´¦</div>
                <div class="sub-menu-item" onclick="loadContent('ReconCarrier', this)">æ‰¿è¿å•†å¯¹è´¦</div>
                <div class="sub-menu-item" onclick="loadContent('ReconDriver', this)">å¸æœºå¯¹è´¦</div>
                <div class="sub-menu-item" onclick="loadContent('ReconDiffHandle', this)">å¯¹è´¦å·®å¼‚å¤„ç†</div>
            </div>

            <div class="menu-item collapsed" onclick="toggleSubMenu(this)">åº”æ”¶ç®¡ç†</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('ARCustomerStatement', this)">å®¢æˆ·å¯¹è´¦å•åˆ—è¡¨</div>
                <div class="sub-menu-item" onclick="loadContent('ARPrecollection', this)">é¢„æ”¶æ¬¾å•</div>
                <div class="sub-menu-item" onclick="loadContent('ARCollectionVerify', this)">å®¢æˆ·æ”¶æ¬¾æ ¸é”€</div>
                <div class="sub-menu-item" onclick="loadContent('ARAgeAnalysis', this)">å®¢æˆ·è´¦é¾„åˆ†æ</div>
            </div>

            <div class="menu-item collapsed" onclick="toggleSubMenu(this)">åº”ä»˜ç®¡ç†</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('APPaymentApply', this)">ä¾›åº”å•†ä»˜æ¬¾ç”³è¯·</div>
                <div class="sub-menu-item" onclick="loadContent('APPrepayment', this)">é¢„ä»˜æ¬¾å•</div>
                <div class="sub-menu-item" onclick="loadContent('APPaymentVerify', this)">ä»˜æ¬¾æ ¸é”€</div>
                <div class="sub-menu-item" onclick="loadContent('APInvoiceManage', this)">ä¾›åº”å•†å‘ç¥¨ç®¡ç†</div>
            </div>

            <div class="menu-item collapsed" onclick="toggleSubMenu(this)">èµ„é‡‘ä¸èƒ½æºç®¡ç†</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('FundCustomerAcct', this)">å®¢æˆ·èµ„é‡‘è´¦æˆ·</div>
                <div class="sub-menu-item" onclick="loadContent('FundEnergyAcct', this)">èƒ½æºè´¦æˆ·ç®¡ç†</div>
                <div class="sub-menu-item" onclick="loadContent('FundWallet', this)">å¸æœº/ç½‘ç‚¹é’±åŒ…</div>
                <div class="sub-menu-item" onclick="loadContent('FundExecution', this)">æ”¶æ¬¾ä¸ä»˜æ¬¾æ‰§è¡Œ</div>
                <div class="sub-menu-item" onclick="loadContent('FundBankConnect', this)">é“¶ä¼ç›´è”</div>
                <div class="sub-menu-item" onclick="loadContent('FundClearingRule', this)">æ¸…åˆ†ä¸åˆ†è´¦è§„åˆ™</div>
            </div>

            <div class="menu-item collapsed" onclick="toggleSubMenu(this)">è´¹ç”¨æŠ¥é”€</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('ExpenseLoan', this)">å€Ÿæ¬¾å•</div>
                <div class="sub-menu-item" onclick="loadContent('ExpenseRepay', this)">è¿˜æ¬¾å•</div>
                <div class="sub-menu-item" onclick="loadContent('ExpenseDaily', this)">æ—¥å¸¸è´¹ç”¨æŠ¥é”€</div>
                <div class="sub-menu-item" onclick="loadContent('ExpenseTravel', this)">å·®æ—…æŠ¥é”€</div>
                <div class="sub-menu-item" onclick="loadContent('ExpenseCompensation', this)">é…¬é‡‘ç»“ç®—</div>
            </div>

            <div class="menu-item collapsed" onclick="toggleSubMenu(this)">è´¢åŠ¡æŒ‚è´¦</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('PendingWaybill', this)">è¿å•æŒ‚è´¦</div>
                <div class="sub-menu-item" onclick="loadContent('PendingAbnormal', this)">å¼‚åŠ¨æŒ‚è´¦</div>
                <div class="sub-menu-item" onclick="loadContent('PendingOther', this)">å…¶ä»–æŒ‚è´¦</div>
            </div>

        <!--     <div class="menu-item collapsed" onclick="toggleSubMenu(this)">ç¥¨æ®ç¨åŠ¡ç®¡ç†</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('TaxInputInvoice', this)">è¿›é¡¹å‘ç¥¨å°è´¦</div>
                <div class="sub-menu-item" onclick="loadContent('TaxOutputInvoice', this)">é”€é¡¹å‘ç¥¨å°è´¦</div>
                <div class="sub-menu-item" onclick="loadContent('TaxRateConfig', this)">ç¨ç‡é…ç½®</div>
            </div> -->

            <div class="menu-group-title">ç¥¨æ®ç¨åŠ¡ç®¡ç†</div>
            <div class="menu-item collapsed" onclick="toggleSubMenu(this)">å‘ç¥¨ç®¡ç†</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('TaxOutputInvoice', this)">é”€é¡¹å‘ç¥¨å°è´¦</div>
                <div class="sub-menu-item" onclick="alert('è¿›é¡¹æ¨¡å—å¾…å¼€å‘')">è¿›é¡¹å‘ç¥¨å°è´¦</div>
            </div>
        <!--     <div class="menu-item collapsed" onclick="toggleSubMenu(this)">é¢„ç®—ä¸ç»©æ•ˆ</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('BudgetPlanning', this)">é¢„ç®—ç¼–åˆ¶</div>
                <div class="sub-menu-item" onclick="loadContent('BudgetExecutionAnalysis', this)">é¢„ç®—æ‰§è¡Œåˆ†æ</div>
                <div class="sub-menu-item" onclick="loadContent('BudgetPerformance', this)">ç»©æ•ˆè€ƒæ ¸</div>
            </div> -->
            <div class="menu-item collapsed" onclick="toggleSubMenu(this)">é¢„ç®—ä¸ç»©æ•ˆ</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('BudgetPlanning', this)">é¢„ç®—ç¼–åˆ¶</div>
                <div class="sub-menu-item" onclick="loadContent('BudgetExecutionAnalysis', this)">é¢„ç®—æ‰§è¡Œåˆ†æ</div>
                <div class="sub-menu-item" onclick="loadContent('BudgetPerformance', this)">ç»©æ•ˆè€ƒæ ¸</div>
            </div>

            <div class="menu-item collapsed" onclick="toggleSubMenu(this)">é£æ§ä¸æ—¥å¿—</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('RiskSensitiveLog', this)">æ•æ„Ÿæ“ä½œæ—¥å¿—</div>
                <div class="sub-menu-item" onclick="loadContent('RiskRedStamping', this)">çº¢å†²ä¸åç»“è´¦è®°å½•</div>
                <div class="sub-menu-item" onclick="loadContent('RiskDataChange', this)">æ•°æ®å˜æ›´æ˜ç»†</div>
            </div>


            <div class="menu-group-title">ä¼šè®¡æ ¸ç®—</div>

            <div class="menu-item collapsed" onclick="toggleSubMenu(this)">ä¼šè®¡åŸºç¡€</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('AcctSubject', this)">ä¼šè®¡ç§‘ç›®</div>
                <div class="sub-menu-item" onclick="loadContent('AcctSet', this)">ä¼šè®¡è´¦å¥—</div>

                <div class="sub-menu-item" onclick="loadContent('AcctPeriod', this)">ä¼šè®¡æœŸé—´</div>

                <div class="sub-menu-item" onclick="loadContent('AcctAuxiliary', this)">è¾…åŠ©æ ¸ç®—é¡¹</div>
                <div class="sub-menu-item" onclick="loadContent('AcctRule', this)">è®°è´¦è§„åˆ™</div>
            </div>

            <div class="menu-item collapsed" onclick="toggleSubMenu(this)">å›ºå®šèµ„äº§ç®¡ç†</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('AssetCard', this)">èµ„äº§å¡ç‰‡</div>
                <div class="sub-menu-item" onclick="loadContent('AssetDepreciation', this)">æŠ˜æ—§è®¡ç®—</div>
                <div class="sub-menu-item" onclick="loadContent('AssetChange', this)">èµ„äº§å˜åŠ¨</div>
            </div>

            <div class="menu-item collapsed" onclick="toggleSubMenu(this)">å‡­è¯ç®¡ç†</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('VoucherEntryReview', this)">å‡­è¯å½•å…¥</div>
                <div class="sub-menu-item" onclick="loadContent('VoucherQueryPrint', this)">å‡­è¯æŸ¥è¯¢/å®¡æ ¸</div>
                <div class="sub-menu-item" onclick="loadContent('AcctSubjectSummary', this)">ç§‘ç›®æ±‡æ€»è¡¨</div>
            </div>

            <div class="menu-item collapsed" onclick="toggleSubMenu(this)">ä¼šè®¡å¼•æ“</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('EngineMapping', this)">ä¸šåŠ¡å•æ®æ˜ å°„é…ç½®</div>
                <div class="sub-menu-item" onclick="loadContent('EngineTemplate', this)">è‡ªåŠ¨åˆ†å½•æ¨¡æ¿</div>
                <div class="sub-menu-item" onclick="loadContent('EngineLog', this)">å‡­è¯ç”Ÿæˆæ—¥å¿—</div>
            </div>

            <div class="menu-item collapsed" onclick="toggleSubMenu(this)">æœŸæœ«å¤„ç†</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('PeriodEndProfit', this)">ç»“è½¬æŸç›Š</div>
                <div class="sub-menu-item" onclick="loadContent('PeriodEndClose', this)">æœˆæœ«ç»“è´¦/é”å®š</div>
            </div>


            <div class="menu-group-title">æ•°æ®æŠ¥è¡¨</div>

            <div class="menu-item collapsed" onclick="toggleSubMenu(this)">æ³•å®šæŠ¥è¡¨</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('ReportBalanceSheet', this)">èµ„äº§è´Ÿå€ºè¡¨</div>
                <div class="sub-menu-item" onclick="loadContent('ReportIncomeStatement', this)">åˆ©æ¶¦æŸç›Šè¡¨</div>
                <div class="sub-menu-item" onclick="loadContent('ReportCashFlow', this)">ç°é‡‘æµé‡è¡¨</div>
                <div class="sub-menu-item" onclick="loadContent('ReportOtherStatutory', this)">å…¶ä»–æŠ¥è¡¨</div>
            </div>

            <div class="menu-item collapsed" onclick="toggleSubMenu(this)">ç®¡ç†æŠ¥è¡¨</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('ReportVehicleProfit', this)">å•è½¦çº¿è·¯ç›ˆäºåˆ†æ</div>
                <div class="sub-menu-item" onclick="loadContent('ReportCustomerProfit', this)">å®¢æˆ·æ¯›åˆ©åˆ†æ</div>
                <div class="sub-menu-item" onclick="loadContent('ReportARAPAge', this)">åº”æ”¶åº”ä»˜è´¦é¾„åˆ†æ</div>
            </div>


        <!--     <div class="menu-group-title">é“¶ä¼ç›´è”</div>
            <div class="menu-item collapsed" onclick="toggleSubMenu(this)">é“¶ä¼ç›´è”åŠŸèƒ½</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('BankStatementSync', this)">é“¶è¡Œå¯¹è´¦å•åŒæ­¥</div>
                <div class="sub-menu-item" onclick="loadContent('OnlinePayment', this)">çº¿ä¸Šæ”¯ä»˜/ä»£æ”¶ä»˜</div>
                <div class="sub-menu-item" onclick="loadContent('BankBalanceQuery', this)">é“¶è¡Œä½™é¢å®æ—¶æŸ¥è¯¢</div>
            </div> -->
            <div class="menu-group-title">åŸºç¡€èµ„æ–™</div>
            <div class="menu-item collapsed" onclick="toggleSubMenu(this)">å¾€æ¥å•ä½</div>
            <div class="sub-menu">
                <div class="sub-menu-item" onclick="loadContent('BaseCustomer', this)">å®¢æˆ·æ¡£æ¡ˆ</div>
                <div class="sub-menu-item" onclick="">ä¾›åº”å•†æ¡£æ¡ˆ</div> </div>

            <div class="menu-group-title">è®¾ç½®</div>
            <div class="menu-item" onclick="loadContent('BasicSetup', this)">åŸºç¡€è®¾ç½®</div>
            <div class="menu-item" onclick="loadContent('Permission', this)">æƒé™ç®¡ç†</div>
            <div class="menu-item" onclick="loadContent('SystemLog', this)">ç³»ç»Ÿæ—¥å¿—</div>

        </div>

        <div class="content-area" id="content-area">
            </div>
    </div>

   <script>
    /**
     * æ ¸å¿ƒè¾…åŠ©ï¼šè¿½åŠ ã€æ•°æ®å˜æ›´ã€‘æ—¥å¿—
     */
    function addDataChangeLog(changeLog) {
        // 1. è¯»å–ç°æœ‰æ—¥å¿—
        let logs = JSON.parse(sessionStorage.getItem('GlobalDataChangeLogs') || "[]");
        // 2. è¿½åŠ æ–°æ—¥å¿—åˆ°æœ€å‰é¢
        logs.unshift(changeLog);
        // 3. ä¿å­˜
        sessionStorage.setItem('GlobalDataChangeLogs', JSON.stringify(logs));
    }



    // --- å…¨å±€å˜é‡ï¼šç”¨äºåœ¨åˆ—è¡¨é¡µå’Œè¯¦æƒ…é¡µä¹‹é—´ä¼ æ•°æ® ---
     var g_currentVoucher = null;

        // =========================================================================
// æ ¸å¿ƒä¿®å¤ï¼šè¾…åŠ©å‡½æ•°å¿…é¡»å®šä¹‰åœ¨loadContentè°ƒç”¨ä¹‹å‰
// =========================================================================


/**
     * æ ¸å¿ƒè¾…åŠ©ï¼šè¿½åŠ å®¡è®¡æ—¥å¿—åˆ°å­˜å‚¨ (æ”¯æŒå¤šæ¡å…±å­˜)
     */
    function addAuditLog(newLog) {
        // 1. è¯»å–ç°æœ‰çš„æ—¥å¿—åˆ—è¡¨ (å¦‚æœä¸ºç©ºï¼Œå°±åˆå§‹åŒ–ä¸ºç©ºæ•°ç»„)
        let logs = JSON.parse(sessionStorage.getItem('GlobalAuditLogs') || "[]");
        
        // 2. æŠŠæ–°æ—¥å¿—åŠ åˆ°æœ€å‰é¢ (unshift)
        logs.unshift(newLog);
        
        // 3. ä¿å­˜å› Session
        sessionStorage.setItem('GlobalAuditLogs', JSON.stringify(logs));
    }



/**
 * è¾…åŠ©å‡½æ•°ï¼šç”¨äºç”Ÿæˆå¸¦æ•°æ®å¾ªç¯çš„è¡¨æ ¼è¡Œ (ä¿®å¤ç¼ºå¤±)
 * @param {number} count - ç”Ÿæˆçš„è¡Œæ•°
 * @param {function(index): string} rowGenerator - è¿”å›å•è¡ŒHTMLå†…å®¹çš„å‡½æ•°
 * @returns {string} - åŒ…å«æ‰€æœ‰è¡¨æ ¼è¡Œçš„HTMLå­—ç¬¦ä¸²
 */
function generateTableRows(count, rowGenerator) {
    let rows = '';
    for (let i = 1; i <= count; i++) {
        rows += rowGenerator(i);
    }
    return rows;
}
        
        /**
         * åˆå§‹åŒ–æ‰€æœ‰ä¸»èœå•é¡¹ä¸ºæŠ˜å çŠ¶æ€ (åªåœ¨é¡µé¢åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡)
         */
        function initializeMenuState() {
            document.querySelectorAll('.sidebar .sub-menu').forEach(subMenu => {
                // ç¡®ä¿å­èœå•é«˜åº¦ä¸º 0
                subMenu.style.maxHeight = "0";
            });
            document.querySelectorAll('.sidebar .menu-item').forEach(menuItem => {
                 // ç¡®ä¿æ‰€æœ‰èœå•é¡¹éƒ½æœ‰ collapsed ç±»ï¼Œä¸”ç§»é™¤ expanded ç±»
                 menuItem.classList.remove('expanded');
                 if (!menuItem.classList.contains('dashboard-item')) {
                    menuItem.classList.add('collapsed');
                 }
            });
        }
        
        /**
         * åˆ‡æ¢ä¸»èœå•é¡¹çš„å­èœå•æ˜¾ç¤º/éšè—
         */
        function toggleSubMenu(element) {
            const subMenu = element.nextElementSibling;
            
            // ç¡®ä¿å­èœå•å­˜åœ¨ï¼Œå¹¶ä¸”å®ƒæ˜¯ä¸€ä¸ª sub-menu div
            if (subMenu && subMenu.classList.contains('sub-menu')) {
                // åˆ‡æ¢å±•å¼€/æŠ˜å çŠ¶æ€
                if (element.classList.contains('collapsed')) {
                    // å±•å¼€
                    element.classList.remove('collapsed');
                    element.classList.add('expanded');
                    subMenu.style.maxHeight = subMenu.scrollHeight + "px";
                } else {
                    // æŠ˜å 
                    element.classList.remove('expanded');
                    element.classList.add('collapsed');
                    subMenu.style.maxHeight = "0";
                }
            }
            
            // æ¿€æ´»/åæ¿€æ´»èœå•é¡¹ (ç‚¹å‡»ä¸»èœå•é¡¹æ—¶ï¼Œä¸åº”è¯¥æ¿€æ´»å®ƒï¼Œé™¤éå®ƒæ²¡æœ‰å­èœå•)
            if (!subMenu || !subMenu.classList.contains('sub-menu')) {
                 const currentActive = document.querySelector('.sidebar .active');
                 if (currentActive) {
                      currentActive.classList.remove('active');
                 }
                 element.classList.add('active');
            }
        }

        /**
         * ç›®å½•æœç´¢/è¿‡æ»¤åŠŸèƒ½
         */
        function filterMenu() {
            const input = document.getElementById('menuSearch');
            const filter = input.value.toUpperCase().trim();
            const menuGroups = document.querySelectorAll('.sidebar > .menu-group-title');

            if (filter === '') {
                // æœç´¢æ¡†æ¸…ç©ºæ—¶ï¼Œæ¢å¤åˆ°é»˜è®¤çš„æŠ˜å çŠ¶æ€å’Œå¯è§æ€§
                initializeMenuState();
                
                document.querySelectorAll('.sidebar .menu-item, .sidebar .menu-group-title').forEach(item => item.style.display = 'block');
                document.querySelectorAll('.sidebar .sub-menu-item').forEach(item => item.style.display = 'block');
                
                return;
            }

            // éå†æ‰€æœ‰èœå•ç»„è¿›è¡Œæœç´¢
            menuGroups.forEach(group => {
                let groupVisible = false;
                let nextElement = group.nextElementSibling;

                // éå†ç»„å†…çš„æ‰€æœ‰ä¸»èœå•é¡¹ (menu-item)
                while (nextElement && !nextElement.classList.contains('menu-group-title') && nextElement.classList.contains('menu-item')) {
                    const menuItem = nextElement;
                    const subMenu = menuItem.nextElementSibling;
                    let mainMatch = false;
                    
                    // 1. æ£€æŸ¥ä¸»èœå•é¡¹æ–‡æœ¬æ˜¯å¦åŒ¹é…
                    const mainText = menuItem.textContent.toUpperCase();
                    if (mainText.indexOf(filter) > -1) {
                        mainMatch = true;
                    }

                    // 2. æ£€æŸ¥å­èœå•æ˜¯å¦åŒ¹é…
                    let subItemVisible = false;
                    if (subMenu && subMenu.classList.contains('sub-menu')) {
                        subMenu.querySelectorAll('.sub-menu-item').forEach(subItem => {
                            const subText = subItem.textContent.toUpperCase();
                            if (subText.indexOf(filter) > -1) {
                                subItem.style.display = 'block';
                                subItemVisible = true;
                            } else {
                                subItem.style.display = 'none';
                            }
                        });
                    }
                    
                    // 3. ç¡®å®šèœå•é¡¹çš„æœ€ç»ˆå¯è§æ€§
                    if (mainMatch || subItemVisible) {
                        menuItem.style.display = 'block';
                        groupVisible = true;

                        // æœç´¢åŒ¹é…æ—¶ï¼Œå¼ºåˆ¶å±•å¼€è¯¥èœå•é¡¹
                        if (subMenu && subMenu.classList.contains('sub-menu')) {
                            menuItem.classList.remove('collapsed');
                            menuItem.classList.add('expanded');
                            subMenu.style.maxHeight = subMenu.scrollHeight + "px";
                        }
                        // å¦‚æœæ˜¯ä¸»èœå•åŒ¹é…ï¼Œç¡®ä¿å­èœå•é¡¹å…¨éƒ¨å¯è§
                        if (mainMatch && subMenu) {
                             subMenu.querySelectorAll('.sub-menu-item').forEach(subItem => subItem.style.display = 'block');
                        }

                    } else {
                        // ä¸åŒ¹é…ï¼Œéšè—
                        menuItem.style.display = 'none';
                        if (subMenu) {
                            menuItem.classList.remove('expanded');
                            menuItem.classList.add('collapsed');
                            subMenu.style.maxHeight = "0";
                        }
                    }

                    // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªä¸»èœå•é¡¹ï¼Œè·³è¿‡å­èœå•å®¹å™¨
                    nextElement = subMenu && subMenu.classList.contains('sub-menu') ? subMenu.nextElementSibling : menuItem.nextElementSibling;
                }

                // æ ¹æ®ç»„å†…æ˜¯å¦æœ‰å¯è§é¡¹æ¥æ˜¾ç¤º/éšè—ç»„æ ‡é¢˜
                group.style.display = groupVisible ? 'block' : 'none';
            });

            // ç¡®ä¿æ¦‚è§ˆ/ä»ªè¡¨ç›˜ä¹Ÿèƒ½è¢«æœç´¢
            const dashboardItem = document.querySelector('.sidebar > .menu-item.dashboard-item');
            if (dashboardItem) {
                const dashboardText = dashboardItem.textContent.toUpperCase();
                dashboardItem.style.display = (dashboardText.indexOf(filter) > -1) ? 'block' : 'none';
            }
        }


        /**
         * åŠ è½½å†…å®¹åˆ°å†…å®¹åŒºï¼Œå¹¶æ›´æ–°èœå•æ¿€æ´»çŠ¶æ€
         */
        function loadContent(moduleCode, element = null) {
            const contentArea = document.getElementById('content-area');
            const allItems = document.querySelectorAll('.menu-item, .sub-menu-item');

            allItems.forEach(item => item.classList.remove('active'));

            if (element) {
                element.classList.add('active');
            } else {
                const defaultItem = document.querySelector(`.menu-item[onclick*="'${moduleCode}'"]`);
                if (defaultItem) defaultItem.classList.add('active');
            }

            let contentHTML = `<h2>${getModuleName(moduleCode)}</h2>`;

            // =========================================================================
            // æ ¸å¿ƒé¡µé¢é€»è¾‘å¼€å§‹
            // =========================================================================
            
            if (moduleCode === 'Dashboard') {
                contentHTML += `
                    <p>æ¬¢è¿å›æ¥ï¼Œè¿™æ˜¯æ‚¨çš„è´¢åŠ¡æ¦‚è§ˆä»ªè¡¨ç›˜ã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¿«é€ŸæŸ¥çœ‹å…³é”®è´¢åŠ¡æŒ‡æ ‡ã€‚</p>
                    <div class="dashboard-grid">
                        <div class="kpi-card"><div class="kpi-title">æœ¬æœˆæ”¶å…¥ (RMB)</div><div class="kpi-value">1,250,000.00</div></div>
                        <div class="kpi-card"><div class="kpi-title">æœ¬æœˆæ”¯å‡º (RMB)</div><div class="kpi-value" style="color:#e74c3c;">480,000.00</div></div>
                        <div class="kpi-card"><div class="kpi-title">ç°é‡‘ä½™é¢ (RMB)</div><div class="kpi-value">7,800,000.00</div></div>
                        <div class="kpi-card"><div class="kpi-title">åº”æ”¶è´¦æ¬¾ (RMB)</div><div class="kpi-value" style="color:#f39c12;">950,000.00</div></div>
                    </div>
                    
                    <h3>å¾…å¤„ç†äº‹é¡¹</h3>
                    <table class="data-table">
                        <thead>
                            <tr><th>äº‹é¡¹</th><th>æ—¥æœŸ</th><th>é‡‘é¢</th><th>æ“ä½œ</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>å¾…å®¡æ ¸å‡­è¯ (å‡­è¯å½•å…¥)</td><td>2025-11-20</td><td>-</td><td><button class="btn-primary">å»å®¡æ ¸</button></td></tr>
                            <tr><td>é“¶è¡Œæµæ°´æœªå¯¹è´¦ (é“¶è¡Œå¯¹è´¦å•åŒæ­¥)</td><td>2025-11-19</td><td>Â¥150,000</td><td><button class="btn-primary">å¯¹è´¦</button></td></tr>
                            <tr><td>é¢„ç®—è¶…æ”¯é¢„è­¦ (é¢„ç®—æ‰§è¡Œåˆ†æ)</td><td>2025-11-15</td><td>-</td><td><button class="btn-primary">æŸ¥çœ‹</button></td></tr>
                        </tbody>
                    </table>
                `;
            } 
            
// =========================================================================
            // 1. è¿å•ç»“ç®— (SettlementWaybill) - [é€»è¾‘ä¿®æ­£ç‰ˆï¼šæ‰‹åŠ¨ç»“ç®— + é€€æ¬¾éš”ç¦»]
            // =========================================================================
            else if (moduleCode === 'SettlementWaybill') {
                
                let waybills = JSON.parse(sessionStorage.getItem('BizWaybills'));
                if (!waybills) {
                    // â˜…â˜…â˜… ä¿®æ­£ï¼šé»˜è®¤å…¨æ˜¯â€œå¾…ç»“ç®—â€ï¼Œæ¨¡æ‹ŸçœŸå®ä¸šåŠ¡åœºæ™¯ â˜…â˜…â˜…
                    waybills = [
                        { id: 'YD202511001', client: 'é˜³å…‰åˆ¶é€ ', date: '2025-11-18', amount: '1200.00', status: 'å¾…ç»“ç®—', details: {'è¿è´¹':1200} },
                        { id: 'YD202511002', client: 'å¼ ä¸‰ä¸ªäºº', date: '2025-11-19', amount: '500.00', status: 'å¾…ç»“ç®—', details: {'è¿è´¹':400, 'æè´§è´¹':100} },
                        { id: 'YD202511003', client: 'EASYè´¸æ˜“', date: '2025-11-19', amount: '2.00', status: 'å¾…ç»“ç®—', details: {'è¿è´¹':2500} }
                    ];
                    sessionStorage.setItem('BizWaybills', JSON.stringify(waybills));
                }

                const rows = waybills.map(w => {
                    const isPending = w.status === 'å¾…ç»“ç®—';
                    const isSettled = w.status === 'å·²ç»“ç®—';
                    const isRefundBill = w.amount.toString().includes('-'); 
                    
                    let statusColor = '#333';
                    let action = '';

                    if (isPending) {
                        statusColor = '#f39c12'; // é»„è‰²
                        // åªæœ‰å¾…ç»“ç®—çš„æ‰èƒ½ç»“ç®—
                        action = `<a href="javascript:void(0)" onclick="settleWaybill('${w.id}')" style="color:#27ae60; font-weight:bold;">è®¡ç®—è´¹ç”¨</a>`;
                    } else if (isSettled) {
                        statusColor = '#27ae60'; // ç»¿è‰²
                        
                        if (!isRefundBill) {
                            // æ­£æ•°å·²ç»“ç®—å•æ® -> å¯ä»¥é€€æ¬¾
                            action = `<a href="javascript:void(0)" onclick="handlePartRefund('${w.id}')" style="color:#e74c3c;">å¼‚å¸¸é€€æ¬¾</a>`;
                        } else {
                            // è´Ÿæ•°é€€æ¬¾å• -> ä»…å±•ç¤ºï¼Œä¸å¯æ“ä½œ
                            action = `<span style="color:#c0392b; font-size:12px;">(é€€æ¬¾æŠµæ‰£é¡¹)</span>`;
                        }
                    } else {
                        statusColor = '#3498db';
                        action = `<span style="color:#ccc;">å·²å…¥è´¦å•</span>`;
                    }

                    const rowStyle = isRefundBill ? 'background-color:#fff0f0; color:#c0392b;' : '';

                    return `<tr style="${rowStyle}">
                        <td><input type="checkbox" ${isSettled ? 'checked' : 'disabled'}></td>
                        <td>${w.id}</td>
                        <td>${w.client}</td>
                        <td>${w.date}</td>
                        <td style="text-align:right; font-weight:bold;">${w.amount}</td>
                        <td><span style="color:${statusColor}; font-weight:bold;">${w.status}</span></td>
                        <td>${action}</td>
                    </tr>`;
                }).join('');

                contentHTML += `
                    <h2>è¿å•ç»“ç®— (Waybill Settlement)</h2>
                    <p style="color:#7f8c8d;">æµç¨‹ï¼šç‚¹å‡»â€œè®¡ç®—è´¹ç”¨â€è¿›è¡Œç»“ç®— -> ç»“ç®—åå¯è¿›è¡Œâ€œå¼‚å¸¸é€€æ¬¾â€ -> æœ€åç”Ÿæˆå¯¹è´¦å•ã€‚</p>
                    
                    <div class="filter-area" style="background:white;padding:15px;margin-bottom:20px;">
                        <button class="btn-primary" onclick="loadContent('SettlementWaybill')">åˆ·æ–°åˆ—è¡¨</button>
                        <button class="btn-primary" style="background-color: #2980b9; margin-left:10px;" onclick="createReconBill()">+ ç”Ÿæˆå¯¹è´¦å• (å«æŠµæ‰£)</button>
                    </div>

                    <table class="data-table">
                        <thead><tr><th>é€‰</th><th>è¿å•å·</th><th>å®¢æˆ·</th><th>æ—¥æœŸ</th><th style="text-align:right;">é‡‘é¢</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr></thead>
                        <tbody>${rows}</tbody>
                    </table>
                `;
            }

            // =========================================================================
            // å¹²çº¿æ‰¹æ¬¡ç»“ç®— (Settlement Trunk)
            // =========================================================================
            else if (moduleCode === 'SettlementTrunk') {
                contentHTML += `
                    <h2>å¹²çº¿æ‰¹æ¬¡ç»“ç®—</h2>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="æ‰¹æ¬¡å· / æ‰¿è¿å•†åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">è·¯çº¿/çº¿è·¯ (å…¨éƒ¨)</option>
                                <option>åä¸œ-åå—å¹²çº¿</option>
                                <option>ååŒ—-åä¸­å¹²çº¿</option>
                            </select>
                            <input type="date" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">ç»“ç®—çŠ¶æ€ (å…¨éƒ¨)</option>
                                <option>å¾…è®¡ç®—</option>
                                <option>å¾…æ ¸é”€</option>
                                <option>å·²æ ¸ç®—</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #2980b9;">æ‰¹é‡è®¡ç®—è´¹ç”¨</button>
                        <button class="btn-primary" style="background-color: #f1c40f;">ç”Ÿæˆåº”ä»˜å•</button>
                        <button style="background-color: #34495e; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;">å¯¼å‡ºåˆ—è¡¨</button>
                    </div>

                    <h3>å¹²çº¿æ‰¹æ¬¡åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æ‰¹æ¬¡å·</th>
                                <th>æ‰¿è¿å•†</th>
                                <th>è·¯çº¿</th>
                                <th>å‘è½¦æ—¥æœŸ</th>
                                <th>è¿å•æ•°</th>
                                <th>çŠ¶æ€</th>
                                <th>é¢„è®¡è´¹ç”¨ (RMB)</th>
                                <th>å®é™…è´¹ç”¨ (RMB)</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>TX202511001</td>
                                <td>ç”²ç‰©æµ</td>
                                <td>æ²ª-æ·±</td>
                                <td>2025-11-15</td>
                                <td>45</td>
                                <td><span style="color: #c0392b;">å¾…è®¡ç®—</span></td>
                                <td>-</td>
                                <td>-</td>
                                <td><a href="#" style="color:#2980b9;">è®¡ç®—è´¹ç”¨</a></td>
                            </tr>
                            <tr>
                                <td>TX202511002</td>
                                <td>ä¹™è¿è¾“</td>
                                <td>äº¬-æ­¦</td>
                                <td>2025-11-16</td>
                                <td>32</td>
                                <td><span style="color: #27ae60;">å·²æ ¸ç®—</span></td>
                                <td>25,000.00</td>
                                <td>25,120.00</td>
                                <td><a href="#" style="color:#3498db;">è¯¦æƒ…/æ ¸é”€</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // çŸ­é€”æ‰¹æ¬¡ç»“ç®— (Settlement Short Haul)
            // =========================================================================
            else if (moduleCode === 'SettlementShortHaul') {
                contentHTML += `
                    <h2>çŸ­é€”æ‰¹æ¬¡ç»“ç®—</h2>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="æ‰¹æ¬¡å· / å¸æœºå§“å" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">é…é€åŒºåŸŸ (å…¨éƒ¨)</option>
                                <option>ä¸Šæµ·å¸‚åŒº</option>
                                <option>å¹¿å·å‘¨è¾¹</option>
                            </select>
                            <input type="date" placeholder="é…é€æ—¥æœŸ" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">ç»“ç®—ç±»å‹</option>
                                <option>æè´§è´¹</option>
                                <option>æ´¾é€è´¹</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #2980b9;">æ‰¹é‡ç¡®è®¤è´¹ç”¨</button>
                        <button class="btn-primary" style="background-color: #f1c40f;">ç”Ÿæˆé…¬é‡‘å•</button>
                        <button style="background-color: #34495e; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;">å¯¼å‡ºåˆ—è¡¨</button>
                    </div>

                    <h3>çŸ­é€”æ‰¹æ¬¡åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æ‰¹æ¬¡å·</th>
                                <th>å¸æœº/ç½‘ç‚¹</th>
                                <th>é…é€åŒºåŸŸ</th>
                                <th>è¿å•æ•°é‡</th>
                                <th>ç»“ç®—ç±»å‹</th>
                                <th>çŠ¶æ€</th>
                                <th>è®¡ç®—è´¹ç”¨ (RMB)</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>SD202511005</td>
                                <td>å¸æœºå¼ ä¸‰</td>
                                <td>ä¸Šæµ·å¸‚åŒº</td>
                                <td>15</td>
                                <td>æ´¾é€è´¹</td>
                                <td><span style="color: #f39c12;">å¾…ç¡®è®¤</span></td>
                                <td>950.00</td>
                                <td><a href="#" style="color:#3498db;">æ ¸å¯¹</a> | <a href="#" style="color:#27ae60;">ç¡®è®¤</a></td>
                            </tr>
                            <tr>
                                <td>SD202511006</td>
                                <td>ç½‘ç‚¹B</td>
                                <td>å¹¿å·å‘¨è¾¹</td>
                                <td>8</td>
                                <td>æè´§è´¹</td>
                                <td><span style="color: #27ae60;">å·²ç¡®è®¤</span></td>
                                <td>500.00</td>
                                <td><a href="#" style="color:#3498db;">è¯¦æƒ…</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // è®¡è´¹è§„åˆ™é…ç½® (Settlement Rule Config)
            // =========================================================================
            else if (moduleCode === 'SettlementRuleConfig') {
                contentHTML += `
                    <h2>è®¡è´¹è§„åˆ™é…ç½®</h2>
                    <p style="color: #7f8c8d;">ç®¡ç†ç³»ç»Ÿç”¨äºè‡ªåŠ¨è®¡ç®—è¿å•ã€æ‰¹æ¬¡è´¹ç”¨çš„è§„åˆ™æ¨¡æ¿ã€‚ä¿®æ”¹è§„åˆ™å°†å½±å“æœªæ¥çš„ç»“ç®—æ•°æ®ã€‚</p>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ æ–°å¢è®¡è´¹è§„åˆ™</button>
                        <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; margin-left: 10px;">
                            <option value="">æŒ‰ç±»å‹ç­›é€‰</option>
                            <option>å¹²çº¿è¿è´¹</option>
                            <option>æ´¾é€è´¹</option>
                            <option>å¢å€¼æœåŠ¡è´¹</option>
                        </select>
                    </div>

                    <h3>å½“å‰è®¡è´¹è§„åˆ™åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>è§„åˆ™åç§°</th>
                                <th>è®¡è´¹ç±»å‹</th>
                                <th>ç”Ÿæ•ˆæ—¥æœŸ</th>
                                <th>çŠ¶æ€</th>
                                <th>æè¿°/å…¬å¼</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>å¹²çº¿æ ‡å‡†è´¹ç‡ V1.1</td>
                                <td>å¹²çº¿è¿è´¹</td>
                                <td>2025-10-01</td>
                                <td><span style="color: #27ae60;">ç”Ÿæ•ˆä¸­</span></td>
                                <td>æŒ‰é‡é‡/ä½“ç§¯*è·ç¦» (åˆ†æ®µé˜¶æ¢¯è®¡è´¹)</td>
                                <td><a href="#" style="color:#3498db;">ç¼–è¾‘</a> | <a href="#" style="color:#e74c3c;">åœç”¨</a></td>
                            </tr>
                            <tr>
                                <td>å¸‚åŒºæ´¾é€è´¹ V2.0</td>
                                <td>æ´¾é€è´¹</td>
                                <td>2025-11-01</td>
                                <td><span style="color: #27ae60;">ç”Ÿæ•ˆä¸­</span></td>
                                <td>æŒ‰åŒºåŸŸ+ä»¶æ•° (ä¿åº•è´¹ç”¨)</td>
                                <td><a href="#" style="color:#3498db;">ç¼–è¾‘</a> | <a href="#" style="color:#e74c3c;">åœç”¨</a></td>
                            </tr>
                             <tr>
                                <td>ç‡ƒæ²¹é™„åŠ è´¹ V1.0</td>
                                <td>é™„åŠ è´¹</td>
                                <td>2025-01-01</td>
                                <td><span style="color: #f39c12;">å·²åœç”¨</span></td>
                                <td>åŸºç¡€è´¹ç‡ * 2%</td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹</a> | <a href="#" style="color:#27ae60;">å¯ç”¨</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }
            
// =========================================================================
            // 2. ç½‘ç‚¹å¯¹è´¦ (ReconSite) - [æ•°æ®æºå¤´2]
            // =========================================================================
            else if (moduleCode === 'ReconSite') {
                
                let recons = JSON.parse(sessionStorage.getItem('BizRecons'));
                if (!recons) {
                    recons = [
                        { id: 'DZ-WD001', site: 'ä¸Šæµ·è™¹æ¡¥ç½‘ç‚¹', period: '2025-11', amount: '15,000.00', status: 'å¾…ç¡®è®¤' },
                        { id: 'DZ-WD002', site: 'åŒ—äº¬æœé˜³ç½‘ç‚¹', period: '2025-11', amount: '8,000.00', status: 'å·²ç¡®è®¤' }
                    ];
                    sessionStorage.setItem('BizRecons', JSON.stringify(recons));
                }

                const rows = recons.map(r => {
                    const isPending = r.status === 'å¾…ç¡®è®¤';
                    const action = isPending 
                        ? `<a href="javascript:void(0)" onclick="confirmSettlement('recon', '${r.id}', '${r.site}', '${r.amount}')" style="color:#27ae60; font-weight:bold;">ç¡®è®¤å¯¹è´¦å¹¶å¼€ç¥¨</a>`
                        : `<span style="color:#ccc;">å·²æ¨é€åˆ°ç¨åŠ¡</span>`;

                    return `<tr>
                        <td>${r.id}</td>
                        <td>${r.site}</td>
                        <td>${r.period}</td>
                        <td style="text-align:right;">${r.amount}</td>
                        <td><span style="color:${isPending?'#f39c12':'#27ae60'}">${r.status}</span></td>
                        <td>${action}</td>
                    </tr>`;
                }).join('');

                contentHTML += `
                    <h2>ç½‘ç‚¹å¯¹è´¦ (Site Reconciliation)</h2>
                    <p style="color:#7f8c8d;">å¯¹è´¦æºå¤´ï¼šç¡®è®¤ç½‘ç‚¹å¾€æ¥é‡‘é¢ï¼Œéœ€å¼€ç¥¨éƒ¨åˆ†è‡ªåŠ¨æ¨é€ã€‚</p>
                    <table class="data-table">
                        <thead><tr><th>å¯¹è´¦å•å·</th><th>ç½‘ç‚¹åç§°</th><th>æœŸé—´</th><th style="text-align:right;">é‡‘é¢</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr></thead>
                        <tbody>${rows}</tbody>
                    </table>
                `;
            }      
            

else if (moduleCode === 'ReconCustomer') {
    let recons = JSON.parse(sessionStorage.getItem('CustomerRecons'));
    if (!recons) {
        recons = [
            /* { 
                id: 'DZ202511-001', 
                client: 'é˜³å…‰åˆ¶é€ æœ‰é™å…¬å¸', 
                period: '2025-11', 
                amount: '1200.00', 
                status: 'å¾…å®¢æˆ·ç¡®è®¤',
                details: [ // é»˜è®¤æ˜ç»†
                    { waybillId: 'YD202511001', date: '2025-11-18', amount: '50,000.00' },
                    { waybillId: 'YD202511002', date: '2025-11-19', amount: '50,000.00' }
                ]
            }, */
            { 
                id: 'DZ202511-002', 
                client: 'EASYè´¸æ˜“å…¬å¸', 
                period: '2025-11', 
                amount: '2.00', 
                status: 'å·²ç¡®è®¤',
                details: [
                    { waybillId: 'YD202511003', date: '2025-11-20', amount: '2.00' }
                ]
            }
        ];
        sessionStorage.setItem('CustomerRecons', JSON.stringify(recons));
    }

  const rows = recons.map(r => {
    let statusColor = '#333';
    let action = '';

    if (r.status === 'å¾…å®¢æˆ·ç¡®è®¤') {
        statusColor = '#f39c12'; // é»„è‰²
        // â˜…â˜…â˜… ä¿®æ”¹ç‚¹ï¼šå¢åŠ â€œé©³å›â€æŒ‰é’® â˜…â˜…â˜…
        action = `
            <a href="javascript:void(0)" onclick="confirmRecon('${r.id}')" style="color:#27ae60; font-weight:bold;">ç¡®è®¤</a> | 
            <a href="javascript:void(0)" onclick="rejectRecon('${r.id}')" style="color:#e74c3c;">é©³å›</a>
        `;
    } 
    else if (r.status === 'å·²é©³å›') {
        statusColor = '#c0392b'; // çº¢è‰²
        // â˜…â˜…â˜… ä¿®æ”¹ç‚¹ï¼šé©³å›åå…è®¸è´¢åŠ¡â€œé‡æ–°æäº¤â€ â˜…â˜…â˜…
        action = `
            <span style="color:#999; font-size:12px;">åŸå› : ${r.rejectReason || 'æ— '}</span><br>
            <a href="javascript:void(0)" onclick="resubmitRecon('${r.id}')" style="color:#3498db;">ä¿®æ­£å¹¶é‡æ</a>
        `;
    }
    else if (r.status === 'å·²ç¡®è®¤') {
        statusColor = '#27ae60';
        action = `<button onclick="applyInvoiceFromRecon('${r.id}', '${r.client}', '${r.amount}')" class="btn-primary" style="padding:4px 8px; font-size:12px;">ç”³è¯·å¼€ç¥¨</button>`;
    } 
    else if (r.status === 'å¼€ç¥¨ä¸­' || r.status === 'å·²å¼€ç¥¨') {
        statusColor = '#999';
        action = `<span style="color:#ccc">å·²æ¨é€åˆ°ç¨åŠ¡</span>`;
    }

    const detailBtn = `<a href="javascript:void(0)" onclick="viewReconDetail('${r.id}')" style="color:#3498db; margin-left:5px;">æ˜ç»†</a>`;

    return `<tr>
        <td>${r.id}</td>
        <td>${r.client}</td>
        <td>${r.period}</td>
        <td style="text-align:right; font-weight:bold;">${r.amount}</td>
        <td><span style="color:${statusColor}; font-weight:bold;">${r.status}</span></td>
        <td>${action} ${detailBtn}</td>
    </tr>`;
}).join('');
    contentHTML += `
        <h2>å®¢æˆ·å¯¹è´¦ (Customer Reconciliation)</h2>
        <p style="color: #7f8c8d;">æ ‡å‡†æµç¨‹ï¼šç”Ÿæˆå¯¹è´¦å• â†’ ç­‰å¾…å®¢æˆ·ç¡®è®¤ â†’ ç¡®è®¤åç”³è¯·å¼€ç¥¨ã€‚</p>
        
        <div class="filter-area" style="background:white;padding:15px;margin-bottom:20px;">
            <button class="btn-primary" onclick="loadContent('ReconCustomer')">åˆ·æ–°åˆ—è¡¨</button>
        </div>

        <table class="data-table">
            <thead><tr>
                <th>å¯¹è´¦å•å·</th>
                <th>å®¢æˆ·åç§°</th>
                <th>å¯¹è´¦æœŸé—´</th>
                <th style="text-align:right;">åº”æ”¶é‡‘é¢</th>
                <th>çŠ¶æ€</th>
                <th>æ“ä½œ</th>
            </tr></thead>
            <tbody>${rows}</tbody>
        </table>
    `;
}

// =========================================================================
// å¯¹è´¦å•æ˜ç»†é¡µ (ReconDetail) - æ–°å¢æ¨¡å—
// =========================================================================
else if (moduleCode === 'ReconDetail') {
    const reconId = sessionStorage.getItem('CurrentReconId');
    const recons = JSON.parse(sessionStorage.getItem('CustomerRecons') || "[]");
    const recon = recons.find(r => r.id === reconId);
    
    if (!recon) {
        contentHTML += `<h2>å¯¹è´¦å•æ˜ç»†</h2><p style="color:#e74c3c;">æœªæ‰¾åˆ°å¯¹è´¦å•æ•°æ®ï¼Œè¯·è¿”å›åˆ—è¡¨é‡è¯•ã€‚</p>`;
    } else {
        // ç”Ÿæˆæ˜ç»†è¡Œ
        const detailRows = (recon.details || []).map((item, index) => `
            <tr>
                <td>${index + 1}</td>
                <td>${item.waybillId}</td>
                <td>${item.date}</td>
                <td style="text-align:right; font-weight:bold;">${item.amount}</td>
                <td><span style="color:#27ae60;">å·²ç»“ç®—</span></td>
            </tr>
        `).join('');

        contentHTML += `
            <div style="margin-bottom:20px;">
                <button class="btn-primary" style="background-color: #95a5a6;" onclick="loadContent('ReconCustomer')"> â† è¿”å›å¯¹è´¦åˆ—è¡¨</button>
                <button class="btn-primary" style="background-color: #3498db; margin-left:10px;" onclick="window.print()">ğŸ–¨ æ‰“å°å¯¹è´¦å•</button>
            </div>

            <div style="background:white; padding:30px; border-radius:8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <h2 style="border-bottom:2px solid #3498db; padding-bottom:10px;">å®¢æˆ·å¯¹è´¦å•</h2>
                
                <div style="display:flex; justify-content:space-between; margin:20px 0; padding:15px; background:#f9f9f9; border-radius:4px;">
                    <div>
                        <div style="margin-bottom:8px;"><strong>å¯¹è´¦å•å·ï¼š</strong>${recon.id}</div>
                        <div><strong>å®¢æˆ·åç§°ï¼š</strong>${recon.client}</div>
                    </div>
                    <div style="text-align:right;">
                        <div style="margin-bottom:8px;"><strong>å¯¹è´¦æœŸé—´ï¼š</strong>${recon.period}</div>
                        <div><strong>ç”Ÿæˆæ—¶é—´ï¼š</strong>${recon.createTime || '2025-11-24'}</div>
                    </div>
                </div>

                <h3 style="margin-top:30px;">è¿å•æ˜ç»†åˆ—è¡¨</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width:8%;">åºå·</th>
                            <th style="width:25%;">è¿å•å·</th>
                            <th style="width:20%;">è¿å•æ—¥æœŸ</th>
                            <th style="text-align:right; width:20%;">é‡‘é¢ (RMB)</th>
                            <th style="width:15%;">çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${detailRows}
                    </tbody>
                    <tfoot>
                        <tr style="background:#f0f0f0; font-weight:bold;">
                            <td colspan="3" style="text-align:right; padding-right:20px;">åˆè®¡ï¼š</td>
                            <td style="text-align:right; font-size:16px; color:#e74c3c;">Â¥${recon.amount}</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>

                <div style="margin-top:30px; padding:15px; background:#e8f5e9; border-left:4px solid #27ae60; border-radius:4px;">
                    <div style="margin-bottom:5px;"><strong>ğŸ“Œ å¯¹è´¦è¯´æ˜ï¼š</strong></div>
                    <div style="color:#666;">æœ¬å¯¹è´¦å•åŒ…å« ${(recon.details || []).length} ç¬”è¿å•ï¼Œæ€»é‡‘é¢ Â¥${recon.amount}ï¼Œè¯·æ ¸å¯¹æ— è¯¯åç¡®è®¤ã€‚</div>
                </div>
            </div>
        `;
    }
}
            // =========================================================================
            // 3. æ‰¿è¿å•†å¯¹è´¦ (ReconCarrier)
            // =========================================================================
            else if (moduleCode === 'ReconCarrier') {
                contentHTML += `
                    <h2>æ‰¿è¿å•†å¯¹è´¦</h2>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="æ‰¿è¿å•†åç§°/ç¼–å·" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">å¯¹è´¦çŠ¶æ€ (å…¨éƒ¨)</option>
                                <option>å¾…æ ¸ç®—</option>
                                <option>å¾…æ‰¿è¿å•†ç¡®è®¤</option>
                                <option>å·²ç¡®è®¤</option>
                            </select>
                            <input type="date" placeholder="æ‰¹æ¬¡æ—¥æœŸèŒƒå›´" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                            <button class="btn-primary" style="background-color: #2980b9;">ç”Ÿæˆå¯¹è´¦å•</button>
                        </div>
                    </div>
                    
                    <h3>æ‰¿è¿å•†å¯¹è´¦å•åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å¯¹è´¦å•å·</th>
                                <th>æ‰¿è¿å•†åç§°</th>
                                <th>æ‰¹æ¬¡æ•°é‡</th>
                                <th>åº”ä»˜æ€»é¢ (RMB)</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>DZ202511-CY003</td>
                                <td>è¿…è¾¾å¿«è¿</td>
                                <td>10</td>
                                <td>125,000.00</td>
                                <td><span style="color: #f39c12;">å¾…æ‰¿è¿å•†ç¡®è®¤</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹</a> | <a href="#" style="color:#e74c3c;">å‚¬åŠ</a></td>
                            </tr>
                            <tr>
                                <td>DZ202510-CY001</td>
                                <td>è¿œèˆªç‰©æµ</td>
                                <td>8</td>
                                <td>90,000.00</td>
                                <td><span style="color: #27ae60;">å·²ç¡®è®¤</span></td>
                                <td><a href="#" style="color:#3498db;">è½¬åº”ä»˜</a> | <a href="#" style="color:#34495e;">æ‰“å°</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // 4. å¸æœºå¯¹è´¦ (ReconDriver)
            // =========================================================================
            else if (moduleCode === 'ReconDriver') {
                contentHTML += `
                    <h2>å¸æœºå¯¹è´¦ (é…¬é‡‘/è´¹ç”¨)</h2>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="å¸æœºå§“å/å·¥å·/æ‰‹æœºå·" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">å¯¹è´¦ç±»å‹ (å…¨éƒ¨)</option>
                                <option>é…¬é‡‘ç»“ç®—</option>
                                <option>æŠ¥é”€è´¹ç”¨</option>
                            </select>
                            <input type="date" placeholder="ç»“ç®—å‘¨æœŸ" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <h3>å¸æœºç»“ç®—å•åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ç»“ç®—å•å·</th>
                                <th>å¸æœºå§“å</th>
                                <th>ç»“ç®—å‘¨æœŸ</th>
                                <th>ç»“ç®—ç±»å‹</th>
                                <th>åº”ä»˜é‡‘é¢ (RMB)</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>JS202511-SJ020</td>
                                <td>æå¸ˆå‚…</td>
                                <td>2025-11-01 ~ 11-15</td>
                                <td>é…¬é‡‘ç»“ç®—</td>
                                <td>4,500.00</td>
                                <td><span style="color: #f39c12;">å¾…æ”¯ä»˜</span></td>
                                <td><a href="#" style="color:#27ae60;">è½¬æ”¯ä»˜</a> | <a href="#" style="color:#3498db;">è¯¦æƒ…</a></td>
                            </tr>
                            <tr>
                                <td>JS202511-SJ021</td>
                                <td>ç‹å¸ˆå‚…</td>
                                <td>2025-11-01 ~ 11-15</td>
                                <td>æŠ¥é”€è´¹ç”¨</td>
                                <td>800.00</td>
                                <td><span style="color: #c0392b;">å¾…å®¡æ‰¹</span></td>
                                <td><a href="#" style="color:#e74c3c;">å®¡æ‰¹</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // 5. å¯¹è´¦å·®å¼‚å¤„ç† (ReconDiffHandle)
            // =========================================================================
            else if (moduleCode === 'ReconDiffHandle') {
                contentHTML += `
                    <h2>å¯¹è´¦å·®å¼‚å¤„ç†</h2>
                    <p style="color: #7f8c8d;">é›†ä¸­å¤„ç†æ‰€æœ‰å¯¹è´¦å•ä¸­ï¼Œç³»ç»Ÿè®°å½•ä¸å¤–éƒ¨å¯¹è±¡åé¦ˆå­˜åœ¨ä¸ä¸€è‡´çš„å·®å¼‚è®°å½•ã€‚</p>
                    
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">å¯¹è´¦å¯¹è±¡ç±»å‹</option>
                                <option>å®¢æˆ·</option>
                                <option>ç½‘ç‚¹</option>
                                <option>æ‰¿è¿å•†</option>
                            </select>
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">å·®å¼‚å¤„ç†çŠ¶æ€</option>
                                <option>å¾…è´¢åŠ¡åˆ†æ</option>
                                <option>å¾…å¯¹æ–¹ç¡®è®¤</option>
                                <option>å·²æ ¸é”€</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢å·®å¼‚</button>
                        </div>
                    </div>

                    <h3>å·®å¼‚è®°å½•åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å¯¹è´¦å•å·</th>
                                <th>å·®å¼‚å¯¹è±¡</th>
                                <th>å·®å¼‚é‡‘é¢ (RMB)</th>
                                <th>å·®å¼‚ç±»å‹</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>DZ202510-KH005</td>
                                <td>é˜³å…‰åˆ¶é€  (å®¢æˆ·)</td>
                                <td>+350.00</td>
                                <td>è¿è´¹è®¡ç®—é”™è¯¯</td>
                                <td><span style="color: #f39c12;">å¾…è´¢åŠ¡åˆ†æ</span></td>
                                <td><a href="#" style="color:#e74c3c;">åˆ†æ/è°ƒæ•´</a> | <a href="#" style="color:#3498db;">è¯¦æƒ…</a></td>
                            </tr>
                            <tr>
                                <td>DZ202510-WD002</td>
                                <td>å¹¿å·ç™½äº‘ç½‘ç‚¹</td>
                                <td>-100.00</td>
                                <td>ä»£æ”¶è´§æ¬¾é—æ¼</td>
                                <td><span style="color: #27ae60;">å·²æ ¸é”€</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹è®°å½•</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }else if (moduleCode === 'ARCustomerStatement') {
                contentHTML += `
                    <h2>å®¢æˆ·å¯¹è´¦å•åˆ—è¡¨</h2>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="å¯¹è´¦å•å· / å®¢æˆ·åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">çŠ¶æ€ (å…¨éƒ¨)</option>
                                <option>å¾…å‘é€</option>
                                <option>å¾…ç¡®è®¤</option>
                                <option>å·²ç¡®è®¤</option>
                                <option>å·²æ ¸é”€</option>
                            </select>
                            <input type="date" placeholder="å¯¹è´¦å‘¨æœŸå¼€å§‹" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <input type="date" placeholder="å¯¹è´¦å‘¨æœŸç»“æŸ" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ åˆ›å»ºæ–°å¯¹è´¦å•</button>
                        <button class="btn-primary" style="background-color: #3498db;">æ‰¹é‡å‘é€</button>
                        <button style="background-color: #34495e; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;">å¯¼å‡ºåˆ—è¡¨</button>
                    </div>

                    <h3>å¯¹è´¦å•åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å¯¹è´¦å•å·</th>
                                <th>å®¢æˆ·åç§°</th>
                                <th>å¯¹è´¦å‘¨æœŸ</th>
                                <th>åº”æ”¶æ€»é¢ (RMB)</th>
                                <th>å·²æ ¸é”€ (RMB)</th>
                                <th>å¾…æ ¸é”€ (RMB)</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>CZD20251101</td>
                                <td>é˜³å…‰åˆ¶é€ </td>
                                <td>2025-10</td>
                                <td>15,000.00</td>
                                <td>0.00</td>
                                <td>15,000.00</td>
                                <td><span style="color: #f39c12;">å¾…ç¡®è®¤</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹/æ ¸å¯¹</a> | <a href="#" style="color:#27ae60;">å‘é€</a></td>
                            </tr>
                            <tr>
                                <td>CZD20251002</td>
                                <td>è¿œæ™¯è´¸æ˜“</td>
                                <td>2025-09</td>
                                <td>22,500.00</td>
                                <td>22,500.00</td>
                                <td>0.00</td>
                                <td><span style="color: #27ae60;">å·²æ ¸é”€</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }
            
            // =========================================================================
            // 5. é¢„æ”¶æ¬¾å• (AR Precollection)
            // =========================================================================
            else if (moduleCode === 'ARPrecollection') {
                contentHTML += `
                    <h2>é¢„æ”¶æ¬¾å•</h2>
                    <p style="color: #7f8c8d;">ç®¡ç†å®¢æˆ·æå‰æ”¯ä»˜çš„æ¬¾é¡¹ï¼Œè¿™äº›æ¬¾é¡¹å°†åœ¨åç»­è¿å•ç»“ç®—æ—¶ç”¨äºæ ¸é”€åº”æ”¶æ¬¾ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="é¢„æ”¶æ¬¾å•å· / å®¢æˆ·åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">æ ¸é”€çŠ¶æ€ (å…¨éƒ¨)</option>
                                <option>æœªæ ¸é”€</option>
                                <option>éƒ¨åˆ†æ ¸é”€</option>
                                <option>å·²æ ¸é”€</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ æ–°å¢é¢„æ”¶æ¬¾å•</button>
                    </div>

                    <h3>é¢„æ”¶æ¬¾å•åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>é¢„æ”¶æ¬¾å•å·</th>
                                <th>å®¢æˆ·åç§°</th>
                                <th>é¢„æ”¶é‡‘é¢ (RMB)</th>
                                <th>å·²æ ¸é”€é‡‘é¢ (RMB)</th>
                                <th>å¯ç”¨ä½™é¢ (RMB)</th>
                                <th>æ ¸é”€çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>YSD202511001</td>
                                <td>åŒ—æ–¹ç‰©æµ</td>
                                <td>50,000.00</td>
                                <td>15,000.00</td>
                                <td>35,000.00</td>
                                <td><span style="color: #f39c12;">éƒ¨åˆ†æ ¸é”€</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹/æ ¸é”€</a></td>
                            </tr>
                            <tr>
                                <td>YSD202510002</td>
                                <td>åå—ç§‘æŠ€</td>
                                <td>10,000.00</td>
                                <td>0.00</td>
                                <td>10,000.00</td>
                                <td><span style="color: #c0392b;">æœªæ ¸é”€</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹/æ ¸é”€</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // 6. å®¢æˆ·æ”¶æ¬¾æ ¸é”€ (AR Collection Verify)
            // =========================================================================
            else if (moduleCode === 'ARCollectionVerify') {
                contentHTML += `
                    <h2>å®¢æˆ·æ”¶æ¬¾æ ¸é”€</h2>
                    <p style="color: #7f8c8d;">å°†å®¢æˆ·çš„å®é™…æ”¶æ¬¾ä¸åº”æ”¶è´¦æ¬¾ï¼ˆå¯¹è´¦å•æˆ–è¿å•ï¼‰è¿›è¡ŒåŒ¹é…å’Œæ ¸é”€ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="æ”¶æ¬¾æµæ°´å· / å®¢æˆ·åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">æ ¸é”€çŠ¶æ€ (å…¨éƒ¨)</option>
                                <option>å¾…æ ¸é”€</option>
                                <option>éƒ¨åˆ†æ ¸é”€</option>
                                <option>å·²æ ¸é”€</option>
                            </select>
                            <input type="date" placeholder="æ”¶æ¬¾æ—¥æœŸ" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ æ–°å¢æ”¶æ¬¾æµæ°´</button>
                        <button class="btn-primary" style="background-color: #3498db;">æ‰¹é‡æ ¸é”€</button>
                    </div>

                    <h3>å¾…å¤„ç†æ”¶æ¬¾æµæ°´</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æµæ°´å·</th>
                                <th>å®¢æˆ·åç§°</th>
                                <th>æ”¶æ¬¾é‡‘é¢ (RMB)</th>
                                <th>å·²æ ¸é”€é‡‘é¢ (RMB)</th>
                                <th>å¾…æ ¸é”€ä½™é¢ (RMB)</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>SK202511005</td>
                                <td>é˜³å…‰åˆ¶é€ </td>
                                <td>15,000.00</td>
                                <td>0.00</td>
                                <td>15,000.00</td>
                                <td><a href="#" style="color:#27ae60;">ç«‹å³æ ¸é”€</a></td>
                            </tr>
                            <tr>
                                <td>SK202511006</td>
                                <td>ABCç§‘æŠ€</td>
                                <td>5,000.00</td>
                                <td>5,000.00</td>
                                <td>0.00</td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹æ ¸é”€è®°å½•</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // 7. å®¢æˆ·è´¦é¾„åˆ†æ (AR Age Analysis)
            // =========================================================================
            else if (moduleCode === 'ARAgeAnalysis') {
                contentHTML += `
                    <h2>å®¢æˆ·è´¦é¾„åˆ†æ</h2>
                    <p style="color: #7f8c8d;">åˆ†æåº”æ”¶è´¦æ¬¾çš„è´¦æœŸåˆ†å¸ƒï¼Œå¸®åŠ©ç®¡ç†å±‚è¯†åˆ«åè´¦é£é™©ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="å®¢æˆ·åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">æˆªæ­¢æ—¥æœŸ (æœ¬æœˆ)</option>
                                <option>ä¸Šæœˆ</option>
                                <option>æœ¬å­£åº¦</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                            <button style="background-color: #34495e; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;">ç”Ÿæˆåˆ†ææŠ¥è¡¨</button>
                        </div>
                    </div>
                    
                    <h3>åº”æ”¶è´¦æ¬¾è´¦é¾„åˆ†å¸ƒ (æˆªæ­¢ 2025-11-30)</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å®¢æˆ·åç§°</th>
                                <th>æ€»åº”æ”¶ (RMB)</th>
                                <th>< 30å¤© (RMB)</th>
                                <th>30-60å¤© (RMB)</th>
                                <th>60-90å¤© (RMB)</th>
                                <th>> 90å¤© (RMB)</th>
                                <th>é£é™©ç­‰çº§</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>é˜³å…‰åˆ¶é€ </td>
                                <td>35,000.00</td>
                                <td>15,000.00</td>
                                <td>10,000.00</td>
                                <td>5,000.00</td>
                                <td>5,000.00</td>
                                <td><span style="color: #e74c3c; font-weight: bold;">é«˜</span></td>
                            </tr>
                            <tr>
                                <td>è¿œæ™¯è´¸æ˜“</td>
                                <td>12,000.00</td>
                                <td>12,000.00</td>
                                <td>0.00</td>
                                <td>0.00</td>
                                <td>0.00</td>
                                <td><span style="color: #27ae60;">ä½</span></td>
                            </tr>
                        </tbody>
                    </table>
                    <p style="margin-top: 15px; color: #7f8c8d;">* å›¾è¡¨åŒºåŸŸï¼ˆé¥¼å›¾æˆ–æŸ±çŠ¶å›¾ï¼‰å¯åœ¨æ­¤å¤„å±•ç¤ºã€‚</p>
                `;
            }// =========================================================================
            // 8. ä¾›åº”å•†ä»˜æ¬¾ç”³è¯· (AP Payment Apply)
            // =========================================================================
            else if (moduleCode === 'APPaymentApply') {
                contentHTML += `
                    <h2>ä¾›åº”å•†ä»˜æ¬¾ç”³è¯·</h2>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="ç”³è¯·å•å· / ä¾›åº”å•†åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">å®¡æ‰¹çŠ¶æ€ (å…¨éƒ¨)</option>
                                <option>å¾…æäº¤</option>
                                <option>å®¡æ‰¹ä¸­</option>
                                <option>å·²æ‰¹å‡†</option>
                                <option>å·²é©³å›</option>
                            </select>
                            <input type="date" placeholder="ç”³è¯·æ—¥æœŸèŒƒå›´" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ æ–°å¢ä»˜æ¬¾ç”³è¯·</button>
                        <button class="btn-primary" style="background-color: #f39c12;">æ‰¹é‡æäº¤å®¡æ‰¹</button>
                    </div>

                    <h3>ä»˜æ¬¾ç”³è¯·åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ç”³è¯·å•å·</th>
                                <th>ä¾›åº”å•†åç§°</th>
                                <th>ç”³è¯·é‡‘é¢ (RMB)</th>
                                <th>ç”¨é€”/æ‘˜è¦</th>
                                <th>åˆ›å»ºæ—¥æœŸ</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>AP202511001</td>
                                <td>ç”²æ‰¿è¿å•†</td>
                                <td>18,500.00</td>
                                <td>å¹²çº¿è¿è´¹ç»“ç®—</td>
                                <td>2025-11-19</td>
                                <td><span style="color: #f39c12;">å®¡æ‰¹ä¸­</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹/æ’¤å›</a></td>
                            </tr>
                            <tr>
                                <td>AP202511002</td>
                                <td>ä¹™åŠå…¬ç”¨å“</td>
                                <td>800.00</td>
                                <td>æ—¥å¸¸åŠå…¬é‡‡è´­</td>
                                <td>2025-11-20</td>
                                <td><span style="color: #27ae60;">å·²æ‰¹å‡†</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹/æ‰§è¡Œä»˜æ¬¾</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }
            
            // =========================================================================
            // 9. é¢„ä»˜æ¬¾å• (AP Prepayment)
            // =========================================================================
            else if (moduleCode === 'APPrepayment') {
                contentHTML += `
                    <h2>é¢„ä»˜æ¬¾å•</h2>
                    <p style="color: #7f8c8d;">ç®¡ç†å‘ä¾›åº”å•†é¢„å…ˆæ”¯ä»˜çš„æ¬¾é¡¹ï¼Œè¿™äº›æ¬¾é¡¹å°†åœ¨åç»­åº”ä»˜è´¦æ¬¾å‘ç”Ÿæ—¶ç”¨äºæ ¸é”€ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="é¢„ä»˜æ¬¾å•å· / ä¾›åº”å•†åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">æ ¸é”€çŠ¶æ€ (å…¨éƒ¨)</option>
                                <option>æœªæ ¸é”€</option>
                                <option>éƒ¨åˆ†æ ¸é”€</option>
                                <option>å·²æ ¸é”€</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ æ–°å¢é¢„ä»˜æ¬¾å•</button>
                    </div>

                    <h3>é¢„ä»˜æ¬¾å•åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>é¢„ä»˜æ¬¾å•å·</th>
                                <th>ä¾›åº”å•†åç§°</th>
                                <th>é¢„ä»˜é‡‘é¢ (RMB)</th>
                                <th>å·²æ ¸é”€é‡‘é¢ (RMB)</th>
                                <th>å¯ç”¨ä½™é¢ (RMB)</th>
                                <th>æ ¸é”€çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>YFD202511001</td>
                                <td>ååŒ—ç‡ƒæ²¹</td>
                                <td>100,000.00</td>
                                <td>25,000.00</td>
                                <td>75,000.00</td>
                                <td><span style="color: #f39c12;">éƒ¨åˆ†æ ¸é”€</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹/æ ¸é”€</a></td>
                            </tr>
                            <tr>
                                <td>YFD202510002</td>
                                <td>å—æ–¹è®¾å¤‡</td>
                                <td>50,000.00</td>
                                <td>0.00</td>
                                <td>50,000.00</td>
                                <td><span style="color: #c0392b;">æœªæ ¸é”€</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹/æ ¸é”€</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // 10. ä»˜æ¬¾æ ¸é”€ (AP Payment Verify)
            // =========================================================================
            else if (moduleCode === 'APPaymentVerify') {
                contentHTML += `
                    <h2>ä»˜æ¬¾æ ¸é”€</h2>
                    <p style="color: #7f8c8d;">å°†å®é™…å‘ç”Ÿçš„é“¶è¡Œä»˜æ¬¾æµæ°´ä¸å·²æ‰¹å‡†çš„åº”ä»˜å•æ®ï¼ˆåº”ä»˜è´¦æ¬¾ã€é¢„ä»˜æ¬¾ï¼‰è¿›è¡ŒåŒ¹é…å’Œæ ¸é”€ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="ä»˜æ¬¾æµæ°´å· / ä¾›åº”å•†åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">æ ¸é”€çŠ¶æ€ (å…¨éƒ¨)</option>
                                <option>å¾…æ ¸é”€</option>
                                <option>å·²æ ¸é”€</option>
                            </select>
                            <input type="date" placeholder="ä»˜æ¬¾æ—¥æœŸ" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #3498db;">æ‰¹é‡è‡ªåŠ¨åŒ¹é…æ ¸é”€</button>
                    </div>

                    <h3>å¾…æ ¸é”€ä»˜æ¬¾æµæ°´</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>é“¶è¡Œæµæ°´å·</th>
                                <th>ä¾›åº”å•†åç§°</th>
                                <th>ä»˜æ¬¾é‡‘é¢ (RMB)</th>
                                <th>å·²æ ¸é”€é‡‘é¢ (RMB)</th>
                                <th>å¾…æ ¸é”€ä½™é¢ (RMB)</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>FK202511010</td>
                                <td>ç”²æ‰¿è¿å•†</td>
                                <td>18,500.00</td>
                                <td>0.00</td>
                                <td>18,500.00</td>
                                <td><a href="#" style="color:#27ae60;">ç«‹å³æ ¸é”€</a></td>
                            </tr>
                            <tr>
                                <td>FK202511011</td>
                                <td>æŸè®¾å¤‡ç§Ÿèµ</td>
                                <td>5,000.00</td>
                                <td>5,000.00</td>
                                <td>0.00</td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹æ ¸é”€è®°å½•</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // 11. ä¾›åº”å•†å‘ç¥¨ç®¡ç† (AP Invoice Manage)
            // =========================================================================
            else if (moduleCode === 'APInvoiceManage') {
                contentHTML += `
                    <h2>ä¾›åº”å•†å‘ç¥¨ç®¡ç†</h2>
                    <p style="color: #7f8c8d;">è®°å½•å’Œç®¡ç†æ”¶åˆ°çš„ä¾›åº”å•†ï¼ˆè¿›é¡¹ï¼‰å‘ç¥¨ä¿¡æ¯ï¼Œä½œä¸ºåº”ä»˜è´¦æ¬¾å’Œç¨åŠ¡æ ¸ç®—çš„ä¾æ®ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="å‘ç¥¨å·ç  / ä¾›åº”å•†åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">è®¤è¯çŠ¶æ€ (å…¨éƒ¨)</option>
                                <option>å¾…è®¤è¯</option>
                                <option>å·²è®¤è¯</option>
                            </select>
                            <input type="date" placeholder="å¼€ç¥¨æ—¥æœŸèŒƒå›´" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ ç™»è®°æ–°å‘ç¥¨</button>
                        <button class="btn-primary" style="background-color: #3498db;">æ‰¹é‡è®¤è¯</button>
                    </div>

                    <h3>å‘ç¥¨å°è´¦</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å‘ç¥¨å·ç </th>
                                <th>ä¾›åº”å•†åç§°</th>
                                <th>é‡‘é¢ (RMB)</th>
                                <th>ç¨é¢ (RMB)</th>
                                <th>ä»·ç¨åˆè®¡ (RMB)</th>
                                <th>å¼€ç¥¨æ—¥æœŸ</th>
                                <th>è®¤è¯çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1300055210</td>
                                <td>ååŒ—ç‡ƒæ²¹</td>
                                <td>9,090.91</td>
                                <td>909.09</td>
                                <td>10,000.00</td>
                                <td>2025-11-15</td>
                                <td><span style="color: #f39c12;">å¾…è®¤è¯</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹/è®¤è¯</a></td>
                            </tr>
                            <tr>
                                <td>1300055211</td>
                                <td>æŸè®¾å¤‡ç§Ÿèµ</td>
                                <td>4,716.98</td>
                                <td>283.02</td>
                                <td>5,000.00</td>
                                <td>2025-11-10</td>
                                <td><span style="color: #27ae60;">å·²è®¤è¯</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }  // =========================================================================
            // 1. å®¢æˆ·èµ„é‡‘è´¦æˆ· (FundCustomerAcct)
            // =========================================================================
            else if (moduleCode === 'FundCustomerAcct') {
                contentHTML += `
                    <h2>å®¢æˆ·èµ„é‡‘è´¦æˆ·</h2>
                    <p style="color: #7f8c8d;">ç®¡ç†å®¢æˆ·çš„é¢„å­˜èµ„é‡‘è´¦æˆ·å’Œä¿è¯é‡‘ï¼Œç”¨äºç›´æ¥ç»“ç®—è¿è´¹ã€‚</p>
                    
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="å®¢æˆ·åç§°/è´¦æˆ·ID" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">è´¦æˆ·çŠ¶æ€</option>
                                <option>æ­£å¸¸</option>
                                <option>å†»ç»“</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                            <button class="btn-primary" style="background-color: #27ae60;">+ æ–°å¢èµ„é‡‘è´¦æˆ·</button>
                        </div>
                    </div>

                    <h3>èµ„é‡‘è´¦æˆ·åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>è´¦æˆ·ID</th>
                                <th>å®¢æˆ·åç§°</th>
                                <th>è´¦æˆ·ç±»å‹</th>
                                <th>å½“å‰ä½™é¢ (RMB)</th>
                                <th>æœ€è¿‘å˜åŠ¨æ—¶é—´</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>CFA1001</td>
                                <td>é˜³å…‰åˆ¶é€ </td>
                                <td>é¢„å­˜è´¦æˆ·</td>
                                <td><strong style="color: #2980b9;">50,000.00</strong></td>
                                <td>2025-11-20 09:30</td>
                                <td>æ­£å¸¸</td>
                                <td><a href="#" style="color:#3498db;">å……å€¼/æ‰£æ¬¾</a> | <a href="#" style="color:#2980b9;">æµæ°´</a></td>
                            </tr>
                            <tr>
                                <td>CFA1002</td>
                                <td>æ˜“è¾¾ç‰©æµ</td>
                                <td>ä¿è¯é‡‘</td>
                                <td><strong style="color: #f39c12;">10,000.00</strong></td>
                                <td>2025-10-01</td>
                                <td>æ­£å¸¸</td>
                                <td><a href="#" style="color:#3498db;">è°ƒæ•´</a> | <a href="#" style="color:#e74c3c;">å†»ç»“</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }
            
            // =========================================================================
            // 2. èƒ½æºè´¦æˆ·ç®¡ç† (FundEnergyAcct)
            // =========================================================================
            else if (moduleCode === 'FundEnergyAcct') {
                contentHTML += `
                    <h2>èƒ½æºè´¦æˆ·ç®¡ç†</h2>
                    <p style="color: #7f8c8d;">ç®¡ç†å…¬å¸è½¦è¾†å’Œå¸æœºçš„åŠ æ²¹å¡ã€å……ç”µæ¡©ç­‰èƒ½æºæ”¯å‡ºè´¦æˆ·ã€‚</p>
                    
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="è´¦æˆ·ç¼–å·/è½¦ç‰Œå·" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">èƒ½æºç±»å‹</option>
                                <option>åŠ æ²¹å¡</option>
                                <option>å……ç”µæ¡©</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                            <button class="btn-primary" style="background-color: #27ae60;">æ‰¹é‡å……å€¼</button>
                        </div>
                    </div>

                    <h3>èƒ½æºè´¦æˆ·åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>è´¦æˆ·ID</th>
                                <th>è½¦ç‰Œå·/å¸æœº</th>
                                <th>èƒ½æºç±»å‹</th>
                                <th>å½“å‰ä½™é¢ (RMB)</th>
                                <th>å……å€¼é˜ˆå€¼</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>GAS201</td>
                                <td>æ²ªAÂ·T8888</td>
                                <td>åŠ æ²¹å¡</td>
                                <td><strong style="color: #2980b9;">1,500.00</strong></td>
                                <td>500.00</td>
                                <td>æ­£å¸¸</td>
                                <td><a href="#" style="color:#3498db;">å……å€¼</a> | <a href="#" style="color:#2980b9;">æµæ°´</a></td>
                            </tr>
                            <tr>
                                <td>EV305</td>
                                <td>è‹BÂ·E6666</td>
                                <td>å……ç”µæ¡©</td>
                                <td><strong style="color: #e74c3c;">200.00</strong></td>
                                <td>500.00</td>
                                <td><span style="color: #e74c3c;">ä½ä½™é¢</span></td>
                                <td><a href="#" style="color:#3498db;">å……å€¼</a> | <a href="#" style="color:#e74c3c;">é¢„è­¦è®¾ç½®</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // 3. å¸æœº/ç½‘ç‚¹é’±åŒ… (FundWallet)
            // =========================================================================
            else if (moduleCode === 'FundWallet') {
                contentHTML += `
                    <h2>å¸æœº/ç½‘ç‚¹é’±åŒ…ç®¡ç†</h2>
                    <p style="color: #7f8c8d;">ç®¡ç†å¸æœºå’Œç½‘ç‚¹çš„å†…éƒ¨è™šæ‹Ÿè´¦æˆ·ï¼Œç”¨äºæ”¯ä»˜é…¬é‡‘ã€æŠ¥é”€æˆ–æ”¶å–ä»£æ”¶è´§æ¬¾ã€‚</p>
                    
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="å§“å/ç½‘ç‚¹åç§°/é’±åŒ…ID" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">ç”¨æˆ·ç±»å‹</option>
                                <option>å¸æœº</option>
                                <option>ç½‘ç‚¹</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                            <button class="btn-primary" style="background-color: #f39c12;">æ‰¹é‡æç°å®¡æ‰¹</button>
                        </div>
                    </div>

                    <h3>é’±åŒ…è´¦æˆ·åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>é’±åŒ…ID</th>
                                <th>ç”¨æˆ·ç±»å‹</th>
                                <th>å§“å/åç§°</th>
                                <th>å½“å‰ä½™é¢ (RMB)</th>
                                <th>å¾…æç°é‡‘é¢ (RMB)</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>WLT5001</td>
                                <td>å¸æœº</td>
                                <td>æå¸ˆå‚…</td>
                                <td><strong style="color: #2980b9;">8,500.00</strong></td>
                                <td>1,000.00</td>
                                <td><a href="#" style="color:#f39c12;">æç°å®¡æ‰¹</a> | <a href="#" style="color:#3498db;">æµæ°´</a></td>
                            </tr>
                            <tr>
                                <td>WLT5002</td>
                                <td>ç½‘ç‚¹</td>
                                <td>ä¸Šæµ·åˆ†æ‹¨ä¸­å¿ƒ</td>
                                <td><strong style="color: #2980b9;">12,000.00</strong></td>
                                <td>0.00</td>
                                <td><a href="#" style="color:#3498db;">å……å€¼/æ‰£æ¬¾</a> | <a href="#" style="color:#3498db;">æµæ°´</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // 4. æ”¶æ¬¾ä¸ä»˜æ¬¾æ‰§è¡Œ (FundExecution)
            // =========================================================================
            else if (moduleCode === 'FundExecution') {
                contentHTML += `
                    <h2>æ”¶æ¬¾ä¸ä»˜æ¬¾æ‰§è¡Œ (ä»»åŠ¡ä¸­å¿ƒ)</h2>
                    <p style="color: #7f8c8d;">é›†ä¸­ç®¡ç†å’Œæ‰§è¡Œå¾…å¤„ç†çš„æ”¶æ¬¾ä»»åŠ¡ï¼ˆå¦‚ä»£æ”¶è´§æ¬¾æ¸…åˆ†ï¼‰å’Œä»˜æ¬¾ä»»åŠ¡ï¼ˆå¦‚å¸æœºé…¬é‡‘æ”¯ä»˜ï¼‰ã€‚</p>
                    
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="ä»»åŠ¡ç¼–å·/å…³è”å•æ®å·" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">ä»»åŠ¡ç±»å‹</option>
                                <option>æ”¶æ¬¾æ¸…åˆ†</option>
                                <option>æ‰¹é‡æ”¯ä»˜</option>
                                <option>æç°æ”¯ä»˜</option>
                            </select>
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">æ‰§è¡ŒçŠ¶æ€</option>
                                <option>å¾…æ‰§è¡Œ</option>
                                <option>æ‰§è¡Œä¸­</option>
                                <option>æˆåŠŸ</option>
                                <option>å¤±è´¥</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                            <button class="btn-primary" style="background-color: #27ae60;">æ‰¹é‡æ‰§è¡Œ</button>
                        </div>
                    </div>

                    <h3>æ‰§è¡Œä»»åŠ¡åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ä»»åŠ¡ID</th>
                                <th>ä»»åŠ¡ç±»å‹</th>
                                <th>æ€»é‡‘é¢ (RMB)</th>
                                <th>å•æ®/ç¬”æ•°</th>
                                <th>æäº¤æ—¶é—´</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>FE20251120-001</td>
                                <td>æ‰¹é‡æ”¯ä»˜ (é…¬é‡‘)</td>
                                <td>15,500.00</td>
                                <td>15ç¬”</td>
                                <td>2025-11-20 10:00</td>
                                <td><span style="color: #f39c12;">å¾…æ‰§è¡Œ</span></td>
                                <td><a href="#" style="color:#27ae60;">æ‰§è¡Œ</a> | <a href="#" style="color:#3498db;">è¯¦æƒ…</a></td>
                            </tr>
                            <tr>
                                <td>FE20251119-005</td>
                                <td>æ”¶æ¬¾æ¸…åˆ† (ä»£æ”¶)</td>
                                <td>35,000.00</td>
                                <td>200ç¬”</td>
                                <td>2025-11-19 14:00</td>
                                <td><span style="color: #27ae60;">æˆåŠŸ</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹æ—¥å¿—</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // 5. é“¶ä¼ç›´è” (FundBankConnect)
            // =========================================================================
            else if (moduleCode === 'FundBankConnect') {
                contentHTML += `
                    <h2>é“¶ä¼ç›´è”æ¥å£ç›‘æ§</h2>
                    <p style="color: #7f8c8d;">ç›‘æ§ä¸é“¶è¡Œç³»ç»Ÿçš„æ¥å£è¿æ¥çŠ¶æ€ã€è‡ªåŠ¨å¯¹è´¦å’Œæ”¯ä»˜æŒ‡ä»¤å‘é€æƒ…å†µã€‚</p>
                    
                    <div class="dashboard-grid">
                        <div class="kpi-card" style="padding: 15px;">
                            <div class="kpi-title">å½“å‰è¿æ¥çŠ¶æ€</div>
                            <div class="kpi-value" style="font-size: 28px; color: #27ae60;">âœ… è¿è¡Œæ­£å¸¸</div>
                        </div>
                         <div class="kpi-card" style="padding: 15px;">
                            <div class="kpi-title">å¾…å‘é€æ”¯ä»˜æŒ‡ä»¤æ•°</div>
                            <div class="kpi-value" style="font-size: 28px; color: #f39c12;">12 ç¬”</div>
                        </div>
                        <div class="kpi-card" style="padding: 15px;">
                            <div class="kpi-title">ä»Šæ—¥è‡ªåŠ¨å¯¹è´¦æˆåŠŸç‡</div>
                            <div class="kpi-value" style="font-size: 28px; color: #2980b9;">98.5%</div>
                        </div>
                    </div>
                    
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">äº¤æ˜“ç±»å‹</option>
                                <option>ä½™é¢æŸ¥è¯¢</option>
                                <option>å•ç¬”æ”¯ä»˜</option>
                                <option>æ‰¹é‡æ”¯ä»˜</option>
                                <option>å›å•æŸ¥è¯¢</option>
                            </select>
                            <input type="date" placeholder="äº¤æ˜“æ—¥æœŸ" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                            <button class="btn-primary">æŸ¥è¯¢äº¤æ˜“æ—¥å¿—</button>
                            <button class="btn-primary" style="background-color: #34495e;">æŸ¥çœ‹é“¶è¡Œè´¦æˆ·é…ç½®</button>
                        </div>
                    </div>
                    
                    <h3>é“¶ä¼äº¤æ˜“æ—¥å¿—</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>äº¤æ˜“æµæ°´å·</th>
                                <th>äº¤æ˜“ç±»å‹</th>
                                <th>é‡‘é¢ (RMB)</th>
                                <th>äº¤æ˜“æ—¶é—´</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>BKTRX251120-101</td>
                                <td>æ‰¹é‡æ”¯ä»˜</td>
                                <td>-15,500.00</td>
                                <td>2025-11-20 10:15</td>
                                <td><span style="color: #27ae60;">æˆåŠŸ</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥å›å•</a></td>
                            </tr>
                            <tr>
                                <td>BKTRX251120-102</td>
                                <td>ä½™é¢æŸ¥è¯¢</td>
                                <td>-</td>
                                <td>2025-11-20 10:18</td>
                                <td><span style="color: #c0392b;">å¤±è´¥</span></td>
                                <td><a href="#" style="color:#e74c3c;">æŸ¥çœ‹è¯¦æƒ…</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // 6. æ¸…åˆ†ä¸åˆ†è´¦è§„åˆ™ (FundClearingRule)
            // =========================================================================
            else if (moduleCode === 'FundClearingRule') {
                contentHTML += `
                    <h2>æ¸…åˆ†ä¸åˆ†è´¦è§„åˆ™é…ç½®</h2>
                    <p style="color: #7f8c8d;">é…ç½®è‡ªåŠ¨å°†æ”¶æ¬¾èµ„é‡‘æŒ‰é¢„å®šæ¯”ä¾‹å’Œæ¡ä»¶åˆ†é…ç»™ç½‘ç‚¹ã€æ‰¿è¿å•†æˆ–å¹³å°çš„è§„åˆ™ã€‚</p>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ æ–°å¢æ¸…åˆ†è§„åˆ™</button>
                        <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; margin-left: 10px;">
                            <option value="">æŒ‰ä¸šåŠ¡åœºæ™¯ç­›é€‰</option>
                            <option>ä»£æ”¶è´§æ¬¾</option>
                            <option>å¹³å°è¿è´¹</option>
                        </select>
                    </div>

                    <h3>åˆ†è´¦è§„åˆ™åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>è§„åˆ™åç§°</th>
                                <th>ä¸šåŠ¡åœºæ™¯</th>
                                <th>åˆ†é…ç›®æ ‡</th>
                                <th>æ¸…åˆ†å…¬å¼</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ä»£æ”¶è´§æ¬¾åˆ†æ¶¦è§„åˆ™ V1.0</td>
                                <td>ä»£æ”¶è´§æ¬¾</td>
                                <td>ç½‘ç‚¹, å¹³å°</td>
                                <td>ä»£æ”¶é‡‘é¢*0.5%ç»™ç½‘ç‚¹ï¼Œå‰©ä½™å½’å¹³å°</td>
                                <td><span style="color: #27ae60;">ç”Ÿæ•ˆä¸­</span></td>
                                <td><a href="#" style="color:#3498db;">ç¼–è¾‘</a> | <a href="#" style="color:#e74c3c;">åœç”¨</a></td>
                            </tr>
                            <tr>
                                <td>å¹³å°è¿è´¹åˆ†æˆ V1.2</td>
                                <td>å¹³å°è¿è´¹</td>
                                <td>æ‰¿è¿å•†, å¹³å°</td>
                                <td>æ‰¿è¿å•†åº”ä»˜é‡‘é¢å…¨é¢æ”¯ä»˜ï¼Œåº”æ”¶ä½™é¢å½’å¹³å°</td>
                                <td><span style="color: #f39c12;">å¾…å®¡æ‰¹</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹</a> | <a href="#" style="color:#27ae60;">å®¡æ‰¹</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }else if (moduleCode === 'ExpenseLoan') {
                contentHTML += `
                    <h2>å€Ÿæ¬¾å•</h2>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="å€Ÿæ¬¾å•å· / ç”³è¯·äºº" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">å®¡æ‰¹çŠ¶æ€ (å…¨éƒ¨)</option>
                                <option>å¾…å®¡æ‰¹</option>
                                <option>å·²æ‰¹å‡†</option>
                                <option>å·²æ ¸é”€</option>
                            </select>
                            <input type="date" placeholder="å€Ÿæ¬¾æ—¥æœŸèŒƒå›´" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ æ–°å¢å€Ÿæ¬¾ç”³è¯·</button>
                        <button class="btn-primary" style="background-color: #f39c12;">å¾…å®¡æ‰¹ (3)</button>
                    </div>

                    <h3>å€Ÿæ¬¾å•åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å€Ÿæ¬¾å•å·</th>
                                <th>ç”³è¯·äºº/éƒ¨é—¨</th>
                                <th>å€Ÿæ¬¾é‡‘é¢ (RMB)</th>
                                <th>é¢„è®¡è¿˜æ¬¾æ—¥</th>
                                <th>çŠ¶æ€</th>
                                <th>å·²æ ¸é”€é‡‘é¢</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>JQ202511001</td>
                                <td>æå›› / é”€å”®éƒ¨</td>
                                <td>5,000.00</td>
                                <td>2025-12-30</td>
                                <td><span style="color: #f39c12;">å¾…å®¡æ‰¹</span></td>
                                <td>0.00</td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹/å®¡æ‰¹</a></td>
                            </tr>
                            <tr>
                                <td>JQ202510002</td>
                                <td>ç‹äº” / è¿è¥éƒ¨</td>
                                <td>2,000.00</td>
                                <td>2025-11-25</td>
                                <td><span style="color: #27ae60;">å·²æ‰¹å‡†</span></td>
                                <td>1,500.00</td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹/æ ¸é”€</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }
            
            // =========================================================================
            // 13. è¿˜æ¬¾å• (Expense Repay)
            // =========================================================================
            else if (moduleCode === 'ExpenseRepay') {
                contentHTML += `
                    <h2>è¿˜æ¬¾å•</h2>
                    <p style="color: #7f8c8d;">è®°å½•å‘˜å·¥å¯¹å·²æ‰¹å‡†çš„å€Ÿæ¬¾è¿›è¡Œå½’è¿˜çš„å•æ®ï¼Œç”¨äºç»“æ¸…å€Ÿæ¬¾ä½™é¢ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="è¿˜æ¬¾å•å· / è¿˜æ¬¾äºº" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">çŠ¶æ€ (å…¨éƒ¨)</option>
                                <option>å¾…å…¥è´¦</option>
                                <option>å·²å…¥è´¦</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ ç™»è®°è¿˜æ¬¾</button>
                    </div>

                    <h3>è¿˜æ¬¾å•åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>è¿˜æ¬¾å•å·</th>
                                <th>è¿˜æ¬¾äºº</th>
                                <th>è¿˜æ¬¾é‡‘é¢ (RMB)</th>
                                <th>å…³è”å€Ÿæ¬¾å•å·</th>
                                <th>è¿˜æ¬¾æ–¹å¼</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>HK202511005</td>
                                <td>ç‹äº”</td>
                                <td>500.00</td>
                                <td>JQ202510002</td>
                                <td>é“¶è¡Œè½¬è´¦</td>
                                <td><span style="color: #f39c12;">å¾…å…¥è´¦</span></td>
                                <td><a href="#" style="color:#3498db;">ç¡®è®¤å…¥è´¦</a></td>
                            </tr>
                            <tr>
                                <td>HK202511006</td>
                                <td>å¼ ä¸‰</td>
                                <td>1,000.00</td>
                                <td>JQ202510001</td>
                                <td>ç°é‡‘</td>
                                <td><span style="color: #27ae60;">å·²å…¥è´¦</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // 14. æ—¥å¸¸è´¹ç”¨æŠ¥é”€ (Expense Daily)
            // =========================================================================
            else if (moduleCode === 'ExpenseDaily') {
                contentHTML += `
                    <h2>æ—¥å¸¸è´¹ç”¨æŠ¥é”€</h2>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="æŠ¥é”€å•å· / ç”³è¯·äºº" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">æŠ¥é”€ç±»å‹ (å…¨éƒ¨)</option>
                                <option>åŠå…¬è´¹</option>
                                <option>ä¸šåŠ¡æ‹›å¾…è´¹</option>
                                <option>é€šè®¯è´¹</option>
                            </select>
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">çŠ¶æ€ (å…¨éƒ¨)</option>
                                <option>å¾…ä»˜æ¬¾</option>
                                <option>å·²ä»˜æ¬¾</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ æ–°å¢æŠ¥é”€å•</button>
                        <button class="btn-primary" style="background-color: #3498db;">å¾…ä»˜æ¬¾å¤„ç† (12)</button>
                    </div>

                    <h3>æ—¥å¸¸æŠ¥é”€å•åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æŠ¥é”€å•å·</th>
                                <th>æŠ¥é”€äºº</th>
                                <th>æ€»é‡‘é¢ (RMB)</th>
                                <th>å†²é”€å€Ÿæ¬¾</th>
                                <th>åº”ä»˜é‡‘é¢</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>BX202511010</td>
                                <td>èµµå…­</td>
                                <td>850.00</td>
                                <td>å¦</td>
                                <td>850.00</td>
                                <td><span style="color: #f39c12;">å¾…ä»˜æ¬¾</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹/å®¡æ ¸</a></td>
                            </tr>
                            <tr>
                                <td>BX202511011</td>
                                <td>é’±ä¸ƒ</td>
                                <td>3,200.00</td>
                                <td>æ˜¯ (2000)</td>
                                <td>1,200.00</td>
                                <td><span style="color: #27ae60;">å·²ä»˜æ¬¾</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // 15. å·®æ—…æŠ¥é”€ (Expense Travel)
            // =========================================================================
            else if (moduleCode === 'ExpenseTravel') {
                contentHTML += `
                    <h2>å·®æ—…æŠ¥é”€</h2>
                    <p style="color: #7f8c8d;">ç®¡ç†å‡ºå·®ç”³è¯·å…³è”çš„äº¤é€šã€ä½å®¿ã€è¡¥è´´ç­‰æŠ¥é”€ï¼Œé€šå¸¸ä¸å·®æ—…ç”³è¯·å•å…³è”ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="æŠ¥é”€å•å· / ç›®çš„åœ°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">çŠ¶æ€ (å…¨éƒ¨)</option>
                                <option>å¾…å®¡æ‰¹</option>
                                <option>å·²æ‰¹å‡†</option>
                            </select>
                            <input type="text" placeholder="å…³è”å·®æ—…ç”³è¯·å·" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ æ–°å¢å·®æ—…æŠ¥é”€</button>
                    </div>

                    <h3>å·®æ—…æŠ¥é”€å•åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æŠ¥é”€å•å·</th>
                                <th>æŠ¥é”€äºº</th>
                                <th>å‡ºå·®äº‹ç”±</th>
                                <th>æŠ¥é”€æ€»é¢ (RMB)</th>
                                <th>å†²å€Ÿæ¬¾é‡‘é¢</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>CL202511003</td>
                                <td>æå››</td>
                                <td>æ‹œè®¿æ·±åœ³å®¢æˆ·</td>
                                <td>4,500.00</td>
                                <td>3,000.00</td>
                                <td><span style="color: #f39c12;">å¾…å®¡æ‰¹</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹/å®¡æ‰¹</a></td>
                            </tr>
                            <tr>
                                <td>CL202510001</td>
                                <td>å¼ ä¸‰</td>
                                <td>å‚åŠ è¡Œä¸šä¼šè®®</td>
                                <td>2,100.00</td>
                                <td>0.00</td>
                                <td><span style="color: #27ae60;">å·²æ‰¹å‡†</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // 16. é…¬é‡‘ç»“ç®— (Expense Compensation)
            // =========================================================================
            else if (moduleCode === 'ExpenseCompensation') {
                contentHTML += `
                    <h2>é…¬é‡‘ç»“ç®—</h2>
                    <p style="color: #7f8c8d;">å¤„ç†ä¸è¿å•æˆ–æ‰¹æ¬¡å…³è”çš„å¸æœºã€ç½‘ç‚¹çš„æœåŠ¡è´¹ã€ææˆæˆ–å¥–åŠ±ç­‰ç»“ç®—ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="ç»“ç®—æ‰¹æ¬¡å· / å¯¹è±¡åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">ç»“ç®—å¯¹è±¡</option>
                                <option>å¸æœº</option>
                                <option>ç½‘ç‚¹</option>
                            </select>
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">çŠ¶æ€ (å…¨éƒ¨)</option>
                                <option>å¾…å‘æ”¾</option>
                                <option>å·²å‘æ”¾</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">æ‰¹é‡ç”Ÿæˆä»˜æ¬¾å•</button>
                    </div>

                    <h3>é…¬é‡‘ç»“ç®—åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ç»“ç®—å•å·</th>
                                <th>ç»“ç®—å¯¹è±¡</th>
                                <th>å¯¹è±¡åç§°</th>
                                <th>é…¬é‡‘æ€»é¢ (RMB)</th>
                                <th>ç»“ç®—å‘¨æœŸ</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>CJ202511001</td>
                                <td>å¸æœº</td>
                                <td>ç‹å¸ˆå‚…</td>
                                <td>3,800.00</td>
                                <td>2025-11</td>
                                <td><span style="color: #f39c12;">å¾…å‘æ”¾</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹/æ”¯ä»˜</a></td>
                            </tr>
                            <tr>
                                <td>CJ202511002</td>
                                <td>ç½‘ç‚¹</td>
                                <td>è¥¿åŒºç½‘ç‚¹</td>
                                <td>15,000.00</td>
                                <td>2025-10</td>
                                <td><span style="color: #27ae60;">å·²å‘æ”¾</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }// =========================================================================
            // 17. è¿å•æŒ‚è´¦ (Pending Waybill)
            // =========================================================================
            else if (moduleCode === 'PendingWaybill') {
                contentHTML += `
                    <h2>è¿å•æŒ‚è´¦</h2>
                    <p style="color: #7f8c8d;">è®°å½•å› ç‰¹æ®ŠåŸå› ï¼ˆå¦‚å®¢æˆ·ä¿¡ç”¨é¢åº¦ä¸è¶³ã€æ•°æ®å¼‚å¸¸ç­‰ï¼‰æ— æ³•æ­£å¸¸ç»“ç®—çš„è¿å•ï¼Œç­‰å¾…åç»­å¤„ç†ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="è¿å•å· / å®¢æˆ·åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">æŒ‚è´¦åŸå›  (å…¨éƒ¨)</option>
                                <option>ä¿¡ç”¨é¢åº¦è¶…é™</option>
                                <option>ç»“ç®—æ•°æ®å¾…ç¡®è®¤</option>
                                <option>å®¢æˆ·äº‰è®®</option>
                            </select>
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">å¤„ç†çŠ¶æ€ (å…¨éƒ¨)</option>
                                <option>å¾…å¤„ç†</option>
                                <option>å·²è§£é™¤</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #f39c12;">æ‰¹é‡è§£é™¤æŒ‚è´¦</button>
                    </div>

                    <h3>è¿å•æŒ‚è´¦åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>è¿å•å·</th>
                                <th>å®¢æˆ·åç§°</th>
                                <th>åº”æ”¶é‡‘é¢ (RMB)</th>
                                <th>æŒ‚è´¦æ—¥æœŸ</th>
                                <th>æŒ‚è´¦åŸå› </th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>YD202511015</td>
                                <td>Epsilonç§‘æŠ€</td>
                                <td>8,000.00</td>
                                <td>2025-11-20</td>
                                <td>ä¿¡ç”¨é¢åº¦è¶…é™</td>
                                <td><span style="color: #e74c3c; font-weight: bold;">å¾…å¤„ç†</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹è¯¦æƒ…</a> | <a href="#" style="color:#27ae60;">è§£é™¤æŒ‚è´¦</a></td>
                            </tr>
                            <tr>
                                <td>YD202511016</td>
                                <td>Deltaåˆ¶é€ </td>
                                <td>1,500.00</td>
                                <td>2025-11-19</td>
                                <td>ç»“ç®—æ•°æ®å¾…ç¡®è®¤</td>
                                <td><span style="color: #e74c3c; font-weight: bold;">å¾…å¤„ç†</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹è¯¦æƒ…</a> | <a href="#" style="color:#27ae60;">è§£é™¤æŒ‚è´¦</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }
            
            // =========================================================================
            // 18. å¼‚åŠ¨æŒ‚è´¦ (Pending Abnormal)
            // =========================================================================
            else if (moduleCode === 'PendingAbnormal') {
                contentHTML += `
                    <h2>å¼‚åŠ¨æŒ‚è´¦</h2>
                    <p style="color: #7f8c8d;">è®°å½•å› è¿è¾“è¿‡ç¨‹ä¸­çš„å¼‚å¸¸æˆ–èµ”ä»˜äº§ç”Ÿçš„è´¹ç”¨è°ƒæ•´ï¼ˆå¦‚è¶…æœŸç½šæ¬¾ã€ç†èµ”è´¹ç”¨ï¼‰ï¼Œç­‰å¾…æœ€ç»ˆå®šæŸæ ¸ç®—ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="å¼‚åŠ¨å•å· / å…³è”è¿å•å·" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">å¼‚åŠ¨ç±»å‹ (å…¨éƒ¨)</option>
                                <option>ç ´æŸèµ”ä»˜</option>
                                <option>è¶…æœŸç½šæ¬¾</option>
                                <option>å¼‚å¸¸å¤„ç†è´¹</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ æ–°å¢å¼‚åŠ¨æŒ‚è´¦</button>
                    </div>

                    <h3>å¼‚åŠ¨æŒ‚è´¦åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å¼‚åŠ¨å•å·</th>
                                <th>å…³è”è¿å•å·</th>
                                <th>å¼‚åŠ¨ç±»å‹</th>
                                <th>æŒ‚è´¦é‡‘é¢ (RMB)</th>
                                <th>æŒ‚è´¦å¯¹è±¡</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>YDZ202511003</td>
                                <td>YD202511010</td>
                                <td>ç ´æŸèµ”ä»˜</td>
                                <td>-2,500.00 (åº”æ”¶å‡å°‘)</td>
                                <td>å®¢æˆ·A</td>
                                <td><span style="color: #f39c12;">å¾…å®šæŸ</span></td>
                                <td><a href="#" style="color:#3498db;">å®šæŸ/å¤„ç†</a></td>
                            </tr>
                            <tr>
                                <td>YDZ202511004</td>
                                <td>YD202511011</td>
                                <td>è¶…æœŸç½šæ¬¾</td>
                                <td>1,000.00 (åº”ä»˜å¢åŠ )</td>
                                <td>æ‰¿è¿å•†B</td>
                                <td><span style="color: #27ae60;">å·²æ ¸ç®—</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // 19. å…¶ä»–æŒ‚è´¦ (Pending Other)
            // =========================================================================
            else if (moduleCode === 'PendingOther') {
                contentHTML += `
                    <h2>å…¶ä»–æŒ‚è´¦</h2>
                    <p style="color: #7f8c8d;">è®°å½•éè¿å•å’Œå¼‚åŠ¨äº§ç”Ÿçš„ã€éœ€è´¢åŠ¡éƒ¨é—¨å•ç‹¬è·Ÿè¿›å’Œè§£é™¤çš„ä¸´æ—¶æ€§æˆ–ç‰¹æ®Šæ€§æŒ‚è´¦ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="æŒ‚è´¦å•å· / æ‘˜è¦" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">æŒ‚è´¦ç±»å‹ (å…¨éƒ¨)</option>
                                <option>ç³»ç»Ÿæ¥å£å·®å¼‚</option>
                                <option>ä¸´æ—¶å€Ÿæ”¯</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ æ–°å¢å…¶ä»–æŒ‚è´¦</button>
                        <button class="btn-primary" style="background-color: #f39c12;">æ‰¹é‡æ ‡è®°å·²å¤„ç†</button>
                    </div>

                    <h3>å…¶ä»–æŒ‚è´¦åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æŒ‚è´¦å•å·</th>
                                <th>é‡‘é¢ (RMB)</th>
                                <th>æ–¹å‘</th>
                                <th>æŒ‚è´¦æ—¥æœŸ</th>
                                <th>æ‘˜è¦/è¯´æ˜</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>QT202511001</td>
                                <td>500.00</td>
                                <td>åº”ä»˜</td>
                                <td>2025-11-18</td>
                                <td>ç³»ç»Ÿè¿è´¹è®¡ç®—æ¥å£å·®å¼‚</td>
                                <td><span style="color: #e74c3c; font-weight: bold;">å¾…å¤„ç†</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹</a> | <a href="#" style="color:#27ae60;">æ ‡è®°è§£é™¤</a></td>
                            </tr>
                            <tr>
                                <td>QT202511002</td>
                                <td>1,200.00</td>
                                <td>åº”æ”¶</td>
                                <td>2025-11-17</td>
                                <td>ä¸´æ—¶å®¢æˆ·å€Ÿæ¬¾</td>
                                <td><span style="color: #27ae60;">å·²å¤„ç†</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }// =========================================================================
            // 20. è¿›é¡¹å‘ç¥¨å°è´¦ (Tax Input Invoice)
            // =========================================================================
            else if (moduleCode === 'TaxInputInvoice') {
                contentHTML += `
                    <h2>è¿›é¡¹å‘ç¥¨å°è´¦ (æ”¶åˆ°çš„å‘ç¥¨)</h2>
                    <p style="color: #7f8c8d;">è®°å½•å’Œç®¡ç†ä»ä¾›åº”å•†æ”¶åˆ°çš„è¿›é¡¹å‘ç¥¨ï¼Œä½œä¸ºæŠµæ‰£ç¨æ¬¾å’Œæˆæœ¬æ ¸ç®—çš„ä¾æ®ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="å‘ç¥¨å·ç  / ä¾›åº”å•†åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">è®¤è¯çŠ¶æ€ (å…¨éƒ¨)</option>
                                <option>å¾…è®¤è¯</option>
                                <option>å·²è®¤è¯</option>
                                <option>ä½œåºŸ</option>
                            </select>
                            <input type="date" placeholder="å¼€ç¥¨æ—¥æœŸèŒƒå›´" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ æ‰‹åŠ¨å½•å…¥å‘ç¥¨</button>
                        <button class="btn-primary" style="background-color: #3498db;">æ‰¹é‡å¯¼å…¥/OCR</button>
                        <button class="btn-primary" style="background-color: #f39c12;">æ‰¹é‡å‹¾é€‰è®¤è¯</button>
                    </div>

                    <h3>è¿›é¡¹å‘ç¥¨åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å‘ç¥¨å·ç </th>
                                <th>ä¾›åº”å•†åç§°</th>
                                <th>é‡‘é¢ (RMB)</th>
                                <th>ç¨é¢ (RMB)</th>
                                <th>ä»·ç¨åˆè®¡ (RMB)</th>
                                <th>å¼€ç¥¨æ—¥æœŸ</th>
                                <th>è®¤è¯çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1300055215</td>
                                <td>Aè®¾å¤‡ä¾›åº”</td>
                                <td>9,090.91</td>
                                <td>909.09</td>
                                <td>10,000.00</td>
                                <td>2025-11-15</td>
                                <td><span style="color: #f39c12;">å¾…è®¤è¯</span></td>
                                <td><a href="#" style="color:#3498db;">è¯¦æƒ…/æ“ä½œ</a></td>
                            </tr>
                            <tr>
                                <td>1300055216</td>
                                <td>Bè¿è¾“æœåŠ¡</td>
                                <td>4,716.98</td>
                                <td>283.02</td>
                                <td>5,000.00</td>
                                <td>2025-11-10</td>
                                <td><span style="color: #27ae60;">å·²è®¤è¯</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }
            
// =========================================================================
            // 21. é”€é¡¹å‘ç¥¨å°è´¦ (TaxOutputInvoice) - [æœ€ç»ˆè”åŠ¨ç‰ˆ]
            // =========================================================================
            else if (moduleCode === 'TaxOutputInvoice') {
                
                // 1. è¯»å–ã€å¾…å¼€ç¥¨é˜Ÿåˆ—ã€‘(æ¥è‡ªè¿å•å’Œå¯¹è´¦å•çš„æ¨é€)
                const pendingQueue = JSON.parse(sessionStorage.getItem('PendingInvoiceQueue') || "[]");
                
                // ç”Ÿæˆå¾…å¼€ç¥¨è¡Œ (é»„è‰²èƒŒæ™¯)
                const pendingRows = pendingQueue.map((item, index) => `
                    <tr style="background-color: #fffbe6; border-left: 3px solid #f1c40f;">
                        <td style="color:#999;">(è‡ªåŠ¨ç”Ÿæˆ)</td>
                        <td>${item.client} <span style="font-size:12px;color:#666;">[æ¥æº:${item.sourceId}]</span></td>
                        <td style="font-weight:bold;">${item.amount}</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                        <td><span style="color: #f39c12; font-weight:bold;">å¾…å¼€ç¥¨</span></td>
                        <td>
                            <button class="btn-primary" style="padding:4px 8px; font-size:12px;" onclick="generateInvoiceFromQueue('${item.sourceId}', '${item.client}', '${item.amount}', ${index})">ç«‹å³å¼€ç¥¨</button>
                        </td>
                    </tr>
                `).join('');

                // 2. è¯»å–ã€å·²å¼€ç¥¨è®°å½•ã€‘
                const invoices = JSON.parse(sessionStorage.getItem('OutputInvoices') || "[]");
                const invoiceRows = invoices.map(inv => `
                    <tr>
                        <td>${inv.no}</td>
                        <td>${inv.client}</td>
                        <td>${inv.amount}</td>
                        <td>${inv.tax}</td>
                        <td>${inv.total}</td>
                        <td>${inv.date}</td>
                        <td><span style="color:#27ae60;font-weight:bold;">å·²å¼€ç¥¨</span></td>

                        <td><a href="javascript:void(0)" onclick="viewInvoiceDetail('${inv.no}')" style="color:#3498db;">æŸ¥çœ‹</a></td>
                    </tr>
                `).join('');

                contentHTML += `
                    <h2>é”€é¡¹å‘ç¥¨å°è´¦</h2>
                    <p style="color:#7f8c8d;">æ­¤å¤„é›†ä¸­å¤„ç†æ¥è‡ªå„ä¸šåŠ¡æ¨¡å—çš„å¼€ç¥¨ç”³è¯·ã€‚</p>
                    
                    <div class="action-bar" style="margin-bottom:15px;">
                        <button class="btn-primary" onclick="loadContent('TaxOutputInvoice')">åˆ·æ–°å¾…åŠä»»åŠ¡</button>
                    </div>

                    <table class="data-table">
                        <thead><tr><th>å‘ç¥¨å·</th><th>å®¢æˆ·/å¯¹è±¡</th><th>é‡‘é¢</th><th>ç¨é¢</th><th>ä»·ç¨åˆè®¡</th><th>å¼€ç¥¨æ—¥æœŸ</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr></thead>
                        <tbody>
                            ${pendingRows} ${invoiceRows} ${pendingRows.length === 0 && invoiceRows.length === 0 ? '<tr><td colspan="8" style="text-align:center;color:#ccc;">æš‚æ— å¼€ç¥¨ä»»åŠ¡ï¼Œè¯·å»ç»“ç®—/å¯¹è´¦æ¨¡å—å‘èµ·ã€‚</td></tr>' : ''}
                        </tbody>
                    </table>
                `;
            }


            
// =========================================================================
            // 22. å‘ç¥¨è¯¦æƒ…é¡µ (InvoiceDetail) - [ç»ˆæä¿®æ­£ç‰ˆï¼šè‡ªåŠ¨ç®—ç¨ + å®Œç¾UI]
            // =========================================================================
            else if (moduleCode === 'InvoiceDetail') {
                // 1. è·å–åŸºç¡€æ•°æ®
                let inv = window.g_currentInvoice || {
                    no: '253420000002', date: '2025å¹´11æœˆ24æ—¥',
                    clientName: 'æ¼”ç¤ºå®¢æˆ·å…¬å¸', clientTaxId: '9132xxxxxxxx',
                    sellerName: 'ä¹äº«ç‰©æµæœ‰é™å…¬å¸', sellerTaxId: '9131xxxxxxxx',
                    amount: '1,000.00' // åŸºç¡€é‡‘é¢
                };

                // 2. â˜…â˜…â˜… æ ¸å¿ƒä¿®å¤ï¼šå¼ºåˆ¶é‡æ–°è®¡ç®—ç¨é¢å’Œæ€»ä»· â˜…â˜…â˜…
                // å»æ‰é€—å·è½¬æ•°å­—
                const rawAmount = parseFloat(inv.amount.toString().replace(/,/g, '')) || 0;
                const taxRateVal = 0.09; // 9% ç¨ç‡
                const rawTax = rawAmount * taxRateVal;
                const rawTotal = rawAmount + rawTax;

                // æ ¼å¼åŒ–å›å­—ç¬¦ä¸² (ä¿ç•™2ä½å°æ•°)
                inv.amount = rawAmount.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                inv.taxRate = '9%';
                inv.tax = rawTax.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                inv.total = rawTotal.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                
                // ç”Ÿæˆå¤§å†™é‡‘é¢
                inv.totalCn = (typeof convertCurrency === 'function') ? convertCurrency(rawTotal) : 'ï¼ˆé‡‘é¢è®¡ç®—ä¸­...ï¼‰';

                // å‘ç¥¨ä¸“ç”¨è‰² (æ·±çº¢è¤è‰²)
                const inkColor = '#b15b36'; 
                const borderStyle = `1px solid ${inkColor}`;
                
                contentHTML += `
                    <div style="margin-bottom:20px; display:flex; justify-content:space-between;">
                        <button class="btn-primary" style="background-color: #95a5a6;" onclick="loadContent('TaxOutputInvoice')"> < è¿”å›åˆ—è¡¨</button>
                        <div>
                            <button class="btn-primary" style="background-color: #3498db;">ğŸ–¨ æ‰“å°å‘ç¥¨</button>
                            <button class="btn-primary" style="background-color: #27ae60;">ä¸‹è½½ PDF</button>
                        </div>
                    </div>

                    <div style="background: #fff; padding: 30px; border: 1px solid #ccc; width: 950px; margin: 0 auto; box-shadow: 0 4px 15px rgba(0,0,0,0.1); font-family: 'SimSun', 'Songti SC', serif; color: ${inkColor}; box-sizing: border-box;">
                        
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px; padding: 0 10px;">
                            <div style="width: 20%;">
                                <div style="width: 80px; height: 80px; border: 1px solid #ddd; padding: 2px; background:#fff; display:flex; align-items:center; justify-content:center; color:#000; font-size:10px;">
                                    (äºŒç»´ç )
                                </div>
                            </div>
                            <div style="text-align: center; flex: 1; padding-top: 10px;">
                                <h4 style="font-size: 32px; font-family: 'KaiTi', 'STKaiti', serif; font-weight: bold; margin: 0; letter-spacing: 3px; color: ${inkColor}; border-bottom: 2px double ${inkColor}; display: inline-block; padding-bottom: 5px;">ç”µå­å‘ç¥¨ï¼ˆå¢å€¼ç¨ä¸“ç”¨å‘ç¥¨ï¼‰</h2>
                            </div>
                            <div style="width: 25%; text-align: right; line-height: 1.6; font-size: 14px; font-weight: bold; color: ${inkColor};">
                                <div>å‘ç¥¨ä»£ç ï¼š<span style="color:#000;">031001900111</span></div>
                                <div>å‘ç¥¨å·ç ï¼š<span style="color:#000;">${inv.no}</span></div>
                                <div>å¼€ç¥¨æ—¥æœŸï¼š<span style="color:#000;">${inv.date}</span></div>
                                <div>æ ¡&nbsp;éªŒ&nbsp;ç ï¼š<span style="color:#000;">1234 5678 9012 3456 7890</span></div>
                            </div>
                        </div>

                        <table style="width: 100%; border-collapse: collapse; border: 2px solid ${inkColor}; font-size: 13px;">
                            
                            <tr>
                                <td style="width: 25px; padding: 15px 5px; text-align: center; border-right: ${borderStyle}; border-bottom: ${borderStyle}; line-height: 1.4;">
                                    è´­<br>ä¹°<br>æ–¹
                                </td>
                                <td style="width: 55%; padding: 6px 10px; border-right: ${borderStyle}; border-bottom: ${borderStyle}; line-height: 1.8; color: #333;">
                                    <div><span style="color:${inkColor}">åã€€ã€€ã€€ã€€ç§°ï¼š</span>${inv.clientName}</div>
                                    <div><span style="color:${inkColor}">çº³ç¨äººè¯†åˆ«å·ï¼š</span><span style="font-family:Arial;">${inv.clientTaxId}</span></div>
                                    <div><span style="color:${inkColor}">åœ° å€ã€ç”µ è¯ï¼š</span>ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒº... 021-88888888</div>
                                    <div><span style="color:${inkColor}">å¼€æˆ·è¡ŒåŠè´¦å·ï¼š</span>æ‹›å•†é“¶è¡Œ... 6225xxxxxxxx</div>
                                </td>
                                <td style="width: 25px; padding: 15px 5px; text-align: center; border-right: ${borderStyle}; border-bottom: ${borderStyle}; line-height: 1.4;">
                                    å¯†<br>ç <br>åŒº
                                </td>
                                <td style="padding: 6px; border-bottom: ${borderStyle}; font-family: 'Courier New', monospace; font-size: 12px; color: #333; word-break: break-all;">
                                    &lt;01*&gt;56*9&gt;81/02-8&lt;3*&lt;-31&lt;/02&lt;&lt;53+
                                    <br>*&gt;-6+77/&gt;+&lt;51*&lt;-/5+56*9&gt;81/02-8
                                    <br>&lt;3*&lt;-31&lt;4&gt;2*9&lt;&lt;01+/8&lt;7+&gt;-2*5&lt;1
                                </td>
                            </tr>

                            <tr style="text-align: center; color: ${inkColor}; background-color: transparent;">
                                <td colspan="4" style="padding: 0; border-bottom: ${borderStyle};">
                                    <table style="width: 100%; border-collapse: collapse; text-align: center;">
                                        <tr>
                                            <td style="width: 30%; padding: 5px; border-right: ${borderStyle};">è´§ç‰©æˆ–åº”ç¨åŠ³åŠ¡ã€æœåŠ¡åç§°</td>
                                            <td style="width: 10%; padding: 5px; border-right: ${borderStyle};">è§„æ ¼å‹å·</td>
                                            <td style="width: 5%;  padding: 5px; border-right: ${borderStyle};">å•ä½</td>
                                            <td style="width: 10%; padding: 5px; border-right: ${borderStyle};">æ•°é‡</td>
                                            <td style="width: 15%; padding: 5px; border-right: ${borderStyle};">å•ä»·</td>
                                            <td style="width: 15%; padding: 5px; border-right: ${borderStyle};">é‡‘é¢</td>
                                            <td style="width: 5%;  padding: 5px; border-right: ${borderStyle};">ç¨ç‡</td>
                                            <td style="width: 10%; padding: 5px;">ç¨é¢</td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>

                            <tr style="height: 150px; vertical-align: top; color: #000;">
                                <td colspan="4" style="padding: 0; border-bottom: ${borderStyle};">
                                    <table style="width: 100%; border-collapse: collapse; text-align: center; font-family: Arial;">
                                        <tr>
                                            <td style="width: 30%; padding: 8px; text-align: left; border-right: ${borderStyle};">*ç‰©æµè¾…åŠ©æœåŠ¡*è¿è¾“æœåŠ¡è´¹</td>
                                            <td style="width: 10%; border-right: ${borderStyle};"></td>
                                            <td style="width: 5%;  border-right: ${borderStyle};">é¡¹</td>
                                            <td style="width: 10%; text-align: right; padding-right: 5px; border-right: ${borderStyle};">1</td>
                                            <td style="width: 15%; text-align: right; padding-right: 5px; border-right: ${borderStyle};">${inv.amount}</td>
                                            <td style="width: 15%; text-align: right; padding-right: 5px; border-right: ${borderStyle};">${inv.amount}</td>
                                            <td style="width: 5%;  text-align: right; padding-right: 5px; border-right: ${borderStyle};">${inv.taxRate}</td>
                                            <td style="width: 10%; text-align: right; padding-right: 5px;">${inv.tax}</td>
                                        </tr>
                                        <tr><td style="border-right: ${borderStyle}; height: 100px;"></td><td style="border-right: ${borderStyle};"></td><td style="border-right: ${borderStyle};"></td><td style="border-right: ${borderStyle};"></td><td style="border-right: ${borderStyle};"></td><td style="border-right: ${borderStyle};"></td><td style="border-right: ${borderStyle};"></td><td></td></tr>
                                    </table>
                                </td>
                            </tr>

                            <tr style="height: 30px; color: ${inkColor}; border-bottom: ${borderStyle};">
                                <td colspan="4" style="padding: 0;">
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <tr>
                                            <td style="width: 30%; text-align: center; border-right: ${borderStyle}; padding: 5px;">åˆã€€ã€€ã€€ã€€è®¡</td>
                                            <td style="width: 40%; border-right: ${borderStyle};"></td>
                                            <td style="width: 15%; border-right: ${borderStyle}; text-align: right; padding-right: 5px; color: #000; font-family: Arial;">Â¥${inv.amount}</td>
                                            <td style="width: 15%; text-align: right; padding-right: 5px; color: #000; font-family: Arial;">Â¥${inv.tax}</td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>

                            <tr style="height: 35px; border-bottom: ${borderStyle};">
                                <td colspan="4" style="padding: 0;">
                                    <div style="display:flex; align-items:center; height: 100%;">
                                        <div style="width: 23%; text-align: center; border-right: ${borderStyle}; height: 100%; padding-top: 8px; box-sizing:border-box;">ä»·ç¨åˆè®¡ (å¤§å†™)</div>
                                        <div style="flex: 1; padding-left: 15px; display:flex; align-items:center; height: 100%;">
                                            <span style="border: 1px solid ${inkColor}; border-radius: 50%; padding: 0 3px; font-size: 10px; margin-right: 8px; color:${inkColor};">â“§</span>
                                            <span style="font-family: 'KaiTi'; font-size: 16px; color: #000;">${inv.totalCn}</span>
                                        </div>
                                        <div style="width: 30%; text-align: right; padding-right: 10px; color: ${inkColor};">
                                            (å°å†™) <span style="color: #000; font-family: Arial;">Â¥${inv.total}</span>
                                        </div>
                                    </div>
                                </td>
                            </tr>

                            <tr>
                                <td style="width: 25px; padding: 15px 5px; text-align: center; border-right: ${borderStyle}; line-height: 1.4;">
                                    é”€<br>å”®<br>æ–¹
                                </td>
                                <td colspan="3" style="padding: 6px 10px; line-height: 1.8; color: #333;">
                                    <div><span style="color:${inkColor}">åã€€ã€€ã€€ã€€ç§°ï¼š</span>${inv.sellerName}</div>
                                    <div><span style="color:${inkColor}">çº³ç¨äººè¯†åˆ«å·ï¼š</span><span style="font-family:Arial;">${inv.sellerTaxId}</span></div>
                                    <div><span style="color:${inkColor}">åœ° å€ã€ç”µ è¯ï¼š</span>æ»å·å¸‚... 0550-8888888</div>
                                    <div><span style="color:${inkColor}">å¼€æˆ·è¡ŒåŠè´¦å·ï¼š</span>å·¥è¡Œ... 1234567890</div>
                                </td>
                            </tr>
                        </table>

                        <div style="display: flex; justify-content: space-between; margin-top: 15px; font-size: 14px; padding: 0 10px;">
                            <div style="width: 25%;">æ”¶æ¬¾äººï¼šæè´¢åŠ¡</div>
                            <div style="width: 25%;">å¤æ ¸ï¼šå¼ ä¸»ç®¡</div>
                            <div style="width: 25%;">å¼€ç¥¨äººï¼šç®¡ç†å‘˜</div>
                            <div style="width: 25%;">é”€å”®æ–¹ï¼š(ç« )</div>
                        </div>

                    </div>
                `;
            }

            
            // =========================================================================
            // 22. ç¨ç‡é…ç½® (Tax Rate Config)
            // =========================================================================
            else if (moduleCode === 'TaxRateConfig') {
                contentHTML += `
                    <h2>ç¨ç‡é…ç½®</h2>
                    <p style="color: #7f8c8d;">ç®¡ç†ç³»ç»Ÿä¸­ä½¿ç”¨çš„æ‰€æœ‰ç¨ç‡å’Œç¨ç§é…ç½®ï¼ŒåŒ…æ‹¬å¢å€¼ç¨ã€é™„åŠ ç¨ç­‰ï¼Œç¡®ä¿è®¡è´¹å’Œå¼€ç¥¨å‡†ç¡®ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="ç¨ç§åç§° / ç¼–ç " style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">çŠ¶æ€ (å…¨éƒ¨)</option>
                                <option>å¯ç”¨</option>
                                <option>åœç”¨</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ æ–°å¢ç¨ç‡é…ç½®</button>
                    </div>

                    <h3>ç¨ç‡é…ç½®åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ç¨ç§åç§°</th>
                                <th>ç¨ç‡ (%)</th>
                                <th>ç¨æ”¶ç¼–ç </th>
                                <th>ç”Ÿæ•ˆæ—¥æœŸ</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>å¢å€¼ç¨ - ä¸€èˆ¬è®¡ç¨</td>
                                <td>9%</td>
                                <td>304020101</td>
                                <td>2019-04-01</td>
                                <td><span style="color: #27ae60;">å¯ç”¨</span></td>
                                <td><a href="#" style="color:#3498db;">ç¼–è¾‘</a> | <a href="#" style="color:#e74c3c;">åœç”¨</a></td>
                            </tr>
                            <tr>
                                <td>å¢å€¼ç¨ - å°è§„æ¨¡</td>
                                <td>3%</td>
                                <td>304020102</td>
                                <td>2019-01-01</td>
                                <td><span style="color: #27ae60;">å¯ç”¨</span></td>
                                <td><a href="#" style="color:#3498db;">ç¼–è¾‘</a> | <a href="#" style="color:#e74c3c;">åœç”¨</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }// =========================================================================
            // 23. é¢„ç®—ç¼–åˆ¶ (Budget Planning)
            // =========================================================================
            else if (moduleCode === 'BudgetPlanning') {
                contentHTML += `
                    <h2>é¢„ç®—ç¼–åˆ¶</h2>
                    <p style="color: #7f8c8d;">æŒ‰å¹´åº¦/å­£åº¦/éƒ¨é—¨/ç§‘ç›®ç¼–åˆ¶å’Œç®¡ç†å…¬å¸çš„è¿è¥é¢„ç®—ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">é¢„ç®—å¹´åº¦</option>
                                <option>2026</option>
                                <option>2025</option>
                            </select>
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">é¢„ç®—ç‰ˆæœ¬</option>
                                <option>åˆç¨¿</option>
                                <option>ç»ˆç‰ˆ</option>
                                <option>è°ƒæ•´ç‰ˆA</option>
                            </select>
                            <input type="text" placeholder="éƒ¨é—¨åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ æ–°å¢é¢„ç®—ç‰ˆæœ¬</button>
                        <button class="btn-primary" style="background-color: #3498db;">ä¸‹è½½é¢„ç®—æ¨¡æ¿</button>
                        <button class="btn-primary" style="background-color: #f39c12;">å¯¼å…¥é¢„ç®—æ•°æ®</button>
                    </div>

                    <h3>2025å¹´åº¦é¢„ç®—æ¦‚è§ˆ (ç»ˆç‰ˆ)</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>éƒ¨é—¨/ç§‘ç›®</th>
                                <th>å¹´åº¦é¢„ç®—æ€»é¢ (RMB)</th>
                                <th>ä¸€å­£åº¦</th>
                                <th>äºŒå­£åº¦</th>
                                <th>ä¸‰å­£åº¦</th>
                                <th>å››å­£åº¦</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>é”€å”®éƒ¨ - å·®æ—…è´¹</td>
                                <td>500,000.00</td>
                                <td>150,000.00</td>
                                <td>150,000.00</td>
                                <td>100,000.00</td>
                                <td>100,000.00</td>
                                <td><a href="#" style="color:#3498db;">ç¼–è¾‘è¯¦æƒ…</a></td>
                            </tr>
                            <tr>
                                <td>è¿è¥éƒ¨ - è½¦è¾†ç»´æŠ¤è´¹</td>
                                <td>800,000.00</td>
                                <td>200,000.00</td>
                                <td>200,000.00</td>
                                <td>200,000.00</td>
                                <td>200,000.00</td>
                                <td><a href="#" style="color:#3498db;">ç¼–è¾‘è¯¦æƒ…</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }
            
            // =========================================================================
            // 24. é¢„ç®—æ‰§è¡Œåˆ†æ (Budget Analysis)
            // =========================================================================
            else if (moduleCode === 'BudgetAnalysis') {
                contentHTML += `
                    <h2>é¢„ç®—æ‰§è¡Œåˆ†æ</h2>
                    <p style="color: #7f8c8d;">å®æ—¶è·Ÿè¸ªå’Œæ¯”è¾ƒå®é™…å‘ç”Ÿè´¹ç”¨ä¸é¢„ç®—é‡‘é¢ï¼Œç›‘æ§é¢„ç®—ä½¿ç”¨æƒ…å†µï¼Œå¹¶é¢„è­¦è¶…æ”¯é£é™©ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">é¢„ç®—å‘¨æœŸ</option>
                                <option>æœ¬å¹´åº¦</option>
                                <option>æœ¬å­£åº¦</option>
                                <option>æœ¬æœˆ</option>
                            </select>
                            <input type="text" placeholder="éƒ¨é—¨/ç§‘ç›®ç­›é€‰" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="summary-cards" style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <div class="card" style="flex: 1; padding: 15px; border-radius: 6px; background-color: #e8f5e9; border-left: 5px solid #27ae60;">
                            <h4>é¢„ç®—æ€»é¢ (æœ¬å¹´)</h4>
                            <p style="font-size: 24px; color: #27ae60;">12,000,000.00</p>
                        </div>
                        <div class="card" style="flex: 1; padding: 15px; border-radius: 6px; background-color: #fff3e0; border-left: 5px solid #f39c12;">
                            <h4>å®é™…å‘ç”Ÿ (æœ¬å¹´)</h4>
                            <p style="font-size: 24px; color: #f39c12;">8,500,000.00</p>
                        </div>
                        <div class="card" style="flex: 1; padding: 15px; border-radius: 6px; background-color: #fbecec; border-left: 5px solid #e74c3c;">
                            <h4>è¶…æ”¯é£é™©é¢„è­¦</h4>
                            <p style="font-size: 24px; color: #e74c3c;">2ä¸ªç§‘ç›®</p>
                        </div>
                    </div>

                    <h3>é¢„ç®—æ‰§è¡Œæ˜ç»†</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>éƒ¨é—¨</th>
                                <th>è´¹ç”¨ç§‘ç›®</th>
                                <th>é¢„ç®—é‡‘é¢ (RMB)</th>
                                <th>å®é™…å‘ç”Ÿ (RMB)</th>
                                <th>é¢„ç®—å·®å¼‚ (RMB)</th>
                                <th>æ‰§è¡Œç‡ (%)</th>
                                <th>è¶‹åŠ¿</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>é”€å”®éƒ¨</td>
                                <td>å·®æ—…è´¹</td>
                                <td>500,000.00</td>
                                <td>450,000.00</td>
                                <td>+50,000.00</td>
                                <td>90.0%</td>
                                <td><span style="color: #27ae60;">è¾¾æ ‡</span></td>
                            </tr>
                            <tr>
                                <td>è¿è¥éƒ¨</td>
                                <td>è½¦è¾†ç»´æŠ¤è´¹</td>
                                <td>800,000.00</td>
                                <td>850,000.00</td>
                                <td>-50,000.00</td>
                                <td>106.3%</td>
                                <td><span style="color: #e74c3c; font-weight: bold;">è¶…æ”¯</span></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // 25. ç»©æ•ˆè€ƒæ ¸ (Performance Assessment)
            // =========================================================================
            else if (moduleCode === 'PerformanceAssessment') {
                contentHTML += `
                    <h2>ç»©æ•ˆè€ƒæ ¸</h2>
                    <p style="color: #7f8c8d;">åŸºäºè´¢åŠ¡æ•°æ®ï¼ˆå¦‚æˆæœ¬æ§åˆ¶ã€åˆ©æ¶¦ç‡ã€å›æ¬¾ç‡ï¼‰å¯¹éƒ¨é—¨æˆ–ä¸ªäººè¿›è¡Œç»©æ•ˆè¯„ä¼°ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">è€ƒæ ¸å‘¨æœŸ</option>
                                <option>2025 Q4</option>
                                <option>2025 Q3</option>
                            </select>
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">è€ƒæ ¸å¯¹è±¡ç±»å‹</option>
                                <option>éƒ¨é—¨</option>
                                <option>å‘˜å·¥</option>
                            </select>
                            <input type="text" placeholder="è€ƒæ ¸å¯¹è±¡åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #3498db;">å‘èµ·ç»©æ•ˆè®¡ç®—</button>
                        <button class="btn-primary" style="background-color: #f39c12;">å¯¼å‡ºè€ƒæ ¸ç»“æœ</button>
                    </div>

                    <h3>2025 Q4 éƒ¨é—¨ç»©æ•ˆç»“æœ</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>è€ƒæ ¸å¯¹è±¡ (éƒ¨é—¨)</th>
                                <th>å›æ¬¾ç‡ç›®æ ‡</th>
                                <th>å®é™…å›æ¬¾ç‡ (%)</th>
                                <th>æˆæœ¬æ§åˆ¶ç›®æ ‡</th>
                                <th>å®é™…æˆæœ¬åå·® (%)</th>
                                <th>ç»¼åˆå¾—åˆ†</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>é”€å”®éƒ¨</td>
                                <td>98.0%</td>
                                <td>99.5%</td>
                                <td>Â±3%</td>
                                <td>+1.2%</td>
                                <td>95.0</td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹æ˜ç»†</a></td>
                            </tr>
                            <tr>
                                <td>è¿è¥éƒ¨</td>
                                <td>N/A</td>
                                <td>N/A</td>
                                <td>Â±5%</td>
                                <td>-6.5%</td>
                                <td>80.5</td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹æ˜ç»†</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }// =========================================================================
            // 23. é¢„ç®—ç¼–åˆ¶ (Budget Planning)
            // =========================================================================
            else if (moduleCode === 'BudgetPlanning') {
                contentHTML += `
                    <h2>é¢„ç®—ç¼–åˆ¶</h2>
                    <p style="color: #7f8c8d;">æŒ‰å¹´åº¦/å­£åº¦/éƒ¨é—¨/ç§‘ç›®ç¼–åˆ¶å’Œç®¡ç†å…¬å¸çš„è¿è¥é¢„ç®—ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">é¢„ç®—å¹´åº¦</option>
                                <option>2026</option>
                                <option>2025</option>
                            </select>
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">é¢„ç®—ç‰ˆæœ¬</option>
                                <option>åˆç¨¿</option>
                                <option>ç»ˆç‰ˆ</option>
                                <option>è°ƒæ•´ç‰ˆA</option>
                            </select>
                            <input type="text" placeholder="éƒ¨é—¨åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ æ–°å¢é¢„ç®—ç‰ˆæœ¬</button>
                        <button class="btn-primary" style="background-color: #3498db;">ä¸‹è½½é¢„ç®—æ¨¡æ¿</button>
                        <button class="btn-primary" style="background-color: #f39c12;">å¯¼å…¥é¢„ç®—æ•°æ®</button>
                    </div>

                    <h3>2025å¹´åº¦é¢„ç®—æ¦‚è§ˆ (ç»ˆç‰ˆ)</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>éƒ¨é—¨/ç§‘ç›®</th>
                                <th>å¹´åº¦é¢„ç®—æ€»é¢ (RMB)</th>
                                <th>ä¸€å­£åº¦</th>
                                <th>äºŒå­£åº¦</th>
                                <th>ä¸‰å­£åº¦</th>
                                <th>å››å­£åº¦</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>é”€å”®éƒ¨ - å·®æ—…è´¹</td>
                                <td>500,000.00</td>
                                <td>150,000.00</td>
                                <td>150,000.00</td>
                                <td>100,000.00</td>
                                <td>100,000.00</td>
                                <td><a href="#" style="color:#3498db;">ç¼–è¾‘è¯¦æƒ…</a></td>
                            </tr>
                            <tr>
                                <td>è¿è¥éƒ¨ - è½¦è¾†ç»´æŠ¤è´¹</td>
                                <td>800,000.00</td>
                                <td>200,000.00</td>
                                <td>200,000.00</td>
                                <td>200,000.00</td>
                                <td>200,000.00</td>
                                <td><a href="#" style="color:#3498db;">ç¼–è¾‘è¯¦æƒ…</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }
            
            // =========================================================================
            // 24. é¢„ç®—æ‰§è¡Œåˆ†æ (Budget Execution Analysis) - ä¿®æ­£ä»£ç åç§°
            // =========================================================================
            else if (moduleCode === 'BudgetExecutionAnalysis') {
                contentHTML += `
                    <h2>é¢„ç®—æ‰§è¡Œåˆ†æ</h2>
                    <p style="color: #7f8c8d;">å®æ—¶è·Ÿè¸ªå’Œæ¯”è¾ƒå®é™…å‘ç”Ÿè´¹ç”¨ä¸é¢„ç®—é‡‘é¢ï¼Œç›‘æ§é¢„ç®—ä½¿ç”¨æƒ…å†µï¼Œå¹¶é¢„è­¦è¶…æ”¯é£é™©ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">é¢„ç®—å‘¨æœŸ</option>
                                <option>æœ¬å¹´åº¦</option>
                                <option>æœ¬å­£åº¦</option>
                                <option>æœ¬æœˆ</option>
                            </select>
                            <input type="text" placeholder="éƒ¨é—¨/ç§‘ç›®ç­›é€‰" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="summary-cards" style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <div class="card" style="flex: 1; padding: 15px; border-radius: 6px; background-color: #e8f5e9; border-left: 5px solid #27ae60;">
                            <h4>é¢„ç®—æ€»é¢ (æœ¬å¹´)</h4>
                            <p style="font-size: 24px; color: #27ae60;">12,000,000.00</p>
                        </div>
                        <div class="card" style="flex: 1; padding: 15px; border-radius: 6px; background-color: #fff3e0; border-left: 5px solid #f39c12;">
                            <h4>å®é™…å‘ç”Ÿ (æœ¬å¹´)</h4>
                            <p style="font-size: 24px; color: #f39c12;">8,500,000.00</p>
                        </div>
                        <div class="card" style="flex: 1; padding: 15px; border-radius: 6px; background-color: #fbecec; border-left: 5px solid #e74c3c;">
                            <h4>è¶…æ”¯é£é™©é¢„è­¦</h4>
                            <p style="font-size: 24px; color: #e74c3c;">2ä¸ªç§‘ç›®</p>
                        </div>
                    </div>

                    <h3>é¢„ç®—æ‰§è¡Œæ˜ç»†</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>éƒ¨é—¨</th>
                                <th>è´¹ç”¨ç§‘ç›®</th>
                                <th>é¢„ç®—é‡‘é¢ (RMB)</th>
                                <th>å®é™…å‘ç”Ÿ (RMB)</th>
                                <th>é¢„ç®—å·®å¼‚ (RMB)</th>
                                <th>æ‰§è¡Œç‡ (%)</th>
                                <th>è¶‹åŠ¿</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>é”€å”®éƒ¨</td>
                                <td>å·®æ—…è´¹</td>
                                <td>500,000.00</td>
                                <td>450,000.00</td>
                                <td>+50,000.00</td>
                                <td>90.0%</td>
                                <td><span style="color: #27ae60;">è¾¾æ ‡</span></td>
                            </tr>
                            <tr>
                                <td>è¿è¥éƒ¨</td>
                                <td>è½¦è¾†ç»´æŠ¤è´¹</td>
                                <td>800,000.00</td>
                                <td>850,000.00</td>
                                <td>-50,000.00</td>
                                <td>106.3%</td>
                                <td><span style="color: #e74c3c; font-weight: bold;">è¶…æ”¯</span></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // 25. ç»©æ•ˆè€ƒæ ¸ (Budget Performance) - ä¿®æ­£ä»£ç åç§°
            // =========================================================================
            else if (moduleCode === 'BudgetPerformance') {
                contentHTML += `
                    <h2>ç»©æ•ˆè€ƒæ ¸</h2>
                    <p style="color: #7f8c8d;">åŸºäºè´¢åŠ¡æ•°æ®ï¼ˆå¦‚æˆæœ¬æ§åˆ¶ã€åˆ©æ¶¦ç‡ã€å›æ¬¾ç‡ï¼‰å¯¹éƒ¨é—¨æˆ–ä¸ªäººè¿›è¡Œç»©æ•ˆè¯„ä¼°ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">è€ƒæ ¸å‘¨æœŸ</option>
                                <option>2025 Q4</option>
                                <option>2025 Q3</option>
                            </select>
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">è€ƒæ ¸å¯¹è±¡ç±»å‹</option>
                                <option>éƒ¨é—¨</option>
                                <option>å‘˜å·¥</option>
                            </select>
                            <input type="text" placeholder="è€ƒæ ¸å¯¹è±¡åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #3498db;">å‘èµ·ç»©æ•ˆè®¡ç®—</button>
                        <button class="btn-primary" style="background-color: #f39c12;">å¯¼å‡ºè€ƒæ ¸ç»“æœ</button>
                    </div>

                    <h3>2025 Q4 éƒ¨é—¨ç»©æ•ˆç»“æœ</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>è€ƒæ ¸å¯¹è±¡ (éƒ¨é—¨)</th>
                                <th>å›æ¬¾ç‡ç›®æ ‡</th>
                                <th>å®é™…å›æ¬¾ç‡ (%)</th>
                                <th>æˆæœ¬æ§åˆ¶ç›®æ ‡</th>
                                <th>å®é™…æˆæœ¬åå·® (%)</th>
                                <th>ç»¼åˆå¾—åˆ†</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>é”€å”®éƒ¨</td>
                                <td>98.0%</td>
                                <td>99.5%</td>
                                <td>Â±3%</td>
                                <td>+1.2%</td>
                                <td>95.0</td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹æ˜ç»†</a></td>
                            </tr>
                            <tr>
                                <td>è¿è¥éƒ¨</td>
                                <td>N/A</td>
                                <td>N/A</td>
                                <td>Â±5%</td>
                                <td>-6.5%</td>
                                <td>80.5</td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹æ˜ç»†</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }
            
            // =========================================================================
            // 26. æ•æ„Ÿæ“ä½œæ—¥å¿— (RiskSensitiveLog) - [æœ€ç»ˆç‰ˆï¼šæ”¯æŒå¤šæ¡è®°å½•å…±å­˜]
            // =========================================================================
            else if (moduleCode === 'RiskSensitiveLog') {
                
                // 1. è¯»å–æ‰€æœ‰åŠ¨æ€æ—¥å¿— (æ•°ç»„)
                const logsStr = sessionStorage.getItem('GlobalAuditLogs');
                let dynamicRowsHTML = '';
                
                if (logsStr) {
                    const logs = JSON.parse(logsStr);
                    // 2. å¾ªç¯ç”Ÿæˆæ¯ä¸€è¡Œ HTML
                    dynamicRowsHTML = logs.map(log => {
                        // æ ¹æ®é£é™©ç­‰çº§å†³å®šé¢œè‰²
                        const badgeColor = log.level === 'é«˜å±' ? '#e74c3c' : (log.level === 'ä¸­é£é™©' ? '#f39c12' : '#3498db');
                        const actionColor = log.level === 'é«˜å±' ? '#c0392b' : '#333';
                        
                        return `
                            <tr style="background-color: #fff0f0; animation: highlight 2s;">
                                <td><span style="background:${badgeColor}; color:white; padding:2px 6px; border-radius:4px; font-size:12px;">â— ${log.level}</span></td>
                                <td>${log.time}</td>
                                <td><strong>${log.user}</strong></td>
                                <td>${log.ip}</td>
                                <td>${log.module}</td>
                                <td style="color: ${actionColor}; font-weight:bold;">${log.action}</td>
                                <td>${log.detail}</td>
                                <td>
                                    <a href="javascript:void(0)" onclick="alert('ã€ç³»ç»Ÿå¿«ç…§ã€‘\\n----------------\\næ•°æ®æŒ‡çº¹ï¼šHash-${Math.floor(Math.random()*10000000)}')" style="color:#3498db;">æŸ¥çœ‹å¿«ç…§</a>
                                </td>
                            </tr>
                        `;
                    }).join(''); // å°†æ•°ç»„æ‹¼æ¥æˆå­—ç¬¦ä¸²
                }

                contentHTML += `
                    <h2>æ•æ„Ÿæ“ä½œæ—¥å¿— ğŸ›¡ï¸</h2>
                    <p style="color: #7f8c8d;">ç³»ç»Ÿçš„â€œé»‘åŒ£å­â€ï¼Œè®°å½•æ‰€æœ‰æ¶‰åŠèµ„é‡‘å®‰å…¨ã€å†…æ§åˆè§„çš„é«˜é£é™©æ“ä½œè¡Œä¸ºã€‚å®¡è®¡æ•°æ®ä¸å¯åˆ é™¤ã€‚</p>
                    
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items:center;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">é£é™©ç­‰çº§ (å…¨éƒ¨)</option>
                                <option value="high">ğŸ”´ é«˜å±</option>
                                <option value="medium">ğŸŸ  ä¸­é£é™©</option>
                            </select>
                            <input type="text" placeholder="æ“ä½œäºº / å…³é”®è¯" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <button class="btn-primary">ğŸ” å®¡è®¡æŸ¥è¯¢</button>
                            <button class="btn-primary" style="background-color: #34495e;">å¯¼å‡ºå®¡è®¡æŠ¥å‘Š</button>
                        </div>
                    </div>
                    
                    <h3>æ•æ„Ÿæ“ä½œè®°å½• (å®æ—¶æ›´æ–°)</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>é£é™©ç­‰çº§</th>
                                <th>æ“ä½œæ—¶é—´</th>
                                <th>æ“ä½œäºº (è´¦å·)</th>
                                <th>IP åœ°å€</th>
                                <th>æ“ä½œæ¨¡å—</th>
                                <th>æ“ä½œè¡Œä¸º</th>
                                <th>å…³é”®å‚æ•° / è¯¦æƒ…</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            
                            ${dynamicRowsHTML}

                            <tr>
                                <td><span style="background:#e74c3c; color:white; padding:2px 6px; border-radius:4px; font-size:12px;">â— é«˜å±</span></td>
                                <td>2025-11-22 14:30:05</td>
                                <td><strong>ç®¡ç†å‘˜ (admin)</strong></td>
                                <td>192.168.1.88</td>
                                <td>æœˆæœ«ç»“è´¦</td>
                                <td style="color: #c0392b; font-weight:bold;">æ‰§è¡Œåç»“è´¦</td>
                                <td>ç›®æ ‡æœŸé—´ï¼š2025å¹´11æœŸ</td>
                                <td><a href="javascript:void(0)" onclick="alert('å¿«ç…§æ•°æ®å·²å½’æ¡£')" style="color:#3498db;">æŸ¥çœ‹å¿«ç…§</a></td>
                            </tr>
                             <tr>
                                <td><span style="background:#f39c12; color:white; padding:2px 6px; border-radius:4px; font-size:12px;">â— ä¸­é£é™©</span></td>
                                <td>2025-11-21 16:40:00</td>
                                <td>ç³»ç»Ÿç®¡ç†å‘˜</td>
                                <td>10.0.0.5</td>
                                <td>è®¡è´¹è§„åˆ™é…ç½®</td>
                                <td>ä¿®æ”¹è§„åˆ™è´¹ç‡</td>
                                <td>å¹²çº¿è¿è´¹ï¼š2.5 -> 2.8</td>
                                <td><a href="javascript:void(0)" onclick="alert('å˜æ›´å‰ï¼š2.5\\nå˜æ›´åï¼š2.8')" style="color:#3498db;">å¯¹æ¯”å˜æ›´</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }


            // =========================================================================
            // 27. çº¢å†²ä¸åç»“è´¦è®°å½• (Risk Red Stamping)
            // =========================================================================
            else if (moduleCode === 'RiskRedStamping') {
                contentHTML += `
                    <h2>çº¢å†²ä¸åç»“è´¦è®°å½•</h2>
                    <p style="color: #7f8c8d;">é›†ä¸­è®°å½•æ‰€æœ‰æ¶‰åŠæ•°æ®å›æº¯ã€ä½œåºŸæˆ–åå‘æ“ä½œçš„å†å²ï¼Œç¡®ä¿å®¡è®¡é“¾æ¡å®Œæ•´ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">æ“ä½œå¯¹è±¡ (å…¨éƒ¨)</option>
                                <option>å‡­è¯çº¢å†²</option>
                                <option>å•æ®ä½œåºŸ</option>
                                <option>åç»“è´¦</option>
                            </select>
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">æ“ä½œäºº (å…¨éƒ¨)</option>
                                <option>å¼ ä¸‰</option>
                                <option>æå››</option>
                            </select>
                            <input type="date" placeholder="æ“ä½œæ—¥æœŸèŒƒå›´" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <h3>çº¢å†²/åç»“è´¦è®°å½•åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>è®°å½•æ—¶é—´</th>
                                <th>æ“ä½œäºº</th>
                                <th>æ“ä½œç±»å‹</th>
                                <th>å½±å“æœŸé—´/å•æ®</th>
                                <th>åŸå§‹å•æ®å·</th>
                                <th>æ“ä½œè¯¦æƒ…</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2025-11-20 11:00:00</td>
                                <td>ç®¡ç†å‘˜</td>
                                <td><span style="color: #e74c3c; font-weight: bold;">åç»“è´¦</span></td>
                                <td>2025-10 æœˆ</td>
                                <td>-</td>
                                <td>å°† 10 æœˆä»½ä»å·²ç»“è´¦çŠ¶æ€åè½¬</td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹å®¡è®¡æ—¥å¿—</a></td>
                            </tr>
                            <tr>
                                <td>2025-11-19 09:10:00</td>
                                <td>æå››</td>
                                <td>å‡­è¯çº¢å†²</td>
                                <td>PZ202511005</td>
                                <td>PZ202511005</td>
                                <td>çº¢å†²é”™è¯¯çš„æ‰‹åŠ¨å‡­è¯</td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹çº¢å†²å‡­è¯</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

// =========================================================================
            // 28. æ•°æ®å˜æ›´æ˜ç»† (RiskDataChange) - [ä¿®å¤è¯»å–é€»è¾‘]
            // =========================================================================
            else if (moduleCode === 'RiskDataChange') {
                
                // 1. ä» SessionStorage è¯»å–åŠ¨æ€æ—¥å¿—
                const logsStr = sessionStorage.getItem('GlobalDataChangeLogs');
                let dynamicRowsHTML = '';

                if (logsStr) {
                    const logs = JSON.parse(logsStr);
                    // éå†ç”Ÿæˆ HTML
                    dynamicRowsHTML = logs.map(log => `
                        <tr style="background-color: #fff0f0; animation: highlight 2s;">
                            <td>${log.time}</td>
                            <td><strong>${log.user}</strong></td>
                            <td>${log.object}</td>
                            <td>${log.objId}</td>
                            <td style="color: #2980b9; font-weight:bold;">${log.field}</td>
                            <td style="color: #999; text-decoration: line-through;">${log.oldVal}</td>
                            <td style="color: #e74c3c; font-weight:bold;">${log.newVal}</td>
                            <td><a href="javascript:void(0)" onclick="viewDataChangeDetail(this)" style="color:#3498db;">æŸ¥çœ‹è¯¦æƒ…</a></td>
                        </tr>
                    `).join('');
                }

                contentHTML += `
                    <h2>æ•°æ®å˜æ›´æ˜ç»† ğŸ“</h2>
                    <p style="color: #7f8c8d;">è¯¦ç»†è®°å½•æ ¸å¿ƒåŸºç¡€æ•°æ®ï¼ˆå¦‚å®¢æˆ·èµ„æ–™ã€ç§‘ç›®ä½™é¢ã€èµ„äº§å¡ç‰‡ï¼‰çš„æ¯ä¸€æ¬¡ä¿®æ”¹ï¼ŒåŒ…æ‹¬ä¿®æ”¹å‰åçš„å€¼ã€‚</p>
                    
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="å˜æ›´äºº / è®°å½•ID" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">å˜æ›´å¯¹è±¡ (å…¨éƒ¨)</option>
                                <option>å®¢æˆ·æ¡£æ¡ˆ</option>
                                <option>ä¾›åº”å•†æ¡£æ¡ˆ</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <h3>æ•°æ®å˜æ›´è®°å½•åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th style="width: 160px;">å˜æ›´æ—¶é—´</th>
                                <th style="width: 100px;">å˜æ›´äºº</th>
                                <th style="width: 120px;">å˜æ›´å¯¹è±¡</th>
                                <th style="width: 120px;">å¯¹è±¡ ID</th>
                                <th style="width: 150px;">å­—æ®µåç§°</th>
                                <th>åŸå€¼ (Old)</th>
                                <th>æ–°å€¼ (New)</th>
                                <th style="width: 80px;">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            
                            ${dynamicRowsHTML}

                            <tr>
                                <td>2025-11-21 16:30:00</td>
                                <td>æå‡ºçº³</td>
                                <td>ä¾›åº”å•†æ¡£æ¡ˆ</td>
                                <td>SUP-0088</td>
                                <td style="color: #c0392b; font-weight:bold;">é“¶è¡Œè´¦å·</td>
                                <td style="color: #999; text-decoration: line-through;">6222...8888</td>
                                <td style="color: #c0392b; font-weight:bold;">6222...9999</td>
                                <td><a href="javascript:void(0)" onclick="viewDataChangeDetail(this)" style="color:#3498db;">æŸ¥çœ‹è¯¦æƒ…</a></td>
                            </tr>
                            <tr>
                                <td>2025-11-21 14:15:22</td>
                                <td>å¼ é”€å”®</td>
                                <td>å®¢æˆ·æ¡£æ¡ˆ</td>
                                <td>CUST-1024</td>
                                <td style="color: #2980b9; font-weight:bold;">ä¿¡ç”¨é¢åº¦</td>
                                <td style="color: #999;">50,000.00</td>
                                <td style="color: #27ae60; font-weight:bold;">100,000.00</td>
                                <td><a href="javascript:void(0)" onclick="viewDataChangeDetail(this)" style="color:#3498db;">æŸ¥çœ‹è¯¦æƒ…</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

// =========================================================================
            // 29. ä¼šè®¡ç§‘ç›® (Acct Subject) - [å…¨é‡å®Œæ•´ç‰ˆ]
            // =========================================================================
            else if (moduleCode === 'AcctSubject') {
                
                // 1. è¯»å–å­˜å‚¨çš„ç§‘ç›®æ•°æ® (å¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤çš„å…¨é‡æ•°æ®)
                let storedAccounts = JSON.parse(sessionStorage.getItem('AcctSubjects'));
                
                if (!storedAccounts) {
                    // â˜…â˜…â˜… åˆå§‹åŒ–å…¨é‡ç§‘ç›®æ•°æ® (åŸºäºæ‚¨çš„ Excel å’Œæ ‡å‡†ä¼šè®¡å‡†åˆ™) â˜…â˜…â˜…
                    storedAccounts = [
                        // --- èµ„äº§ç±» (1) ---
                        { code: '1001', name: 'åº“å­˜ç°é‡‘', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: 'ä¼ä¸šçš„åº“å­˜ç°é‡‘' },
                        { code: '1002', name: 'é“¶è¡Œå­˜æ¬¾', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'é“¶è¡Œè´¦æˆ·', status: 'å¯ç”¨', remark: 'ä¼ä¸šå­˜å…¥é“¶è¡Œæˆ–å…¶ä»–é‡‘èæœºæ„çš„å„ç§æ¬¾é¡¹' },
                        { code: '1012', name: 'å…¶ä»–è´§å¸èµ„é‡‘', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: 'é“¶è¡Œæ±‡ç¥¨ã€æœ¬ç¥¨ã€ä¿¡ç”¨å¡å­˜æ¬¾ç­‰' },
                        { code: '1101', name: 'äº¤æ˜“æ€§é‡‘èèµ„äº§', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: 'çŸ­æœŸæŒæœ‰çš„è‚¡ç¥¨ã€å€ºåˆ¸ã€åŸºé‡‘ç­‰' },
                        { code: '1121', name: 'åº”æ”¶ç¥¨æ®', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'å®¢æˆ·', status: 'å¯ç”¨', remark: 'å•†ä¸šæ±‡ç¥¨' },
                        { code: '1122', name: 'åº”æ”¶è´¦æ¬¾', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'å®¢æˆ·', status: 'å¯ç”¨', remark: 'å› é”€å”®å•†å“ã€æä¾›åŠ³åŠ¡åº”æ”¶å–çš„æ¬¾é¡¹' },
                        { code: '1123', name: 'é¢„ä»˜è´¦æ¬¾', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'ä¾›åº”å•†', status: 'å¯ç”¨', remark: 'é¢„ä»˜ç»™ä¾›åº”å•†çš„æ¬¾é¡¹' },
                        { code: '1131', name: 'åº”æ”¶è‚¡åˆ©', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: 'åº”æ”¶å–çš„ç°é‡‘è‚¡åˆ©' },
                        { code: '1132', name: 'åº”æ”¶åˆ©æ¯', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: 'åº”æ”¶å–çš„åˆ©æ¯' },
                        { code: '1221', name: 'å…¶ä»–åº”æ”¶æ¬¾', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'å¾€æ¥å•ä½,å‘˜å·¥', status: 'å¯ç”¨', remark: 'é™¤åº”æ”¶è´¦æ¬¾å¤–çš„å…¶ä»–å„ç§åº”æ”¶æš‚ä»˜æ¬¾é¡¹' },
                        { code: '122101', name: 'æŠ¼é‡‘', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'å¾€æ¥å•ä½', status: 'å¯ç”¨', remark: '' },
                        { code: '122102', name: 'ä¿è¯é‡‘', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'å¾€æ¥å•ä½', status: 'å¯ç”¨', remark: '' },
                        { code: '122103', name: 'å‘˜å·¥å€Ÿæ¬¾', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'å‘˜å·¥', status: 'å¯ç”¨', remark: 'å¤‡ç”¨é‡‘ç­‰' },
                        { code: '1231', name: 'åè´¦å‡†å¤‡', type: 'èµ„äº§', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: 'åº”æ”¶æ¬¾é¡¹çš„å¤‡æŠµç§‘ç›®' },
                        { code: '1511', name: 'é•¿æœŸè‚¡æƒæŠ•èµ„', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'è¢«æŠ•èµ„å•ä½', status: 'å¯ç”¨', remark: '' },
                        { code: '1521', name: 'æŠ•èµ„æ€§æˆ¿åœ°äº§', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'é¡¹ç›®', status: 'å¯ç”¨', remark: 'ä¸ºèµšå–ç§Ÿé‡‘æˆ–èµ„æœ¬å¢å€¼è€ŒæŒæœ‰çš„æˆ¿åœ°äº§' },
                        { code: '1531', name: 'é•¿æœŸåº”æ”¶æ¬¾', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '1601', name: 'å›ºå®šèµ„äº§', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'èµ„äº§ç±»åˆ«', status: 'å¯ç”¨', remark: 'ä½¿ç”¨å¯¿å‘½è¶…è¿‡ä¸€å¹´çš„æœ‰å½¢èµ„äº§' },
                        { code: '160101', name: 'æˆ¿å±‹åŠå»ºç­‘ç‰©', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '160102', name: 'äº¤é€šè¿è¾“è®¾å¤‡', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'è½¦è¾†', status: 'å¯ç”¨', remark: 'ç‰©æµè½¦è¾†' },
                        { code: '160103', name: 'åŠå…¬å®¶å…·åŠè®¾å¤‡', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '160104', name: 'ç”µå­è®¾å¤‡', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: 'ç”µè„‘ã€æ‰“å°æœºç­‰' },
                        { code: '1602', name: 'ç´¯è®¡æŠ˜æ—§', type: 'èµ„äº§', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: 'å›ºå®šèµ„äº§çš„å¤‡æŠµç§‘ç›®' },
                        { code: '1604', name: 'åœ¨å»ºå·¥ç¨‹', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'é¡¹ç›®', status: 'å¯ç”¨', remark: 'æ­£åœ¨å»ºè®¾ä¸­çš„èµ„äº§' },
                        { code: '1605', name: 'å·¥ç¨‹ç‰©èµ„', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '1606', name: 'å›ºå®šèµ„äº§æ¸…ç†', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '1701', name: 'æ— å½¢èµ„äº§', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: 'ä¸“åˆ©æƒã€è½¯ä»¶è‘—ä½œæƒç­‰' },
                        { code: '1702', name: 'ç´¯è®¡æ‘Šé”€', type: 'èµ„äº§', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: 'æ— å½¢èµ„äº§çš„å¤‡æŠµç§‘ç›®' },
                        { code: '1801', name: 'é•¿æœŸå¾…æ‘Šè´¹ç”¨', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: 'æ‘Šé”€æœŸåœ¨ä¸€å¹´ä»¥ä¸Šçš„è´¹ç”¨' },
                        { code: '1811', name: 'é€’å»¶æ‰€å¾—ç¨èµ„äº§', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '1901', name: 'å¾…å¤„ç†è´¢äº§æŸæº¢', type: 'èµ„äº§', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: 'ç›˜ç›ˆç›˜äºå¤„ç†' },

                        // --- è´Ÿå€ºç±» (2) ---
                        { code: '2001', name: 'çŸ­æœŸå€Ÿæ¬¾', type: 'è´Ÿå€º', direction: 'è´·', aux: 'é“¶è¡Œ', status: 'å¯ç”¨', remark: '1å¹´å†…çš„å€Ÿæ¬¾' },
                        { code: '2101', name: 'äº¤æ˜“æ€§é‡‘èè´Ÿå€º', type: 'è´Ÿå€º', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '2201', name: 'åº”ä»˜ç¥¨æ®', type: 'è´Ÿå€º', direction: 'è´·', aux: 'ä¾›åº”å•†', status: 'å¯ç”¨', remark: '' },
                        { code: '2202', name: 'åº”ä»˜è´¦æ¬¾', type: 'è´Ÿå€º', direction: 'è´·', aux: 'ä¾›åº”å•†', status: 'å¯ç”¨', remark: 'è´­ä¹°ææ–™ã€æ¥å—åŠ³åŠ¡åº”ä»˜çš„æ¬¾é¡¹' },
                        { code: '2203', name: 'é¢„æ”¶è´¦æ¬¾', type: 'è´Ÿå€º', direction: 'è´·', aux: 'å®¢æˆ·', status: 'å¯ç”¨', remark: 'é¢„æ”¶çš„è¿è´¹ç­‰' },
                        { code: '2211', name: 'åº”ä»˜èŒå·¥è–ªé…¬', type: 'è´Ÿå€º', direction: 'è´·', aux: 'éƒ¨é—¨', status: 'å¯ç”¨', remark: 'å·¥èµ„ã€å¥–é‡‘ã€ç¤¾ä¿ç­‰' },
                        { code: '2221', name: 'åº”äº¤ç¨è´¹', type: 'è´Ÿå€º', direction: 'è´·', aux: 'ç¨ç§', status: 'å¯ç”¨', remark: '' },
                        { code: '222101', name: 'åº”äº¤å¢å€¼ç¨', type: 'è´Ÿå€º', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '222102', name: 'åº”äº¤ä¼ä¸šæ‰€å¾—ç¨', type: 'è´Ÿå€º', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '222103', name: 'åº”äº¤åŸå»ºç¨', type: 'è´Ÿå€º', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '222104', name: 'åº”äº¤æ•™è‚²è´¹é™„åŠ ', type: 'è´Ÿå€º', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '2231', name: 'åº”ä»˜åˆ©æ¯', type: 'è´Ÿå€º', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '2232', name: 'åº”ä»˜è‚¡åˆ©', type: 'è´Ÿå€º', direction: 'è´·', aux: 'è‚¡ä¸œ', status: 'å¯ç”¨', remark: '' },
                        { code: '2241', name: 'å…¶ä»–åº”ä»˜æ¬¾', type: 'è´Ÿå€º', direction: 'è´·', aux: 'å¾€æ¥å•ä½', status: 'å¯ç”¨', remark: 'é™¤ä¸»è¥ä¸šåŠ¡å¤–çš„åº”ä»˜æš‚æ”¶æ¬¾é¡¹' },
                        { code: '224101', name: 'ä»£æ”¶è´§æ¬¾', type: 'è´Ÿå€º', direction: 'è´·', aux: 'å®¢æˆ·', status: 'å¯ç”¨', remark: 'ç‰©æµä»£æ”¶æ¬¾' },
                        { code: '224102', name: 'ä¿è¯é‡‘', type: 'è´Ÿå€º', direction: 'è´·', aux: 'å¾€æ¥å•ä½', status: 'å¯ç”¨', remark: '' },
                        { code: '2401', name: 'é€’å»¶æ”¶ç›Š', type: 'è´Ÿå€º', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '2501', name: 'é•¿æœŸå€Ÿæ¬¾', type: 'è´Ÿå€º', direction: 'è´·', aux: 'é“¶è¡Œ', status: 'å¯ç”¨', remark: '1å¹´ä»¥ä¸Šçš„å€Ÿæ¬¾' },
                        { code: '2701', name: 'é•¿æœŸåº”ä»˜æ¬¾', type: 'è´Ÿå€º', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '2801', name: 'é¢„è®¡è´Ÿå€º', type: 'è´Ÿå€º', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '2901', name: 'é€’å»¶æ‰€å¾—ç¨è´Ÿå€º', type: 'è´Ÿå€º', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },

                        // --- æƒç›Šç±» (4) ---
                        { code: '4001', name: 'å®æ”¶èµ„æœ¬', type: 'æƒç›Š', direction: 'è´·', aux: 'è‚¡ä¸œ', status: 'å¯ç”¨', remark: 'æŠ•èµ„è€…æŠ•å…¥èµ„æœ¬' },
                        { code: '4002', name: 'èµ„æœ¬å…¬ç§¯', type: 'æƒç›Š', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '4101', name: 'ç›ˆä½™å…¬ç§¯', type: 'æƒç›Š', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: 'ä»å‡€åˆ©æ¶¦ä¸­æå–çš„å…¬ç§¯é‡‘' },
                        { code: '4103', name: 'æœ¬å¹´åˆ©æ¶¦', type: 'æƒç›Š', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: 'å½“æœŸå®ç°çš„å‡€åˆ©æ¶¦æˆ–äºæŸ' },
                        { code: '4104', name: 'åˆ©æ¶¦åˆ†é…', type: 'æƒç›Š', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: 'åˆ©æ¶¦åˆ†é…åŠå†å¹´äºæŸå¼¥è¡¥' },

                        // --- æŸç›Šç±» (6) ---
                        { code: '6001', name: 'ä¸»è¥ä¸šåŠ¡æ”¶å…¥', type: 'æŸç›Š', direction: 'è´·', aux: 'å®¢æˆ·,é¡¹ç›®', status: 'å¯ç”¨', remark: 'è¿è¾“æœåŠ¡æ”¶å…¥' },
                        { code: '600110', name: 'å…¶ä»–è¥ä¸šæ”¶å…¥', type: 'æŸç›Š', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '6051', name: 'å…¶ä»–ä¸šåŠ¡æ”¶å…¥', type: 'æŸç›Š', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: 'åŸææ–™é”€å”®ã€ç§Ÿé‡‘æ”¶å…¥ç­‰' },
                        { code: '6101', name: 'å…¬å…ä»·å€¼å˜åŠ¨æŸç›Š', type: 'æŸç›Š', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '6111', name: 'æŠ•èµ„æ”¶ç›Š', type: 'æŸç›Š', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '6301', name: 'è¥ä¸šå¤–æ”¶å…¥', type: 'æŸç›Š', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: 'ä¸ç»è¥æ— ç›´æ¥å…³ç³»çš„æ”¶å…¥' },
                        { code: '6401', name: 'ä¸»è¥ä¸šåŠ¡æˆæœ¬', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'é¡¹ç›®', status: 'å¯ç”¨', remark: 'è¿è¾“æˆæœ¬ã€ç‡ƒæ²¹è´¹ç­‰' },
                        { code: '6402', name: 'å…¶ä»–ä¸šåŠ¡æˆæœ¬', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '6403', name: 'è¥ä¸šç¨é‡‘åŠé™„åŠ ', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: 'åŸå»ºç¨ã€æ•™è‚²è´¹é™„åŠ ç­‰' },
                        { code: '6601', name: 'é”€å”®è´¹ç”¨', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'éƒ¨é—¨', status: 'å¯ç”¨', remark: 'é”€å”®è¿‡ç¨‹ä¸­å‘ç”Ÿçš„è´¹ç”¨' },
                        { code: '6602', name: 'ç®¡ç†è´¹ç”¨', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'éƒ¨é—¨', status: 'å¯ç”¨', remark: 'ç®¡ç†éƒ¨é—¨å‘ç”Ÿçš„è´¹ç”¨' },
                        { code: '660201', name: 'å·¥èµ„', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'éƒ¨é—¨', status: 'å¯ç”¨', remark: '' },
                        { code: '660202', name: 'ç¤¾ä¿è´¹', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'éƒ¨é—¨', status: 'å¯ç”¨', remark: '' },
                        { code: '660203', name: 'åŠå…¬è´¹', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'éƒ¨é—¨', status: 'å¯ç”¨', remark: '' },
                        { code: '660204', name: 'ä¿é™©è´¹', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'éƒ¨é—¨', status: 'å¯ç”¨', remark: '' },
                        { code: '660205', name: 'æˆ¿ç§Ÿè´¹', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'éƒ¨é—¨', status: 'å¯ç”¨', remark: '' },
                        { code: '660206', name: 'æ°´ç”µè´¹', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'éƒ¨é—¨', status: 'å¯ç”¨', remark: '' },
                        { code: '660207', name: 'ç‰©ä¸šè´¹', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'éƒ¨é—¨', status: 'å¯ç”¨', remark: '' },
                        { code: '660208', name: 'æ‹›å¾…è´¹', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'éƒ¨é—¨', status: 'å¯ç”¨', remark: '' },
                        { code: '660209', name: 'å·®æ—…è´¹', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'éƒ¨é—¨', status: 'å¯ç”¨', remark: '' },
                        { code: '660210', name: 'äº¤é€šè´¹', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'éƒ¨é—¨', status: 'å¯ç”¨', remark: '' },
                        { code: '660211', name: 'é€šè®¯è´¹', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'éƒ¨é—¨', status: 'å¯ç”¨', remark: '' },
                        { code: '660212', name: 'ä¿®ç¼®è´¹', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'éƒ¨é—¨', status: 'å¯ç”¨', remark: '' },
                        { code: '660213', name: 'æ‹›è˜è´¹', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'éƒ¨é—¨', status: 'å¯ç”¨', remark: '' },
                        { code: '660214', name: 'å›ºå®šèµ„äº§æŠ˜æ—§è´¹', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'éƒ¨é—¨', status: 'å¯ç”¨', remark: '' },
                        { code: '660215', name: 'ä½å€¼æ˜“è€—å“', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'éƒ¨é—¨', status: 'å¯ç”¨', remark: '' },
                        { code: '6603', name: 'è´¢åŠ¡è´¹ç”¨', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: 'åˆ©æ¯æ”¯å‡ºã€æ‰‹ç»­è´¹ç­‰' },
                        { code: '660301', name: 'æ±‡æ¬¾æ‰‹ç»­è´¹', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '660302', name: 'ä»£æ”¶æ‰‹ç»­è´¹', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '660303', name: 'åˆ©æ¯æ”¶å…¥', type: 'æŸç›Š', direction: 'è´·', aux: 'æ— ', status: 'å¯ç”¨', remark: 'æ³¨æ„ï¼šåˆ©æ¯æ”¶å…¥è®°è´¢åŠ¡è´¹ç”¨è´·æ–¹' },
                        { code: '6701', name: 'èµ„äº§å‡å€¼æŸå¤±', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '6711', name: 'è¥ä¸šå¤–æ”¯å‡º', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: 'ä¸ç»è¥æ— ç›´æ¥å…³ç³»çš„æ”¯å‡º' },
                        { code: '6801', name: 'æ‰€å¾—ç¨è´¹ç”¨', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: '' },
                        { code: '6901', name: 'ä»¥å‰å¹´åº¦æŸç›Šè°ƒæ•´', type: 'æŸç›Š', direction: 'å€Ÿ', aux: 'æ— ', status: 'å¯ç”¨', remark: '' }
                    ];
                    sessionStorage.setItem('AcctSubjects', JSON.stringify(storedAccounts));
                }

                // 2. æ’åºï¼šæŒ‰ç§‘ç›®ç¼–ç æ’åºï¼Œä¿è¯çˆ¶å­é¡ºåº
                storedAccounts.sort((a, b) => a.code.localeCompare(b.code));

                // 3. ç”Ÿæˆè¡¨æ ¼ HTML
                const rowsHTML = storedAccounts.map(item => {
                    // è®¡ç®—å±‚çº§
                    const level = (item.code.length - 2) / 2; 
                    const indent = (level - 1) * 24; 
                    
                    const statusColor = item.status === 'å¯ç”¨' ? '#27ae60' : '#c0392b';
                    const toggleAction = item.status === 'å¯ç”¨' ? 'åœç”¨' : 'å¯ç”¨';
                    const toggleClass = item.status === 'å¯ç”¨' ? 'color:#e74c3c;' : 'color:#27ae60;';

                    return `
                        <tr id="row-${item.code}">
                            <td>
                                <div style="padding-left:${indent}px;">
                                    <span style="color:#999; margin-right:5px;">${level > 1 ? 'â””â”€' : ''}</span>
                                    <strong>${item.code}</strong>
                                </div>
                            </td>
                            <td class="val-name">${item.name}</td>
                            <td>${item.type}</td>
                            <td>${item.aux || '-'}</td>
                            
                            <td class="val-dir">${item.direction}</td>
                            <td class="val-status"><span style="color: ${statusColor}; font-weight: bold;">${item.status}</span></td>
                            <td class="val-remark" style="color:#777; font-size:12px;">${item.remark || '-'}</td>
                            
                            <td>
                                <a href="javascript:void(0)" onclick="editSubject('${item.code}')" style="color:#3498db;">ç¼–è¾‘</a> | 
                                <a href="javascript:void(0)" onclick="toggleSubjectStatus('${item.code}')" style="${toggleClass}">${toggleAction}</a>
                            </td>
                        </tr>
                    `;
                }).join('');

                contentHTML += `
                    <h2>ä¼šè®¡ç§‘ç›® (Chart of Accounts)</h2>
                    <p style="color: #7f8c8d;">ç®¡ç†ä¼ä¸šçš„ä¼šè®¡ç§‘ç›®ä½“ç³»ã€‚æ”¯æŒå¤šçº§ç§‘ç›®è®¾ç½®ï¼ˆå¦‚ 1001 -> 100101ï¼‰ã€‚</p>
                    
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="ç§‘ç›®ç¼–ç  / åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;" onclick="addSubject()">+ æ–°å¢ç§‘ç›®</button>
                        <button class="btn-primary" style="background-color: #3498db;">å¯¼å…¥ç§‘ç›®è¡¨</button>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th style="width: 180px;">ç§‘ç›®ç¼–ç </th>
                                <th>ç§‘ç›®åç§°</th>
                                <th>ç§‘ç›®ç±»å‹</th>
                                <th>è¾…åŠ©æ ¸ç®—</th>
                                <th style="width: 80px;">ä½™é¢æ–¹å‘</th>
                                <th style="width: 80px;">çŠ¶æ€</th>
                                <th>å¤‡æ³¨</th>
                                <th style="width: 120px;">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${rowsHTML}
                        </tbody>
                    </table>
                `;
            }


            // =========================================================================
            // 30. ä¼šè®¡è´¦å¥— (Acct Set)
            // =========================================================================
            else if (moduleCode === 'AcctSet') {
                contentHTML += `
                    <h2>ä¼šè®¡è´¦å¥—</h2>
                    <p style="color: #7f8c8d;">ç®¡ç†å’Œé…ç½®å¤šå¥—ä¼šè®¡ä¸»ä½“ï¼ˆå¦‚æ€»è´¦å¥—ã€å­å…¬å¸è´¦å¥—ï¼‰ï¼Œç¡®ä¿ç‹¬ç«‹æ ¸ç®—ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="è´¦å¥—åç§° / ç¼–ç " style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ æ–°å¢ä¼šè®¡è´¦å¥—</button>
                    </div>

                    <h3>ä¼šè®¡è´¦å¥—åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>è´¦å¥—ç¼–ç </th>
                                <th>è´¦å¥—åç§°</th>
                                <th>å¯ç”¨æ—¥æœŸ</th>
                                <th>è®°è´¦æœ¬ä½å¸</th>
                                <th>å½“å‰æœŸé—´</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>001</td>
                                <td>é›†å›¢æ€»è´¦å¥— (åˆå¹¶ä¸»ä½“)</td>
                                <td>2024-01-01</td>
                                <td>RMB</td>
                                <td>2025å¹´11æœŸ</td>
                                <td><a href="#" style="color:#3498db;">è®¾ç½®</a> | <a href="#" style="color:#f39c12;">åˆ‡æ¢</a></td>
                            </tr>
                            <tr>
                                <td>002</td>
                                <td>åå—å­å…¬å¸è´¦å¥—</td>
                                <td>2025-01-01</td>
                                <td>RMB</td>
                                <td>2025å¹´11æœŸ</td>
                                <td><a href="#" style="color:#3498db;">è®¾ç½®</a> | <a href="#" style="color:#f39c12;">åˆ‡æ¢</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

          // =========================================================================
            // 31. ä¼šè®¡æœŸé—´ (Acct Period) - æ‚¨çš„æœ€æ–°ä¿®æ”¹ç‰ˆ
            // =========================================================================
            else if (moduleCode === 'AcctPeriod') {
                contentHTML += `
                    <h2>ä¼šè®¡æœŸé—´</h2>
                    <p style="color: #7f8c8d;">å®šä¹‰å’Œæ§åˆ¶è´¦åŠ¡å¤„ç†çš„æœˆä»½æœŸé—´ï¼Œæ”¯æŒå¤šæ ¸ç®—ä¸»ä½“çš„æœŸé—´ç®¡ç†ã€‚</p>
                    
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                            <span style="font-weight:bold; color:#555;">å½“å‰æ ¸ç®—ä¸»ä½“ï¼š</span>
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px; font-weight:bold;">
                                <option>ä¸Šæµ·æ€»éƒ¨è´¦å¥— (é»˜è®¤)</option>
                                <option>å¹¿å·åˆ†æ‹¨è´¦å¥—</option>
                                <option>åŒ—äº¬åˆ†æ‹¨è´¦å¥—</option>
                            </select>
                            
                            <div style="width: 1px; height: 20px; background: #ddd; margin: 0 10px;"></div>
                            
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">å¹´åº¦</option>
                                <option selected>2025</option>
                                <option>2024</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #f39c12;">ğŸ”„ é‡ç®—æœ¬æœŸä½™é¢</button>
                        <button class="btn-primary" style="background-color: #34495e;">ğŸ”’ å¹´ç»ˆæ°¸ä¹…å°è´¦</button>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ä¼šè®¡æœŸé—´</th>
                                <th>èµ·æ­¢æ—¥æœŸ</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2025å¹´1æœŸ</td>
                                <td>2025-1-01 ~ 1-31</td>
                                <td><span style="display:inline-block;width:8px;height:8px;background:#27ae60;border-radius:50%;margin-right:5px;"></span>å·²å®Œç»“(å·²è®°è´¦)</td>
                                <td><a href="#" style="color:#27ae60;">æœŸæœ«ç»“è´¦</a></td>
                            </tr>
                            <tr>
                                <td>2025å¹´2æœŸ</td>
                                <td>2025-2-01 ~ 2-28</td>
                                <td><span style="display:inline-block;width:8px;height:8px;background:#27ae60;border-radius:50%;margin-right:5px;"></span>å·²å®Œç»“(å·²è®°è´¦)</td>
                                <td><a href="#" style="color:#27ae60;">æœŸæœ«ç»“è´¦</a></td>
                            </tr>
                            <tr>
                                <td>2025å¹´3æœŸ</td>
                                <td>2025-3-01 ~ 3-31</td>
                                <td><span style="display:inline-block;width:8px;height:8px;background:#27ae60;border-radius:50%;margin-right:5px;"></span>å·²å®Œç»“(å·²è®°è´¦)</td>
                                <td><a href="#" style="color:#27ae60;">æœŸæœ«ç»“è´¦</a></td>
                            </tr>
                            <tr>
                                <td>2025å¹´4æœŸ</td>
                                <td>2025-4-01 ~ 4-30</td>
                                <td><span style="display:inline-block;width:8px;height:8px;background:#27ae60;border-radius:50%;margin-right:5px;"></span>å·²å®Œç»“(å·²è®°è´¦)</td>
                                <td><a href="#" style="color:#27ae60;">æœŸæœ«ç»“è´¦</a></td>
                            </tr>
                            <tr>
                                <td>2025å¹´5æœŸ</td>
                                <td>2025-5-01 ~ 5-31</td>
                                <td><span style="display:inline-block;width:8px;height:8px;background:#27ae60;border-radius:50%;margin-right:5px;"></span>å·²å®Œç»“(å·²è®°è´¦)</td>
                                <td><a href="#" style="color:#27ae60;">æœŸæœ«ç»“è´¦</a></td>
                            </tr>
                            <tr>
                                <td>2025å¹´6æœŸ</td>
                                <td>2025-6-01 ~ 6-30</td>
                                <td><span style="display:inline-block;width:8px;height:8px;background:#27ae60;border-radius:50%;margin-right:5px;"></span>å·²å®Œç»“(å·²è®°è´¦)</td>
                                <td><a href="#" style="color:#27ae60;">æœŸæœ«ç»“è´¦</a></td>
                            </tr>
                            <tr>
                                <td>2025å¹´7æœŸ</td>
                                <td>2025-7-01 ~ 7-31</td>
                                <td><span style="display:inline-block;width:8px;height:8px;background:#27ae60;border-radius:50%;margin-right:5px;"></span>å·²å®Œç»“(å·²è®°è´¦)</td>
                                <td><a href="#" style="color:#27ae60;">æœŸæœ«ç»“è´¦</a></td>
                            </tr>
                            <tr>
                                <td>2025å¹´8æœŸ</td>
                                <td>2025-8-01 ~ 8-31</td>
                                <td><span style="display:inline-block;width:8px;height:8px;background:#27ae60;border-radius:50%;margin-right:5px;"></span>å·²å®Œç»“(å·²è®°è´¦)</td>
                                <td><a href="#" style="color:#27ae60;">æœŸæœ«ç»“è´¦</a></td>
                            </tr>
                            <tr>
                                <td>2025å¹´9æœŸ</td>
                                <td>2025-9-01 ~ 9-30</td>
                                <td><span style="display:inline-block;width:8px;height:8px;background:#27ae60;border-radius:50%;margin-right:5px;"></span>å·²å®Œç»“(å·²è®°è´¦)</td>
                                <td><a href="#" style="color:#27ae60;">æœŸæœ«ç»“è´¦</a></td>
                            </tr>
                             <tr>
                                <td>2025å¹´10æœŸ</td>
                                <td>2025-10-01 ~ 10-31</td>
                                <td><span style="display:inline-block;width:8px;height:8px;background:gray;border-radius:50%;margin-right:5px;"></span>å·²å…³é—­</td>
                                <td><a href="#" style="color:gray;">åç»“è´¦</a></td>
                            </tr>
                            <tr>
                                <td>2025å¹´11æœŸ</td>
                                <td>2025-11-01 ~ 11-30</td>
                                <td><span style="display:inline-block;width:8px;height:8px;background:red;border-radius:50%;margin-right:5px;"></span>è¿›è¡Œä¸­ (å·²è®°è´¦)</td>
                                <td><a href="#" style="color:red;">æœŸæœ«ç»“è´¦</a></td>
                            </tr>
                            <tr>
                                <td>2025å¹´12æœŸ</td>
                                <td>2025-12-01 ~ 12-31</td>
                                <td><span style="display:inline-block;width:8px;height:8px;background:#f1c40f;border-radius:50%;margin-right:5px;"></span>æœªå¼€å¯</td>
                                <td><span style="color:#999;">å¾…ä¸ŠæœŸç»“è´¦åå¼€å¯</span></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }
            
            
            // =========================================================================
            // 32. è¾…åŠ©æ ¸ç®—é¡¹ (Acct Auxiliary)
            // =========================================================================
            else if (moduleCode === 'AcctAuxiliary') {
                contentHTML += `
                    <h2>è¾…åŠ©æ ¸ç®—é¡¹</h2>
                    <p style="color: #7f8c8d;">å®šä¹‰å’Œç®¡ç†é™¤ç§‘ç›®å¤–çš„é™„åŠ æ ¸ç®—ç»´åº¦ï¼ˆå¦‚å®¢æˆ·ã€ä¾›åº”å•†ã€é¡¹ç›®ã€éƒ¨é—¨ï¼‰ï¼Œç”¨äºç²¾ç»†åŒ–ç®¡ç†åˆ†æã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="è¾…åŠ©é¡¹åç§° / ç¼–ç " style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ æ–°å¢è¾…åŠ©æ ¸ç®—é¡¹</button>
                    </div>

                    <h3>è¾…åŠ©æ ¸ç®—é¡¹åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>è¾…åŠ©é¡¹åç§°</th>
                                <th>ç¼–ç </th>
                                <th>ç”¨é€”è¯´æ˜</th>
                                <th>å…³è”ç§‘ç›®æ•°</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>å®¢æˆ·</td>
                                <td>CUSTOMER</td>
                                <td>åº”æ”¶ã€æ”¶å…¥æ ¸ç®—</td>
                                <td>15</td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹ä½¿ç”¨æƒ…å†µ</a> | <a href="#" style="color:#f39c12;">è®¾ç½®</a></td>
                            </tr>
                            <tr>
                                <td>éƒ¨é—¨</td>
                                <td>DEPT</td>
                                <td>è´¹ç”¨ã€æˆæœ¬åˆ†æ‘Šæ ¸ç®—</td>
                                <td>25</td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹ä½¿ç”¨æƒ…å†µ</a> | <a href="#" style="color:#f39c12;">è®¾ç½®</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // 33. è®°è´¦è§„åˆ™ (Acct Rule)
            // =========================================================================
            else if (moduleCode === 'AcctRule') {
                contentHTML += `
                    <h2>è®°è´¦è§„åˆ™</h2>
                    <p style="color: #7f8c8d;">é…ç½®ä¸šåŠ¡å•æ®ï¼ˆå¦‚è¿å•ã€ç»“ç®—å•ï¼‰è‡ªåŠ¨ç”Ÿæˆä¼šè®¡å‡­è¯çš„é€»è¾‘è§„åˆ™ï¼Œå®ç°ä¸šè´¢ä¸€ä½“åŒ–ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">ä¸šåŠ¡ç±»å‹ (å…¨éƒ¨)</option>
                                <option>è¿è´¹æ”¶å…¥</option>
                                <option>ä¾›åº”å•†ä»˜æ¬¾</option>
                                <option>è´¹ç”¨æŠ¥é”€</option>
                            </select>
                            <input type="text" placeholder="è§„åˆ™åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ æ–°å¢è®°è´¦è§„åˆ™</button>
                    </div>

                    <h3>è®°è´¦è§„åˆ™åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>è§„åˆ™åç§°</th>
                                <th>ä¸šåŠ¡ç±»å‹</th>
                                <th>è§¦å‘æ¡ä»¶</th>
                                <th>ç›®æ ‡ç§‘ç›®</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>åº”æ”¶è¿è´¹æ”¶å…¥</td>
                                <td>è¿å•æ”¶å…¥</td>
                                <td>è¿å•çŠ¶æ€ = å·²å®Œæˆ</td>
                                <td>å€Ÿï¼šåº”æ”¶è´¦æ¬¾ï¼Œè´·ï¼šä¸»è¥ä¸šåŠ¡æ”¶å…¥</td>
                                <td><span style="color: #27ae60;">å¯ç”¨</span></td>
                                <td><a href="#" style="color:#3498db;">ç¼–è¾‘</a> | <a href="#" style="color:#f39c12;">æ¨¡æ‹Ÿæµ‹è¯•</a></td>
                            </tr>
                            <tr>
                                <td>å¹²çº¿è´¹åº”ä»˜</td>
                                <td>å¹²çº¿ç»“ç®—</td>
                                <td>æ‰¹æ¬¡çŠ¶æ€ = å·²ç¡®è®¤</td>
                                <td>å€Ÿï¼šè¿è¾“æˆæœ¬ï¼Œè´·ï¼šåº”ä»˜è´¦æ¬¾</td>
                                <td><span style="color: #27ae60;">å¯ç”¨</span></td>
                                <td><a href="#" style="color:#3498db;">ç¼–è¾‘</a> | <a href="#" style="color:#f39c12;">æ¨¡æ‹Ÿæµ‹è¯•</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // 34. èµ„äº§å¡ç‰‡ (Asset Card)
            // =========================================================================
            else if (moduleCode === 'AssetCard') {
                contentHTML += `
                    <h2>èµ„äº§å¡ç‰‡</h2>
                    <p style="color: #7f8c8d;">å›ºå®šèµ„äº§çš„åŸºç¡€ä¿¡æ¯ç®¡ç†ç•Œé¢ï¼ŒåŒ…å«èµ„äº§çš„è¯¦ç»†ä¿¡æ¯ã€ä»·å€¼å’Œå†å²è®°å½•ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="èµ„äº§ç¼–ç  / åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">èµ„äº§ç±»åˆ« (å…¨éƒ¨)</option>
                                <option>è¿è¾“è½¦è¾†</option>
                                <option>åŠå…¬è®¾å¤‡</option>
                                <option>æˆ¿å±‹åŠå»ºç­‘ç‰©</option>
                            </select>
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">ä½¿ç”¨çŠ¶æ€ (å…¨éƒ¨)</option>
                                <option>ä½¿ç”¨ä¸­</option>
                                <option>é—²ç½®</option>
                                <option>æŠ¥åºŸ</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ æ–°å¢èµ„äº§å¡ç‰‡</button>
                        <button class="btn-primary" style="background-color: #3498db;">æ‰¹é‡å¯¼å…¥</button>
                    </div>

                    <h3>å›ºå®šèµ„äº§å¡ç‰‡åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>èµ„äº§ç¼–ç </th>
                                <th>èµ„äº§åç§°</th>
                                <th>æ‰€å±éƒ¨é—¨</th>
                                <th>åŸå€¼ (RMB)</th>
                                <th>ç´¯è®¡æŠ˜æ—§ (RMB)</th>
                                <th>å‡€å€¼ (RMB)</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>FA202501001</td>
                                <td>é‡å‹ç‰µå¼•è½¦ 01</td>
                                <td>è¿è¥éƒ¨</td>
                                <td>350,000.00</td>
                                <td>50,000.00</td>
                                <td>300,000.00</td>
                                <td><span style="color: #27ae60;">ä½¿ç”¨ä¸­</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹/ä¿®æ”¹</a> | <a href="#" style="color:#e74c3c;">å¤„ç½®</a></td>
                            </tr>
                            <tr>
                                <td>FA202506005</td>
                                <td>è´¢åŠ¡éƒ¨ç”µè„‘</td>
                                <td>è´¢åŠ¡éƒ¨</td>
                                <td>8,000.00</td>
                                <td>1,000.00</td>
                                <td>7,000.00</td>
                                <td><span style="color: #27ae60;">ä½¿ç”¨ä¸­</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹/ä¿®æ”¹</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }
            
            // =========================================================================
            // 35. æŠ˜æ—§è®¡ç®— (Asset Depreciation)
            // =========================================================================
            else if (moduleCode === 'AssetDepreciation') {
                contentHTML += `
                    <h2>æŠ˜æ—§è®¡ç®—</h2>
                    <p style="color: #7f8c8d;">æ‰§è¡Œæ¯æœˆå›ºå®šèµ„äº§æŠ˜æ—§çš„è‡ªåŠ¨è®¡ç®—ã€é¢„è§ˆå’Œè®°è´¦å‡­è¯ç”Ÿæˆã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">ä¼šè®¡æœŸé—´</option>
                                <option>2025å¹´11æœŸ</option>
                                <option>2025å¹´10æœŸ</option>
                            </select>
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">è®¡ç®—çŠ¶æ€</option>
                                <option>å¾…è®¡ç®—</option>
                                <option>å·²å®Œæˆ</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">æ‰§è¡Œæœ¬æœˆæŠ˜æ—§è®¡ç®—</button>
                        <button class="btn-primary" style="background-color: #3498db;">ç”ŸæˆæŠ˜æ—§å‡­è¯</button>
                    </div>

                    <h3>æŠ˜æ—§è®¡ç®—ç»“æœ (2025å¹´11æœŸ)</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æŠ˜æ—§æœŸé—´</th>
                                <th>èµ„äº§æ€»æ•°</th>
                                <th>å‚ä¸æŠ˜æ—§èµ„äº§æ•°</th>
                                <th>æœ¬æœŸæŠ˜æ—§æ€»é¢ (RMB)</th>
                                <th>è®¡ç®—çŠ¶æ€</th>
                                <th>å‡­è¯çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2025å¹´11æœŸ</td>
                                <td>150</td>
                                <td>148</td>
                                <td>38,500.00</td>
                                <td><span style="color: #27ae60;">å·²å®Œæˆ</span></td>
                                <td><span style="color: #f39c12;">å¾…ç”Ÿæˆ</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹æ˜ç»†</a> | <a href="#" style="color:#3498db;">ç”Ÿæˆå‡­è¯</a></td>
                            </tr>
                            <tr>
                                <td>2025å¹´10æœŸ</td>
                                <td>150</td>
                                <td>148</td>
                                <td>38,500.00</td>
                                <td><span style="color: #27ae60;">å·²å®Œæˆ</span></td>
                                <td><span style="color: #27ae60;">å·²ç”Ÿæˆ</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹å‡­è¯</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            // =========================================================================
            // 36. èµ„äº§å˜åŠ¨ (Asset Change)
            // =========================================================================
            else if (moduleCode === 'AssetChange') {
                contentHTML += `
                    <h2>èµ„äº§å˜åŠ¨</h2>
                    <p style="color: #7f8c8d;">è®°å½•å›ºå®šèµ„äº§çš„å¢åŠ ã€å‡å°‘ã€è½¬ç§»å’Œä»·å€¼è°ƒæ•´ç­‰å˜åŠ¨äº‹ä»¶ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="èµ„äº§ç¼–ç  / å˜åŠ¨å•å·" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">å˜åŠ¨ç±»å‹ (å…¨éƒ¨)</option>
                                <option>æ–°å¢</option>
                                <option>æŠ¥åºŸ</option>
                                <option>éƒ¨é—¨è½¬ç§»</option>
                            </select>
                            <input type="date" placeholder="å˜åŠ¨æ—¥æœŸèŒƒå›´" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">+ ç™»è®°æ–°å¢èµ„äº§</button>
                        <button class="btn-primary" style="background-color: #f39c12;">ç™»è®°èµ„äº§å¤„ç½®</button>
                    </div>

                    <h3>èµ„äº§å˜åŠ¨è®°å½•åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å˜åŠ¨å•å·</th>
                                <th>èµ„äº§åç§°</th>
                                <th>å˜åŠ¨ç±»å‹</th>
                                <th>å˜åŠ¨æ—¥æœŸ</th>
                                <th>æ¶‰åŠé‡‘é¢ (RMB)</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ZD20251101</td>
                                <td>é‡å‹ç‰µå¼•è½¦ 02</td>
                                <td><span style="color: #27ae60;">æ–°å¢</span></td>
                                <td>2025-11-15</td>
                                <td>380,000.00</td>
                                <td><span style="color: #27ae60;">å·²å®Œæˆ</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹å¡ç‰‡</a></td>
                            </tr>
                            <tr>
                                <td>ZD20251102</td>
                                <td>æ—§æ‰“å°æœº</td>
                                <td><span style="color: #e74c3c;">æŠ¥åºŸ</span></td>
                                <td>2025-11-18</td>
                                <td>-1,500.00 (å¤„ç½®æŸå¤±)</td>
                                <td><span style="color: #27ae60;">å·²å®Œæˆ</span></td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹è¯¦æƒ…</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

// =========================================================================
            // 37. å‡­è¯å½•å…¥ (VoucherEntryReview) - [ç»ˆæä¿®å¤ç‰ˆï¼šæ‰¾å›å½•å…¥ç•Œé¢]
            // =========================================================================
            else if (moduleCode === 'VoucherEntryReview') {
                
                const savedVouchers = JSON.parse(sessionStorage.getItem('ManualVouchers') || "[]");
                
                const voucherRows = savedVouchers.map(v => {
                    let statusColor = '#999';
                    if (v.status === 'å¾…å®¡æ ¸') statusColor = '#f39c12';
                    else if (v.status === 'å·²é©³å›') statusColor = '#c0392b';
                    else if (v.status === 'å·²å®¡æ ¸' || v.status === 'å·²è®°è´¦') statusColor = '#27ae60';

                    let actionBtns = '';
                    // åªæœ‰æœªç”Ÿæ•ˆçš„å‡­è¯å¯ä»¥ç¼–è¾‘
                    if (v.status === 'å¾…å®¡æ ¸' || v.status === 'å·²é©³å›' || v.status === 'è‰ç¨¿') {
                        actionBtns = `
                            <a href="javascript:void(0)" onclick="editVoucher('${v.id}')" style="color:#3498db;">ç¼–è¾‘</a> | 
                            <a href="javascript:void(0)" onclick="deleteVoucher(this, '${v.id}')" style="color:#e74c3c;">åˆ é™¤</a>
                        `;
                    } else {
                        actionBtns = `<a href="javascript:void(0)" onclick="openVoucherDetail(this)" style="color:#999;">æŸ¥çœ‹</a>`;
                    }

                    return `
                        <tr>
                            <td>${v.id}</td>
                            <td>${v.date}</td>
                            <td style="text-align:right; font-family:'Courier New'; font-weight:bold;">${v.amount}</td>
                            <td>${v.user}</td>
                            <td><span style="color: ${statusColor}; font-weight: bold;">${v.status}</span></td>
                            <td>${actionBtns}</td>
                        </tr>
                    `;
                }).join('');

                contentHTML += `
                    <h2>å‡­è¯å½•å…¥</h2>
                    <p style="color: #7f8c8d;">ç”¨äºå‡ºçº³æˆ–åˆ¶å•äººå‘˜æ‰‹åŠ¨å½•å…¥ä¼šè®¡å‡­è¯ã€‚</p>

                    <div class="action-bar" style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #ccc; padding-bottom: 10px;">
                        <button class="btn-primary" style="background-color: #27ae60;" onclick="resetVoucherForm()">ğŸ”„ é‡ç½®/æ–°å»º</button>
                        <div style="font-weight: bold; color: #2980b9;">å½“å‰ç”Ÿæˆå‡­è¯å·ï¼š<span id="current-v-id">è®°${new Date().getFullYear()}11${Math.floor(Math.random()*1000+1000)}</span></div>
                    </div>
                    
                    <h3>å‡­è¯å½•å…¥åŒºåŸŸ</h3>
                    <div style="border: 1px solid #ccc; padding: 15px; border-radius: 4px; background-color: #f9f9f9; margin-bottom: 20px;">
                        <div style="display: flex; gap: 20px; margin-bottom: 10px;">
                            <span>æ—¥æœŸ: <input type="date" id="v-date" value="2025-11-20" style="padding: 5px; border: 1px solid #ccc;"></span>
                            <span>é™„å•æ®æ•°: <input type="number" value="1" style="width: 50px; padding: 5px; border: 1px solid #ccc;"></span>
                            <span>å¸ç§: <select style="padding: 5px; border: 1px solid #ccc;"><option>RMB</option></select></span>
                        </div>
                        
                        <table class="data-table" style="width: 100%; margin-top: 10px;">
                            <thead>
                                <tr>
                                    <th style="width: 30%;">æ‘˜è¦</th>
                                    <th style="width: 30%;">ä¼šè®¡ç§‘ç›®</th>
                                    <th style="width: 15%; text-align: right;">å€Ÿæ–¹é‡‘é¢ (RMB)</th>
                                    <th style="width: 15%; text-align: right;">è´·æ–¹é‡‘é¢ (RMB)</th>
                                </tr>
                            </thead>
                            <tbody id="entry-table-body">
                                <tr>
                                    <td><input type="text" class="input-summary" placeholder="æ‘˜è¦" style="width: 95%;"></td>
                                    <td><input type="text" class="input-account" placeholder="ç§‘ç›®ä»£ç " style="width: 95%;"></td>
                                    <td><input type="number" class="input-debit" oninput="calculateTotals()" placeholder="0.00" style="width: 95%; text-align: right;"></td>
                                    <td><input type="number" class="input-credit" oninput="calculateTotals()" placeholder="0.00" style="width: 95%; text-align: right;"></td>
                                </tr>
                                <tr>
                                    <td>
                                        <div style="display:flex; align-items:center;">
                                            <a href="javascript:void(0)" onclick="removeEntryRow(this)" style="color:#ccc; margin-right:5px; text-decoration:none; font-size:16px;">âœ•</a>
                                            <input type="text" class="input-summary" placeholder="æ‘˜è¦" style="width: 90%;">
                                        </div>
                                    </td>
                                    <td><input type="text" class="input-account" placeholder="ç§‘ç›®ä»£ç " style="width: 95%;"></td>
                                    <td><input type="number" class="input-debit" oninput="calculateTotals()" placeholder="0.00" style="width: 95%; text-align: right;"></td>
                                    <td><input type="number" class="input-credit" oninput="calculateTotals()" placeholder="0.00" style="width: 95%; text-align: right;"></td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="4" style="padding: 5px;">
                                        <button onclick="addEntryRow()" style="width:100%; padding: 8px; border: 1px dashed #aaa; background: #fff; cursor: pointer; color: #555;">+ æ·»åŠ åˆ†å½•è¡Œ</button>
                                    </td>
                                </tr>
                                <tr style="font-weight: bold; background-color: #eee;">
                                    <td colspan="2" style="text-align: right; padding-right: 20px;">åˆ è®¡ï¼š</td>
                                    <td style="text-align: right; font-size: 16px; color: #27ae60;" id="total-debit-display">0.00</td>
                                    <td style="text-align: right; font-size: 16px; color: #27ae60;" id="total-credit-display">0.00</td>
                                </tr>
                            </tfoot>
                        </table>
                        
                        <div style="margin-top: 15px; text-align: right;">
                            <button class="btn-primary" style="background-color: #f39c12;" onclick="saveVoucher('è‰ç¨¿')">ä¿å­˜è‰ç¨¿</button>
                            <button class="btn-primary" style="background-color: #3498db;" onclick="saveVoucher('å¾…å®¡æ ¸')">æäº¤å®¡æ ¸</button>
                        </div>
                    </div>
                    <h3>æˆ‘çš„å‡­è¯åˆ—è¡¨ (åˆ¶å•)</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å‡­è¯å·</th>
                                <th>æ—¥æœŸ</th>
                                <th style="text-align: right; padding-right: 20px;">é‡‘é¢ (RMB)</th>
                                <th>åˆ¶å•äºº</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${voucherRows}
                            <tr>
                                <td>è®°2025110005</td>
                                <td>2025-11-20</td>
                                <td style="text-align: right; font-family:'Courier New'; font-weight:bold;">15,000.00</td>
                                <td>æå››</td>
                                <td><span style="color: #c0392b; font-weight: bold;">å·²é©³å›</span></td>
                                <td>
                                    <a href="#" onclick="alert('åŠ è½½æ¨¡æ‹Ÿæ•°æ®...')" style="color:#3498db;">ç¼–è¾‘</a> | 
                                    <a href="#" style="color:#e74c3c;">åˆ é™¤</a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

// =========================================================================
            // 38. å‡­è¯æŸ¥è¯¢/å®¡æ ¸ (VoucherQueryPrint) - [ä¿®å¤ç‰ˆï¼šä¼šè®¡å®¡æ ¸æƒé™]
            // =========================================================================
            else if (moduleCode === 'VoucherQueryPrint') {
                
                const manualVouchers = JSON.parse(sessionStorage.getItem('ManualVouchers') || "[]");
                
                const dynamicRows = manualVouchers.map(v => {
                    let statusColor = '#27ae60';
                    let actionBtns = '';

                    // 1. çŠ¶æ€é¢œè‰²åˆ¤æ–­
                    if (v.status === 'å¾…å®¡æ ¸') {
                        statusColor = '#f39c12';
                        actionBtns = `
                            <a href="javascript:void(0)" onclick="auditPass('${v.id}')" style="color:#27ae60; font-weight:bold;">å®¡æ ¸</a> | 
                            <a href="javascript:void(0)" onclick="auditReject('${v.id}')" style="color:#e74c3c;">é©³å›</a>
                        `;
                    } else if (v.status === 'å·²å®¡æ ¸' || v.status === 'å·²è®°è´¦') {
                        statusColor = '#27ae60';
                        actionBtns = `
                            <a href="javascript:void(0)" onclick="openVoucherDetail(this)" style="color:#3498db;">æŸ¥çœ‹</a> | 
                            <a href="javascript:void(0)" onclick="handleRedDash(this, '${v.id}')" style="color:#f39c12;">çº¢å†²</a>
                        `;
                    } else if (v.status === 'å·²é©³å›') {
                        statusColor = '#c0392b';
                        actionBtns = `<span style="color:#999;">ç­‰å¾…é‡æ</span>`;
                    } else if (v.status === 'å·²å†²é”€') {
                         statusColor = '#999';
                         actionBtns = `<span style="color:#ccc;">å·²ä½œåºŸ</span>`;
                    }

                    // 2. â˜…â˜…â˜… æ ¸å¿ƒä¿®å¤ï¼šåŠ¨æ€è·å–æ‘˜è¦ â˜…â˜…â˜…
                    // å¦‚æœæœ‰åˆ†å½•è¡Œï¼Œå–ç¬¬ä¸€è¡Œçš„æ‘˜è¦ï¼›å¦åˆ™æ˜¾ç¤ºé»˜è®¤å€¼
                    const displaySummary = (v.lines && v.lines.length > 0) ? v.lines[0].summary : 'æ‰‹åŠ¨å½•å…¥å‡­è¯';

                    return `
                        <tr id="row-${v.id}">
                            <td><input type="checkbox" ${v.status === 'å¾…å®¡æ ¸' ? '' : 'disabled'}></td>
                            <td class="val-id">${v.id}</td>
                            <td class="val-date">${v.date}</td>
                            
                            <td class="val-summary">${displaySummary}</td>
                            
                            <td class="val-debit">${v.amount}</td>
                            <td class="val-credit">${v.amount}</td>
                            <td class="status-cell"><span style="color: ${statusColor}; font-weight: bold;">${v.status || 'å·²è®°è´¦'}</span></td>
                            <td>${actionBtns}</td>
                        </tr>
                    `;
                }).join('');

                // ... (HTML å…¶ä½™éƒ¨åˆ†ï¼ŒåŒ…æ‹¬è¡¨å¤´ç­‰ï¼Œä¿æŒä¸å˜) ...
                contentHTML += `
                    <h3>å‡­è¯å®¡æ ¸åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th><input type="checkbox"></th>
                                <th>å‡­è¯å·</th>
                                <th>æ—¥æœŸ</th>
                                <th>æ‘˜è¦</th>
                                <th>å€Ÿæ–¹æ€»é¢</th>
                                <th>è´·æ–¹æ€»é¢</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${dynamicRows}
                            <tr>
                                <td><input type="checkbox"></td>
                                <td class="val-id">è®°2025111808</td>
                                <td class="val-date">2025-11-20</td>
                                <td class="val-summary">æ‰‹åŠ¨å½•å…¥å‡­è¯</td>
                                <td class="val-debit">600.00</td>
                                <td class="val-credit">600.00</td>
                                <td class="status-cell"><span style="color: #f39c12; font-weight: bold;">å¾…å®¡æ ¸</span></td>
                                <td>
                                    <a href="javascript:void(0)" onclick="auditPass('è®°2025111808')" style="color:#27ae60; font-weight:bold;">å®¡æ ¸</a> | 
                                    <a href="javascript:void(0)" onclick="auditReject('è®°2025111808')" style="color:#e74c3c;">é©³å›</a>
                                </td>
                            </tr>
                            <tr id="row-è®°2025110001">
                                <td><input type="checkbox" disabled></td>
                                <td class="val-id">è®°2025110001</td>
                                <td class="val-date">2025-11-20</td>
                                <td class="val-summary">æ”¯ä»˜åŠå…¬ç”¨å“æ¬¾</td>
                                <td class="val-debit">500.00</td>
                                <td class="val-credit">500.00</td>
                                <td class="status-cell"><span style="color: #27ae60; font-weight: bold;">å·²è®°è´¦</span></td>
                                <td>
                                    <a href="javascript:void(0)" onclick="openVoucherDetail(this)" style="color:#3498db;">æŸ¥çœ‹</a> | 
                                    <a href="javascript:void(0)" onclick="handleRedDash(this, 'è®°2025110001')" style="color:#f39c12;">çº¢å†²</a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

// =========================================================================
            // 22. å‡­è¯è¯¦æƒ…é¡µ (VoucherDetail) - [æœ€ç»ˆä¿®å¤ç‰ˆï¼šè‡ªåŠ¨è®¡ç®—åˆè®¡é‡‘é¢]
            // =========================================================================
            else if (moduleCode === 'VoucherDetail') {
                // 1. å°è¯•è·å–ä¼ é€’çš„åŸºç¡€ä¿¡æ¯
                let v = g_currentVoucher || { id: 'æ— æ•°æ®' };

                // è‡ªåŠ¨å›æå®Œæ•´æ•°æ®
                if (v.id) {
                    const allVouchers = JSON.parse(sessionStorage.getItem('ManualVouchers') || "[]");
                    const fullData = allVouchers.find(item => item.id === v.id);
                    if (fullData) v = fullData;
                }

                // æ•°æ®å…œåº•
                if (!v.lines) v.lines = []; 

                // â˜…â˜…â˜… æ ¸å¿ƒä¿®å¤ï¼šç°åœºé‡æ–°è®¡ç®—åˆè®¡é‡‘é¢ (ä¸å†ä¾èµ– v.debit) â˜…â˜…â˜…
                let calcDebit = 0;
                let calcCredit = 0;

                v.lines.forEach(line => {
                    // å…¼å®¹ä¸åŒå­—æ®µåå¹¶å»é€—å·
                    const dStr = (line.jf || line.debit || '0').toString().replace(/,/g, '');
                    const cStr = (line.df || line.credit || '0').toString().replace(/,/g, '');
                    
                    calcDebit += parseFloat(dStr) || 0;
                    calcCredit += parseFloat(cStr) || 0;
                });

                // æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸² (ä¿ç•™2ä½å°æ•°)
                const totalDebitStr = calcDebit.toFixed(2);
                const totalCreditStr = calcCredit.toFixed(2);
                // â˜…â˜…â˜… ä¿®å¤ç»“æŸ â˜…â˜…â˜…

                // è§£ææ—¥æœŸ
                const dateVal = v.date || new Date().toISOString().slice(0,10);
                const dateObj = new Date(dateVal);
                const y = dateObj.getFullYear();
                const m = String(dateObj.getMonth() + 1).padStart(2, '0');
                const d = String(dateObj.getDate()).padStart(2, '0');

                // æ ·å¼ä¿æŒä¸å˜
                const voucherStyle = `
                    <style>
                        .voucher-box {
                            font-family: "SimSun", "Songti SC", serif;
                            color: #333;
                            width: 1000px;
                            margin: 0 auto;
                            padding: 30px;
                            background: #fff;
                            position: relative;
                            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                            border: 1px solid #ddd;
                        }
                        .v-title-container { text-align: center; margin-bottom: 10px; position: relative; }
                        .v-title {
                            font-size: 36px; font-weight: bold; letter-spacing: 15px;
                            display: inline-block; border-bottom: 3px double #333;
                            padding-bottom: 5px; margin-bottom: 5px; text-shadow: 0.5px 0 0 #333;
                        }
                        .v-header-info {
                            display: flex; justify-content: space-between; align-items: flex-end;
                            margin-bottom: 5px; font-size: 15px; padding: 0 5px;
                        }
                        .v-date-group span {
                            display: inline-block; border-bottom: 1px solid #333;
                            width: 50px; text-align: center; margin: 0 2px; font-family: Arial;
                        }
                        .v-table { width: 100%; border-collapse: collapse; border: 2px solid #333; }
                        .v-table th, .v-table td {
                            border: 1px solid #333; height: 40px; vertical-align: middle; font-size: 15px;
                        }
                        .v-table th { text-align: center; font-weight: bold; padding: 5px; }
                        
                        /* é‡‘é¢ç½‘æ ¼èƒŒæ™¯ */
                        .money-grid-bg {
                            background-image: linear-gradient(to right, transparent 95%, #ddd 95%);
                            background-size: 9.09% 100%; 
                            font-family: 'Courier New', monospace; font-size: 18px; font-weight: bold;
                            letter-spacing: 6px; text-align: right; padding-right: 3px; overflow: hidden;
                        }
                        .money-header-row div {
                            display: flex; justify-content: space-between; padding: 0 2px;
                            color: #666; font-weight: normal; transform: scale(0.95); font-size: 12px;
                        }
                        .money-header-row span { flex: 1; text-align: center; border-right: 1px solid #eee; }
                        .money-header-row span:last-child { border: 0; }
                        .v-footer {
                            margin-top: 15px; display: flex; justify-content: space-between; font-size: 14px; padding: 0 10px;
                        }
                        .v-footer span {
                            display: inline-block; width: 70px; border-bottom: 1px solid #333; height: 20px; text-align: center;
                        }
                        .attachment-side { position: absolute; right: -25px; top: 110px; width: 20px; font-size: 13px; line-height: 1.2; text-align: center; }
                    </style>
                `;

                // åŠ¨æ€ç”Ÿæˆåˆ†å½•è¡Œ
                let linesHTML = '';
                const minRows = 5;
                const loopCount = Math.max(v.lines.length, minRows);

                for (let i = 0; i < loopCount; i++) {
                    const line = v.lines[i] || {}; 
                    
                    const summary = line.summary || line.zy || '';
                    const accountStr = line.account || line.km || '';
                    let debit = line.debit || line.jf || '';
                    let credit = line.credit || line.df || '';

                    let subjectCode = '';
                    let subjectName = accountStr;
                    
                    const match = accountStr.match(/^(\d+)\s+(.*)/); 
                    if (match) {
                        subjectCode = match[1]; 
                        subjectName = match[2]; 
                    } else if (/^\d+$/.test(accountStr)) {
                        subjectCode = accountStr;
                        subjectName = ''; 
                    }

                    const debitVal = debit ? debit.toString().replace(/,/g, '') : '';
                    const creditVal = credit ? credit.toString().replace(/,/g, '') : '';
                    const rowColor = v.isRed ? 'color: red;' : '';

                    linesHTML += `
                        <tr style="${rowColor}">
                            <td style="padding:0 8px;">${summary}</td>
                            <td style="padding:0 8px;">${subjectName}</td>
                            <td style="padding:0 8px; text-align:center;">${subjectCode}</td>
                            <td style="text-align:center;">${summary ? 'âˆš' : ''}</td>
                            <td class="money-grid-bg">${debitVal}</td>
                            <td class="money-grid-bg">${creditVal}</td>
                        </tr>
                    `;
                }

                contentHTML += `
                    ${voucherStyle}
                    
                    <div style="margin-bottom:20px; display:flex; justify-content:space-between;">
                        <button class="btn-primary" style="background-color: #95a5a6;" onclick="loadContent('VoucherQueryPrint')"> < è¿”å›åˆ—è¡¨</button>
                        <div>
                            <button class="btn-primary" style="background-color: #3498db;" onclick="window.print()">ğŸ–¨ æ‰“å°å‡­è¯</button>
                        </div>
                    </div>

                    <div class="voucher-box">
                        <div class="v-title-container">
                            <div class="v-title">è®° è´¦ å‡­ è¯</div>
                            <div style="position:absolute; right:10px; top:10px; font-size:14px;">è®°å­—ç¬¬ ${v.id.replace(/\D/g, '')} å·</div>
                        </div>

                        <div class="v-header-info">
                            <div style="visibility:hidden;">å ä½</div>
                            <div class="v-date-group">
                                <span>${y}</span>å¹´<span>${m}</span>æœˆ<span>${d}</span>æ—¥
                            </div>
                            <div style="visibility:hidden;">å ä½</div>
                        </div>

                        <table class="v-table">
                            <thead>
                                <tr>
                                    <th rowspan="2" style="width: 22%;">æ‘˜ è¦</th>
                                    <th rowspan="2" style="width: 18%;">æ€»è´¦ç§‘ç›®</th>
                                    <th rowspan="2" style="width: 15%;">æ˜ç»†ç§‘ç›®</th>
                                    <th rowspan="2" style="width: 30px;">âˆš</th>
                                    <th style="width: 20%;">å€Ÿ æ–¹ é‡‘ é¢</th>
                                    <th style="width: 20%;">è´· æ–¹ é‡‘ é¢</th>
                                </tr>
                                <tr class="money-header-row">
                                    <th style="padding:0;">
                                        <div style="border:none;">
                                            <span>åƒ</span><span>ç™¾</span><span>å</span><span>ä¸‡</span><span>åƒ</span><span>ç™¾</span><span>å</span><span>å…ƒ</span><span>è§’</span><span>åˆ†</span>
                                        </div>
                                    </th>
                                    <th style="padding:0;">
                                        <div style="border:none;">
                                            <span>åƒ</span><span>ç™¾</span><span>å</span><span>ä¸‡</span><span>åƒ</span><span>ç™¾</span><span>å</span><span>å…ƒ</span><span>è§’</span><span>åˆ†</span>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                ${linesHTML}
                                <tr style="${v.isRed ? 'color:red;' : ''}">
                                    <td colspan="3" style="text-align: left; padding-left: 20px; font-weight: bold;">åˆã€€ã€€è®¡</td>
                                    <td></td>
                                    <td class="money-grid-bg">
                                        <span style="float:left; font-size:12px; margin-top:3px; margin-left:5px;">Â¥</span>
                                        ${totalDebitStr}
                                    </td>
                                    <td class="money-grid-bg">
                                        <span style="float:left; font-size:12px; margin-top:3px; margin-left:5px;">Â¥</span>
                                        ${totalCreditStr}
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="attachment-side">é™„<br>å•<br>æ®<br><br><strong>1</strong><br><br>å¼ </div>

                        <div class="v-footer">
                            <div>è´¢åŠ¡ä¸»ç®¡ï¼š<span>___________</span></div>
                            <div>è®°è´¦ï¼š<span>${v.status==='å·²è®°è´¦'?'ç³»ç»Ÿ':''}</span></div>
                            <div>å‡ºçº³ï¼š<span>___________</span></div>
                            <div>å®¡æ ¸ï¼š<span>å¼ ä¸‰</span></div>
                            <div>åˆ¶å•ï¼š<span>${v.user || 'ç³»ç»Ÿå¼•æ“'}</span></div>
                        </div>
                    </div>
                `;
            }



// =========================================================================
            // 39. ç§‘ç›®æ±‡æ€»è¡¨ (AcctSubjectSummary) - [ç»ˆæä¿®å¤ç‰ˆï¼šç²¾å‡†æ±‡æ€»]
            // =========================================================================
            else if (moduleCode === 'AcctSubjectSummary') {
                
                const includeUnchecked = false; // é»˜è®¤ä¸å«æœªå®¡æ ¸
                const vouchers = JSON.parse(sessionStorage.getItem('ManualVouchers') || "[]");
                
                // 1. å®šä¹‰åŸºç¡€ç§‘ç›®å­—å…¸
                // å…³é”®æŠ€å·§ï¼šæŠŠä¸­æ–‡åç§°ä¹Ÿåšæˆæ˜ å°„ï¼Œé˜²æ­¢å½•å…¥æ—¶åªå†™ä¸­æ–‡åŒ¹é…ä¸åˆ°
                let summaryMap = {
                    '1001': { code:'1001', name:'åº“å­˜ç°é‡‘', start: 5000.00, debit: 0, credit: 0, dir: 'å€Ÿ' },
                    '1002': { code:'1002', name:'é“¶è¡Œå­˜æ¬¾', start: 800000.00, debit: 0, credit: 0, dir: 'å€Ÿ' },
                    '1122': { code:'1122', name:'åº”æ”¶è´¦æ¬¾', start: 150000.00, debit: 0, credit: 0, dir: 'å€Ÿ' },
                    '2202': { code:'2202', name:'åº”ä»˜è´¦æ¬¾', start: 60000.00, debit: 0, credit: 0, dir: 'è´·' },
                    '6001': { code:'6001', name:'ä¸»è¥ä¸šåŠ¡æ”¶å…¥', start: 0.00, debit: 0, credit: 0, dir: 'è´·' },
                    '6602': { code:'6602', name:'ç®¡ç†è´¹ç”¨', start: 0.00, debit: 0, credit: 0, dir: 'å€Ÿ' },
                    '6401': { code:'6401', name:'ä¸»è¥ä¸šåŠ¡æˆæœ¬', start: 0.00, debit: 0, credit: 0, dir: 'å€Ÿ' },
                    '4103': { code:'4103', name:'æœ¬å¹´åˆ©æ¶¦', start: 0.00, debit: 0, credit: 0, dir: 'è´·' }
                };

                // 2. éå†å‡­è¯
                vouchers.forEach(v => {
                    let isValid = false;
                    if (v.status === 'å·²å®¡æ ¸' || v.status === 'å·²è®°è´¦') isValid = true;
                    if (includeUnchecked && (v.status === 'å¾…å®¡æ ¸' || v.status === 'è‰ç¨¿')) isValid = true;
                    if (v.status === 'å·²é©³å›' || v.status === 'å·²å†²é”€') isValid = false;

                    if (isValid && v.lines) {
                        v.lines.forEach(line => {
                            const acctInput = line.account ? line.account.trim() : 'æœªå½•å…¥';
                            const debitVal = parseFloat(line.debit) || 0;
                            const creditVal = parseFloat(line.credit) || 0;

                            // â˜…â˜…â˜… æ™ºèƒ½åŒ¹é…é€»è¾‘ â˜…â˜…â˜…
                            let targetKey = null;

                            // A. å…ˆè¯•ç€æ‰¾ä»£ç  (æ¯”å¦‚ "6001")
                            const codeMatch = acctInput.match(/^\d+/);
                            if (codeMatch && summaryMap[codeMatch[0]]) {
                                targetKey = codeMatch[0];
                            } 
                            // B. å¦‚æœæ²¡ä»£ç ï¼Œè¯•ç€æ‰¾ä¸­æ–‡åç§° (æ¯”å¦‚ "ä¸»è¥ä¸šåŠ¡æ”¶å…¥")
                            else {
                                targetKey = Object.keys(summaryMap).find(k => summaryMap[k].name === acctInput || acctInput.includes(summaryMap[k].name));
                            }

                            if (targetKey) {
                                // æ‰¾åˆ°äº†é¢„è®¾ç§‘ç›® -> ç´¯åŠ 
                                summaryMap[targetKey].debit += debitVal;
                                summaryMap[targetKey].credit += creditVal;
                            } else {
                                // æ²¡æ‰¾åˆ° -> åŠ¨æ€æ–°å¢ä¸€è¡Œ (ç”¨è¾“å…¥å†…å®¹åš key)
                                if (!summaryMap[acctInput]) {
                                    summaryMap[acctInput] = { 
                                        code: acctInput, name: '(è‡ªå½•å…¥)', start: 0, debit: 0, credit: 0, dir: 'å€Ÿ' 
                                    };
                                }
                                summaryMap[acctInput].debit += debitVal;
                                summaryMap[acctInput].credit += creditVal;
                            }
                        });
                    }
                });

                // 3. ç”Ÿæˆ HTML
                let rowsHTML = '';
                let totalDebit = 0, totalCredit = 0;
                
                // æŒ‰ç§‘ç›®ä»£ç æ’åº
                const sortedKeys = Object.keys(summaryMap).sort();

                sortedKeys.forEach(key => {
                    const data = summaryMap[key];
                    
                    // è®¡ç®—æœŸæœ«
                    let endBalance = 0;
                    if (data.dir === 'å€Ÿ') {
                        endBalance = data.start + data.debit - data.credit;
                    } else {
                        endBalance = data.start + data.credit - data.debit;
                    }

                    totalDebit += data.debit;
                    totalCredit += data.credit;

                    // â˜…â˜…â˜… åªè¦æœ‰ä½™é¢ OR æœ‰å‘ç”Ÿé¢ï¼Œå°±æ˜¾ç¤ºï¼â˜…â˜…â˜…
                    // å“ªæ€•ä½™é¢æ˜¯0ï¼Œåªè¦æœ¬æœŸå‘ç”Ÿè¿‡ï¼ˆdebit/creditä¸ä¸º0ï¼‰ï¼Œä¹Ÿè¦æ˜¾ç¤ºå‡ºæ¥
                    if (data.start !== 0 || data.debit !== 0 || data.credit !== 0) {
                        rowsHTML += `
                            <tr>
                                <td>${data.code}</td>
                                <td>${data.name}</td>
                                <td>${data.dir}</td>
                                <td style="text-align:right; color:#999;">${data.start.toLocaleString('en-US', {minimumFractionDigits: 2})}</td>
                                <td style="text-align:right; font-weight:bold; color:${data.debit > 0 ? '#2980b9' : '#333'}">${data.debit.toLocaleString('en-US', {minimumFractionDigits: 2})}</td>
                                <td style="text-align:right; font-weight:bold; color:${data.credit > 0 ? '#2980b9' : '#333'}">${data.credit.toLocaleString('en-US', {minimumFractionDigits: 2})}</td>
                                <td style="text-align:right; color:#27ae60; font-weight:bold;">${endBalance.toLocaleString('en-US', {minimumFractionDigits: 2})}</td>
                                <td><a href="javascript:void(0)" onclick="openSubjectDetail('${data.code}', '${data.name}')" style="color:#3498db;">è”æŸ¥æ˜ç»†</a></td>
                            </tr>
                        `;
                    }
                });

                contentHTML += `
                    <h2>ç§‘ç›®æ±‡æ€»è¡¨</h2>
                    <p style="color: #7f8c8d;">å®æ—¶æ±‡æ€»å½“å‰ä¼šè®¡æœŸé—´å„ç§‘ç›®çš„å‘ç”Ÿé¢åŠä½™é¢ã€‚</p>
                    <div class="filter-area" style="background:white;padding:15px;margin-bottom:20px;">
                        <button class="btn-primary" onclick="loadContent('AcctSubjectSummary')">åˆ·æ–°æ•°æ®</button>
                    </div>
                    <h3>2025å¹´11æœŸ æ±‡æ€»æ•°æ®</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ç§‘ç›®ç¼–ç </th><th>ç§‘ç›®åç§°</th><th>æ–¹å‘</th>
                                <th style="text-align:right;">æœŸåˆä½™é¢</th>
                                <th style="text-align:right;background:#eef2f3;">å€Ÿæ–¹å‘ç”Ÿ</th>
                                <th style="text-align:right;background:#eef2f3;">è´·æ–¹å‘ç”Ÿ</th>
                                <th style="text-align:right;">æœŸæœ«ä½™é¢</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>${rowsHTML}</tbody>
                        <tfoot>
                            <tr style="font-weight:bold;background:#f0f0f0;">
                                <td colspan="4" style="text-align:center;">åˆ è®¡</td>
                                <td style="text-align:right;color:#e74c3c;">${totalDebit.toLocaleString('en-US', {minimumFractionDigits: 2})}</td>
                                <td style="text-align:right;color:#e74c3c;">${totalCredit.toLocaleString('en-US', {minimumFractionDigits: 2})}</td>
                                <td colspan="2"></td>
                            </tr>
                        </tfoot>
                    </table>
                `;
            }

// =========================================================================
            // 40. ä¸šåŠ¡å•æ®æ˜ å°„é…ç½® (EngineMapping) - [åŠŸèƒ½å¢å¼ºç‰ˆï¼šæ”¯æŒå¢æ”¹åœ]
            // =========================================================================
            else if (moduleCode === 'EngineMapping') {
                
                // 1. åˆå§‹åŒ–é»˜è®¤æ•°æ® (å¦‚æœ Session ä¸ºç©º)
                let mappings = JSON.parse(sessionStorage.getItem('EngineMappings'));
                if (!mappings) {
                    mappings = [
                        { id: 'MAP_CST_REV_AIR', name: 'é™†è¿å‡ºå£æ”¶å…¥ç¡®è®¤', type: 'å®¢æˆ·ç»“ç®—å•', condition: "ä¸šåŠ¡çº¿=é™†è¿ä¸”çŠ¶æ€=å·²ç¡®è®¤", template: 'TPL_REV_AIR', status: 'ç¦ç”¨' },
                        { id: 'MAP_AP_PAYMENT', name: 'ä¾›åº”å•†è¿è´¹åº”ä»˜', type: 'ä¾›åº”å•†å¯¹è´¦å•', condition: "çŠ¶æ€=å·²å®¡æ‰¹", template: 'TPL_COST_TRUNK', status: 'ç¦ç”¨' }
                    ];
                    sessionStorage.setItem('EngineMappings', JSON.stringify(mappings));
                }

// 2. ç”Ÿæˆè¡¨æ ¼è¡Œ (æ–°å¢äº†åˆ é™¤æŒ‰é’®)
                const rowsHTML = mappings.map(item => {
                    const statusColor = item.status === 'å¯ç”¨' ? '#27ae60' : '#c0392b';
                    const toggleAction = item.status === 'å¯ç”¨' ? 'ç¦ç”¨' : 'å¯ç”¨';
                    const toggleColor = item.status === 'å¯ç”¨' ? '#e74c3c' : '#27ae60';
                    
                    return `
                        <tr>
                            <td>${item.id}</td>
                            <td>${item.name}</td>
                            <td>${item.type}</td>
                            <td>${item.condition}</td>
                            <td>${item.template}</td>
                            <td><span style="color: ${statusColor}; font-weight: bold;">${item.status}</span></td>
                            <td>
                                <a href="javascript:void(0)" onclick="editMapping('${item.id}')" style="color:#3498db;">ç¼–è¾‘</a> | 
                                <a href="javascript:void(0)" onclick="toggleMappingStatus('${item.id}')" style="color:${toggleColor};">${toggleAction}</a> |
                                <a href="javascript:void(0)" onclick="deleteMapping(this, '${item.id}')" style="color:#c0392b;">åˆ é™¤</a>
                            </td>
                        </tr>
                    `;
                }).join('');

                contentHTML += `
                    <h2>ä¸šåŠ¡å•æ®æ˜ å°„é…ç½® ğŸ”—</h2>
                    <p style="color: #7f8c8d;">å®šä¹‰å’Œç®¡ç†ä¸šåŠ¡ç³»ç»Ÿå•æ®ä¸ä¼šè®¡å‡­è¯çš„è½¬æ¢è§„åˆ™ï¼Œæ˜¯ä¸šè´¢ä¸€ä½“åŒ–çš„æ ¸å¿ƒã€‚</p>
                    
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">æºå•æ®ç±»å‹ (å…¨éƒ¨)</option>
                                <option>å®¢æˆ·ç»“ç®—å•</option>
                                <option>ä¾›åº”å•†å¯¹è´¦å•</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;" onclick="addMapping()">+ æ–°å¢æ˜ å°„é…ç½®</button>
                        <button class="btn-primary" style="background-color: #f39c12;" onclick="testMapping()">æ¨¡æ‹Ÿæµ‹è¯•</button>
                    </div>

                    <h3>æ˜ å°„é…ç½®åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>é…ç½®ID</th>
                                <th>é…ç½®åç§°</th>
                                <th>æºå•æ®ç±»å‹</th>
                                <th>è§¦å‘æ¡ä»¶</th>
                                <th>å…³è”æ¨¡æ¿</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${rowsHTML}
                        </tbody>
                    </table>
                    <p style="margin-top:10px; color:#999; font-size:12px;">* æç¤ºï¼šç¦ç”¨é…ç½®åï¼Œå¯¹åº”çš„ä¸šåŠ¡å•æ®å°†æ— æ³•è‡ªåŠ¨ç”Ÿæˆå‡­è¯ã€‚</p>
                `;
            }


// =========================================================================
            // 41. è‡ªåŠ¨åˆ†å½•æ¨¡æ¿ (EngineTemplate) - [åŠŸèƒ½å¢å¼ºç‰ˆï¼šæ”¯æŒé…ç½®]
            // =========================================================================
            else if (moduleCode === 'EngineTemplate') {
                
                // 1. è¯»å–æ¨¡æ¿æ•°æ®
                let templates = JSON.parse(sessionStorage.getItem('AutoVoucherTemplates') || "[]");
                
                // å¦‚æœä¸ºç©ºï¼Œåˆå§‹åŒ–ä¸€ä¸ªé»˜è®¤æ¨¡æ¿ç”¨äºæ¼”ç¤º
                if (templates.length === 0) {
                    templates = [{
                        id: 'TPL_REV_001',
                        name: 'é™†è¿æ ‡å‡†æ¨¡æ¿',
                        matchRule: { bizType: 'é™†è¿', invoiceType: 'ä¸“ç”¨å‘ç¥¨' },
                        entries: [
                            { dir: 'å€Ÿ', subject: '1122 åº”æ”¶è´¦æ¬¾', amountType: 'ä»·ç¨åˆè®¡' },
                            { dir: 'è´·', subject: '6001 ä¸»è¥ä¸šåŠ¡æ”¶å…¥', amountType: 'ä¸å«ç¨é‡‘é¢' },
                            { dir: 'è´·', subject: '2221 åº”äº¤ç¨è´¹-é”€é¡¹', amountType: 'ç¨é¢' }
                        ],
                        status: 'å¯ç”¨'
                    }];
                    sessionStorage.setItem('AutoVoucherTemplates', JSON.stringify(templates));
                }

                // 2. ç”Ÿæˆåˆ—è¡¨ HTML
                const rowsHTML = templates.map(t => `
                    <tr>
                        <td>${t.id}</td>
                        <td><strong>${t.name}</strong></td>
                        <td>ä¸šåŠ¡çº¿:${t.matchRule.bizType} | å‘ç¥¨:${t.matchRule.invoiceType}</td>
                        <td>${t.entries.length} è¡Œåˆ†å½•</td>
                        <td><span style="color:${t.status==='å¯ç”¨'?'#27ae60':'#ccc'}">${t.status}</span></td>
                        <td>
                            <a href="javascript:void(0)" onclick="deleteTemplate('${t.id}')" style="color:#e74c3c;">åˆ é™¤</a>
                        </td>
                    </tr>
                `).join('');

                contentHTML += `
                    <h2>è‡ªåŠ¨åˆ†å½•æ¨¡æ¿ ğŸ“‹</h2>
                    <p style="color: #7f8c8d;">å®šä¹‰å‘ç¥¨å¼€å…·åè‡ªåŠ¨ç”Ÿæˆå‡­è¯çš„è§„åˆ™ã€‚</p>
                    
                    <div id="tpl-list-view">
                        <div class="action-bar" style="margin-bottom: 15px;">
                            <button class="btn-primary" style="background-color: #27ae60;" onclick="showTemplateForm()">+ æ–°å¢åˆ†å½•æ¨¡æ¿</button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>æ¨¡æ¿ç¼–ç </th><th>æ¨¡æ¿åç§°</th><th>é€‚ç”¨æ¡ä»¶ (è§¦å‘è§„åˆ™)</th><th>åˆ†å½•è¡Œæ•°</th><th>çŠ¶æ€</th><th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>${rowsHTML}</tbody>
                        </table>
                    </div>

                    <div id="tpl-edit-view" style="display:none; background:#fff; padding:20px; border-radius:8px; border:1px solid #ddd;">
                        <h3 style="margin-top:0;">æ–°å¢/ç¼–è¾‘æ¨¡æ¿</h3>
                        <div style="display:flex; gap:15px; margin-bottom:15px;">
                            <input type="text" id="tpl-name" placeholder="æ¨¡æ¿åç§° (å¦‚: é™†è¿è¿æ”¶å…¥æ¨¡æ¿)" style="padding:8px; width:200px; border:1px solid #ccc;">
                            <select id="tpl-bizType" style="padding:8px; border:1px solid #ccc;">
                                <option value="é€šç”¨">é€šç”¨ä¸šåŠ¡</option>
                                <option value="é™†è¿">é™†è¿</option>
                                <option value="ç©ºè¿">ç©ºè¿</option>
                                <option value="æµ·è¿">æµ·è¿</option>
                            </select>
                            <select id="tpl-invType" style="padding:8px; border:1px solid #ccc;">
                                <option value="ä¸“ç”¨å‘ç¥¨">å¢å€¼ç¨ä¸“ç”¨å‘ç¥¨</option>
                                <option value="æ™®é€šå‘ç¥¨">æ™®é€šå‘ç¥¨</option>
                            </select>
                        </div>
                        
                        <div style="background:#f9f9f9; padding:10px; border-left:4px solid #3498db; margin-bottom:15px;">
                            <strong>åˆ†å½•è§„åˆ™é…ç½®ï¼š</strong>
                            <ul style="font-size:13px; color:#666; margin:5px 0 0 20px;">
                                <li>è¡Œ1 (å€Ÿ)ï¼š1122 åº”æ”¶è´¦æ¬¾ (é‡‘é¢ = ä»·ç¨åˆè®¡)</li>
                                <li>è¡Œ2 (è´·)ï¼š6001 ä¸»è¥ä¸šåŠ¡æ”¶å…¥ (é‡‘é¢ = ä¸å«ç¨é‡‘é¢)</li>
                                <li>è¡Œ3 (è´·)ï¼š2221 åº”äº¤ç¨è´¹-é”€é¡¹ (é‡‘é¢ = ç¨é¢)</li>
                            </ul>
                            <p style="font-size:12px; color:#999;">(ä¸ºç®€åŒ–åŸå‹ï¼Œæ­¤å¤„ä½¿ç”¨å›ºå®šé€»è¾‘ï¼Œå®é™…å¼€å‘éœ€æ”¯æŒåŠ¨æ€å¢å‡è¡Œ)</p>
                        </div>

                        <div style="text-align:right;">
                            <button class="btn-primary" style="background-color:#95a5a6;" onclick="hideTemplateForm()">å–æ¶ˆ</button>
                            <button class="btn-primary" onclick="saveTemplate()">ä¿å­˜é…ç½®</button>
                        </div>
                    </div>
                `;
            }

            // =========================================================================
            // 42. å‡­è¯ç”Ÿæˆæ—¥å¿— (EngineLog)
            // =========================================================================
            else if (moduleCode === 'EngineLog') {
                contentHTML += `
                    <h2>å‡­è¯ç”Ÿæˆæ—¥å¿— ğŸ“œ</h2>
                    <p style="color: #7f8c8d;">æä¾›è‡ªåŠ¨ç”Ÿæˆå‡­è¯è¿‡ç¨‹çš„å®¡è®¡è¿½è¸ªã€‚è®°å½•æ¯æ¬¡å•æ®è½¬æ¢çš„ç»“æœå’Œé”™è¯¯ä¿¡æ¯ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="date" placeholder="èµ·å§‹æ—¥æœŸ" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">ç”ŸæˆçŠ¶æ€ (å…¨éƒ¨)</option>
                                <option>æˆåŠŸ</option>
                                <option>å¤±è´¥</option>
                                <option>éƒ¨åˆ†æˆåŠŸ</option>
                            </select>
                            <input type="text" placeholder="æºå•æ®å· / å‡­è¯å·" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>

                    <h3>è‡ªåŠ¨åˆ†å½•æ—¥å¿—è®°å½•</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æ—¶é—´æˆ³</th>
                                <th>æºå•æ®ç±»å‹/å·</th>
                                <th>ç”Ÿæˆå‡­è¯å·</th>
                                <th>é‡‘é¢ (RMB)</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œäºº/ç³»ç»Ÿ</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2025-11-20 20:58:30</td>
                                <td>ç»“ç®—å• CS008976</td>
                                <td>è‡ª2025110015</td>
                                <td>15,000.00</td>
                                <td><span style="color: #27ae60; font-weight: bold;">æˆåŠŸ</span></td>
                                <td>System Batch</td>
                                <td><a href="#" style="color:#3498db;">æŸ¥çœ‹å‡­è¯</a> | <a href="#" style="color:#27ae60;">é‡è¯•</a></td>
                            </tr>
                            <tr>
                                <td>2025-11-20 20:59:15</td>
                                <td>æŠ¥é”€å• BX201005</td>
                                <td>-</td>
                                <td>800.00</td>
                                <td><span style="color: #e74c3c; font-weight: bold;">å¤±è´¥</span></td>
                                <td>User_LiLei</td>
                                <td><a href="#" style="color:#e74c3c;">æŸ¥çœ‹é”™è¯¯è¯¦æƒ…</a> | <a href="#" style="color:#3498db;">ä¿®æ”¹å¹¶é‡è¯•</a></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }
            
// =========================================================================
            // 43. ç»“è½¬æŸç›Š (PeriodEndProfit) - [é€»è¾‘ä¿®å¤ç‰ˆï¼šé»˜è®¤æœªç»“è½¬ + çœŸå®è®¡ç®—]
            // =========================================================================
            else if (moduleCode === 'PeriodEndProfit') {
                
                // 1. è¯»å–çŠ¶æ€ (é»˜è®¤ä¸º false/æœªç»“è½¬)
                const isTransferred = sessionStorage.getItem('2025-11-ProfitTransferred') === 'true';
                
                // 2. è¯»å–å·²ä¿å­˜çš„ç»“è½¬é‡‘é¢ (å¦‚æœæ²¡æœ‰ï¼Œè¯´æ˜è¿˜æ²¡ç®—è¿‡)
                const savedAmount = sessionStorage.getItem('2025-11-ProfitAmount');
                
                // 3. è®¾ç½®æ˜¾ç¤ºå˜é‡
                const statusText = isTransferred ? 'å·²ç»“è½¬' : 'æœªç»“è½¬';
                const statusColor = isTransferred ? '#27ae60' : '#c0392b';
                
                // å…³é”®ï¼šå¦‚æœå·²ç»“è½¬ï¼Œæ˜¾ç¤ºé‡‘é¢ï¼›å¦åˆ™æ˜¾ç¤ºâ€œå¾…æ‰§è¡Œâ€
                const amountText = isTransferred 
                    ? `<span style="color: #2980b9; font-weight:bold;">${savedAmount}</span>` 
                    : '<span style="color: #f39c12;">å¾…æ‰§è¡Œ (ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—)</span>';
                
                const timeText = isTransferred ? new Date().toLocaleString() : '-';
                const voucherText = isTransferred ? 'ç»“202511001' : '-';
                
                // 4. æ“ä½œæŒ‰é’®é€»è¾‘
                const actionHtml = isTransferred 
                    ? `<a href="javascript:void(0)" onclick="reverseTransfer('2025å¹´11æœŸ')" style="color:#e74c3c;">å†²å›</a> | <a href="javascript:void(0)" onclick="viewPLVoucher('ç»“202511001')" style="color:#3498db;">æŸ¥çœ‹å‡­è¯</a>`
                    : `<button onclick="executeTransfer('2025å¹´11æœŸ')" class="btn-primary" style="padding:4px 8px; font-size:12px;">æ‰§è¡Œç»“è½¬</button>`;

                contentHTML += `
                    <h2>ç»“è½¬æŸç›Š (P&L Transfer) ğŸ”„</h2>
                    <p style="color: #7f8c8d;">æ‰§è¡ŒæœŸæœ«è‡ªåŠ¨æ“ä½œï¼Œå°†æ‰€æœ‰æŸç›Šç±»ç§‘ç›®ä½™é¢ç»“è½¬åˆ°æœ¬å¹´åˆ©æ¶¦ã€‚</p>
                    
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                         <button class="btn-primary" onclick="loadContent('PeriodEndProfit')">åˆ·æ–°çŠ¶æ€</button>
                    </div>

                    <h3>ç»“è½¬å†å²è®°å½•</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æœŸé—´</th>
                                <th>æ“ä½œæ—¶é—´</th>
                                <th>æŸç›Šå‡€é¢ (RMB)</th>
                                <th>ç»“è½¬å‡­è¯å·</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr id="row-2025-11" style="${isTransferred ? 'background:#f0fdf4' : ''}">
                                <td>2025å¹´11æœŸ</td>
                                <td class="time-cell">${timeText}</td>
                                <td class="amount-cell">${amountText}</td>
                                <td class="voucher-cell">${voucherText}</td>
                                <td class="status-cell"><span style="color: ${statusColor}; font-weight: bold;">${statusText}</span></td>
                                <td class="action-cell">${actionHtml}</td>
                            </tr>
                            <tr>
                                <td>2025å¹´10æœŸ</td>
                                <td>2025-11-01 10:15</td>
                                <td>+50,000.00</td>
                                <td>ç»“202510001</td>
                                <td><span style="color: #27ae60; font-weight: bold;">å·²ç»“è½¬</span></td>
                                <td><span style="color:#ccc">å†å²æ•°æ®</span></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }


// =========================================================================
            // 44. æœˆæœ«ç»“è´¦ (PeriodEndClose) - [ä¿®å¤ç‰ˆï¼šåç»“è´¦é€»è¾‘é—­ç¯]
            // =========================================================================
            else if (moduleCode === 'PeriodEndClose') {
                
                // 1. è¯»å–ç»“è´¦çŠ¶æ€
                const isClosed = sessionStorage.getItem('2025-11-MonthClosed') === 'true';

                if (isClosed) {
                    // --- åœºæ™¯ Aï¼šå·²ç»“è´¦çŠ¶æ€ (æ˜¾ç¤ºåç»“è´¦) ---
                    contentHTML += `
                        <h2>æœˆæœ«ç»“è´¦/é”å®š (Period End) ğŸ”’</h2>
                        
                        <div style="background: #e8f5e9; padding: 40px; text-align: center; border: 1px solid #27ae60; border-radius: 8px; margin-top: 20px;">
                            <h1 style="color: #27ae60; margin: 0;">âœ… 2025å¹´11æœŸ å·²ç»“è´¦</h1>
                            <p style="color: #666; margin-top: 10px;">å½“å‰ä¼šè®¡æœŸé—´å·²åˆ‡æ¢è‡³ <strong>2025å¹´12æœŸ</strong>ã€‚</p>
                            <p style="color: #666;">å†å²æ•°æ®å·²é”å®šï¼Œç¦æ­¢å½•å…¥ã€ä¿®æ”¹æˆ–åˆ é™¤å‡­è¯ã€‚</p>
                            
                            <div style="margin-top: 30px;">
                                <button class="btn-primary" style="background-color: #e74c3c; padding: 10px 30px; font-size: 16px;" onclick="executeReOpen()">âª ç”³è¯·åç»“è´¦ (å›é€€)</button>
                            </div>
                            <p style="font-size:12px; color:#999; margin-top:10px;">* åç»“è´¦æ“ä½œå°†è®°å½•é«˜å±å®¡è®¡æ—¥å¿—</p>
                        </div>
                    `;
                } else {
                    // --- åœºæ™¯ Bï¼šæœªç»“è´¦çŠ¶æ€ (æ˜¾ç¤ºæ£€æŸ¥è¡¨) ---
                    contentHTML += `
                        <h2>æœˆæœ«ç»“è´¦/é”å®š (Period End) ğŸ”’</h2>
                        <p style="color: #7f8c8d;">æ‰§è¡ŒæœŸæœ«ç»“è´¦ï¼Œé”å®šå½“æœŸæ•°æ®ã€‚ç»“è´¦å‰éœ€é€šè¿‡æ‰€æœ‰ç³»ç»Ÿæ£€æŸ¥ã€‚</p>
                        
                        <div class="filter-area" style="background-color: white; padding: 15px; margin-bottom: 20px;">
                            <span style="font-weight:bold;">å½“å‰ä¼šè®¡æœŸé—´ï¼š<span style="color:#2980b9; font-size:18px;">2025å¹´11æœŸ</span></span>
                            <button class="btn-primary" onclick="refreshClosingCheck()" style="margin-left:15px;">ğŸ”„ åˆ·æ–°æ£€æŸ¥çŠ¶æ€</button>
                        </div>
                        
                        <div class="action-bar" style="margin-bottom: 15px;">
                            <button id="btnExecuteClose" class="btn-primary" style="background-color: #95a5a6; cursor: not-allowed;" onclick="executeMonthEndClose()" disabled>æ‰§è¡Œæœˆæœ«ç»“è´¦</button>
                        </div>

                        <h3>ç»“è´¦å‰æ£€æŸ¥æ¸…å•</h3>
                        <table class="data-table">
                            <thead><tr><th>æ£€æŸ¥é¡¹</th><th>çŠ¶æ€</th><th>æç¤ºä¿¡æ¯</th><th>æ“ä½œ</th></tr></thead>
                            <tbody id="checkListBody">
                                <tr><td colspan="4" style="text-align:center; color:#999;">è¯·ç‚¹å‡»â€œåˆ·æ–°æ£€æŸ¥çŠ¶æ€â€å¼€å§‹è‡ªæ£€...</td></tr>
                            </tbody>
                        </table>
                    `;
                    
                    // è‡ªåŠ¨è§¦å‘ä¸€æ¬¡æ£€æŸ¥
                    setTimeout(refreshClosingCheck, 200);
                }
            }

            // =========================================================================
            // 45. èµ„äº§è´Ÿå€ºè¡¨ (ReportBalanceSheet) - 20 æ¡æ˜ç»†æ•°æ®
            // =========================================================================
            else if (moduleCode === 'ReportBalanceSheet') {
                const balanceSheetDetails = generateTableRows(20, (i) => {
                    const isAR = i % 2 === 0; // æ¨¡æ‹Ÿåº”æ”¶å’Œåº”ä»˜äº¤æ›¿
                    const name = isAR ? `å®¢æˆ· ${i} (ç§‘æŠ€)` : `ä¾›åº”å•† ${i} (ç‰©æµ)`;
                    const item = isAR ? 'åº”æ”¶è´¦æ¬¾' : 'åº”ä»˜è´¦æ¬¾';
                    const endBalance = (300000 - i * 1000).toFixed(2);
                    const initialBalance = (250000 - i * 500).toFixed(2);
                    const color = isAR ? '#2980b9' : '#e74c3c';
                    
                    return `
                        <tr>
                            <td>${isAR ? 'èµ„äº§' : 'è´Ÿå€º'}</td>
                            <td>${item} - ${name}</td>
                            <td style="text-align: right; color: ${color};">${endBalance}</td>
                            <td style="text-align: right;">${initialBalance}</td>
                            <td><a href="#" style="color:#3498db;">æ˜ç»†è´¦</a></td>
                        </tr>
                    `;
                });

                contentHTML += `
                    <h2>èµ„äº§è´Ÿå€ºè¡¨ (Balance Sheet) ğŸ“Š</h2>
                    <p style="color: #7f8c8d;">æ ¹æ®ä¼šè®¡è´¦å¥—ï¼Œç”Ÿæˆç‰¹å®šæ—¶ç‚¹çš„è´¢åŠ¡çŠ¶å†µæŠ¥è¡¨ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;"><option>2025-11-30</option></select>
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;"><option>å•ä½“å…¬å¸</option></select>
                            <button class="btn-primary" style="background-color: #3498db;">ç”ŸæˆæŠ¥è¡¨</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">å¯¼å‡º Excel</button>
                        <button class="btn-primary" style="background-color: #34495e;">æ‰“å°æŠ¥è¡¨</button>
                    </div>

                    <h3>æŠ¥è¡¨é™„æ³¨ï¼šåº”æ”¶åº”ä»˜æ˜ç»†åˆ—è¡¨ (å…± 20 æ¡)</h3>
                    <table class="data-table">
                        <thead>
                            <tr style="background-color: #ecf0f1;">
                                <th style="width: 15%;">æŠ¥è¡¨ç±»åˆ«</th>
                                <th>æ˜ç»†é¡¹ç›® (å®¢æˆ·/ä¾›åº”å•†)</th>
                                <th style="text-align: right;">æœŸæœ«ä½™é¢ (RMB)</th>
                                <th style="text-align: right;">å¹´åˆä½™é¢ (RMB)</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${balanceSheetDetails}
                        </tbody>
                    </table>
                `;
            }


// =========================================================================
            // 46. åˆ©æ¶¦æŸç›Šè¡¨ (ReportIncomeStatement) - [æ™ºèƒ½è¯†åˆ«ç‰ˆ]
            // =========================================================================
            else if (moduleCode === 'ReportIncomeStatement') {
                
                let data = { income: 0, cost: 0, saleExp: 0, adminExp: 0, finExp: 0, tax: 0 };
                const vouchers = JSON.parse(sessionStorage.getItem('ManualVouchers') || "[]");
                
                vouchers.forEach(v => {
                    if (v.status === 'å·²å®¡æ ¸' || v.status === 'å·²è®°è´¦') {
                        if (v.lines) {
                            v.lines.forEach(line => {
                                const account = line.account ? line.account.trim() : '';
                                const code = account.split(' ')[0];
                                const val = parseFloat(line.debit) || 0;
                                const valCredit = parseFloat(line.credit) || 0;

                                // â˜…â˜…â˜… æ™ºèƒ½åŒ¹é…é€»è¾‘ (åŒæ—¶åŒ¹é…ä»£ç å’Œä¸­æ–‡) â˜…â˜…â˜…
                                
                                // 1. æ”¶å…¥ (60å¼€å¤´ æˆ– åŒ…å«"æ”¶å…¥") - é€šå¸¸è®°è´·æ–¹
                                if (code.startsWith('60') || code.startsWith('61') || code.startsWith('63') || account.includes('æ”¶å…¥')) {
                                    data.income += valCredit; 
                                }
                                // 2. æˆæœ¬ (64å¼€å¤´ æˆ– åŒ…å«"æˆæœ¬") - é€šå¸¸è®°å€Ÿæ–¹
                                else if (code.startsWith('6401') || code.startsWith('6402') || account.includes('æˆæœ¬')) {
                                    data.cost += val;
                                }
                                // 3. ç¨é‡‘ (6403 æˆ– åŒ…å«"ç¨é‡‘")
                                else if (code.startsWith('6403') || account.includes('ç¨é‡‘')) {
                                    data.tax += val;
                                }
                                // 4. é”€å”®è´¹ç”¨ (6601 æˆ– åŒ…å«"é”€å”®")
                                else if (code.startsWith('6601') || account.includes('é”€å”®')) {
                                    data.saleExp += val;
                                }
                                // 5. ç®¡ç†è´¹ç”¨ (6602 æˆ– åŒ…å«"ç®¡ç†"ã€"åŠå…¬"ã€"å·¥èµ„")
                                else if (code.startsWith('6602') || account.includes('ç®¡ç†') || account.includes('åŠå…¬') || account.includes('å·¥èµ„')) {
                                    data.adminExp += val;
                                }
                                // 6. è´¢åŠ¡è´¹ç”¨ (6603 æˆ– åŒ…å«"è´¢åŠ¡"ã€"åˆ©æ¯")
                                else if (code.startsWith('6603') || account.includes('è´¢åŠ¡') || account.includes('åˆ©æ¯')) {
                                    data.finExp += val;
                                }
                            });
                        }
                    }
                });

                // è®¡ç®—åˆ©æ¶¦
                const opProfit = data.income - data.cost - data.tax - data.saleExp - data.adminExp - data.finExp;
                const netProfit = opProfit; // ç®€åŒ–

                const fmt = (num) => num.toLocaleString('en-US', {minimumFractionDigits: 2});
                const color = (num) => num < 0 ? 'color: #e74c3c; font-weight:bold;' : 'color: #333;';

                contentHTML += `
                    <h2>åˆ©æ¶¦æŸç›Šè¡¨ (Income Statement) ğŸ“ˆ</h2>
                    <p style="color: #7f8c8d;">æŠ¥å‘Šç‰¹å®šä¼šè®¡æœŸé—´çš„ç»è¥æˆæœï¼Œæ•°æ®æ¥æºäºå·²è®°è´¦å‡­è¯ã€‚</p>
                    
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <button class="btn-primary" onclick="loadContent('ReportIncomeStatement')">åˆ·æ–°æŠ¥è¡¨</button>
                    </div>

                    <div style="background:white; padding:20px; border-radius:8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                        <table class="data-table">
                            <thead>
                                <tr style="background-color: #ecf0f1;">
                                    <th style="width: 50%;">é¡¹ ç›®</th>
                                    <th style="text-align: right;">æœ¬æœŸé‡‘é¢ (RMB)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="font-weight:bold;">ä¸€ã€è¥ä¸šæ”¶å…¥</td>
                                    <td style="text-align: right; font-weight:bold;">${fmt(data.income)}</td>
                                </tr>
                                <tr>
                                    <td style="padding-left: 20px;">å‡ï¼šè¥ä¸šæˆæœ¬</td>
                                    <td style="text-align: right;">${fmt(data.cost)}</td>
                                </tr>
                                <tr>
                                    <td style="padding-left: 20px;">ç®¡ç†è´¹ç”¨ (å«å·¥èµ„)</td>
                                    <td style="text-align: right;">${fmt(data.adminExp)}</td>
                                </tr>
                                <tr style="background-color: #f9f9f9;">
                                    <td style="font-weight:bold;">äºŒã€è¥ä¸šåˆ©æ¶¦</td>
                                    <td style="text-align: right; ${color(opProfit)}">${fmt(opProfit)}</td>
                                </tr>
                                <tr style="background-color: #f0fdf4;">
                                    <td style="font-weight:bold; font-size:16px;">ä¸‰ã€å‡€åˆ©æ¶¦</td>
                                    <td style="text-align: right; font-size:16px; ${color(netProfit)}">${fmt(netProfit)}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                `;
            }         


            // =========================================================================
            // 47. ç°é‡‘æµé‡è¡¨ (ReportCashFlow) - 20 æ¡æ˜ç»†æ•°æ®
            // =========================================================================
            else if (moduleCode === 'ReportCashFlow') {
                const cashFlowDetails = generateTableRows(20, (i) => {
                    const activityType = i % 5 === 0 ? 'æŠ•èµ„æ´»åŠ¨' : (i % 3 === 0 ? 'ç­¹èµ„æ´»åŠ¨' : 'ç»è¥æ´»åŠ¨');
                    const direction = i % 4 === 0 ? 'æµå‡º' : 'æµå…¥';
                    const amount = (direction === 'æµå‡º' ? -1 : 1) * (10000 + i * 500);
                    const narration = i % 3 === 0 ? 'æ”¯ä»˜è¿è¾“æœåŠ¡è´¹' : (i % 5 === 0 ? 'è´­ä¹°å›ºå®šèµ„äº§' : 'æ”¶å›è¿è´¹æ¬¾é¡¹');
                    const color = amount < 0 ? '#e74c3c' : '#27ae60';

                    return `
                        <tr>
                            <td>${activityType}</td>
                            <td>${direction}</td>
                            <td>${narration} - äº¤æ˜“ID: ${i.toString().padStart(4, '0')}</td>
                            <td style="text-align: right; color: ${color};">${amount.toFixed(2)}</td>
                            <td><a href="#" style="color:#3498db;">åŸå§‹å•æ®</a></td>
                        </tr>
                    `;
                });

                contentHTML += `
                    <h2>ç°é‡‘æµé‡è¡¨ (Cash Flow Statement) ğŸ’¸</h2>
                    <p style="color: #7f8c8d;">æŠ¥å‘Šç‰¹å®šä¼šè®¡æœŸé—´å†…ç°é‡‘åŠç°é‡‘ç­‰ä»·ç‰©çš„æµå…¥å’Œæµå‡ºæƒ…å†µã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;"><option>2025å¹´11æœˆ</option></select>
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;"><option>ç›´æ¥æ³•</option></select>
                            <button class="btn-primary" style="background-color: #3498db;">ç”ŸæˆæŠ¥è¡¨</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">å¯¼å‡º Excel</button>
                        <button class="btn-primary" style="background-color: #f39c12;">ç°é‡‘æµé‡è¡¨é™„æ³¨</button>
                    </div>

                    <h3>ç°é‡‘æµé‡æ˜ç»†äº¤æ˜“ (å…± 20 æ¡)</h3>
                    <table class="data-table">
                        <thead>
                            <tr style="background-color: #ecf0f1;">
                                <th style="width: 15%;">æ´»åŠ¨ç±»å‹</th>
                                <th style="width: 10%;">æ–¹å‘</th>
                                <th>äº¤æ˜“æ‘˜è¦</th>
                                <th style="text-align: right;">é‡‘é¢ (RMB)</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${cashFlowDetails}
                        </tbody>
                    </table>
                `;
            }
            // =========================================================================
            // 48. å…¶ä»–æ³•å®šæŠ¥è¡¨ (ReportOtherStatutory) - 20 æ¡æ•°æ®
            // =========================================================================
            else if (moduleCode === 'ReportOtherStatutory') {
                const auxiliaryRows = generateTableRows(20, (i) => {
                    const clientName = `å®¢æˆ· ${i} (å…¬å¸)`;
                    const initialBalance = (50000 + i * 200).toFixed(2);
                    const debit = (10000 + i * 50).toFixed(2);
                    const credit = (5000 + i * 10).toFixed(2);
                    const endBalance = (parseFloat(initialBalance) + parseFloat(debit) - parseFloat(credit)).toFixed(2);
                    const status = i % 5 === 0 ? '<span style="color: #e74c3c;">è¶…æœŸ</span>' : 'æ­£å¸¸';
                    
                    return `
                        <tr>
                            <td>${clientName}</td>
                            <td style="text-align: right;">${initialBalance}</td>
                            <td style="text-align: right;">${debit}</td>
                            <td style="text-align: right;">${credit}</td>
                            <td style="text-align: right;">${endBalance}</td>
                            <td>${status}</td>
                            <td><a href="#" style="color:#3498db;">æ˜ç»†è´¦</a></td>
                        </tr>
                    `;
                });

                contentHTML += `
                    <h2>å…¶ä»–æ³•å®šæŠ¥è¡¨ ğŸ“ƒ</h2>
                    <p style="color: #7f8c8d;">ç®¡ç†å’Œç”Ÿæˆé™¤ä¸‰å¤§ä¸»è¡¨ä¹‹å¤–çš„ã€æ»¡è¶³ç¨åŠ¡æˆ–ç›‘ç®¡è¦æ±‚çš„æ³•å®šæŠ¥è¡¨ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;"><option>è¾…åŠ©è´¦ä½™é¢è¡¨</option></select>
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;"><option>å®¢æˆ·</option></select>
                            <input type="date" placeholder="æˆªæ­¢æ—¥æœŸ" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                            <button class="btn-primary">ç”ŸæˆæŠ¥è¡¨</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">å¯¼å‡º Excel</button>
                        <button class="btn-primary" style="background-color: #3498db;">æ‰¹é‡å½’æ¡£</button>
                    </div>

                    <h3>æŠ¥è¡¨åˆ—è¡¨ (å®¢æˆ·è¾…åŠ©è´¦ä½™é¢è¡¨, å…± 20 æ¡)</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>è¾…åŠ©æ ¸ç®—é¡¹ (å®¢æˆ·åç§°)</th>
                                <th style="text-align: right;">æœŸåˆä½™é¢ (RMB)</th>
                                <th style="text-align: right;">æœ¬æœŸå€Ÿæ–¹å‘ç”Ÿé¢ (RMB)</th>
                                <th style="text-align: right;">æœ¬æœŸè´·æ–¹å‘ç”Ÿé¢ (RMB)</th>
                                <th style="text-align: right;">æœŸæœ«ä½™é¢ (RMB)</th>
                                <th>è´¦é¾„çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${auxiliaryRows}
                        </tbody>
                    </table>
                `;
            }
            // =========================================================================
            // 49. å•è½¦çº¿è·¯ç›ˆäºåˆ†æ (ReportVehicleProfit)
            // =========================================================================
            else if (moduleCode === 'ReportVehicleProfit') {
                contentHTML += `
                    <h2>å•è½¦çº¿è·¯ç›ˆäºåˆ†æ ğŸšš</h2>
                    <p style="color: #7f8c8d;">æŒ‰è½¦è¾†å’Œè¿è¾“çº¿è·¯ç»´åº¦ï¼Œåˆ†ææ”¶å…¥ã€ç›´æ¥æˆæœ¬ã€é—´æ¥æˆæœ¬å’Œæ¯›åˆ©ï¼Œè¯„ä¼°è¿è¾“èµ„äº§çš„ç›ˆåˆ©èƒ½åŠ›ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">æŠ¥å‘ŠæœŸé—´</option>
                                <option>2025å¹´11æœˆ</option>
                                <option>2025å¹´Q4</option>
                            </select>
                            <input type="text" placeholder="è½¦ç‰Œå· / çº¿è·¯åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">æ’åºä¾æ®</option>
                                <option>æ¯›åˆ©ç‡ (é™åº)</option>
                                <option>æ€»æ¯›åˆ© (é™åº)</option>
                            </select>
                            <button class="btn-primary" style="background-color: #3498db;">ç”Ÿæˆåˆ†æ</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">å¯¼å‡º Excel</button>
                    </div>

                    <h3>çº¿è·¯ç›ˆäºæ˜ç»† (2025å¹´11æœˆ)</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>çº¿è·¯/è½¦ç‰Œå·</th>
                                <th style="text-align: right;">æ€»æ”¶å…¥ (RMB)</th>
                                <th style="text-align: right;">æ€»æˆæœ¬ (RMB)</th>
                                <th style="text-align: right;">æ¯›åˆ© (RMB)</th>
                                <th style="text-align: right;">æ¯›åˆ©ç‡ (%)</th>
                                <th>çŠ¶æ€</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>æ²ªAÂ·8888 (æ²ª-æ·±çº¿)</td>
                                <td style="text-align: right;">150,000.00</td>
                                <td style="text-align: right;">105,000.00</td>
                                <td style="text-align: right;">45,000.00</td>
                                <td style="text-align: right;"><strong style="color: #27ae60;">30.0%</strong></td>
                                <td>ç›ˆåˆ©</td>
                            </tr>
                            <tr>
                                <td>äº¬BÂ·6666 (äº¬-æ´¥çº¿)</td>
                                <td style="text-align: right;">80,000.00</td>
                                <td style="text-align: right;">82,000.00</td>
                                <td style="text-align: right;"><span style="color: #e74c3c;">-2,000.00</span></td>
                                <td style="text-align: right;"><strong style="color: #e74c3c;">-2.5%</strong></td>
                                <td>äºæŸ</td>
                            </tr>
                            <tr>
                                <td>**çº¿è·¯æ€»è®¡**</td>
                                <td style="text-align: right; font-weight: bold;">2,500,000.00</td>
                                <td style="text-align: right; font-weight: bold;">1,800,000.00</td>
                                <td style="text-align: right; font-weight: bold; color: #2980b9;">700,000.00</td>
                                <td style="text-align: right; font-weight: bold; color: #2980b9;">28.0%</td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }
            // =========================================================================
            // 50. å®¢æˆ·æ¯›åˆ©åˆ†æ (ReportCustomerProfit)
            // =========================================================================
            else if (moduleCode === 'ReportCustomerProfit') {
                contentHTML += `
                    <h2>å®¢æˆ·æ¯›åˆ©åˆ†æ ğŸ‘¥</h2>
                    <p style="color: #7f8c8d;">æŒ‰å®¢æˆ·ç»´åº¦åˆ†ææ”¶å…¥è´¡çŒ®ã€æœåŠ¡æˆæœ¬å’Œæ¯›åˆ©ï¼Œè¯†åˆ«é«˜ä»·å€¼å®¢æˆ·å’Œä½æ•ˆæœåŠ¡é¡¹ç›®ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">æŠ¥å‘ŠæœŸé—´</option>
                                <option>2025å¹´11æœˆ</option>
                                <option>2025å¹´Q4</option>
                            </select>
                            <input type="text" placeholder="å®¢æˆ·åç§° / å®¢æˆ·ç»„" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">æ¯›åˆ©ç‡èŒƒå›´</option>
                                <option>ä½äº 10%</option>
                                <option>é«˜äº 30%</option>
                            </select>
                            <button class="btn-primary" style="background-color: #3498db;">ç”Ÿæˆåˆ†æ</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">å¯¼å‡º Excel</button>
                        <button class="btn-primary" style="background-color: #f39c12;">æŸ¥çœ‹æ¯›åˆ©å›¾è°±</button>
                    </div>

                    <h3>å®¢æˆ·æ¯›åˆ©æ˜ç»† (2025å¹´11æœˆ)</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å®¢æˆ·åç§°</th>
                                <th style="text-align: right;">æ”¶å…¥æ€»é¢ (RMB)</th>
                                <th style="text-align: right;">æ€»æœåŠ¡æˆæœ¬ (RMB)</th>
                                <th style="text-align: right;">æ¯›åˆ© (RMB)</th>
                                <th style="text-align: right;">æ¯›åˆ©ç‡ (%)</th>
                                <th>è®¢å•æ•°</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>A. ç”µå­ç§‘æŠ€é›†å›¢</td>
                                <td style="text-align: right;">500,000.00</td>
                                <td style="text-align: right;">300,000.00</td>
                                <td style="text-align: right;">200,000.00</td>
                                <td style="text-align: right;"><strong style="color: #27ae60;">40.0%</strong></td>
                                <td>150</td>
                            </tr>
                            <tr>
                                <td>B. ä¼ ç»Ÿåˆ¶é€ æœ‰é™å…¬å¸</td>
                                <td style="text-align: right;">120,000.00</td>
                                <td style="text-align: right;">115,000.00</td>
                                <td style="text-align: right;"><span style="color: #e74c3c;">5,000.00</span></td>
                                <td style="text-align: right;"><strong style="color: #e74c3c;">4.2%</strong></td>
                                <td>60</td>
                            </tr>
                            <tr>
                                <td>**å®¢æˆ·æ€»è®¡**</td>
                                <td style="text-align: right; font-weight: bold;">4,500,000.00</td>
                                <td style="text-align: right; font-weight: bold;">3,000,000.00</td>
                                <td style="text-align: right; font-weight: bold; color: #2980b9;">1,500,000.00</td>
                                <td style="text-align: right; font-weight: bold; color: #2980b9;">33.3%</td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }
            // =========================================================================
            // 51. åº”æ”¶åº”ä»˜è´¦é¾„åˆ†æ (ReportARAPAge)
            // =========================================================================
            else if (moduleCode === 'ReportARAPAge') {
                contentHTML += `
                    <h2>åº”æ”¶åº”ä»˜è´¦é¾„åˆ†æ â³</h2>
                    <p style="color: #7f8c8d;">åˆ†æåº”æ”¶/åº”ä»˜è´¦æ¬¾çš„è´¦æœŸåˆ†å¸ƒï¼Œè¯„ä¼°èµ„é‡‘å‘¨è½¬å’Œåè´¦é£é™©ã€‚æŒ‰å®¢æˆ·/ä¾›åº”å•†è¿›è¡Œæ˜ç»†åˆ’åˆ†ã€‚</p>
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">åˆ†æå¯¹è±¡</option>
                                <option>åº”æ”¶è´¦æ¬¾ (A/R)</option>
                                <option>åº”ä»˜è´¦æ¬¾ (A/P)</option>
                            </select>
                            <input type="date" placeholder="æˆªæ­¢æ—¥æœŸ" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
                            <button class="btn-primary" style="background-color: #3498db;">ç”Ÿæˆåˆ†æ</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;">å¯¼å‡º Excel</button>
                        <button class="btn-primary" style="background-color: #34495e;">æŸ¥çœ‹è´¦é¾„å›¾è¡¨</button>
                    </div>

                    <h3>åº”æ”¶è´¦æ¬¾è´¦é¾„åˆ†å¸ƒ (æˆªæ­¢ 2025-11-30)</h3>
                    <table class="data-table">
                        <thead>
                            <tr style="background-color: #ecf0f1;">
                                <th>å®¢æˆ·/ä¾›åº”å•†</th>
                                <th style="text-align: right;">æ€»ä½™é¢ (RMB)</th>
                                <th style="text-align: right;">< 30å¤© (RMB)</th>
                                <th style="text-align: right;">30-90å¤© (RMB)</th>
                                <th style="text-align: right;">91-180å¤© (RMB)</th>
                                <th style="text-align: right;">> 180å¤© (RMB)</th>
                                <th>å‚¬æ”¶çŠ¶æ€</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>å®¢æˆ· C - åå—åˆ†éƒ¨</td>
                                <td style="text-align: right;">250,000.00</td>
                                <td style="text-align: right;">180,000.00</td>
                                <td style="text-align: right;">50,000.00</td>
                                <td style="text-align: right;">15,000.00</td>
                                <td style="text-align: right;"><strong style="color: #e74c3c;">5,000.00</strong></td>
                                <td>éœ€å‚¬æ”¶</td>
                            </tr>
                            <tr>
                                <td>å®¢æˆ· D - åä¸œåˆ†éƒ¨</td>
                                <td style="text-align: right;">80,000.00</td>
                                <td style="text-align: right;">80,000.00</td>
                                <td style="text-align: right;">0.00</td>
                                <td style="text-align: right;">0.00</td>
                                <td style="text-align: right;">0.00</td>
                                <td>æ­£å¸¸</td>
                            </tr>
                            <tr>
                                <td>**æ€»è®¡**</td>
                                <td style="text-align: right; font-weight: bold;">5,000,000.00</td>
                                <td style="text-align: right; font-weight: bold;">3,500,000.00</td>
                                <td style="text-align: right; font-weight: bold;">1,000,000.00</td>
                                <td style="text-align: right; font-weight: bold;">350,000.00</td>
                                <td style="text-align: right; font-weight: bold; color: #e74c3c;">150,000.00</td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

// =========================================================================
            // 40. ç§‘ç›®æ˜ç»†è´¦ (AcctSubjectDetail) - [ä¿®å¤ç‰ˆï¼šæ™ºèƒ½è¯†åˆ«å€Ÿè´·æ–¹å‘]
            // =========================================================================
            else if (moduleCode === 'AcctSubjectDetail') {
                
                const targetCode = sessionStorage.getItem('CurrentSubjectCode') || '1002';
                const targetName = sessionStorage.getItem('CurrentSubjectName') || 'é“¶è¡Œå­˜æ¬¾';
                const vouchers = JSON.parse(sessionStorage.getItem('ManualVouchers') || "[]");
                
                // 1. â˜…â˜…â˜… æ ¸å¿ƒä¿®å¤ï¼šå®šä¹‰ç§‘ç›®çš„â€œé»˜è®¤æ–¹å‘â€ â˜…â˜…â˜…
                // èµ„äº§/æˆæœ¬/è´¹ç”¨ç±» (1xxx, 5xxx, 6xxx) -> é»˜è®¤ "å€Ÿ"
                // è´Ÿå€º/æƒç›Š/æ”¶å…¥ç±» (2xxx, 3xxx, 4xxx) -> é»˜è®¤ "è´·"
                const firstDigit = targetCode.charAt(0);
                const defaultDir = (['2','3','4','60'].some(prefix => targetCode.startsWith(prefix))) ? 'è´·' : 'å€Ÿ';

                // 2. è®¾ç½®æœŸåˆä½™é¢ (æ¨¡æ‹Ÿ)
                // å‡è®¾ï¼šé“¶è¡Œå­˜æ¬¾æœ‰æœŸåˆï¼Œåº”ä»˜è´¦æ¬¾æœŸåˆä¸º0
                let currentBalance = (targetCode === '1002') ? 800000 : 0;

                // 3. ç”Ÿæˆâ€œæœŸåˆä½™é¢â€è¡Œ
                // å¦‚æœä½™é¢ä¸º0ï¼Œæ–¹å‘æ˜¾ç¤ºâ€œå¹³â€ï¼Œå¦åˆ™æ˜¾ç¤ºé»˜è®¤æ–¹å‘
                const startDirText = currentBalance === 0 ? 'å¹³' : defaultDir;
                
                let tableHTML = `
                    <tr style="background-color:#fdfdfd; color:#999;">
                        <td>2025-11-01</td>
                        <td>-</td>
                        <td>æœŸåˆä½™é¢</td>
                        <td>-</td>
                        <td>-</td>
                        <td>${startDirText}</td>
                        <td style="text-align:right;">${currentBalance.toLocaleString('en-US', {minimumFractionDigits: 2})}</td>
                    </tr>
                `;

                // 4. éå†å‡­è¯è®¡ç®—
                const sortedVouchers = [...vouchers].reverse(); // æŒ‰æ—¶é—´é¡ºåº

                sortedVouchers.forEach(v => {
                    if (v.status === 'å·²å®¡æ ¸' || v.status === 'å·²è®°è´¦') {
                        if (v.lines) {
                            v.lines.forEach(line => {
                                if (line.account.startsWith(targetCode)) {
                                    const debit = parseFloat(line.debit) || 0;
                                    const credit = parseFloat(line.credit) || 0;
                                    
                                    // â˜…â˜…â˜… æ ¸å¿ƒä¿®å¤ï¼šæ ¹æ®æ–¹å‘è®¡ç®—ä½™é¢ â˜…â˜…â˜…
                                    if (defaultDir === 'å€Ÿ') {
                                        // èµ„äº§ç±»ï¼šä½™é¢ = ä¸Šæ¬¡ä½™é¢ + å€Ÿ - è´·
                                        currentBalance = currentBalance + debit - credit;
                                    } else {
                                        // è´Ÿå€ºç±»(å¦‚åº”ä»˜è´¦æ¬¾)ï¼šä½™é¢ = ä¸Šæ¬¡ä½™é¢ + è´· - å€Ÿ
                                        currentBalance = currentBalance + credit - debit;
                                    }

                                    // è®¡ç®—å½“å‰è¡Œçš„æ–¹å‘æ–‡å­—
                                    let dirText = 'å¹³';
                                    if (currentBalance > 0) dirText = defaultDir; // è¿˜æ˜¯æ¬ é’±/æœ‰é’±
                                    else if (currentBalance < 0) dirText = (defaultDir === 'å€Ÿ' ? 'è´·' : 'å€Ÿ'); // å˜æˆåæ–¹å‘äº†(æ¯”å¦‚é“¶è¡Œé€æ”¯)

                                    tableHTML += `
                                        <tr>
                                            <td>${v.date}</td>
                                            <td><a href="#" onclick="openVoucherDetail(this)" class="val-id" style="color:#3498db;">${v.id}</a></td>
                                            <td>${line.summary}</td>
                                            <td style="text-align:right;">${debit ? debit.toLocaleString('en-US', {minimumFractionDigits: 2}) : ''}</td>
                                            <td style="text-align:right;">${credit ? credit.toLocaleString('en-US', {minimumFractionDigits: 2}) : ''}</td>
                                            <td>${dirText}</td>
                                            <td style="text-align:right; font-weight:bold;">${Math.abs(currentBalance).toLocaleString('en-US', {minimumFractionDigits: 2})}</td>
                                        </tr>
                                    `;
                                }
                            });
                        }
                    }
                });

                contentHTML += `
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h2>ç§‘ç›®æ˜ç»†è´¦ï¼š<span style="color:#2980b9;">${targetCode} ${targetName}</span></h2>
                        <button class="btn-primary" style="background-color: #95a5a6;" onclick="loadContent('AcctSubjectSummary')"> < è¿”å›æ±‡æ€»è¡¨</button>
                    </div>
                    
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items:center;">
                            <input type="date" value="2025-11-01" style="padding:8px; border:1px solid #ccc;">
                            <span>è‡³</span>
                            <input type="date" value="2025-11-30" style="padding:8px; border:1px solid #ccc;">
                            <input type="text" placeholder="æ‘˜è¦å…³é”®è¯" style="padding:8px; border:1px solid #ccc;">
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æ—¥æœŸ</th>
                                <th>å‡­è¯å·</th>
                                <th style="width:30%;">æ‘˜è¦</th>
                                <th style="text-align:right;">å€Ÿæ–¹é‡‘é¢</th>
                                <th style="text-align:right;">è´·æ–¹é‡‘é¢</th>
                                <th>æ–¹å‘</th>
                                <th style="text-align:right;">ä½™é¢</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${tableHTML}
                        </tbody>
                    </table>
                    
                    <div style="margin-top:10px; font-size:12px; color:#7f8c8d;">
                        * æ³¨ï¼š${targetCode} å±äº <strong>${defaultDir}æ–¹ç§‘ç›®</strong>ï¼Œ${defaultDir === 'å€Ÿ' ? 'å€Ÿæ–¹è¡¨ç¤ºå¢åŠ ï¼Œè´·æ–¹è¡¨ç¤ºå‡å°‘' : 'è´·æ–¹è¡¨ç¤ºå¢åŠ ï¼Œå€Ÿæ–¹è¡¨ç¤ºå‡å°‘'}ã€‚
                    </div>
                `;
            }



            // =========================================================================
            // 90. å®¢æˆ·æ¡£æ¡ˆ (BaseCustomer) - [æœ€ç»ˆç‰ˆï¼šæ”¯æŒæ–°å¢å­—æ®µ & æ•°æ®æŒä¹…åŒ–]
            // =========================================================================
            else if (moduleCode === 'BaseCustomer') {
                
                // 1. å®šä¹‰é»˜è®¤æ•°æ® (å†™æ­»åœ¨ä»£ç é‡Œçš„è€æ•°æ®)
                const defaultCustomers = [
                  /*   { id: 'CUST-1024', name: 'é˜³å…‰åˆ¶é€ æœ‰é™å…¬å¸', taxId: '91320100MA1...', type: 'æœˆç»“', limit: '1200.00', days: '30', status: 'æ­£å¸¸' }, */
                    { id: 'CUST-8812', name: 'å¼ ä¸‰ (ä¸ªäºº)', taxId: '-', type: 'ç°ç»“', limit: '0.00', days: '0', status: 'æ­£å¸¸' },
                    { id: 'CUST-9001', name: 'é£é™©è´¸æ˜“å•†è´¸', taxId: '91310000MA3...', type: 'æœˆç»“', limit: '50,000.00', days: '60', status: 'å·²å†»ç»“' }
                ];

                // 2. è¯»å–æ–°å¢æ•°æ® (ä» SessionStorage è¯»å–æ‚¨åˆšæ‰æ·»åŠ çš„)
                const addedCustomers = JSON.parse(sessionStorage.getItem('AddedCustomers') || "[]");

                // 3. åˆå¹¶æ•°æ® (æ–°æ•°æ®æ’åœ¨å‰é¢)
                const allCustomers = [...addedCustomers, ...defaultCustomers];

                // 4. åŠ¨æ€ç”Ÿæˆè¡¨æ ¼ HTML
                const rowsHTML = allCustomers.map(c => {
                    // æ ·å¼å¤„ç†
                    const typeBadge = c.type === 'ç°ç»“' 
                        ? '<span style="background:#f6ffed; color:#52c41a; padding:2px 6px; border-radius:4px; font-size:12px;">ç°ç»“</span>'
                        : '<span style="background:#e6f7ff; color:#1890ff; padding:2px 6px; border-radius:4px; font-size:12px;">æœˆç»“</span>';
                    
                    const statusHtml = c.status === 'æ­£å¸¸' 
                        ? '<span style="color: #27ae60;">æ­£å¸¸</span>' 
                        : '<span style="color: #e74c3c; font-weight:bold;">å·²å†»ç»“</span>';

                    const rowStyle = c.status === 'å·²å†»ç»“' ? 'background-color: #fff1f0;' : '';
                    
                    // å†»ç»“æŒ‰é’®é€»è¾‘
                    const freezeAction = c.status === 'æ­£å¸¸'
                        ? `<a href="javascript:void(0)" onclick="toggleFreeze(this, '${c.id}', '${c.name}')" style="color:#e74c3c;">å†»ç»“</a>`
                        : `<a href="javascript:void(0)" onclick="toggleFreeze(this, '${c.id}', '${c.name}')" style="color:#3498db;">ç”³è¯·è§£å†»</a>`;

                    return `
                        <tr style="${rowStyle}">
                            <td>${c.id}</td>
                            <td class="val-name">${c.name}</td>
                            <td>${c.taxId}</td>
                            <td>${typeBadge}</td>
                            <td><strong>${c.limit}</strong></td>
                            <td>${c.days}</td>
                            <td>${statusHtml}</td>
                            <td>
                                <a href="javascript:void(0)" onclick="editCustomerInfo(this, '${c.id}')" style="color:#3498db;">ä¿®æ”¹èµ„æ–™</a> | 
                                ${freezeAction}
                            </td>
                        </tr>
                    `;
                }).join('');

                contentHTML += `
                    <h2>å®¢æˆ·æ¡£æ¡ˆ (Customer Master Data)</h2>
                    <p style="color: #7f8c8d;">ç®¡ç†å®¢æˆ·çš„è´¢åŠ¡åŸºç¡€ä¿¡æ¯ï¼ˆå¼€ç¥¨ä¿¡æ¯ã€é“¶è¡Œè´¦æˆ·ï¼‰åŠä¿¡ç”¨æ§åˆ¶ç­–ç•¥ã€‚</p>
                    
                    <div class="filter-area" style="background-color: white; padding: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <input type="text" placeholder="å®¢æˆ·ç¼–ç  / åç§°" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            <select style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">å®¢æˆ·ç±»åˆ«</option>
                                <option>ä¼ä¸šå®¢æˆ·</option>
                            </select>
                            <button class="btn-primary">æŸ¥è¯¢</button>
                        </div>
                    </div>
                    
                    <div class="action-bar" style="margin-bottom: 15px;">
                        <button class="btn-primary" style="background-color: #27ae60;" onclick="addCustomer()">+ æ–°å¢å®¢æˆ·</button>
                        <button class="btn-primary" style="background-color: #3498db;">åŒæ­¥ CRM æ•°æ®</button>
                        <button class="btn-primary" style="background-color: #f39c12;">æ‰¹é‡è®¾ç½®é¢åº¦</button>
                    </div>

                    <h3>å®¢æˆ·åˆ—è¡¨</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å®¢æˆ·ç¼–ç </th>
                                <th>å®¢æˆ·åç§°</th>
                                <th>çº³ç¨äººè¯†åˆ«å·</th>
                                <th>ç»“ç®—æ–¹å¼</th>
                                <th>ä¿¡ç”¨é¢åº¦ (RMB)</th>
                                <th>è´¦æœŸ (å¤©)</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${rowsHTML}
                        </tbody>
                    </table>
                `;
            }




             else {
                contentHTML += `<p>æ‚¨å·²åˆ‡æ¢åˆ° **${getModuleName(moduleCode)}** æ¨¡å—ã€‚</p>
                                 <p>æ­¤å¤„å°†åŠ è½½è¯¥åŠŸèƒ½çš„è¯¦ç»†æ“ä½œç•Œé¢ï¼Œä¾‹å¦‚ï¼š</p>
                                 <ul>
                                    <li>å¦‚æœæ˜¯ **æŠ¥è¡¨**ï¼Œåˆ™æ˜¾ç¤ºç­›é€‰æ¡ä»¶å’ŒæŠ¥è¡¨é¢„è§ˆã€‚</li>
                                    <li>å¦‚æœæ˜¯ **å½•å…¥**ï¼Œåˆ™æ˜¾ç¤ºæ•°æ®è¡¨å•ã€‚</li>
                                    <li>å¦‚æœæ˜¯ **æŸ¥è¯¢**ï¼Œåˆ™æ˜¾ç¤ºæŸ¥è¯¢æ¡ä»¶å’Œæ•°æ®åˆ—è¡¨ã€‚</li>
                                 </ul>
                                 <p style="color: #999;">ï¼ˆæ­¤ä¸ºåŸå‹å›¾æ¨¡æ‹Ÿå†…å®¹ï¼Œè¯·åŸºäºæ­¤ç»“æ„è¿›è¡Œåç»­çš„è¯¦ç»†é¡µé¢è®¾è®¡ï¼‰</p>`;
            }
            
            // =========================================================================
            // æ ¸å¿ƒé¡µé¢é€»è¾‘ç»“æŸ
            // =========================================================================


            contentArea.innerHTML = contentHTML;
        }

        /**
         * æ¨¡å—ä»£ç ä¸ä¸­æ–‡åç§°æ˜ å°„ (ä¿æŒä¸å˜)
         */
        function getModuleName(code) {
            const names = {
                'Dashboard': 'è´¢åŠ¡æ¦‚è§ˆ / ä»ªè¡¨ç›˜',
                'SettlementWaybill': 'è¿å•ç»“ç®—', 'SettlementTrunk': 'å¹²çº¿æ‰¹æ¬¡ç»“ç®—', 'SettlementShortHaul': 'çŸ­é€”æ‰¹æ¬¡ç»“ç®—', 'SettlementRuleConfig': 'è®¡è´¹è§„åˆ™é…ç½®',
                'ReconSite': 'ç½‘ç‚¹å¯¹è´¦', 'ReconCustomer': 'å®¢æˆ·å¯¹è´¦', 'ReconCarrier': 'æ‰¿è¿å•†å¯¹è´¦', 'ReconDriver': 'å¸æœºå¯¹è´¦', 'ReconDiffHandle': 'å¯¹è´¦å·®å¼‚å¤„ç†',
                'ARCustomerStatement': 'å®¢æˆ·å¯¹è´¦å•åˆ—è¡¨', 'ARPrecollection': 'é¢„æ”¶æ¬¾å•', 'ARCollectionVerify': 'å®¢æˆ·æ”¶æ¬¾æ ¸é”€', 'ARAgeAnalysis': 'å®¢æˆ·è´¦é¾„åˆ†æ',
                'APPaymentApply': 'ä¾›åº”å•†ä»˜æ¬¾ç”³è¯·', 'APPrepayment': 'é¢„ä»˜æ¬¾å•', 'APPaymentVerify': 'ä»˜æ¬¾æ ¸é”€', 'APInvoiceManage': 'ä¾›åº”å•†å‘ç¥¨ç®¡ç†',
                'FundCustomerAcct': 'å®¢æˆ·èµ„é‡‘è´¦æˆ·', 'FundEnergyAcct': 'èƒ½æºè´¦æˆ·ç®¡ç†', 'FundWallet': 'å¸æœº/ç½‘ç‚¹é’±åŒ…', 'FundExecution': 'æ”¶æ¬¾ä¸ä»˜æ¬¾æ‰§è¡Œ', 'FundBankConnect': 'é“¶ä¼ç›´è”', 'FundClearingRule': 'æ¸…åˆ†ä¸åˆ†è´¦è§„åˆ™',
                'ExpenseLoan': 'å€Ÿæ¬¾å•', 'ExpenseRepay': 'è¿˜æ¬¾å•', 'ExpenseDaily': 'æ—¥å¸¸è´¹ç”¨æŠ¥é”€', 'ExpenseTravel': 'å·®æ—…æŠ¥é”€', 'ExpenseCompensation': 'é…¬é‡‘ç»“ç®—',
                'PendingWaybill': 'è¿å•æŒ‚è´¦', 'PendingAbnormal': 'å¼‚åŠ¨æŒ‚è´¦', 'PendingOther': 'å…¶ä»–æŒ‚è´¦',
                'TaxInputInvoice': 'è¿›é¡¹å‘ç¥¨å°è´¦', 'TaxOutputInvoice': 'é”€é¡¹å‘ç¥¨å°è´¦', 'TaxRateConfig': 'ç¨ç‡é…ç½®',
                'BudgetPlanning': 'é¢„ç®—ç¼–åˆ¶', 'BudgetExecutionAnalysis': 'é¢„ç®—æ‰§è¡Œåˆ†æ', 'BudgetPerformance': 'ç»©æ•ˆè€ƒæ ¸',
                'RiskSensitiveLog': 'æ•æ„Ÿæ“ä½œæ—¥å¿—', 'RiskRedStamping': 'çº¢å†²ä¸åç»“è´¦è®°å½•', 'RiskDataChange': 'æ•°æ®å˜æ›´æ˜ç»†',
                'AcctSubject': 'ä¼šè®¡ç§‘ç›®', 'AcctSet': 'ä¼šè®¡è´¦å¥—', 'AcctPeriod': 'ä¼šè®¡æœŸé—´', 'AcctAuxiliary': 'è¾…åŠ©æ ¸ç®—é¡¹', 'AcctRule': 'è®°è´¦è§„åˆ™',
                'AssetCard': 'èµ„äº§å¡ç‰‡', 'AssetDepreciation': 'æŠ˜æ—§è®¡ç®—', 'AssetChange': 'èµ„äº§å˜åŠ¨',
                'VoucherEntryReview': 'å‡­è¯å½•å…¥', 'VoucherQueryPrint': 'å‡­è¯æŸ¥è¯¢/å®¡æ ¸', 'SubjectSummary': 'ç§‘ç›®æ±‡æ€»è¡¨',
                'EngineMapping': 'ä¸šåŠ¡å•æ®æ˜ å°„é…ç½®', 'EngineTemplate': 'è‡ªåŠ¨åˆ†å½•æ¨¡æ¿', 'EngineLog': 'å‡­è¯ç”Ÿæˆæ—¥å¿—',
                'PeriodEndProfit': 'ç»“è½¬æŸç›Š', 'PeriodEndClose': 'æœˆæœ«ç»“è´¦/é”å®š',
                'ReportBalanceSheet': 'èµ„äº§è´Ÿå€ºè¡¨', 'ReportIncomeStatement': 'åˆ©æ¶¦æŸç›Šè¡¨', 'ReportCashFlow': 'ç°é‡‘æµé‡è¡¨', 'ReportOtherStatutory': 'å…¶ä»–æŠ¥è¡¨',
                'ReportVehicleProfit': 'å•è½¦çº¿è·¯ç›ˆäºåˆ†æ', 'ReportCustomerProfit': 'å®¢æˆ·æ¯›åˆ©åˆ†æ', 'ReportARAPAge': 'åº”æ”¶åº”ä»˜è´¦é¾„åˆ†æ',
                'BankStatementSync': 'é“¶è¡Œå¯¹è´¦å•åŒæ­¥', 'OnlinePayment': 'çº¿ä¸Šæ”¯ä»˜/ä»£æ”¶ä»˜', 'BankBalanceQuery': 'é“¶è¡Œä½™é¢å®æ—¶æŸ¥è¯¢',
                'BasicSetup': 'åŸºç¡€è®¾ç½®', 'Permission': 'æƒé™ç®¡ç†', 'SystemLog': 'ç³»ç»Ÿæ—¥å¿—/å®¡è®¡'
            };
            return names[code] || 'æœªçŸ¥æ¨¡å—';
        }

        // é»˜è®¤åŠ è½½ä»ªè¡¨ç›˜å¹¶åœ¨åŠ è½½ååˆå§‹åŒ–èœå•çŠ¶æ€ï¼ˆå…¨éƒ¨æŠ˜å ï¼‰
        window.onload = function () {
            loadContent('Dashboard');
            initializeMenuState();
        };

        
        // --- 1. æ‰“å¼€å‡­è¯è¯¦æƒ… (æŠ“å–å½“å‰è¡Œæ•°æ®) ---
        window.openVoucherDetail = function(btnElement) {
            const row = btnElement.closest('tr');
            
            // æŠ“å–æ•°æ®
            const id = row.querySelector('.val-id').innerText;
            const date = row.querySelector('.val-date').innerText;
            const summary = row.querySelector('.val-summary').innerText;
            const debit = row.querySelector('.val-debit').innerText;
            const credit = row.querySelector('.val-credit').innerText;
            
            // åˆ¤æ–­æ˜¯ä¸æ˜¯çº¢å­—å‡­è¯ (æ ¹æ®é¢œè‰²æˆ–é‡‘é¢æ˜¯å¦ä¸ºè´Ÿ)
            const isRed = debit.includes('-') || row.style.backgroundColor.includes('rgb(255, 240, 240)');

            // å­˜å…¥å…¨å±€å˜é‡
            window.g_currentVoucher = {
                id: id,
                date: date,
                summary: summary,
                debit: debit,
                credit: credit,
                isRed: isRed
            };

            // è·³è½¬é¡µé¢
            loadContent('VoucherDetail');
        }


        
/**
     * æ¨¡æ‹Ÿçº¢å†²æ“ä½œ (ä¿®å¤ç‰ˆï¼šçœŸå®ç”Ÿæˆæ•°æ®å¹¶ä¿å­˜)
     * @param {HTMLElement} element - æŒ‰é’®å…ƒç´ 
     * @param {string} originalVoucherId - åŸå‡­è¯å·
     */
    window.handleRedDash = function(element, originalVoucherId) {
        if (!confirm(`âš ï¸ ã€é«˜å±æ“ä½œã€‘\n\nç¡®å®šè¦å¯¹å‡­è¯ ${originalVoucherId} æ‰§è¡Œçº¢å†²æ“ä½œå—ï¼Ÿ\n\nç³»ç»Ÿå°†ç”Ÿæˆä¸€å¼ è´Ÿæ•°é‡‘é¢çš„çº¢å­—å‡­è¯ï¼Œæ­¤æ“ä½œä¸å¯é€†ã€‚`)) return;

        // 1. è¯»å–ç°æœ‰å‡­è¯åº“
        let list = JSON.parse(sessionStorage.getItem('ManualVouchers') || "[]");
        
        // 2. æ‰¾åˆ°åŸå§‹å‡­è¯
        const originalIndex = list.findIndex(v => v.id === originalVoucherId);
        if (originalIndex === -1) {
            alert("âŒ é”™è¯¯ï¼šæœªæ‰¾åˆ°åŸå§‹å‡­è¯æ•°æ®ï¼Œæ— æ³•çº¢å†²ã€‚");
            return;
        }
        const original = list[originalIndex];

        // 3. ç”Ÿæˆçº¢å­—å‡­è¯ ID
        // ç®€å•çš„ç”Ÿæˆè§„åˆ™ï¼šæŠŠ "è®°" æ¢æˆ "çº¢"ï¼Œæˆ–è€…åŠ åç¼€
        const redId = originalVoucherId.includes('è®°') 
            ? originalVoucherId.replace('è®°', 'çº¢') 
            : 'çº¢' + originalVoucherId;

        // 4. â˜…â˜…â˜… æ ¸å¿ƒï¼šå…‹éš†å¹¶å–åé‡‘é¢ â˜…â˜…â˜…
        const redLines = original.lines.map(line => ({
            summary: `[å†²é”€] ${line.summary}`, // æ‘˜è¦åŠ å‰ç¼€
            account: line.account,
            // å¦‚æœæœ‰é‡‘é¢ï¼Œå°±åŠ è´Ÿå·
            debit: line.debit ? `-${line.debit.toString().replace(/-/g,'')}` : '', 
            credit: line.credit ? `-${line.credit.toString().replace(/-/g,'')}` : ''
        }));

        // è®¡ç®—æ€»é‡‘é¢ (è´Ÿæ•°)
        const redAmount = `-${original.amount.toString().replace(/-/g,'')}`;

        const redVoucher = {
            id: redId,
            date: new Date().toISOString().slice(0, 10),
            amount: redAmount,
            user: 'å½“å‰ç”¨æˆ·',
            status: 'å·²è®°è´¦', // çº¢å†²å‡­è¯ç›´æ¥ç”Ÿæ•ˆ
            isRed: true,      // æ ‡è®°ä¸ºçº¢å­—ï¼Œè¯¦æƒ…é¡µä¼šå˜è‰²
            lines: redLines   // â˜…â˜…â˜… å¿…é¡»ä¿å­˜åˆ†å½•è¡Œï¼Œè¯¦æƒ…é¡µæ‰æœ‰æ•°æ®ï¼
        };

        // 5. æ›´æ–°åŸå§‹å‡­è¯çŠ¶æ€ä¸ºâ€œå·²å†²é”€â€
        list[originalIndex].status = 'å·²å†²é”€';

        // 6. æ’å…¥æ–°å‡­è¯å¹¶ä¿å­˜
        list.unshift(redVoucher);
        sessionStorage.setItem('ManualVouchers', JSON.stringify(list));

        // 7. è®°å½•å®¡è®¡æ—¥å¿—
        if (typeof addAuditLog === 'function') {
            addAuditLog({
                level: 'é«˜å±',
                time: new Date().toLocaleString(),
                user: 'å½“å‰ç”¨æˆ·',
                module: 'å‡­è¯ç®¡ç†',
                action: 'æ‰§è¡Œçº¢å†²',
                detail: `åŸå‡­è¯:${originalVoucherId} -> çº¢å­—å‡­è¯:${redId}`
            });
        }

        alert(`âœ… çº¢å†²æˆåŠŸï¼\nå·²ç”Ÿæˆçº¢å­—å‡­è¯ï¼š${redId}`);
        
        // 8. åˆ·æ–°åˆ—è¡¨é¡µé¢ (è®©ç•Œé¢é‡æ–°æ¸²æŸ“çœŸå®æ•°æ®)
        loadContent('VoucherQueryPrint');
    }



        // ============================================
        // é”€é¡¹å‘ç¥¨å°è´¦ - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
        // ============================================

        // 1. åŠŸèƒ½ï¼šä»å¯¹è´¦å•ç”Ÿæˆå¼€ç¥¨ç”³è¯· (Open Statement Modal)
        window.openStatementModal = function() {
            // æ¨¡æ‹Ÿå¼¹çª—ï¼šè¿™é‡Œä¸ºäº†ç®€ä¾¿ä½¿ç”¨ promptï¼Œå®é™…å¼€å‘ä¼šç”¨ Modal ç»„ä»¶
            const input = prompt("ğŸ§¾ æ¨¡æ‹Ÿå¼¹çª—ï¼šè¯·é€‰æ‹©è¦å¼€ç¥¨çš„å¯¹è´¦å•ã€‚\n\nè¯·è¾“å…¥å¯¹è´¦å•å· (ä¾‹å¦‚ï¼šDZ202511001)ï¼š", "DZ202511001");
            
            if (input) {
                // æ¨¡æ‹Ÿåç«¯å¤„ç†å¹¶æ’å…¥æ–°è¡Œ
                const tableBody = document.querySelector('#invoiceTable tbody');
                const newRow = `
                    <tr style="background-color: #e6f7ff; animation: highlight 1s;">
                        <td class="val-inv-no" style="color:#ccc;">-</td>
                        <td class="val-client">æ–°é€‰å®¢æˆ·(æ¥è‡ª${input})</td>
                        <td class="val-amount">1,000.00</td>
                        <td class="val-tax">60.00</td>
                        <td class="val-total">1,060.00</td>
                        <td class="val-date">-</td>
                        <td class="status-cell"><span style="color: #f39c12; font-weight:bold;">å¾…å¼€ç¥¨</span></td>
                        <td>
                            <a href="javascript:void(0)" onclick="generateInvoice(this)" style="color:#27ae60; font-weight:bold; border:1px solid #27ae60; padding:2px 6px; border-radius:4px; text-decoration:none;">ç”Ÿæˆå‘ç¥¨</a>
                        </td>
                    </tr>
                `;
                tableBody.insertAdjacentHTML('afterbegin', newRow);
                alert(`âœ… å·²æˆåŠŸä»å¯¹è´¦å•ã€${input}ã€‘ç”Ÿæˆå¼€ç¥¨ç”³è¯·ï¼\n\nåˆ—è¡¨ç¬¬ä¸€è¡Œå·²æ–°å¢ä¸€æ¡â€œå¾…å¼€ç¥¨â€è®°å½•ã€‚`);
            }
        }

        // 2. åŠŸèƒ½ï¼šç”Ÿæˆå‘ç¥¨ (Generate Invoice)
        window.generateInvoice = function(btn) {
            const row = btn.closest('tr');
            const client = row.querySelector('.val-client').innerText;
            const total = row.querySelector('.val-total').innerText;

            if(!confirm(`â“ ç¡®è®¤è¦ä¸ºã€${client}ã€‘é‡‘é¢ ${total} æ‰§è¡Œå¼€ç¥¨æ“ä½œå—ï¼Ÿ\n\nç³»ç»Ÿå°†è¿æ¥ç¨æ§æ¥å£ç”Ÿæˆå‘ç¥¨å·ç ã€‚`)) return;

            // æ¨¡æ‹Ÿå¼€ç¥¨è¿‡ç¨‹
            btn.innerText = "å¼€ç¥¨ä¸­...";
            btn.style.color = "#999";
            
            setTimeout(() => {
                // ç”Ÿæˆæ¨¡æ‹Ÿå‘ç¥¨å·
                const newInvNo = "13000" + Math.floor(Math.random() * 90000 + 10000);
                const today = new Date().toISOString().split('T')[0];

                // æ›´æ–°ç•Œé¢çŠ¶æ€
                row.querySelector('.val-inv-no').innerText = newInvNo;
                row.querySelector('.val-inv-no').style.color = "#333";
                row.querySelector('.val-date').innerText = today;
                row.querySelector('.status-cell').innerHTML = '<span style="color: #27ae60;">å·²å¼€ç¥¨</span>';
                
                // æ›¿æ¢æ“ä½œæŒ‰é’®ï¼šå˜ä¸º æŸ¥çœ‹ | çº¢å†²
                const actionCell = btn.parentElement;
                actionCell.innerHTML = `
                    <a href="javascript:void(0)" onclick="viewInvoiceDetail('${inv.no}')" style="color:#3498db;">æŸ¥çœ‹</a>
                    | 
                    <a href="javascript:void(0)" onclick="handleInvoiceRedDash(this)" style="color:#e74c3c;">å†²çº¢</a>
                `;
                
                row.style.backgroundColor = "#fff"; // ç§»é™¤é«˜äº®
                alert(`ğŸ‰ å¼€ç¥¨æˆåŠŸï¼\n\nå‘ç¥¨å·ç ï¼š${newInvNo}\nçŠ¶æ€å·²æ›´æ–°ã€‚`);
            }, 1000);
        }

        // 3. åŠŸèƒ½ï¼šçº¢å†²å‘ç¥¨ (Red Dash Invoice)
        window.handleInvoiceRedDash = function(btn) {
            const row = btn.closest('tr');
            const invNo = row.querySelector('.val-inv-no').innerText;

            const reason = prompt(`âš ï¸ è­¦å‘Šï¼šæ‚¨æ­£åœ¨å¯¹å‘ç¥¨ã€${invNo}ã€‘è¿›è¡Œçº¢å­—å†²é”€ï¼\næ­¤æ“ä½œå°†ä½œåºŸåŸå‘ç¥¨å¹¶ç”Ÿæˆçº¢å­—å‘ç¥¨ã€‚\n\nè¯·è¾“å…¥å†²çº¢åŸå› ï¼š`);
            
            if (reason) {
                // 1. åŸè¡Œå˜ç°ï¼ŒçŠ¶æ€å˜å†²çº¢
                row.style.color = "#999";
                row.style.backgroundColor = "#f9f9f9";
                row.querySelector('.status-cell').innerHTML = '<span style="color: #e74c3c; text-decoration: line-through;">å·²å†²çº¢</span>';
                
                // ç¦ç”¨æŒ‰é’®
                const parentTd = btn.parentElement;
                parentTd.innerHTML = '<span style="color:#ccc;">å·²ä½œåºŸ</span>';

                // 2. æ’å…¥çº¢å­—è¡Œ
                // è·å–åŸæ•°æ®
                const client = row.querySelector('.val-client').innerText;
                const amount = row.querySelector('.val-amount').innerText;
                const tax = row.querySelector('.val-tax').innerText;
                const total = row.querySelector('.val-total').innerText;
                const date = row.querySelector('.val-date').innerText;

                const redRow = `
                    <tr style="background-color: #fff0f0; color: #e74c3c;">
                        <td class="val-inv-no">çº¢-${invNo}</td>
                        <td class="val-client">${client}</td>
                        <td class="val-amount">-${amount}</td>
                        <td class="val-tax">-${tax}</td>
                        <td class="val-total">-${total}</td>
                        <td class="val-date">${date}</td>
                        <td class="status-cell"><span style="color: #e74c3c;">çº¢å­—å‘ç¥¨</span></td>
                        <td>
                            <a href="javascript:void(0)" onclick="viewInvoiceDetail(this)" style="color:#e74c3c;">æŸ¥çœ‹çº¢ç¥¨</a>
                        </td>
                    </tr>
                `;
                row.insertAdjacentHTML('afterend', redRow);
                
                alert("âœ… çº¢å†²æ“ä½œå®Œæˆï¼Œçº¢å­—å‘ç¥¨å·²ç”Ÿæˆã€‚");
            }
        }


        /**
 * æ¨¡æ‹Ÿçº¢å†²æ“ä½œçš„å‡½æ•° (å¯¹åº”â€œçº¢å†²â€æŒ‰é’®)
 * @param {HTMLElement} element - è¢«ç‚¹å‡»çš„å…ƒç´ 
 * @param {string} voucherId - è¦å†²é”€çš„å‡­è¯ç¼–å·
 */
function handleRedDash(element, voucherId) {
    if (confirm(`ç¡®å®šè¦å¯¹å‡­è¯ ${voucherId} æ‰§è¡Œçº¢å†²æ“ä½œå—ï¼Ÿ\n\nç³»ç»Ÿå°†ç”Ÿæˆä¸€å¼ çº¢å­—å†²é”€å‡­è¯ï¼Œå¹¶è¦æ±‚æ‚¨é‡æ–°å½•å…¥æ­£ç¡®çš„å‡­è¯ã€‚`)) {
        // å®é™…åº”ç”¨ä¸­ï¼šæ­¤å¤„ä¼šè°ƒç”¨åç«¯æ¥å£ï¼Œç”Ÿæˆçº¢å­—å‡­è¯ï¼Œå¹¶åˆ·æ–°åˆ—è¡¨
        alert(`ã€ç³»ç»Ÿæ¨¡æ‹Ÿã€‘\nå·²å¯¹å‡­è¯ ${voucherId} æ‰§è¡Œå†²çº¢æ“ä½œã€‚\nè¯·æŸ¥çœ‹åˆ—è¡¨ä¸­çš„çº¢å­—å†²é”€å‡­è¯è®°å½•ã€‚`);
        
        // æ¨¡æ‹ŸçŠ¶æ€å˜æ›´æˆ–è·³è½¬åˆ°çº¢å†²é¡µé¢
        // åœ¨åŸå‹ä¸­ï¼Œæˆ‘ä»¬ç®€å•åœ°å¼¹çª—æç¤º
    }
}

/**
 * æ¨¡æ‹Ÿçº¢å†²æ“ä½œçš„å‡½æ•° (å¯¹åº”â€œçº¢å†²â€æŒ‰é’®)
 * æ–°å¢åŠ¨æ€æ’å…¥çº¢å­—å‡­è¯çš„é€»è¾‘ã€‚
 * @param {HTMLElement} element - è¢«ç‚¹å‡»çš„å…ƒç´  (æ“ä½œæŒ‰é’®)
 * @param {string} originalVoucherId - è¦å†²é”€çš„è“å­—å‡­è¯ç¼–å·
 */
function handleRedDash(element, originalVoucherId) {
    if (confirm(`ç¡®å®šè¦å¯¹å‡­è¯ ${originalVoucherId} æ‰§è¡Œçº¢å†²æ“ä½œå—ï¼Ÿ\n\nç³»ç»Ÿå°†ç”Ÿæˆä¸€å¼ çº¢å­—å†²é”€å‡­è¯ã€‚\n\nã€æ³¨æ„ã€‘æ­¤æ“ä½œä¸å¯é€†ï¼Œè¯·åœ¨å®¡è®¡æ—¥å¿—ä¸­æŸ¥çœ‹è®°å½•ã€‚`)) {
        
        const originalRow = element.closest('tr');
        const voucherTableBody = originalRow.closest('tbody');
        
        // --- 1. æ¨¡æ‹Ÿç¦ç”¨åŸå‡­è¯çš„çº¢å†²æŒ‰é’® ---
        const originalActionCell = originalRow.querySelector('td:last-child');
        originalActionCell.innerHTML = `
            <span style="color: #f39c12; font-weight: bold;">å·²çº¢å†²</span> | 
            <a href="javascript:void(0)" style="color:#3498db; cursor: not-allowed;">æŸ¥çœ‹æ˜ç»†</a>
        `;

        // --- 2. æ¨¡æ‹Ÿç”Ÿæˆæ–°çš„çº¢å­—å†²é”€å‡­è¯è¡Œ ---
        const originalDebit = originalRow.querySelector('.val-debit').textContent.replace(/,/g, '');
        const originalCredit = originalRow.querySelector('.val-credit').textContent.replace(/,/g, '');
        
        const newRedVoucherId = originalVoucherId.replace(/è®°|è‡ª/, 'å†²') + 'R'; // æ¨¡æ‹Ÿç”Ÿæˆçº¢å­—ç¼–å·

        const newRowHTML = `
            <tr id="row-${newRedVoucherId}">
                <td><input type="checkbox" disabled></td>
                <td class="val-id" style="color: #e74c3c; font-weight: bold;">${newRedVoucherId} (çº¢å­—)</td>
                <td class="val-date">${new Date().toISOString().slice(0, 10)}</td>
                <td class="val-summary" style="color: #e74c3c;">å†²é”€åŸå‡­è¯: ${originalVoucherId}</td>
                <td class="val-debit" style="color: #e74c3c;">(${parseFloat(originalDebit).toFixed(2)})</td>
                <td class="val-credit" style="color: #e74c3c;">(${parseFloat(originalCredit).toFixed(2)})</td>
                <td class="status-cell"><span style="color: #e74c3c; font-weight: bold;">å·²å†²é”€</span></td>
                <td>
                    <a href="javascript:void(0)" onclick="openVoucherDetail(this)" style="color:#3498db;">æŸ¥çœ‹æ˜ç»†</a> | 
                    <a href="javascript:void(0)" onclick="handleRedDashUndo(this, '${newRedVoucherId}', '${originalVoucherId}')" style="color:#2980b9; font-weight: bold;">æ’¤é”€çº¢å†²</a>
                </td>
            </tr>
        `;
        
        // å°†æ–°è¡Œæ’å…¥åˆ°è¡¨æ ¼é¡¶éƒ¨
        voucherTableBody.insertAdjacentHTML('afterbegin', newRowHTML);

        alert(`ã€ç³»ç»Ÿæç¤ºã€‘å‡­è¯ ${originalVoucherId} å·²è¢«æˆåŠŸå†²çº¢ã€‚\næ–°çš„çº¢å­—å†²é”€å‡­è¯ ${newRedVoucherId} å·²ç”Ÿæˆã€‚`);
    }
}

/**
 * æ¨¡æ‹Ÿæ’¤é”€çº¢å†²æ“ä½œçš„å‡½æ•° (å¯¹åº”â€œæ’¤é”€çº¢å†²â€æŒ‰é’®)
 * æ–°å¢æ¢å¤åŸå‡­è¯çº¢å†²æŒ‰é’®çš„é€»è¾‘ã€‚
 * @param {HTMLElement} element - è¢«ç‚¹å‡»çš„å…ƒç´  (æ“ä½œæŒ‰é’®)
 * @param {string} redVoucherId - è¦æ’¤é”€çš„çº¢å­—å‡­è¯ç¼–å·
 * @param {string} originalVoucherId - åŸå§‹å‡­è¯ç¼–å·
 */
function handleRedDashUndo(element, redVoucherId, originalVoucherId) {
    if (confirm(`è­¦å‘Šï¼šç¡®å®šè¦æ’¤é”€å¯¹å‡­è¯ ${redVoucherId} çš„å†²é”€æ“ä½œå—ï¼Ÿ\n\nè¯¥çº¢å­—å‡­è¯å°†è¢«ä½œåºŸï¼ŒåŸå‡­è¯ (${originalVoucherId}) å°†æ¢å¤å¯å†²çº¢çŠ¶æ€ã€‚`)) {
        
        // --- 1. æ¨¡æ‹Ÿæ¢å¤åŸå‡­è¯çš„çº¢å†²æŒ‰é’® ---
        // æ‰¾åˆ°åŸå§‹å‡­è¯æ‰€åœ¨çš„è¡Œ (å‡è®¾åˆ—è¡¨ä¸­è¿˜å­˜åœ¨)
        const originalRow = document.querySelector(`.val-id:contains('${originalVoucherId}')`).closest('tr');
        if (originalRow) {
             const originalActionCell = originalRow.querySelector('td:last-child');
             originalActionCell.innerHTML = `
                <a href="javascript:void(0)" onclick="openVoucherDetail(this)" style="color:#3498db;">æŸ¥çœ‹æ˜ç»†</a> | 
                <a href="javascript:void(0)" onclick="handleRedDash(this, '${originalVoucherId}')" style="color:#f39c12; font-weight: bold;">çº¢å†²</a>
             `;
        }

        // --- 2. ç§»é™¤çº¢å­—å‡­è¯è¡Œ ---
        const row = element.closest('tr');
        if (row) {
             row.remove();
        }

        alert(`ã€ç³»ç»Ÿæç¤ºã€‘çº¢å­—å‡­è¯ ${redVoucherId} å·²è¢«ä½œåºŸã€‚\nåŸå‡­è¯ ${originalVoucherId} å·²æ¢å¤å¯å†²çº¢çŠ¶æ€ã€‚`);
    }
}



// ==========================================================
    // æœŸæœ«å¤„ç†ä¸ç»“è½¬é€»è¾‘ (ç»ˆæä¿®å¤ç‰ˆï¼šå¢åŠ ç»“è´¦é”å®šæ ¡éªŒ)
    // ==========================================================

    /** 1. æ‰§è¡Œç»“è½¬ (å¸¦ç»“è´¦é”å®šæ ¡éªŒ) */
    window.executeTransfer = function(period) {
        // â˜…â˜…â˜… æ ¸å¿ƒæ ¡éªŒï¼šæ£€æŸ¥æ˜¯å¦å·²ç»“è´¦ â˜…â˜…â˜…
        if (sessionStorage.getItem('2025-11-MonthClosed') === 'true') {
            alert("â›” æ“ä½œè¢«æ‹¦æˆªï¼\n\nå½“å‰ä¼šè®¡æœŸé—´ã€å·²ç»“è´¦é”å®šã€‘ã€‚\nå¦‚éœ€é‡æ–°ç»“è½¬æŸç›Šï¼Œè¯·å…ˆå‰å¾€ã€æœˆæœ«ç»“è´¦ã€‘æ¨¡å—æ‰§è¡Œåç»“è´¦ã€‚");
            return;
        }

        // ... (ä¸‹é¢çš„é€»è¾‘ä¿æŒä¸å˜) ...
        
        // 1. å…ˆè®¡ç®—
        const res = calculateRealProfit();

        if (res.count === 0) {
            alert("âš ï¸ ç³»ç»Ÿæœªæ£€æµ‹åˆ°ã€å·²å®¡æ ¸ã€‘æˆ–ã€å·²è®°è´¦ã€‘çš„å‡­è¯ã€‚\nè¯·å…ˆå»å®¡æ ¸å‡­è¯ã€‚");
            return;
        }

        const profitStr = (res.profit >= 0 ? '+' : '') + res.profit.toLocaleString('en-US', {minimumFractionDigits: 2});
        
        if (!confirm(`â“ ç¡®è®¤æ‰§è¡Œã€${period}ã€‘æŸç›Šç»“è½¬å—ï¼Ÿ\n\næœ¬æœŸå‡€åˆ©æ¶¦ï¼š${profitStr}`)) return;

        sessionStorage.setItem('2025-11-ProfitTransferred', 'true');
        sessionStorage.setItem('2025-11-ProfitAmount', profitStr);
        sessionStorage.setItem('2025-11-ProfitDetail', JSON.stringify(res)); 

        // è®°æ—¥å¿—
        addAuditLog({level:'ä¸­é£é™©', time:new Date().toLocaleString(), user:'å½“å‰ç”¨æˆ·', module:'ç»“è½¬æŸç›Š', action:'æ‰§è¡Œç»“è½¬', detail:profitStr});

        alert(`âœ… ç»“è½¬æˆåŠŸï¼\næŸç›Šç±»ç§‘ç›®ä½™é¢å·²æ¸…é›¶ã€‚`);
        loadContent('PeriodEndProfit');
    }

    /** 2. å†²å›ç»“è½¬ (å¸¦ç»“è´¦é”å®šæ ¡éªŒ) */
    window.reverseTransfer = function(period) {
        // â˜…â˜…â˜… æ ¸å¿ƒæ ¡éªŒï¼šæ£€æŸ¥æ˜¯å¦å·²ç»“è´¦ â˜…â˜…â˜…
        if (sessionStorage.getItem('2025-11-MonthClosed') === 'true') {
            alert("â›” æ“ä½œè¢«æ‹¦æˆªï¼\n\nå½“å‰ä¼šè®¡æœŸé—´ã€å·²ç»“è´¦é”å®šã€‘ã€‚\nå¦‚éœ€å†²å›æŸç›Šï¼Œè¯·å…ˆå‰å¾€ã€æœˆæœ«ç»“è´¦ã€‘æ¨¡å—æ‰§è¡Œåç»“è´¦ã€‚");
            return;
        }

        // ... (ä¸‹é¢çš„é€»è¾‘ä¿æŒä¸å˜) ...

        if (!confirm(`âš ï¸ è­¦å‘Šï¼šç¡®å®šè¦å†²å›ã€${period}ã€‘å—ï¼Ÿ\næ­¤æ“ä½œå°†ä½œåºŸç»“è½¬å‡­è¯ã€‚`)) return;

        sessionStorage.removeItem('2025-11-ProfitTransferred');
        
        // è®°æ—¥å¿—
        addAuditLog({level:'é«˜å±', time:new Date().toLocaleString(), user:'å½“å‰ç”¨æˆ·', module:'ç»“è½¬æŸç›Š', action:'å†²å›ç»“è½¬', detail:period});
        
        alert("âœ… å·²æˆåŠŸå†²å›ï¼\næ‚¨ç°åœ¨å¯ä»¥ä¿®æ”¹å‡­è¯æˆ–é‡æ–°ç»“è½¬ã€‚");
        loadContent('PeriodEndProfit');
    }

  /**
     * 3. æŸ¥çœ‹ç»“è½¬å‡­è¯è¯¦æƒ… (ä¿®æ­£ä¼šè®¡é€»è¾‘)
     */
window.viewPLVoucher = function(voucherId) {
        // è¯»å–åˆšæ‰å­˜çš„æ˜ç»†
        const detailStr = sessionStorage.getItem('2025-11-ProfitDetail');
        // å¦‚æœæ²¡æœ‰çœŸå®æ•°æ®ï¼Œå°±ç”¨é»˜è®¤å‡æ•°æ®å…œåº•
        const detail = detailStr ? JSON.parse(detailStr) : { income: 1125000, cost: 1000000, profit: 125000 };

        window.g_currentVoucher = {
            id: voucherId, 
            date: '2025-11-30', 
            debit: detail.income.toLocaleString('en-US', {minimumFractionDigits: 2}), 
            credit: detail.income.toLocaleString('en-US', {minimumFractionDigits: 2}),
            lines: [
                { zy: 'ç»“è½¬æœ¬æœŸæ”¶å…¥', km: '6001 ä¸»è¥ä¸šåŠ¡æ”¶å…¥', jf: detail.income.toLocaleString('en-US', {minimumFractionDigits: 2}), df: '' },
                { zy: 'ç»“è½¬æˆæœ¬è´¹ç”¨', km: '6401/6602 ç­‰', jf: '', df: detail.cost.toLocaleString('en-US', {minimumFractionDigits: 2}) },
                { zy: 'ç»“è½¬æœ¬å¹´åˆ©æ¶¦', km: '4103 æœ¬å¹´åˆ©æ¶¦', jf: '', df: detail.profit.toLocaleString('en-US', {minimumFractionDigits: 2}) }
            ]
        };
        loadContent('VoucherDetail');
    }

    // --- å†…éƒ¨è¾…åŠ©ï¼šæ›´æ–°è¡Œæ ·å¼ä¸ºâ€œå·²ç»“è½¬â€ ---
    function updateRowToTransferred(row, time, amount, voucherId, period) {
        row.querySelector('.time-cell').innerText = time;
        row.querySelector('.amount-cell').innerHTML = `<span style="color: #2980b9; font-weight:bold;">${amount}</span>`;
        row.querySelector('.voucher-cell').innerText = voucherId;
        row.querySelector('.status-cell').innerHTML = `<span style="color: #27ae60; font-weight: bold;">å·²ç»“è½¬</span>`;
        
        // æ›¿æ¢æ“ä½œæŒ‰é’®ä¸ºï¼šå†²å› | æŸ¥çœ‹
        row.querySelector('.action-cell').innerHTML = `
            <a href="javascript:void(0)" onclick="reverseTransfer('${period}', '${voucherId}', this)" style="color:#e74c3c;">å†²å›</a> | 
            <a href="javascript:void(0)" onclick="viewPLVoucher('${voucherId}')" style="color:#3498db;">æŸ¥çœ‹å‡­è¯</a>
        `;
    }

    // --- å†…éƒ¨è¾…åŠ©ï¼šæ›´æ–°è¡Œæ ·å¼ä¸ºâ€œæœªç»“è½¬â€ ---
    function updateRowToPending(row, period) {
        row.querySelector('.amount-cell').innerHTML = `<span style="color: #f39c12;">å¾…æ‰§è¡Œ</span>`;
        row.querySelector('.voucher-cell').innerText = "-";
        row.querySelector('.status-cell').innerHTML = `<span style="color: #c0392b; font-weight: bold;">æœªç»“è½¬</span>`;
        
        // æ›¿æ¢æ“ä½œæŒ‰é’®ä¸ºï¼šæ‰§è¡Œ
        row.querySelector('.action-cell').innerHTML = `
            <a href="javascript:void(0)" onclick="executeTransfer('${period}', this)" style="color:#27ae60; font-weight:bold;">æ‰§è¡Œ</a>
        `;
    }



    // ==========================================================
    // æœˆæœ«ç»“è´¦/é”å®š - æ ¸å¿ƒé€»è¾‘å‡½æ•°
    // ==========================================================

    // å…¨å±€å˜é‡ï¼šè®°å½•å½“å‰æ£€æŸ¥æ˜¯å¦é€šè¿‡
    var g_isClosingReady = false; 

    /**
     * 1. åˆ·æ–°/æ‰§è¡Œç»“è´¦å‰æ£€æŸ¥ (Checklist)
     */
   // ä¿®å¤ç‚¹ï¼šè¡¥å…¨äº†ä¸¢å¤±çš„ç»“å°¾ç¬¦å·ï¼Œå¹¶å¢åŠ äº†è¯»å– sessionStorage çš„è”åŠ¨é€»è¾‘
    window.refreshClosingCheck = function() {
        const tbody = document.getElementById('checkListBody');
        if (!tbody) return;

        tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; color:#3498db;">â³ ç³»ç»Ÿæ­£åœ¨è¿›è¡Œæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥...</td></tr>';

        setTimeout(() => {
            // 1. è¯»å–â€œç»“è½¬æŸç›Šâ€é¡µé¢å­˜ä¸‹çš„çŠ¶æ€
            const isTransferred = sessionStorage.getItem('2025-11-ProfitTransferred') === 'true';
            
            // 2. æ ¹æ®çŠ¶æ€å†³å®šâ€œæŸç›Šç»“è½¬â€è¿™ä¸€é¡¹æ˜¯é€šè¿‡è¿˜æ˜¯å¤±è´¥
            const profitCheckStatus = isTransferred ? 'pass' : 'fail';
            const profitCheckMsg = isTransferred 
                ? 'æŸç›Šç»“è½¬å‡­è¯å·²ç”Ÿæˆ (å‡€åˆ© +125,000.00)ã€‚' 
                : 'å°šæœªæ‰§è¡ŒæŸç›Šç»“è½¬ï¼ŒæŸç›Šç§‘ç›®ä½™é¢ä¸ä¸º0ã€‚';

            const checks = [
                { name: 'æ‰€æœ‰å‡­è¯å·²å®¡æ ¸', status: 'pass', msg: 'æ— å¾…å®¡æ ¸å‡­è¯ã€‚', link: '' },
                { name: 'æ‰€æœ‰ä¸šåŠ¡å•æ®å·²å…¥è´¦', status: 'warn', msg: 'æœ‰ 2 å¼ è¿å•ç»“ç®—å•æœªè‡ªåŠ¨ç”Ÿæˆå‡­è¯ (ä¸å½±å“ç»“è´¦)ã€‚', link: 'EngineMapping' },
                { name: 'å·²å®Œæˆå›ºå®šèµ„äº§æŠ˜æ—§è®¡ç®—', status: 'pass', msg: 'æŠ˜æ—§å‡­è¯å·²ç”Ÿæˆ (è®¡ 38,500.00)ã€‚', link: '' },
                { name: 'å·²å®ŒæˆæŸç›Šç±»ç§‘ç›®ç»“è½¬', status: profitCheckStatus, msg: profitCheckMsg, link: 'PeriodEndProfit' }, 
                { name: 'è¯•ç®—å¹³è¡¡æ£€æŸ¥', status: 'pass', msg: 'å€Ÿè´·å¹³è¡¡ (å·®é¢ 0.00)ã€‚', link: '' }
            ];

            let html = '';
            let allPass = true;

            checks.forEach(item => {
                let statusHtml = '';
                let actionHtml = '';

                if (item.status === 'pass') {
                    statusHtml = `<span style="color: #27ae60; font-weight: bold;">âœ… é€šè¿‡</span>`;
                    actionHtml = `<span style="color:#ccc;">-</span>`;
                } else if (item.status === 'warn') {
                    statusHtml = `<span style="color: #f39c12; font-weight: bold;">âš ï¸ è­¦å‘Š</span>`;
                    actionHtml = `<a href="javascript:void(0)" onclick="loadContent('${item.link}')" style="color:#3498db;">å»å¤„ç†</a>`;
                } else if (item.status === 'fail') {
                    statusHtml = `<span style="color: #c0392b; font-weight: bold;">âŒ å¤±è´¥</span>`;
                    actionHtml = `<a href="javascript:void(0)" onclick="loadContent('${item.link}')" style="color:#c0392b; font-weight:bold; text-decoration:underline;">ç«‹å³å¤„ç†</a>`;
                    allPass = false;
                }

                html += `<tr><td>${item.name}</td><td>${statusHtml}</td><td>${item.msg}</td><td>${actionHtml}</td></tr>`;
            });

            tbody.innerHTML = html;
            
            // 3. æ§åˆ¶â€œç»“è´¦â€æŒ‰é’®æ˜¯å¦å¯ç”¨
            const btnClose = document.getElementById('btnExecuteClose');
            if (allPass) {
                g_isClosingReady = true;
                btnClose.disabled = false;
                btnClose.style.backgroundColor = "#c0392b";
                btnClose.style.cursor = "pointer";
                btnClose.innerText = "æ‰§è¡Œæœˆæœ«ç»“è´¦ (2025å¹´11æœŸ)";
            } else {
                g_isClosingReady = false;
                btnClose.disabled = true;
                btnClose.style.backgroundColor = "#95a5a6";
                btnClose.style.cursor = "not-allowed";
                btnClose.innerText = "æ— æ³•ç»“è´¦ (è¯·å…ˆå¤„ç†å¤±è´¥é¡¹)";
            }

        }, 600);
    } // 

    window.executeMonthEndClose = function() {
        if (!g_isClosingReady) {
            alert("âŒ ç³»ç»Ÿæ£€æŸ¥æœªé€šè¿‡ï¼");
            return;
        }
        if (confirm(`ğŸ”’ ç¡®è®¤å¯¹ [2025å¹´11æœŸ] è¿›è¡Œæœˆæœ«ç»“è´¦å—ï¼Ÿ\nç»“è´¦åæ•°æ®å°†é”å®šã€‚`)) {
            alert("âœ… ç»“è´¦æˆåŠŸï¼å½“å‰ä¼šè®¡æœŸé—´å·²åˆ‡æ¢ä¸ºï¼š[2025å¹´12æœŸ]ã€‚");
            document.getElementById('currentPeriodDisplay').innerText = "2025å¹´12æœŸ";
            document.getElementById('btnExecuteClose').disabled = true;
            document.getElementById('btnExecuteClose').innerText = "å½“å‰æœŸé—´æ— éœ€ç»“è´¦";
            document.getElementById('checkListBody').innerHTML = '<tr><td colspan="4" style="text-align:center; color:#27ae60;">æ–°æœŸé—´ [2025-12] å°šæœªå¼€å§‹ï¼Œæš‚æ— æ•°æ®éœ€è¦æ£€æŸ¥ã€‚</td></tr>';
        }
    }


/**
     * 3. [ç»ˆæä¿®å¤ç‰ˆ] åç»“è´¦ (ä¿®å¤é¡µé¢è”åŠ¨ + ç¡®ä¿è®°æ—¥å¿—)
     */
    window.executeReOpen = function() {
        // 1. è¯»å–å½“å‰çŠ¶æ€
        const isClosed = sessionStorage.getItem('2025-11-MonthClosed') === 'true';
        
        // å¦‚æœè¿˜æ²¡ç»“è´¦ï¼Œå°±ä¸ç”¨åäº†
        if (!isClosed) {
            alert("âš ï¸ å½“å‰æœŸé—´å°šæœªç»“è´¦ï¼Œæ— éœ€æ“ä½œã€‚");
            return;
        }

        if (confirm("âš ï¸ è­¦å‘Šï¼šç¡®å®šè¦ã€åç»“è´¦ã€‘å—ï¼Ÿ\n\næ­¤æ“ä½œå°†è§£é” 11 æœˆæ•°æ®ï¼Œå¹¶è®°å½•é«˜å±å®¡è®¡æ—¥å¿—ã€‚")) {
            
            // 2. æ¸…é™¤ç»“è´¦çŠ¶æ€ (æ ¸å¿ƒåŠ¨ä½œ)
            sessionStorage.removeItem('2025-11-MonthClosed');
            
            // 3. å†™å…¥å®¡è®¡æ—¥å¿— (ç¡®ä¿ addAuditLog å‡½æ•°å­˜åœ¨)
            if (typeof addAuditLog === 'function') {
                addAuditLog({
                    level: 'é«˜å±',
                    time: new Date().toLocaleString(),
                    user: 'å½“å‰ç”¨æˆ·',
                    ip: '127.0.0.1',
                    module: 'æœˆæœ«ç»“è´¦',
                    action: 'æ‰§è¡Œåç»“è´¦',
                    detail: 'å›é€€è‡³2025-11æœŸï¼Œè§£é™¤æ•°æ®é”å®š'
                });
            } else {
                console.error("addAuditLog å‡½æ•°æœªå®šä¹‰ï¼Œæ—¥å¿—å†™å…¥å¤±è´¥");
            }
            
            alert("âœ… åç»“è´¦æˆåŠŸï¼\n\nå½“å‰æœŸé—´å·²å›é€€è‡³ [2025å¹´11æœŸ]ã€‚");
            
            // 4. â˜…â˜…â˜… å…³é”®ä¿®å¤ï¼šé‡æ–°åŠ è½½æ¨¡å—ï¼Œåˆ·æ–°é¡µé¢è§†å›¾ â˜…â˜…â˜…
            // ä¹‹å‰æ˜¯ refreshClosingCheck()ï¼Œé‚£åªåˆ·æ–°è¡¨æ ¼ï¼Œä¸åˆ·æ–°æ•´ä½“è§†å›¾
            loadContent('PeriodEndClose'); 
        }
    }


    /**
     * 2. æ‰§è¡Œæœˆæœ«ç»“è´¦åŠ¨ä½œ
     */
    function executeMonthEndClose() {
        if (!g_isClosingReady) {
            alert("âŒ ç³»ç»Ÿæ£€æŸ¥æœªé€šè¿‡ï¼Œæ— æ³•æ‰§è¡Œç»“è´¦æ“ä½œï¼\nè¯·å¤„ç†åˆ—è¡¨ä¸­çš„çº¢å­—å¤±è´¥é¡¹ã€‚");
            return;
        }

        if (confirm(`ğŸ”’ ã€é«˜é£é™©æ“ä½œç¡®è®¤ã€‘\n\næ‚¨å³å°†å¯¹ [2025å¹´11æœŸ] è¿›è¡Œæœˆæœ«ç»“è´¦ã€‚\n\nç»“è´¦åï¼š\n1. è¯¥æœŸé—´æ‰€æœ‰å‡­è¯å°†æ— æ³•ä¿®æ”¹æˆ–åˆ é™¤ã€‚\n2. æ— æ³•å†å½•å…¥è¯¥æ—¥æœŸçš„ä¸šåŠ¡å•æ®ã€‚\n3. ä¼šè®¡æœŸé—´å°†è‡ªåŠ¨åˆ‡æ¢è‡³ [2025å¹´12æœŸ]ã€‚\n\nç¡®å®šè¦ç»§ç»­å—ï¼Ÿ`)) {
            // æ¨¡æ‹Ÿç»“è´¦è¿‡ç¨‹
            alert("â³ æ­£åœ¨é”å®šæ•°æ®...\næ­£åœ¨å¤‡ä»½æœŸæœ«è´¦å¥—...\næ­£åœ¨åˆ‡æ¢ä¼šè®¡æœŸé—´...");
            
            alert("âœ… ç»“è´¦æˆåŠŸï¼\n\nå½“å‰ä¼šè®¡æœŸé—´å·²åˆ‡æ¢ä¸ºï¼š[2025å¹´12æœŸ]ã€‚");
            
            // æ¨¡æ‹Ÿåˆ·æ–°é¡µé¢çŠ¶æ€
            document.getElementById('currentPeriodDisplay').innerText = "2025å¹´12æœŸ";
            document.getElementById('btnExecuteClose').disabled = true;
            document.getElementById('btnExecuteClose').innerText = "å½“å‰æœŸé—´æ— éœ€ç»“è´¦";
            document.getElementById('checkListBody').innerHTML = '<tr><td colspan="4" style="text-align:center; color:#27ae60;">æ–°æœŸé—´ [2025-12] å°šæœªå¼€å§‹ï¼Œæš‚æ— æ•°æ®éœ€è¦æ£€æŸ¥ã€‚</td></tr>';
        }
    }

    /**
     * 3. åç»“è´¦ (Re-Open)
     */
    function executeReOpen() {
        // ç®€å•æ¨¡æ‹Ÿï¼šåªèƒ½åæœ€è¿‘çš„ä¸€ä¸ªæœˆ
        if (confirm(`âš ï¸ ã€åç»“è´¦è­¦å‘Šã€‘\n\næ‚¨æ­£åœ¨ç”³è¯·å¯¹ [2025å¹´11æœŸ] æ‰§è¡Œåç»“è´¦æ“ä½œã€‚\n\næ³¨æ„ï¼š\n1. æ­¤æ“ä½œå°†è®°å½•åœ¨ã€æ•æ„Ÿæ“ä½œæ—¥å¿—ã€‘ä¸­ã€‚\n2. 11æœˆçš„æ•°æ®å°†æ¢å¤ä¸ºå¯ç¼–è¾‘çŠ¶æ€ï¼Œå¯èƒ½ä¼šå½±å“æŠ¥è¡¨æ•°æ®ã€‚\n\nè¯·è¾“å…¥â€œç¡®è®¤åç»“è´¦â€ä»¥ç»§ç»­ï¼š`)) {
             // è¿™é‡Œå¯ä»¥åŠ ä¸€ä¸ª prompt äºŒæ¬¡ç¡®è®¤
             alert("âœ… åç»“è´¦æˆåŠŸï¼\n\nä¼šè®¡æœŸé—´å·²å›é€€è‡³ï¼š[2025å¹´11æœŸ]ã€‚\nè¯·å°½å¿«å®Œæˆä¿®æ­£å¹¶é‡æ–°ç»“è´¦ã€‚");
             refreshClosingCheck(); // é‡æ–°åŠ è½½æ£€æŸ¥åˆ—è¡¨
             document.getElementById('currentPeriodDisplay').innerText = "2025å¹´11æœŸ";
        }
    }
    
    // ==========================================================
    // æ•°æ®å˜æ›´è¯¦æƒ…æŸ¥çœ‹ (View Data Change Detail)
    // ==========================================================
    window.viewDataChangeDetail = function(btn) {
        // è·å–å½“å‰è¡Œçš„æ•°æ®
        const row = btn.closest('tr');
        const cells = row.querySelectorAll('td');
        
        const time = cells[0].innerText;
        const user = cells[1].innerText;
        const obj = cells[2].innerText;
        const id = cells[3].innerText;
        const field = cells[4].innerText;
        const oldVal = cells[5].innerText;
        const newVal = cells[6].innerText;

        // æ¨¡æ‹Ÿå¼¹å‡ºä¸€ä¸ªè¯¦ç»†çš„å¯¹æ¯”æŠ¥å‘Š
        alert(
            `ğŸ“ ã€æ•°æ®å˜æ›´è¯¦æƒ…å¿«ç…§ã€‘\n` +
            `--------------------------------------------------\n` +
            `å˜æ›´å¯¹è±¡ï¼š${obj} (${id})\n` +
            `å˜æ›´å­—æ®µï¼šã€${field}ã€‘\n` +
            `--------------------------------------------------\n` +
            `ğŸ”´ å˜æ›´å‰ï¼š${oldVal}\n` +
            `ğŸŸ¢ å˜æ›´åï¼š${newVal}\n` +
            `--------------------------------------------------\n` +
            `æ“ä½œäººï¼š${user}\n` +
            `æ“ä½œæ—¶é—´ï¼š${time}\n` +
            `æ“ä½œ IPï¼š192.168.1.X (å†…ç½‘)\n` +
            `--------------------------------------------------\n` +
            `ç³»ç»Ÿåˆ¤å®šé£é™©ï¼š${field.includes('é“¶è¡Œ') || field.includes('é¢åº¦') ? 'é«˜' : 'ä½'}`
        );
    }




    // ==========================================================
    // å®¢æˆ·æ¡£æ¡ˆç®¡ç† - æ ¸å¿ƒäº¤äº’é€»è¾‘ (å¸¦å®¡è®¡æ—¥å¿—)
    // ==========================================================

// ==========================================================
    // 1. æ–°å¢å®¢æˆ· (ä¿®å¤ç‰ˆï¼šè¡¥å…¨å­—æ®µ + ä¿å­˜åˆ° Session)
    // ==========================================================
    window.addCustomer = function() {
        // 1. æ”¶é›†ä¿¡æ¯ (è¡¥å…¨äº†çº³ç¨å·å’Œè´¦æœŸ)
        const name = prompt("è¯·è¾“å…¥å®¢æˆ·åç§°ï¼š", "æ–°å®¢æˆ·å…¬å¸");
        if (!name) return;
        
        const taxId = prompt("è¯·è¾“å…¥çº³ç¨äººè¯†åˆ«å·ï¼š", "91310000..."); // æ–°å¢
        const type = prompt("è¯·è¾“å…¥ç»“ç®—æ–¹å¼ (æœˆç»“/ç°ç»“)ï¼š", "æœˆç»“");
        const limit = prompt("è¯·è¾“å…¥ä¿¡ç”¨é¢åº¦ (RMB)ï¼š", "50000.00");
        const days = prompt("è¯·è¾“å…¥è´¦æœŸ (å¤©)ï¼š", "30"); // æ–°å¢

        // 2. æ„é€ æ•°æ®å¯¹è±¡
        const newId = "CUST-" + Math.floor(Math.random() * 9000 + 1000);
        const newCustomerObj = {
            id: newId,
            name: name,
            taxId: taxId || "-", // å¦‚æœæ²¡å¡«æ˜¾ç¤º -
            type: type,
            limit: parseFloat(limit).toFixed(2),
            days: days || "0",
            status: "æ­£å¸¸"
        };

        // 3. â˜…â˜…â˜… ä¿å­˜åˆ° Session (æŒä¹…åŒ–) â˜…â˜…â˜…
        // è¯»å–å·²æœ‰åˆ—è¡¨ -> è¿½åŠ æ–°é¡¹ -> å­˜å›å»
        let addedList = JSON.parse(sessionStorage.getItem('AddedCustomers') || "[]");
        addedList.unshift(newCustomerObj); // åŠ åˆ°æœ€å‰é¢
        sessionStorage.setItem('AddedCustomers', JSON.stringify(addedList));

        // 4. è®°å½•å®¡è®¡æ—¥å¿— (ä¿æŒä¸å˜)
        if (typeof addDataChangeLog === 'function') {
            addDataChangeLog({
                time: new Date().toLocaleString(),
                user: 'å½“å‰ç”¨æˆ·',
                object: 'å®¢æˆ·æ¡£æ¡ˆ',
                objId: newId,
                field: 'æ–°å»ºè®°å½•',
                oldVal: '-',
                newVal: `åç§°:${name}, ç¨å·:${taxId}, è´¦æœŸ:${days}å¤©`
            });
        }

        alert(`âœ… å®¢æˆ·ã€${name}ã€‘åˆ›å»ºæˆåŠŸï¼\nå·²ä¿å­˜åˆ°ç³»ç»Ÿã€‚`);
        
        // 5. åˆ·æ–°å½“å‰é¡µé¢ (è®© loadContent é‡æ–°è¯»å–æ•°æ®å¹¶æ¸²æŸ“)
        loadContent('BaseCustomer');
    }



    /**
     * 2. å†»ç»“/è§£å†»å®¢æˆ· (Freeze/Unfreeze)
     */
    window.toggleFreeze = function(btn, id, name) {
        const row = btn.closest('tr');
        const statusCell = row.cells[6]; // çŠ¶æ€åˆ—
        const isFrozen = btn.innerText === 'ç”³è¯·è§£å†»';

        const action = isFrozen ? "è§£å†»" : "å†»ç»“";
        const confirmMsg = isFrozen 
            ? `âš ï¸ ç¡®è®¤è¦ç”³è¯·è§£å†»å®¢æˆ·ã€${name}ã€‘å—ï¼Ÿ\néœ€è¦é£æ§å®¡æ‰¹ã€‚` 
            : `âš ï¸ è­¦å‘Šï¼šç¡®è®¤è¦å†»ç»“å®¢æˆ·ã€${name}ã€‘å—ï¼Ÿ\nå†»ç»“åè¯¥å®¢æˆ·å°†æ— æ³•ä¸‹å•å’Œå¼€ç¥¨ã€‚`;

        if (!confirm(confirmMsg)) return;

        // 1. æ›´æ–°ç•Œé¢çŠ¶æ€
        if (isFrozen) {
            // æ‰§è¡Œè§£å†»
            statusCell.innerHTML = '<span style="color: #27ae60;">æ­£å¸¸</span>';
            btn.innerText = "å†»ç»“";
            btn.style.color = "#e74c3c";
            row.style.backgroundColor = "#fff";
            alert(`âœ… ç”³è¯·å·²æäº¤ï¼\n\nå®¢æˆ·ã€${name}ã€‘çŠ¶æ€å·²æ¢å¤æ­£å¸¸ã€‚`);
        } else {
            // æ‰§è¡Œå†»ç»“
            statusCell.innerHTML = '<span style="color: #e74c3c; font-weight:bold;">å·²å†»ç»“</span>';
            btn.innerText = "ç”³è¯·è§£å†»";
            btn.style.color = "#3498db";
            row.style.backgroundColor = "#fff1f0"; // å˜çº¢èƒŒæ™¯
            alert(`â›” å®¢æˆ·ã€${name}ã€‘å·²å†»ç»“ï¼\nä¸šåŠ¡æƒé™å·²æš‚åœã€‚`);
        }

        // 2. â˜…â˜…â˜… è®°å½•[æ•°æ®å˜æ›´æ˜ç»†] (çŠ¶æ€å˜æ›´) â˜…â˜…â˜…
        if (typeof addDataChangeLog === 'function') {
            addDataChangeLog({
                time: new Date().toLocaleString(),
                user: 'å½“å‰ç”¨æˆ·',
                object: 'å®¢æˆ·æ¡£æ¡ˆ',
                objId: id,
                field: 'å®¢æˆ·çŠ¶æ€',
                oldVal: isFrozen ? 'å·²å†»ç»“' : 'æ­£å¸¸',
                newVal: isFrozen ? 'æ­£å¸¸' : 'å·²å†»ç»“'
            });
        }
    }

// ==========================================================
    // 3. ä¿®æ”¹å®¢æˆ·èµ„æ–™ (ä¿®å¤ç‰ˆï¼šæ”¯æŒä¿®æ”¹ ç»“ç®—æ–¹å¼/é¢åº¦/è´¦æœŸ)
    // ==========================================================
    window.editCustomerInfo = function(btn, id) {
        const row = btn.closest('tr');
        const name = row.querySelector('.val-name').innerText;

        // 1. è·å–å½“å‰ç•Œé¢ä¸Šçš„æ—§å€¼ (æ ¹æ®åˆ—çš„ç´¢å¼•ä½ç½®)
        // ç¬¬4åˆ—(index 3): ç»“ç®—æ–¹å¼ (é‡Œé¢åŒ…äº†span)
        const typeCell = row.cells[3];
        const oldType = typeCell.innerText.trim();

        // ç¬¬5åˆ—(index 4): ä¿¡ç”¨é¢åº¦ (é‡Œé¢åŒ…äº†strong)
        const limitCell = row.cells[4];
        const oldLimit = limitCell.innerText.replace(/,/g, '').trim();

        // ç¬¬6åˆ—(index 5): è´¦æœŸ
        const daysCell = row.cells[5];
        const oldDays = daysCell.innerText.trim();

        // 2. ä¾æ¬¡å¼¹å‡ºè¾“å…¥æ¡† (ç”¨æˆ·ç‚¹å‡»å–æ¶ˆåˆ™ä¿ç•™åŸå€¼)
        const newType = prompt(`æ­£åœ¨ä¿®æ”¹ã€${name}ã€‘\n\n1/3 è¯·è¾“å…¥ç»“ç®—æ–¹å¼ (æœˆç»“/ç°ç»“)ï¼š`, oldType);
        if (newType === null) return; // å¦‚æœç‚¹å‡»å–æ¶ˆï¼Œåˆ™ç»ˆæ­¢åç»­æ“ä½œ

        const newLimit = prompt(`æ­£åœ¨ä¿®æ”¹ã€${name}ã€‘\n\n2/3 è¯·è¾“å…¥ä¿¡ç”¨é¢åº¦ (RMB)ï¼š`, oldLimit);
        if (newLimit === null) return;

        const newDays = prompt(`æ­£åœ¨ä¿®æ”¹ã€${name}ã€‘\n\n3/3 è¯·è¾“å…¥è´¦æœŸ (å¤©æ•°)ï¼š`, oldDays);
        if (newDays === null) return;

        // 3. å˜æ›´æ£€æµ‹ä¸æ›´æ–° (å“ªä¸ªå˜äº†æ”¹å“ªä¸ªï¼Œå¹¶è®°æ—¥å¿—)
        let hasChange = false;

        // --- A. å¤„ç†ç»“ç®—æ–¹å¼å˜æ›´ ---
        if (newType && newType !== oldType) {
            const badgeStyle = newType === 'ç°ç»“' 
                ? 'background:#f6ffed; color:#52c41a;' 
                : 'background:#e6f7ff; color:#1890ff;';
            
            typeCell.innerHTML = `<span style="${badgeStyle} padding:2px 6px; border-radius:4px; font-size:12px;">${newType}</span>`;
            
            // å†™å…¥æ—¥å¿—
            _recordChange(id, 'ç»“ç®—æ–¹å¼', oldType, newType);
            hasChange = true;
        }

        // --- B. å¤„ç†ä¿¡ç”¨é¢åº¦å˜æ›´ ---
        if (newLimit && parseFloat(newLimit) !== parseFloat(oldLimit)) {
            limitCell.innerHTML = `<strong style="color:#e74c3c">${parseFloat(newLimit).toFixed(2)}</strong>`;
            
            // å†™å…¥æ—¥å¿—
            _recordChange(id, 'ä¿¡ç”¨é¢åº¦', parseFloat(oldLimit).toFixed(2), parseFloat(newLimit).toFixed(2));
            hasChange = true;
        }

        // --- C. å¤„ç†è´¦æœŸå˜æ›´ ---
        if (newDays && newDays !== oldDays) {
            daysCell.innerText = newDays;
            daysCell.style.color = "#e74c3c"; // å˜çº¢æç¤º
            daysCell.style.fontWeight = "bold";

            // å†™å…¥æ—¥å¿—
            _recordChange(id, 'è´¦æœŸ(å¤©)', oldDays, newDays);
            hasChange = true;
        }

        // 4. å®Œæˆæç¤º
        if (hasChange) {
            alert(`âœ… å®¢æˆ·ã€${name}ã€‘èµ„æ–™ä¿®æ”¹æˆåŠŸï¼\nå˜æ›´é¡¹å·²é€æ¡è®°å½•åˆ°å®¡è®¡æ¨¡å—ã€‚`);
        } else {
            alert("âš ï¸ æœªæ£€æµ‹åˆ°æ•°æ®å˜æ›´ã€‚");
        }
    }

    // --- å†…éƒ¨è¾…åŠ©å‡½æ•°ï¼šä¸“é—¨ç”¨äºå†™æ—¥å¿—ï¼Œå‡å°‘é‡å¤ä»£ç  ---
    function _recordChange(objId, field, oldVal, newVal) {
        if (typeof addDataChangeLog === 'function') {
            addDataChangeLog({
                time: new Date().toLocaleString(),
                user: 'å½“å‰ç”¨æˆ·',
                object: 'å®¢æˆ·æ¡£æ¡ˆ',
                objId: objId,
                field: field,
                oldVal: oldVal,
                newVal: newVal
            });
        }
    }



    // ==========================================================
    // å‡­è¯å½•å…¥é€»è¾‘ (å…³è”æ•æ„Ÿæ—¥å¿—)
    // ==========================================================


/**
     * 1. é‡ç½®/æ–°å»ºå‡­è¯ (æ¸…ç©ºè¡¨å•)
     */
    window.resetVoucherForm = function() {
        // 1. é‡æ–°ç”Ÿæˆ HTML ç»“æ„ (æ¢å¤åˆ°åˆå§‹çš„ä¸¤è¡Œç©ºåˆ†å½•)
        const tbody = document.getElementById('entry-table-body');
        tbody.innerHTML = `
            <tr>
                <td><input type="text" class="input-summary" placeholder="æ‘˜è¦" style="width: 95%;"></td>
                <td><input type="text" class="input-account" placeholder="ç§‘ç›®ä»£ç " style="width: 95%;"></td>
                <td><input type="number" class="input-debit" oninput="calculateTotals()" placeholder="0.00" style="width: 95%; text-align: right;"></td>
                <td><input type="number" class="input-credit" oninput="calculateTotals()" placeholder="0.00" style="width: 95%; text-align: right;"></td>
            </tr>
            <tr>
                <td>
                    <div style="display:flex; align-items:center;">
                        <a href="javascript:void(0)" onclick="removeEntryRow(this)" style="color:#ccc; margin-right:5px; text-decoration:none; font-size:16px;">âœ•</a>
                        <input type="text" class="input-summary" placeholder="æ‘˜è¦" style="width: 90%;">
                    </div>
                </td>
                <td><input type="text" class="input-account" placeholder="ç§‘ç›®ä»£ç " style="width: 95%;"></td>
                <td><input type="number" class="input-debit" oninput="calculateTotals()" placeholder="0.00" style="width: 95%; text-align: right;"></td>
                <td><input type="number" class="input-credit" oninput="calculateTotals()" placeholder="0.00" style="width: 95%; text-align: right;"></td>
            </tr>
        `;
        
        // 2. ç”Ÿæˆæ–°çš„å‡­è¯å·
        const newId = `è®°${new Date().getFullYear()}11${Math.floor(Math.random()*1000+1000)}`;
        document.getElementById('current-v-id').innerText = newId;
        
        // 3. é‡ç½®åˆè®¡
        calculateTotals();
        
        // 4. æç¤º
        // alert("è¡¨å•å·²æ¸…ç©ºï¼Œå‡†å¤‡å½•å…¥æ–°å‡­è¯ã€‚"); // å«Œçƒ¦å¯ä»¥æ³¨é‡Šæ‰
    }


// ==========================================================
    // å‡­è¯å½•å…¥ä¸å®¡æ ¸ - ä¸šåŠ¡é€»è¾‘å‡½æ•° (æœ€ç»ˆæ•´åˆç‰ˆ)
    // ==========================================================

    /** 1. è‡ªåŠ¨è®¡ç®—åˆè®¡é‡‘é¢ */
    window.calculateTotals = function() {
        let totalDebit = 0;
        let totalCredit = 0;

        document.querySelectorAll('.input-debit').forEach(input => {
            const val = parseFloat(input.value);
            if (!isNaN(val)) totalDebit += val;
        });

        document.querySelectorAll('.input-credit').forEach(input => {
            const val = parseFloat(input.value);
            if (!isNaN(val)) totalCredit += val;
        });

        const dEl = document.getElementById('total-debit-display');
        const cEl = document.getElementById('total-credit-display');
        
        if(dEl && cEl) {
            dEl.innerText = totalDebit.toFixed(2);
            cEl.innerText = totalCredit.toFixed(2);
            
            const isBalanced = totalDebit.toFixed(2) === totalCredit.toFixed(2) && totalDebit > 0;
            const color = isBalanced ? "#27ae60" : "#e74c3c";
            dEl.style.color = color;
            cEl.style.color = color;
        }
    }

/** 2. åŠ¨æ€æ·»åŠ åˆ†å½•è¡Œ (ä¿®å¤ç‰ˆï¼šæ”¯æŒå›å¡«å‚æ•°) */
    window.addEntryRow = function(data = null) {
        const tbody = document.getElementById('entry-table-body');
        if(!tbody) return;

        // æ ¸å¿ƒä¿®å¤ï¼šè¯»å–ä¼ å…¥çš„ data å¯¹è±¡
        const summary = data ? data.summary : '';
        const account = data ? data.account : '';
        const debit = data ? data.debit : '';
        const credit = data ? data.credit : '';

        const newRow = `
            <tr>
                <td>
                    <div style="display:flex; align-items:center;">
                        <a href="javascript:void(0)" onclick="removeEntryRow(this)" style="color:#ccc; margin-right:5px; text-decoration:none; font-size:16px;">âœ•</a>
                        <input type="text" class="input-summary" value="${summary}" placeholder="æ‘˜è¦" style="width: 90%;">
                    </div>
                </td>
                <td><input type="text" class="input-account" value="${account}" list="acct-list" placeholder="ç§‘ç›®" style="width: 95%;"></td>
                <td><input type="number" class="input-debit" value="${debit}" oninput="calculateTotals()" placeholder="0.00" style="width: 95%; text-align: right;"></td>
                <td><input type="number" class="input-credit" value="${credit}" oninput="calculateTotals()" placeholder="0.00" style="width: 95%; text-align: right;"></td>
            </tr>
        `;
        tbody.insertAdjacentHTML('beforeend', newRow);
    }

    /** 3. åˆ é™¤è¡Œ */
    window.removeEntryRow = function(btn) {
        const row = btn.closest('tr');
        const tbody = document.getElementById('entry-table-body');
        if (tbody.rows.length > 1) {
            row.remove();
            calculateTotals();
        } else {
            alert("è‡³å°‘ä¿ç•™ä¸€è¡Œã€‚");
        }
    }

    /** 4. é‡ç½®è¡¨å• (æ–°å»ºæ¨¡å¼) */
    window.resetVoucherForm = function() {
        const tbody = document.getElementById('entry-table-body');
        if(!tbody) return;
        tbody.innerHTML = ''; 
        
        addEntryRow();
        addEntryRow();
        
        const newId = `è®°${new Date().getFullYear()}11${Math.floor(Math.random()*1000+1000)}`;
        document.getElementById('current-v-id').innerText = newId;
        document.getElementById('v-date').value = new Date().toISOString().split('T')[0];
        
        calculateTotals();
    }

/** * 5. [ä¿®å¤ç‰ˆ] ä¿å­˜/æäº¤å‡­è¯ (å«å¼•æ“æ ¡éªŒ + ä¿®å¤é‡å¤IDé—®é¢˜) */
    window.saveVoucher = function(status) {
        // --- 1. å¼•æ“æ ¡éªŒ (ä¿æŒä¸å˜) ---
        const mappings = JSON.parse(sessionStorage.getItem('EngineMappings') || "[]");
        // å¦‚æœæ²¡æœ‰å¯ç”¨çš„è§„åˆ™ï¼Œæ‹¦æˆª (æ¨¡æ‹Ÿå¼ºç®¡æ§)
        if(!mappings.some(m => m.status === 'å¯ç”¨')) return alert("â›” ã€æ‹¦æˆªã€‘ä¼šè®¡å¼•æ“å·²å…³é—­ï¼Œç¦æ­¢å½•å…¥ï¼");

        // --- 2. è·å–æ•°æ® ---
        // â˜…â˜…â˜… æ ¸å¿ƒä¿®å¤ï¼šåŠ  trim() å»é™¤å¯èƒ½çš„ç©ºæ ¼ â˜…â˜…â˜…
        const vId = document.getElementById('current-v-id').innerText.trim();
        const vDate = document.getElementById('v-date').value;
        
        const lines = [];
        const rows = document.querySelectorAll('#entry-table-body tr');
        let totalDebit = 0;
        let totalCredit = 0;

        rows.forEach(row => {
            const summary = row.querySelector('.input-summary').value;
            const account = row.querySelector('.input-account').value;
            const debit = parseFloat(row.querySelector('.input-debit').value) || 0;
            const credit = parseFloat(row.querySelector('.input-credit').value) || 0;

            // è·³è¿‡ç©ºè¡Œ
            if(!summary && !account && debit===0 && credit===0) return;

            totalDebit += debit;
            totalCredit += credit;

            lines.push({
                summary: summary,
                account: account,
                debit: debit === 0 ? '' : debit.toFixed(2),
                credit: credit === 0 ? '' : credit.toFixed(2)
            });
        });

        // æ ¡éªŒå€Ÿè´·å¹³è¡¡
        if (totalDebit === 0 || Math.abs(totalDebit - totalCredit) > 0.01) {
            alert("âŒ å€Ÿè´·ä¸å¹³è¡¡æˆ–é‡‘é¢ä¸º0ï¼Œæ— æ³•ä¿å­˜ï¼");
            return;
        }

        // æ„é€ æ–°å‡­è¯å¯¹è±¡
        const newVoucher = {
            id: vId,
            date: vDate,
            amount: totalDebit.toFixed(2),
            user: 'å½“å‰ç”¨æˆ·',
            status: status, // 'è‰ç¨¿' æˆ– 'å¾…å®¡æ ¸'
            lines: lines 
        };

        // --- 3. å­˜å…¥ Session (ä¿®å¤è¦†ç›–é€»è¾‘) ---
        let list = JSON.parse(sessionStorage.getItem('ManualVouchers') || "[]");
        
        // â˜…â˜…â˜… æ ¸å¿ƒä¿®å¤ï¼šæŸ¥æ‰¾æ—§æ•°æ®ç´¢å¼•ï¼ŒåŸåœ°æ›¿æ¢æˆ–ç½®é¡¶ â˜…â˜…â˜…
        const existingIndex = list.findIndex(v => v.id === vId);

        if (existingIndex > -1) {
            // æ‰¾åˆ°äº†æ—§çš„ï¼šåˆ é™¤æ—§çš„ï¼ŒæŠŠæ–°çš„æ”¾æœ€å‰é¢ (æ–¹ä¾¿ç”¨æˆ·çœ‹åˆ°å˜åŒ–)
            list.splice(existingIndex, 1);
            list.unshift(newVoucher);
        } else {
            // æ²¡æ‰¾åˆ°ï¼šç›´æ¥æ–°å¢
            list.unshift(newVoucher);
        }
        
        sessionStorage.setItem('ManualVouchers', JSON.stringify(list));

        // --- 4. è®°æ—¥å¿— ---
        if (typeof addAuditLog === 'function') {
            addAuditLog({
                level: 'ä¸­é£é™©',
                time: new Date().toLocaleString(),
                user: 'å½“å‰ç”¨æˆ·',
                ip: '127.0.0.1',
                module: 'å‡­è¯å½•å…¥',
                action: status === 'è‰ç¨¿' ? 'ä¿å­˜/ä¿®æ”¹è‰ç¨¿' : 'æäº¤å®¡æ ¸',
                detail: `å‡­è¯:${vId}, çŠ¶æ€:${status}, é‡‘é¢:${totalDebit.toFixed(2)}`
            });
        }

        alert(`âœ… å‡­è¯ã€${vId}ã€‘å·²ä¿å­˜ï¼\nå½“å‰çŠ¶æ€ï¼š${status}`);
        loadContent('VoucherEntryReview'); // åˆ·æ–°é¡µé¢
    }


/** 6. [ä¿®å¤ç‰ˆ] ç¼–è¾‘å‡­è¯ (çœŸå®å›å¡«æ•°æ®) */
    window.editVoucher = function(id) {
        // 1. è¯»å–æ•°æ®
        const list = JSON.parse(sessionStorage.getItem('ManualVouchers') || "[]");
        const voucher = list.find(v => v.id === id);

        if (!voucher) {
            alert("âŒ æœªæ‰¾åˆ°è¯¥å‡­è¯æ•°æ®ã€‚");
            return;
        }
        
        // çŠ¶æ€æ ¡éªŒ
        if (voucher.status === 'å·²å®¡æ ¸' || voucher.status === 'å·²è®°è´¦') {
            alert("âš ï¸ å·²å®¡æ ¸çš„å‡­è¯ä¸å¯ä¿®æ”¹ã€‚");
            return;
        }

        // 2. å›å¡«è¡¨å¤´
        const idEl = document.getElementById('current-v-id');
        const dateEl = document.getElementById('v-date');
        
        if(idEl) idEl.innerText = voucher.id;
        if(dateEl) dateEl.value = voucher.date;

        // 3. å›å¡«åˆ†å½•è¡Œ (å…³é”®)
        const tbody = document.getElementById('entry-table-body');
        if(tbody) {
            tbody.innerHTML = ''; // å…ˆæ¸…ç©º

            if (voucher.lines && voucher.lines.length > 0) {
                // é€è¡Œå›å¡«
                voucher.lines.forEach(line => {
                    addEntryRow(line);
                });
            } else {
                // å…¼å®¹æ—§æ•°æ®
                addEntryRow({ summary: 'æ•°æ®æ¢å¤', account: 'å¾…ç¡®è®¤ç§‘ç›®', debit: voucher.amount, credit: '' });
                addEntryRow({ summary: 'æ•°æ®æ¢å¤', account: '1002 é“¶è¡Œå­˜æ¬¾', debit: '', credit: voucher.amount });
            }
        }

        // 4. é‡æ–°è®¡ç®—åˆè®¡ & æ»šå›é¡¶éƒ¨
        calculateTotals();
        const contentArea = document.getElementById('content-area');
        if(contentArea) contentArea.scrollTop = 0;
    }

    /** 7. åˆ é™¤å‡­è¯ */
    window.deleteVoucher = function(btn, id) {
        if(!confirm(`ç¡®è®¤åˆ é™¤å‡­è¯ã€${id}ã€‘å—ï¼Ÿ`)) return;
        
        let list = JSON.parse(sessionStorage.getItem('ManualVouchers') || "[]");
        list = list.filter(v => v.id !== id);
        sessionStorage.setItem('ManualVouchers', JSON.stringify(list));
        
        btn.closest('tr').remove();
    }


    /**
     * 2. å®¡æ ¸å‡­è¯ (Change Status)
     */
    window.auditVoucher = function(btn, id) {
        if(!confirm(`ç¡®è®¤å®¡æ ¸é€šè¿‡å‡­è¯ã€${id}ã€‘å—ï¼Ÿ\nå®¡æ ¸åå‡­è¯å°†ç”Ÿæ•ˆå¹¶å¯æŸ¥è¯¢ã€‚`)) return;

        // 1. è¯»å–æ•°æ®
        let voucherList = JSON.parse(sessionStorage.getItem('ManualVouchers') || "[]");
        
        // 2. æ‰¾åˆ°å¯¹åº”å‡­è¯å¹¶ä¿®æ”¹çŠ¶æ€
        const target = voucherList.find(v => v.id === id);
        if (target) {
            target.status = "å·²å®¡æ ¸"; // æˆ–è€… "å·²è®°è´¦"
            
            // 3. ä¿å­˜å› Session
            sessionStorage.setItem('ManualVouchers', JSON.stringify(voucherList));
            
            // 4. åˆ·æ–°é¡µé¢
            alert("âœ… å®¡æ ¸é€šè¿‡ï¼");
            loadContent('VoucherEntryReview');
        }
    }

    // ä¼šè®¡ï¼šå®¡æ ¸é€šè¿‡
    window.auditPass = function(id) {
        if(!confirm(`ç¡®è®¤å®¡æ ¸é€šè¿‡å‡­è¯ã€${id}ã€‘å—ï¼Ÿ`)) return;
        
        // æ›´æ–° Session æ•°æ®
        let list = JSON.parse(sessionStorage.getItem('ManualVouchers') || "[]");
        const target = list.find(v => v.id === id);
        if (target) target.status = "å·²è®°è´¦";
        sessionStorage.setItem('ManualVouchers', JSON.stringify(list));
        
        alert("âœ… å®¡æ ¸é€šè¿‡ï¼å‡­è¯å·²æ­£å¼è®°è´¦ã€‚");
        loadContent('VoucherQueryPrint'); // åˆ·æ–°
    }

    // ä¼šè®¡ï¼šé©³å›
    window.auditReject = function(id) {
        const reason = prompt(`è¯·è¾“å…¥é©³å›å‡­è¯ã€${id}ã€‘çš„åŸå› ï¼š`, "é‡‘é¢æœ‰è¯¯ï¼Œè¯·æ ¸å¯¹");
        if (reason) {
            // æ›´æ–° Session æ•°æ®
            let list = JSON.parse(sessionStorage.getItem('ManualVouchers') || "[]");
            const target = list.find(v => v.id === id);
            if (target) target.status = "å·²é©³å›";
            sessionStorage.setItem('ManualVouchers', JSON.stringify(list));
            
            alert(`â›” å‡­è¯å·²é©³å›ç»™åˆ¶å•äººã€‚\nåŸå› ï¼š${reason}`);
            loadContent('VoucherQueryPrint'); // åˆ·æ–°
        }
    }

    // ==========================================================
    // ä¼šè®¡å¼•æ“é…ç½® - æ ¸å¿ƒé€»è¾‘ (å¢åˆ æ”¹æŸ¥ & çŠ¶æ€æ§åˆ¶)
    // ==========================================================

    /**
     * 1. æ–°å¢æ˜ å°„é…ç½®
     */
    window.addMapping = function() {
        const name = prompt("è¯·è¾“å…¥é…ç½®åç§°ï¼š", "æ–°ä¸šåŠ¡æ”¶å…¥è§„åˆ™");
        if (!name) return;
        
        const type = prompt("è¯·è¾“å…¥æºå•æ®ç±»å‹ï¼š", "è´¹ç”¨æŠ¥é”€å•");
        const condition = prompt("è¯·è¾“å…¥è§¦å‘æ¡ä»¶ (é€»è¾‘è¡¨è¾¾å¼)ï¼š", "çŠ¶æ€=å·²å®¡æ ¸");
        const template = prompt("è¯·è¾“å…¥å…³è”åˆ†å½•æ¨¡æ¿IDï¼š", "TPL_EXP_GEN");

        const newId = "MAP_" + Math.floor(Math.random() * 10000);
        
        const newMapping = {
            id: newId,
            name: name,
            type: type,
            condition: condition,
            template: template,
            status: 'å¯ç”¨' // é»˜è®¤å¯ç”¨
        };

        // ä¿å­˜
        let mappings = JSON.parse(sessionStorage.getItem('EngineMappings') || "[]");
        mappings.push(newMapping);
        sessionStorage.setItem('EngineMappings', JSON.stringify(mappings));

        // è®°æ—¥å¿—
        if(typeof addDataChangeLog === 'function') {
            addDataChangeLog({
                time: new Date().toLocaleString(),
                user: 'å½“å‰ç”¨æˆ·',
                object: 'ä¼šè®¡å¼•æ“',
                objId: newId,
                field: 'æ–°å¢è§„åˆ™',
                oldVal: '-',
                newVal: name
            });
        }

        alert("âœ… æ–°å¢é…ç½®æˆåŠŸï¼");
        loadContent('EngineMapping');
    }

    /**
     * 2. ä¿®æ”¹æ˜ å°„é…ç½®
     */
    window.editMapping = function(id) {
        let mappings = JSON.parse(sessionStorage.getItem('EngineMappings') || "[]");
        const item = mappings.find(m => m.id === id);
        
        if (!item) return;

        const newCondition = prompt(`æ­£åœ¨ä¿®æ”¹ã€${item.name}ã€‘\nå½“å‰è§¦å‘æ¡ä»¶ï¼š${item.condition}\n\nè¯·è¾“å…¥æ–°æ¡ä»¶ï¼š`, item.condition);
        
        if (newCondition && newCondition !== item.condition) {
            // è®°å½•å˜æ›´
            if(typeof addDataChangeLog === 'function') {
                addDataChangeLog({
                    time: new Date().toLocaleString(),
                    user: 'å½“å‰ç”¨æˆ·',
                    object: 'ä¼šè®¡å¼•æ“',
                    objId: id,
                    field: 'è§¦å‘æ¡ä»¶',
                    oldVal: item.condition,
                    newVal: newCondition
                });
            }
            
            item.condition = newCondition;
            sessionStorage.setItem('EngineMappings', JSON.stringify(mappings));
            alert("âœ… ä¿®æ”¹æˆåŠŸï¼");
            loadContent('EngineMapping');
        }
    }

    /**
     * 3. åˆ‡æ¢çŠ¶æ€ (å¯ç”¨/ç¦ç”¨) - è¿™æ˜¯è”åŠ¨çš„å…³é”®ï¼
     */
    window.toggleMappingStatus = function(id) {
        let mappings = JSON.parse(sessionStorage.getItem('EngineMappings') || "[]");
        const item = mappings.find(m => m.id === id);
        
        if (!item) return;

        const newStatus = item.status === 'å¯ç”¨' ? 'ç¦ç”¨' : 'å¯ç”¨';
        const confirmMsg = newStatus === 'ç¦ç”¨' 
            ? `âš ï¸ è­¦å‘Šï¼šç¦ç”¨ã€${item.name}ã€‘åï¼Œå‰ç«¯ç›¸å…³ä¸šåŠ¡å•æ®å°†æ— æ³•è‡ªåŠ¨ç”Ÿæˆå‡­è¯ï¼\nç¡®å®šè¦ç¦ç”¨å—ï¼Ÿ`
            : `ç¡®è®¤å¯ç”¨ã€${item.name}ã€‘å—ï¼Ÿ`;

        if (confirm(confirmMsg)) {
            item.status = newStatus;
            sessionStorage.setItem('EngineMappings', JSON.stringify(mappings));
            
            // è®°æ—¥å¿—
            if(typeof addDataChangeLog === 'function') {
                addDataChangeLog({
                    time: new Date().toLocaleString(),
                    user: 'å½“å‰ç”¨æˆ·',
                    object: 'ä¼šè®¡å¼•æ“',
                    objId: id,
                    field: 'é…ç½®çŠ¶æ€',
                    oldVal: item.status === 'å¯ç”¨' ? 'ç¦ç”¨' : 'å¯ç”¨', // æ³¨æ„è¿™é‡Œæ˜¯åçš„å› ä¸ºä¸Šé¢å·²ç»æ”¹äº†å€¼ï¼Œæˆ–è€…åº”è¯¥å…ˆè®°æ—¥å¿—
                    newVal: newStatus
                });
            }

            loadContent('EngineMapping');
        }
    }

    /**
     * 4. æ¨¡æ‹Ÿæµ‹è¯•è§„åˆ™
     */
    window.testMapping = function() {
        // æ¨¡æ‹Ÿä¼ å…¥ä¸€ä¸ªå•æ®
        const mockDoc = { type: 'å®¢æˆ·ç»“ç®—å•', status: 'å·²ç¡®è®¤', business: 'é™†è¿' };
        
        let mappings = JSON.parse(sessionStorage.getItem('EngineMappings') || "[]");
        // æŸ¥æ‰¾åŒ¹é…çš„è§„åˆ™
        const matched = mappings.find(m => m.type === mockDoc.type && m.status === 'å¯ç”¨');

        if (matched) {
            alert(`âœ… æµ‹è¯•æˆåŠŸï¼\n\nè¾“å…¥å•æ®ï¼š${JSON.stringify(mockDoc)}\nåŒ¹é…è§„åˆ™ï¼š${matched.name} (${matched.id})\nè°ƒç”¨æ¨¡æ¿ï¼š${matched.template}\n\nç»“æœï¼šå¯ä»¥ç”Ÿæˆå‡­è¯ã€‚`);
        } else {
            alert(`âŒ æµ‹è¯•å¤±è´¥ã€‚\n\nè¾“å…¥å•æ®ï¼š${JSON.stringify(mockDoc)}\n\nåŸå› ï¼šæœªæ‰¾åˆ°åŒ¹é…çš„ã€å¯ç”¨çŠ¶æ€ã€‘è§„åˆ™ï¼Œæˆ–è§„åˆ™æ¡ä»¶ä¸æ»¡è¶³ã€‚`);
        }
    }


    /** 5. åˆ é™¤æ˜ å°„é…ç½® */
    window.deleteMapping = function(btn, id) {
        if (!confirm(`âš ï¸ ç¡®è®¤è¦åˆ é™¤é…ç½®ã€${id}ã€‘å—ï¼Ÿ\næ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) return;

        let mappings = JSON.parse(sessionStorage.getItem('EngineMappings') || "[]");
        mappings = mappings.filter(m => m.id !== id);
        sessionStorage.setItem('EngineMappings', JSON.stringify(mappings));

        btn.closest('tr').remove();
    }

    // ==========================================================
    // è´¦ç°¿è·³è½¬é€»è¾‘
    // ==========================================================
    window.openSubjectDetail = function(code, name) {
        // 1. æŠŠè¦æŸ¥çš„ç§‘ç›®å­˜èµ·æ¥
        sessionStorage.setItem('CurrentSubjectCode', code);
        sessionStorage.setItem('CurrentSubjectName', name);
        
        // 2. è·³è½¬åˆ°æ˜ç»†è´¦é¡µé¢
        loadContent('AcctSubjectDetail');
    }


    /**
     * æ ¸å¿ƒè¾…åŠ©ï¼šæ ¹æ®å‡­è¯è®¡ç®—æœ¬æœŸæŸç›Š (å®ç°æ•°æ®è”åŠ¨)
     */
    function calculateRealProfit() {
        const vouchers = JSON.parse(sessionStorage.getItem('ManualVouchers') || "[]");
        
        let totalIncome = 0;  // æ”¶å…¥ (è´·æ–¹)
        let totalCost = 0;    // æˆæœ¬è´¹ç”¨ (å€Ÿæ–¹)

        vouchers.forEach(v => {
            // åªç»Ÿè®¡å·²ç”Ÿæ•ˆçš„å‡­è¯
            if (v.status === 'å·²å®¡æ ¸' || v.status === 'å·²è®°è´¦') {
                if (v.lines) {
                    v.lines.forEach(line => {
                        const code = line.account.split(' ')[0]; // å–ç§‘ç›®ä»£ç 
                        const debit = parseFloat(line.debit) || 0;
                        const credit = parseFloat(line.credit) || 0;

                        // ç®€å•çš„æŸç›Šè¯†åˆ«é€»è¾‘ï¼š
                        // 60å¼€å¤´ = æ”¶å…¥ (å–è´·æ–¹)
                        if (code.startsWith('60') || code.startsWith('61') || code.startsWith('63')) {
                            totalIncome += credit;
                        }
                        // 64, 66, 67, 68å¼€å¤´ = æˆæœ¬/è´¹ç”¨ (å–å€Ÿæ–¹)
                        else if (code.startsWith('64') || code.startsWith('66') || code.startsWith('67') || code.startsWith('68')) {
                            totalCost += debit;
                        }
                    });
                }
            }
        });

        return {
            income: totalIncome,
            cost: totalCost,
            profit: totalIncome - totalCost
        };
    }


    // ==========================================================
    // ä¼šè®¡ç§‘ç›®ç®¡ç† - ä¸šåŠ¡é€»è¾‘
    // ==========================================================

    /**
     * 1. æ–°å¢ç§‘ç›® (æ”¯æŒæ·»åŠ å­çº§)
     */
    window.addSubject = function() {
        // 1. æ”¶é›†ä¿¡æ¯
        const parentCode = prompt("è¯·è¾“å…¥ä¸Šçº§ç§‘ç›®ç¼–ç  (ç•™ç©ºåˆ™åˆ›å»ºä¸€çº§ç§‘ç›®)ï¼š\nä¾‹å¦‚è¾“å…¥ '1002' å¯åˆ›å»º '1002xx' çº§ç§‘ç›®");
        
        let newCode = "";
        let type = "èµ„äº§"; // é»˜è®¤
        let direction = "å€Ÿ"; // é»˜è®¤

        // è¯»å–ç°æœ‰æ•°æ®
        let list = JSON.parse(sessionStorage.getItem('AcctSubjects') || "[]");

        if (parentCode) {
            // å¦‚æœæœ‰ä¸Šçº§ï¼ŒæŸ¥æ‰¾ä¸Šçº§ä¿¡æ¯ä»¥ç»§æ‰¿å±æ€§
            const parent = list.find(s => s.code === parentCode);
            if (!parent) return alert("âŒ æœªæ‰¾åˆ°ä¸Šçº§ç§‘ç›®ï¼š" + parentCode);
            
            // ç®€å•çš„ç¼–ç ç”Ÿæˆé€»è¾‘ï¼šçˆ¶çº§ + 01, 02...
            // å®é™…éœ€æ£€æŸ¥æ˜¯å¦å­˜åœ¨ï¼Œè¿™é‡Œç®€åŒ–ä¸ºéšæœºæ•°æ¨¡æ‹Ÿ
            newCode = parentCode + Math.floor(Math.random() * 90 + 10); 
            type = parent.type; // ç»§æ‰¿ç±»å‹
            direction = parent.direction; // ç»§æ‰¿æ–¹å‘
        } else {
            newCode = prompt("è¯·è¾“å…¥æ–°çš„ä¸€çº§ç§‘ç›®ç¼–ç  (4ä½)ï¼š", "1003");
            if(!newCode) return;
        }

        const name = prompt(`æ­£åœ¨åˆ›å»ºç§‘ç›® [${newCode}]\nè¯·è¾“å…¥ç§‘ç›®åç§°ï¼š`);
        if(!name) return;

        const remark = prompt("è¯·è¾“å…¥å¤‡æ³¨ï¼š", "");

        // 2. æ„é€ æ–°ç§‘ç›®
        const newSubject = {
            code: newCode,
            name: name,
            type: type,
            aux: "æ— ", // é»˜è®¤
            direction: direction,
            status: "å¯ç”¨",
            remark: remark
        };

        // 3. ä¿å­˜å¹¶åˆ·æ–°
        list.push(newSubject);
        sessionStorage.setItem('AcctSubjects', JSON.stringify(list));
        
        // è®°æ—¥å¿—
        if (typeof addDataChangeLog === 'function') {
            addDataChangeLog({
                time: new Date().toLocaleString(),
                user: 'å½“å‰ç”¨æˆ·',
                object: 'ä¼šè®¡ç§‘ç›®',
                objId: newCode,
                field: 'æ–°å¢',
                oldVal: '-',
                newVal: name
            });
        }

        alert("âœ… ç§‘ç›®æ–°å¢æˆåŠŸï¼");
        loadContent('AcctSubject');
    }

    /**
     * 2. ç¼–è¾‘ç§‘ç›®
     */
    window.editSubject = function(code) {
        let list = JSON.parse(sessionStorage.getItem('AcctSubjects') || "[]");
        const subject = list.find(s => s.code === code);
        if (!subject) return;

        // ä¾æ¬¡ä¿®æ”¹åç§°ã€æ–¹å‘ã€å¤‡æ³¨
        const newName = prompt(`ä¿®æ”¹ç§‘ç›® [${code}] åç§°ï¼š`, subject.name);
        if (newName !== null) subject.name = newName;

        const newDir = prompt(`ä¿®æ”¹ä½™é¢æ–¹å‘ (å€Ÿ/è´·)ï¼š`, subject.direction);
        if (newDir !== null && (newDir === 'å€Ÿ' || newDir === 'è´·')) subject.direction = newDir;

        const newRemark = prompt(`ä¿®æ”¹å¤‡æ³¨ï¼š`, subject.remark);
        if (newRemark !== null) subject.remark = newRemark;

        // ä¿å­˜
        sessionStorage.setItem('AcctSubjects', JSON.stringify(list));
        
        // è®°æ—¥å¿—
        if (typeof addDataChangeLog === 'function') {
            addDataChangeLog({
                time: new Date().toLocaleString(),
                user: 'å½“å‰ç”¨æˆ·',
                object: 'ä¼šè®¡ç§‘ç›®',
                objId: code,
                field: 'å±æ€§ä¿®æ”¹',
                oldVal: '...',
                newVal: `${newName} / ${newDir}`
            });
        }

        loadContent('AcctSubject');
    }

    /**
     * 3. å¯ç”¨/åœç”¨åˆ‡æ¢
     */
    window.toggleSubjectStatus = function(code) {
        let list = JSON.parse(sessionStorage.getItem('AcctSubjects') || "[]");
        const subject = list.find(s => s.code === code);
        if (!subject) return;

        if(!confirm(`ç¡®è®¤${subject.status === 'å¯ç”¨' ? 'åœç”¨' : 'å¯ç”¨'}ç§‘ç›®ã€${subject.name}ã€‘å—ï¼Ÿ`)) return;

        subject.status = subject.status === 'å¯ç”¨' ? 'åœç”¨' : 'å¯ç”¨';
        sessionStorage.setItem('AcctSubjects', JSON.stringify(list));
        loadContent('AcctSubject');
    }
    

    // ==========================================================
    // ä¸šåŠ¡ä¸ç¨åŠ¡çš„è¿æ¥å™¨
    // ==========================================================
    window.confirmSettlement = function(type, id, client, amount) {
        if (!confirm(`ç¡®è®¤ã€${id}ã€‘é‡‘é¢æ— è¯¯ï¼Œå¹¶ç”³è¯·å¼€ç¥¨å—ï¼Ÿ`)) return;

        // 1. æ›´æ–°æºå•æ®çŠ¶æ€ (æ¨¡æ‹Ÿ)
        if (type === 'waybill') {
            let list = JSON.parse(sessionStorage.getItem('BizWaybills'));
            let item = list.find(i => i.id === id);
            if (item) item.status = 'å·²ç»“ç®—';
            sessionStorage.setItem('BizWaybills', JSON.stringify(list));
            loadContent('SettlementWaybill'); // åˆ·æ–°
        } else if (type === 'recon') {
            let list = JSON.parse(sessionStorage.getItem('BizRecons'));
            let item = list.find(i => i.id === id);
            if (item) item.status = 'å·²ç¡®è®¤';
            sessionStorage.setItem('BizRecons', JSON.stringify(list));
            loadContent('ReconSite'); // åˆ·æ–°
        }

        // 2. â˜…â˜…â˜… æ ¸å¿ƒï¼šå†™å…¥å¾…å¼€ç¥¨é˜Ÿåˆ— â˜…â˜…â˜…
        let queue = JSON.parse(sessionStorage.getItem('PendingInvoiceQueue') || "[]");
        
        // é˜²æ­¢é‡å¤æ·»åŠ 
        if (!queue.some(q => q.sourceId === id)) {
            queue.push({
                sourceId: id,
                sourceType: type === 'waybill' ? 'è¿å•' : 'å¯¹è´¦å•',
                client: client,
                amount: amount,
                createTime: new Date().toLocaleString()
            });
            sessionStorage.setItem('PendingInvoiceQueue', JSON.stringify(queue));
        }
        
        alert("âœ… å·²ç¡®è®¤ï¼æ•°æ®å·²æ¨é€åˆ°ã€é”€é¡¹å‘ç¥¨å°è´¦ã€‘ç­‰å¾…å¼€ç¥¨ã€‚");
    }


/** [å‡çº§ç‰ˆ] é˜Ÿåˆ—å¼€ç¥¨ (å¤„ç†å¾…åŠ + çŠ¶æ€å›å†™ + â˜…è‡ªåŠ¨ç”Ÿæˆå‡­è¯â˜…) */
    window.generateInvoiceFromQueue = function(sourceId, client, amountStr, index) {
        
        // 1. æ¨¡æ‹Ÿè¯¢é—®ä¸šåŠ¡ç±»å‹ (ä¸ºäº†æ¼”ç¤ºæ¨¡æ¿åŒ¹é…)
        const bizType = prompt("è¯·è¾“å…¥ä¸šåŠ¡ç±»å‹ä»¥åŒ¹é…åˆ†å½•æ¨¡æ¿ (é™†è¿/æµ·è¿/ç©ºè¿/é€šç”¨):", "é™†è¿");
        if(!bizType) return;

        if(!confirm(`ç¡®è®¤å¯¹æºå•æ®ã€${sourceId}ã€‘å¼€ç¥¨å—ï¼Ÿ`)) return;

        // 2. ç§»é™¤å¾…åŠ
        let queue = JSON.parse(sessionStorage.getItem('PendingInvoiceQueue') || "[]");
        queue.splice(index, 1);
        sessionStorage.setItem('PendingInvoiceQueue', JSON.stringify(queue));

        // 3. ç”Ÿæˆå‘ç¥¨
        let invoices = JSON.parse(sessionStorage.getItem('OutputInvoices') || "[]");
        const newInvNo = "13000" + Math.floor(Math.random()*90000);
        
        // æ„é€ å®Œæ•´çš„å‘ç¥¨æ•°æ®å¯¹è±¡
        const invoiceObj = {
            no: newInvNo,
            client: client, 
            amount: amountStr, 
            tax: '...', 
            total: '...',
            date: new Date().toISOString().slice(0,10), 
            status: "æ­£å¸¸", 
            remark: sourceId,
            // å…³é”®å­—æ®µï¼Œä¼ ç»™å¼•æ“ç”¨
            /* bizType: bizType, */     
            bizType: 'é™†è¿',
            type: 'ä¸“ç”¨å‘ç¥¨',      
            amountStr: amountStr  
        };
        
        invoices.unshift(invoiceObj);
        sessionStorage.setItem('OutputInvoices', JSON.stringify(invoices));

        // 4. å›å†™çŠ¶æ€ (å¯¹è´¦å•/è¿å•) - ä¿æŒä½ åŸæœ‰çš„é€»è¾‘
        let recons = JSON.parse(sessionStorage.getItem('CustomerRecons') || "[]");
        let reconItem = recons.find(r => r.id === sourceId);
        if (reconItem) {
            reconItem.status = 'å·²å¼€ç¥¨';
            sessionStorage.setItem('CustomerRecons', JSON.stringify(recons));
        }

        // 5. â˜…â˜…â˜… æ ¸å¿ƒè”åŠ¨ï¼šè°ƒç”¨å¼•æ“è‡ªåŠ¨ç”Ÿæˆå‡­è¯ â˜…â˜…â˜…
        const voucherId = window.autoGenerateVoucher(invoiceObj);
        
        let msg = `ğŸ‰ å¼€ç¥¨æˆåŠŸï¼\nå‘ç¥¨å·ï¼š${newInvNo}`;
        if (voucherId) {
            msg += `\n\nâš¡ è‡ªåŠ¨è®°è´¦æˆåŠŸï¼\nå·²æ ¹æ®ã€${bizType}æ”¶å…¥æ¨¡æ¿ã€‘ç”Ÿæˆå‡­è¯ï¼š${voucherId}\nè¯·å‰å¾€ã€å‡­è¯æŸ¥è¯¢/å®¡æ ¸ã€‘æŸ¥çœ‹ã€‚`;
        } else {
            msg += `\n\n(æœªæ‰¾åˆ°åŒ¹é…çš„åˆ†å½•æ¨¡æ¿ï¼Œæœªç”Ÿæˆå‡­è¯)`;
        }

        alert(msg);
        loadContent('TaxOutputInvoice');
    }



    // è¿å•ç»“ç®—é€»è¾‘
    window.settleWaybill = function(id) {
        let list = JSON.parse(sessionStorage.getItem('BizWaybills'));
        let item = list.find(i => i.id === id);
        if (item) {
            item.status = 'å·²ç»“ç®—';
            item.amount = (parseFloat(item.amount) || 1000).toFixed(2); // æ¨¡æ‹Ÿè®¡ç®—
            sessionStorage.setItem('BizWaybills', JSON.stringify(list));
            alert("âœ… è´¹ç”¨è®¡ç®—å®Œæˆï¼çŠ¶æ€å·²æ›´æ–°ä¸ºã€å·²ç»“ç®—ã€‘ã€‚");
            loadContent('SettlementWaybill');
        }
    }




/** ä»å¯¹è´¦å•ç”³è¯·å¼€ç¥¨ */
    window.applyInvoiceFromRecon = function(reconId, client, amount) {
        if(!confirm(`ç¡®è®¤å°†å¯¹è´¦å•ã€${reconId}ã€‘æ¨é€åˆ°å¼€ç¥¨ç³»ç»Ÿå—ï¼Ÿ`)) return;

        // 1. æ£€æŸ¥é‡‘é¢æ˜¯å¦ä¸ºè´Ÿ (å¦‚æœé€€æ¬¾æ¯”è¿è´¹è¿˜å¤šï¼Œä¸èƒ½å¼€ç¥¨)
        if (parseFloat(amount) <= 0) {
            alert("âŒ å¯¹è´¦é‡‘é¢ä¸ºè´Ÿæˆ–é›¶ï¼Œæ— éœ€å¼€ç¥¨ï¼");
            return;
        }

        // 2. æ¨é€åˆ°å‘ç¥¨å¾…åŠ
        let queue = JSON.parse(sessionStorage.getItem('PendingInvoiceQueue') || "[]");
        if (queue.some(q => q.sourceId === reconId)) return alert("âš ï¸ å·²åœ¨åˆ—è¡¨ä¸­");

        queue.push({
            sourceId: reconId,
            sourceType: 'å¯¹è´¦å•',
            client: client,
            amount: amount, // è¿™é‡Œä¼ è¿‡å»çš„æ˜¯ 100 (å‡€é¢)ï¼Œè¿™æ˜¯æœ€åˆè§„çš„
            createTime: new Date().toLocaleString()
        });
        sessionStorage.setItem('PendingInvoiceQueue', JSON.stringify(queue));

        // 3. æ›´æ–°çŠ¶æ€
        let list = JSON.parse(sessionStorage.getItem('CustomerRecons'));
        let item = list.find(r => r.id === reconId);
        if(item) item.status = 'å¼€ç¥¨ä¸­';
        sessionStorage.setItem('CustomerRecons', JSON.stringify(list));

        alert(`âœ… ç”³è¯·æˆåŠŸï¼\n\nå·²æ¨é€é‡‘é¢ï¼š${amount} (å‡€é¢)\n\n*æ³¨ï¼šè´Ÿæ•°é€€æ¬¾é¡¹å·²åœ¨å¯¹è´¦é˜¶æ®µæŠµæ‰£ï¼Œä¸ç›´æ¥ä½“ç°åœ¨å¼€ç¥¨åˆ—è¡¨ä¸­ã€‚`);
        loadContent('ReconCustomer');
    }

    
/** 3. æŸ¥çœ‹å¯¹è´¦å•æ˜ç»† (æ–°å¢åŠŸèƒ½) */
    window.viewReconDetails = function(reconId) {
        // å»è¿å•åº“é‡Œæ‰¾ï¼ŒreconId åŒ¹é…çš„è¿å•
        const allWaybills = JSON.parse(sessionStorage.getItem('BizWaybills') || "[]");
        const details = allWaybills.filter(w => w.reconId === reconId);

        if (details.length === 0) {
            alert("âš ï¸ æœªæ‰¾åˆ°å…³è”çš„è¿å•æ˜ç»†ï¼ˆå¯èƒ½æ˜¯æ—§æ•°æ®æˆ–æ¨¡æ‹Ÿæ•°æ®ï¼‰ã€‚");
            return;
        }

        // ç®€å•æ‹¼ä¸€ä¸ªå¼¹çª—å†…å®¹
        let msg = `ğŸ§¾ å¯¹è´¦å•ã€${reconId}ã€‘åŒ…å«ä»¥ä¸‹è¿å•ï¼š\n----------------------------------\n`;
        details.forEach(d => {
            msg += `å•å·: ${d.id} | é‡‘é¢: ${d.amount} | çŠ¶æ€: ${d.status}\n`;
        });
        alert(msg);
    }

    /** 4. [å‡çº§ç‰ˆ] ç¡®è®¤å¯¹è´¦ (è”åŠ¨æ›´æ–°è¿å•çŠ¶æ€) */
    window.confirmRecon = function(id) {
        if(!confirm(`æ¨¡æ‹Ÿï¼šå®¢æˆ·å·²å›ä¼ ç¡®è®¤å‡½ï¼Œç¡®è®¤å¯¹è´¦å•ã€${id}ã€‘æ— è¯¯ï¼Ÿ`)) return;
        
        // A. æ›´æ–°å¯¹è´¦å•çŠ¶æ€
        let recons = JSON.parse(sessionStorage.getItem('CustomerRecons') || "[]");
        let item = recons.find(r => r.id === id);
        if(item) {
            item.status = 'å·²ç¡®è®¤';
            sessionStorage.setItem('CustomerRecons', JSON.stringify(recons));
            
            // B. â˜…â˜…â˜… è”åŠ¨ï¼šæŠŠå…³è”çš„è¿å•ä¹Ÿæ”¹æˆâ€œå·²å¯¹è´¦â€ â˜…â˜…â˜…
            let waybills = JSON.parse(sessionStorage.getItem('BizWaybills') || "[]");
            let updatedCount = 0;
            waybills.forEach(w => {
                if (w.reconId === id) {
                    w.status = 'å·²å¯¹è´¦'; // è¿å•çŠ¶æ€å˜æ›´ä¸ºå·²å¯¹è´¦
                    updatedCount++;
                }
            });
            sessionStorage.setItem('BizWaybills', JSON.stringify(waybills));

            alert(`âœ… å¯¹è´¦å•å·²ç¡®è®¤ï¼\nå·²åŒæ­¥æ›´æ–°äº† ${updatedCount} ç¬”è¿å•çš„çŠ¶æ€ä¸ºã€å·²å¯¹è´¦ã€‘ã€‚`);
            loadContent('ReconCustomer');
        }
    }

    /**
     * 2. ä»å¯¹è´¦å•ç”³è¯·å¼€ç¥¨ (æ¨é€åˆ°å‘ç¥¨æ± )
     * ç‚¹å‡»â€œç”³è¯·å¼€ç¥¨â€æ—¶è§¦å‘
     */
    window.applyInvoiceFromRecon = function(reconId, client, amount) {
        if(!confirm(`ç¡®è®¤å°†å¯¹è´¦å•ã€${reconId}ã€‘æ¨é€åˆ°å¼€ç¥¨ç³»ç»Ÿå—ï¼Ÿ`)) return;

        // 1. æ¨é€åˆ°å‘ç¥¨å¾…åŠé˜Ÿåˆ—
        let queue = JSON.parse(sessionStorage.getItem('PendingInvoiceQueue') || "[]");
        
        // é˜²æ­¢é‡å¤æäº¤
        if (queue.some(q => q.sourceId === reconId)) {
            alert("âš ï¸ è¯¥å¯¹è´¦å•å·²åœ¨å¼€ç¥¨åˆ—è¡¨ä¸­ï¼Œè¯·å‹¿é‡å¤æäº¤ã€‚");
            return;
        }

        queue.push({
            sourceId: reconId,
            sourceType: 'å¯¹è´¦å•',
            client: client,
            amount: amount,
            createTime: new Date().toLocaleString()
        });
        sessionStorage.setItem('PendingInvoiceQueue', JSON.stringify(queue));

        // 2. æ›´æ–°å¯¹è´¦å•çŠ¶æ€ä¸ºâ€œå¼€ç¥¨ä¸­â€
        let list = JSON.parse(sessionStorage.getItem('CustomerRecons'));
        let item = list.find(r => r.id === reconId);
        if(item) {
            item.status = 'å¼€ç¥¨ä¸­'; // æˆ–è€… 'å·²ç”³è¯·'
            sessionStorage.setItem('CustomerRecons', JSON.stringify(list));
        }

        alert(`âœ… ç”³è¯·æˆåŠŸï¼\næ•°æ®å·²æ¨é€è‡³ã€é”€é¡¹å‘ç¥¨å°è´¦ã€‘ï¼Œè¯·é€šçŸ¥è´¢åŠ¡å¼€ç¥¨ã€‚`);
        loadContent('ReconCustomer'); // åˆ·æ–°
    }

    
    // ==========================================================
    // â˜…â˜…â˜… æ ¸å¿ƒä¿®å¤ï¼šè·³è½¬å‘ç¥¨è¯¦æƒ…çš„å‡½æ•° (è¯·ç¡®ä¿è¿™æ®µä»£ç åœ¨ script æ ‡ç­¾çš„åº•éƒ¨) â˜…â˜…â˜…
    // ==========================================================
window.viewInvoiceDetail = function(invNo) {
    console.log("ğŸ” [è°ƒè¯•] æŸ¥çœ‹å‘ç¥¨:", invNo);
    
    const list = JSON.parse(sessionStorage.getItem('OutputInvoices') || "[]");
    let inv = list.find(i => i.no === invNo);
    
    if (!inv) {
        console.warn("âš ï¸ æœªæ‰¾åˆ°å‘ç¥¨");
        return alert("å‘ç¥¨æ•°æ®ä¸¢å¤±ï¼Œè¯·åˆ·æ–°é¡µé¢");
    }

    // â­ ä¼ é€’å®Œæ•´æ•°æ®
    window.g_currentInvoice = {
        no: inv.no,
        clientName: inv.client,
        clientTaxId: '9132xxxxxxxx',
        sellerName: 'ä¹äº«ç‰©æµæœ‰é™å…¬å¸',
        sellerTaxId: '9131xxxxxxxx',
        amount: inv.amount,      // å·²æ ¼å¼åŒ–çš„é‡‘é¢
        tax: inv.tax,
        total: inv.total,
        taxRate: '9%',
        date: inv.date
    };

    console.log("âœ… [è°ƒè¯•] æ•°æ®å·²å‡†å¤‡:", window.g_currentInvoice);
    loadContent('InvoiceDetail'); 
}


// ==========================================================
// å·¥å…·å‡½æ•°ï¼šæ•°å­—è½¬ä¸­æ–‡å¤§å†™é‡‘é¢
// ==========================================================
function numberToChinese(money) {
    const cnNums = ['é›¶', 'å£¹', 'è´°', 'å', 'è‚†', 'ä¼', 'é™†', 'æŸ’', 'æŒ', 'ç–'];
    const cnIntRadice = ['', 'æ‹¾', 'ä½°', 'ä»Ÿ'];
    const cnIntUnits = ['', 'ä¸‡', 'äº¿', 'å…†'];
    const cnDecUnits = ['è§’', 'åˆ†'];
    const cnInteger = 'æ•´';
    const cnIntLast = 'åœ†';
    const maxNum = 999999999999.99;

    money = parseFloat(money);
    if (money >= maxNum) return 'é‡‘é¢è¿‡å¤§';
    if (money === 0) return cnNums[0] + cnIntLast + cnInteger;

    let chineseStr = '';
    let integerNum = Math.floor(money);
    let decimalNum = Math.round((money - integerNum) * 100);

    // æ•´æ•°éƒ¨åˆ†
    if (integerNum > 0) {
        let zeroCount = 0;
        let intLen = integerNum.toString().length;
        
        for (let i = 0; i < intLen; i++) {
            let n = integerNum.toString().substr(i, 1);
            let p = intLen - i - 1;
            let q = p / 4;
            let m = p % 4;
            
            if (n == '0') {
                zeroCount++;
            } else {
                if (zeroCount > 0) {
                    chineseStr += cnNums[0];
                }
                zeroCount = 0;
                chineseStr += cnNums[parseInt(n)] + cnIntRadice[m];
            }
            
            if (m == 0 && zeroCount < 4) {
                chineseStr += cnIntUnits[q];
            }
        }
        chineseStr += cnIntLast;
    }

    // å°æ•°éƒ¨åˆ†
    if (decimalNum > 0) {
        let jiao = Math.floor(decimalNum / 10);
        let fen = decimalNum % 10;
        
        if (jiao > 0) {
            chineseStr += cnNums[jiao] + cnDecUnits[0];
        }
        if (fen > 0) {
            chineseStr += cnNums[fen] + cnDecUnits[1];
        }
    } else {
        chineseStr += cnInteger;
    }

    return chineseStr;
}


/** * è¾…åŠ©ï¼šæ•°å­—è½¬ä¸­æ–‡å¤§å†™é‡‘é¢ 
     */
    function convertCurrency(money) {
        // æ±‰å­—æ•°å­—
        var cnNums = new Array('é›¶', 'å£¹', 'è´°', 'å', 'è‚†', 'ä¼', 'é™†', 'æŸ’', 'æŒ', 'ç–');
        // åŸºæœ¬å•ä½
        var cnIntRadice = new Array('', 'æ‹¾', 'ä½°', 'ä»Ÿ');
        var cnIntUnits = new Array('', 'ä¸‡', 'äº¿', 'å…†');
        var cnDecUnits = new Array('è§’', 'åˆ†', 'æ¯«', 'å˜');
        var cnInteger = 'æ•´';
        var cnIntLast = 'åœ†';
        
        var maxNum = 999999999999999.9999;
        var integerNum;
        var decimalNum;
        var chineseStr = '';
        var parts;
        
        if (money == '') { return ''; }
        money = parseFloat(money);
        if (money >= maxNum) return 'é‡‘é¢è¿‡å¤§';
        if (money === 0) return cnNums[0] + cnIntLast + cnInteger;

        money = money.toString();
        if (money.indexOf('.') == -1) {
            integerNum = money;
            decimalNum = '';
        } else {
            parts = money.split('.');
            integerNum = parts[0];
            decimalNum = parts[1].substr(0, 4);
        }
        
        if (parseInt(integerNum, 10) > 0) {
            var zeroCount = 0;
            var IntLen = integerNum.length;
            for (var i = 0; i < IntLen; i++) {
                var n = integerNum.substr(i, 1);
                var p = IntLen - i - 1;
                var q = p / 4;
                var m = p % 4;
                if (n == '0') {
                    zeroCount++;
                } else {
                    if (zeroCount > 0) {
                        chineseStr += cnNums[0];
                    }
                    zeroCount = 0;
                    chineseStr += cnNums[parseInt(n)] + cnIntRadice[m];
                }
                if (m == 0 && zeroCount < 4) {
                    chineseStr += cnIntUnits[q];
                }
            }
            chineseStr += cnIntLast;
        }
        
        if (decimalNum != '') {
            var decLen = decimalNum.length;
            for (var i = 0; i < decLen; i++) {
                var n = decimalNum.substr(i, 1);
                if (n != '0') {
                    chineseStr += cnNums[Number(n)] + cnDecUnits[i];
                }
            }
        }
        
        if (chineseStr == '') {
            chineseStr += cnNums[0] + cnIntLast + cnInteger;
        } else if (decimalNum == '') {
            chineseStr += cnInteger;
        }
        return chineseStr;
    }


// ==========================================================
    // å¼‚å¸¸é€€æ¬¾ä¸å¯¹è´¦æ ¸å¿ƒé€»è¾‘
    // ==========================================================
// ==========================================================
    // å¼‚å¸¸é€€æ¬¾ä¸è”åŠ¨å¯¹è´¦é€»è¾‘ (ä¿®å¤ç‰ˆ)
    // ==========================================================

    /** 1. å¤„ç†å¼‚å¸¸é€€æ¬¾ (ç”Ÿæˆè´Ÿæ•°å•æ®) */
    window.handlePartRefund = function(id) {
        let list = JSON.parse(sessionStorage.getItem('BizWaybills'));
        let item = list.find(i => i.id === id);
        if (!item) return;

        // æ¨¡æ‹Ÿè¾“å…¥é€€æ¬¾é‡‘é¢
        const refundAmountStr = prompt(`å½“å‰è¿å•ã€${id}ã€‘é‡‘é¢ï¼š${item.amount}\nè¯·è¾“å…¥é€€æ¬¾é‡‘é¢ (ä¾‹å¦‚é€€è¿è´¹400)ï¼š`, "400");
        if (!refundAmountStr) return;
        
        const refundAmount = parseFloat(refundAmountStr);
        if (isNaN(refundAmount) || refundAmount <= 0) return alert("é‡‘é¢æ— æ•ˆ");

        if(!confirm(`ç¡®è®¤é€€æ¬¾ ${refundAmount} å…ƒå—ï¼Ÿ\nç³»ç»Ÿå°†ç”Ÿæˆä¸€æ¡è´Ÿæ•°ç»“ç®—å•ã€‚`)) return;

        // ç”Ÿæˆçº¢å­—è°ƒæ•´å•
        const refundBill = {
            id: id + '-é€€', // å…³è”åŸå•å·
            client: item.client,
            date: new Date().toISOString().split('T')[0],
            amount: '-' + refundAmount.toFixed(2), // â˜…â˜…â˜… è´Ÿæ•° â˜…â˜…â˜…
            status: 'å·²ç»“ç®—', // â˜…â˜…â˜… å…³é”®ï¼šè®¾ä¸ºå·²ç»“ç®—ï¼Œä»¥ä¾¿ä¸‹ä¸€æ­¥èƒ½è¢«é€‰ä¸­ â˜…â˜…â˜…
            details: { 'é€€æ¬¾è¯´æ˜': 'å¼‚å¸¸é€€è¿è´¹' }
        };

        // æ’å…¥åˆ°åŸå•åé¢
        const idx = list.findIndex(i => i.id === id);
        list.splice(idx + 1, 0, refundBill);
        
        sessionStorage.setItem('BizWaybills', JSON.stringify(list));
        alert("âœ… é€€æ¬¾å•å·²ç”Ÿæˆï¼\nçŠ¶æ€ä¸ºã€å·²ç»“ç®—ã€‘ï¼Œä¸‹æ¬¡ç”Ÿæˆå¯¹è´¦å•æ—¶å°†è‡ªåŠ¨æŠµæ‰£ã€‚");
        loadContent('SettlementWaybill');
    }

// æ¨¡æ‹Ÿç”Ÿæˆå¯¹è´¦å• (ä»ç»“ç®—é¡µè·³è½¬åˆ°å¯¹è´¦é¡µ) - ä¿®å¤ç‰ˆï¼šä¿å­˜æ˜ç»†
window.createReconBill = function() {
    // 1. è·å–æ‰€æœ‰ã€å·²ç»“ç®—ã€‘çš„è¿å•
    let waybills = JSON.parse(sessionStorage.getItem('BizWaybills') || "[]");
    let settledBills = waybills.filter(w => w.status === 'å·²ç»“ç®—');
    
    if (settledBills.length === 0) {
        alert("âš ï¸ æ²¡æœ‰ã€å·²ç»“ç®—ã€‘çš„è¿å•ï¼Œæ— æ³•ç”Ÿæˆå¯¹è´¦å•ã€‚");
        return;
    }

    // 2. æŒ‰å®¢æˆ·åˆ†ç»„ï¼ˆçœŸå®åœºæ™¯åº”è¯¥æŒ‰å®¢æˆ·åˆ†ç»„ï¼Œè¿™é‡Œç®€åŒ–ä¸ºæ‰¹é‡å¤„ç†ï¼‰
    const customerGroups = {};
    settledBills.forEach(bill => {
        const client = bill.client;
        if (!customerGroups[client]) {
            customerGroups[client] = [];
        }
        customerGroups[client].push(bill);
    });

    // 3. ä¸ºæ¯ä¸ªå®¢æˆ·ç”Ÿæˆä¸€å¼ å¯¹è´¦å•
    let recons = JSON.parse(sessionStorage.getItem('CustomerRecons') || "[]");
    
    Object.keys(customerGroups).forEach(client => {
        const bills = customerGroups[client];
        
        // è®¡ç®—æ€»é‡‘é¢
        const totalAmount = bills.reduce((sum, b) => {
            return sum + parseFloat(b.amount.replace(/,/g, ''));
        }, 0);

        // ç”Ÿæˆå¯¹è´¦å•ID
        const newReconId = 'DZ' + new Date().getFullYear() + 
                          String(new Date().getMonth() + 1).padStart(2, '0') + 
                          '-' + String(Math.floor(Math.random() * 1000)).padStart(3, '0');
        
        // â­ æ ¸å¿ƒä¿®å¤ï¼šä¿å­˜å®Œæ•´çš„è¿å•æ˜ç»†
        const newRecon = {
            id: newReconId,
            client: client,
            period: '2025-11',
            amount: totalAmount.toFixed(2),
            status: 'å¾…å®¢æˆ·ç¡®è®¤',
            createTime: new Date().toLocaleString(),
            // â­ æ–°å¢ï¼šä¿å­˜è¿å•æ˜ç»†åˆ—è¡¨
            details: bills.map(b => ({
                waybillId: b.id,
                date: b.date,
                amount: b.amount,
                status: b.status
            }))
        };
        
        recons.unshift(newRecon);
        
        // æ›´æ–°è¿å•çŠ¶æ€ä¸º"å¯¹è´¦ä¸­"
        bills.forEach(b => {
            b.status = 'å¯¹è´¦ä¸­';
            b.reconId = newReconId; // å…³è”å¯¹è´¦å•å·
        });
    });

    // 4. ä¿å­˜æ•°æ®
    sessionStorage.setItem('CustomerRecons', JSON.stringify(recons));
    sessionStorage.setItem('BizWaybills', JSON.stringify(waybills));

    alert(`âœ… å¯¹è´¦å•ç”ŸæˆæˆåŠŸï¼\nå…±ç”Ÿæˆ ${Object.keys(customerGroups).length} å¼ å¯¹è´¦å•ã€‚`);
    loadContent('ReconCustomer'); // è·³è½¬åˆ°å®¢æˆ·å¯¹è´¦
}

// ==========================================================
// æŸ¥çœ‹å¯¹è´¦å•æ˜ç»†
// ==========================================================
window.viewReconDetail = function(reconId) {
    console.log("ğŸ” [è°ƒè¯•] æŸ¥çœ‹å¯¹è´¦å•æ˜ç»†:", reconId);
    
    // ä¿å­˜å½“å‰æŸ¥çœ‹çš„å¯¹è´¦å•ID
    sessionStorage.setItem('CurrentReconId', reconId);
    
    // è·³è½¬åˆ°æ˜ç»†é¡µ
    loadContent('ReconDetail');
}
    
   
/**
     * æ ¸å¿ƒè¾…åŠ©ï¼šæ ¹æ®å‡­è¯è®¡ç®—æœ¬æœŸæŸç›Š (å®ç°æ•°æ®è”åŠ¨)
     */
    function calculateRealProfit() {
        const vouchers = JSON.parse(sessionStorage.getItem('ManualVouchers') || "[]");
        
        let totalIncome = 0;  // æ”¶å…¥ (è´·æ–¹)
        let totalCost = 0;    // æˆæœ¬è´¹ç”¨ (å€Ÿæ–¹)

        vouchers.forEach(v => {
            // åªç»Ÿè®¡å·²ç”Ÿæ•ˆçš„å‡­è¯
            if (v.status === 'å·²å®¡æ ¸' || v.status === 'å·²è®°è´¦') {
                if (v.lines) {
                    v.lines.forEach(line => {
                        const code = line.account.split(' ')[0]; // å–ç§‘ç›®ä»£ç 
                        const debit = parseFloat(line.debit) || 0;
                        const credit = parseFloat(line.credit) || 0;

                        // ç®€å•çš„æŸç›Šè¯†åˆ«é€»è¾‘ï¼š
                        // 60å¼€å¤´ = æ”¶å…¥ (å–è´·æ–¹)
                        if (code.startsWith('60') || code.startsWith('61') || code.startsWith('63')) {
                            totalIncome += credit;
                        }
                        // 64, 66, 67, 68å¼€å¤´ = æˆæœ¬/è´¹ç”¨ (å–å€Ÿæ–¹)
                        else if (code.startsWith('64') || code.startsWith('66') || code.startsWith('67') || code.startsWith('68')) {
                            totalCost += debit;
                        }
                    });
                }
            }
        });

        return {
            income: totalIncome,
            cost: totalCost,
            profit: totalIncome - totalCost
        };
    }


// ==========================================================
    // â˜…â˜…â˜… æ ¸å¿ƒä¿®å¤è¡¥ä¸ï¼šæœŸæœ«ç»“è½¬ä¸ç»“è´¦é€»è¾‘ (è¯·æ”¾åœ¨ Script æœ€åº•éƒ¨) â˜…â˜…â˜…
    // ==========================================================

    // 1. [å‡çº§ç‰ˆ] æ™ºèƒ½è®¡ç®—åˆ©æ¶¦ (æ”¯æŒä¸­æ–‡ç§‘ç›® + çŠ¶æ€è¿‡æ»¤)
    window.calculateRealProfit = function() {
        const vouchers = JSON.parse(sessionStorage.getItem('ManualVouchers') || "[]");
        let totalIncome = 0; 
        let totalCost = 0;
        let validCount = 0;

        console.log("å¼€å§‹è®¡ç®—åˆ©æ¶¦...");

        vouchers.forEach(v => {
            // åªæœ‰â€œå·²å®¡æ ¸â€æˆ–â€œå·²è®°è´¦â€çš„å‡­è¯æ‰å‚ä¸è®¡ç®—
            if (v.status === 'å·²å®¡æ ¸' || v.status === 'å·²è®°è´¦') {
                validCount++;
                if (v.lines) {
                    v.lines.forEach(line => {
                        // å…¼å®¹å¤„ç†ï¼šæå–ç§‘ç›®ä»£ç å’Œåç§°
                        const acctStr = line.account ? line.account.trim() : '';
                        const code = acctStr.split(' ')[0]; 
                        const debit = parseFloat(line.debit) || 0;
                        const credit = parseFloat(line.credit) || 0;

                        // --- æ™ºèƒ½åŒ¹é…é€»è¾‘ ---
                        
                        // A. æ”¶å…¥ç±» (è´·æ–¹)ï¼šä»£ç ä»¥ 60/61/63 å¼€å¤´ï¼Œæˆ–åç§°å«â€œæ”¶å…¥â€
                        if (code.startsWith('60') || code.startsWith('61') || code.startsWith('63') || acctStr.includes('æ”¶å…¥')) {
                            totalIncome += credit;
                        }
                        
                        // B. æˆæœ¬è´¹ç”¨ç±» (å€Ÿæ–¹)ï¼šä»£ç ä»¥ 64/66/67/68 å¼€å¤´ï¼Œæˆ–åç§°å«â€œæˆæœ¬â€ã€â€œè´¹ç”¨â€ã€â€œå·¥èµ„â€ã€â€œè¿è´¹â€
                        else if (code.startsWith('64') || code.startsWith('66') || code.startsWith('67') || code.startsWith('68') || 
                                 acctStr.includes('æˆæœ¬') || acctStr.includes('è´¹ç”¨') || acctStr.includes('å·¥èµ„') || acctStr.includes('è¿è´¹')) {
                            totalCost += debit;
                        }
                    });
                }
            }
        });

        console.log(`è®¡ç®—å®Œæˆï¼šæœ‰æ•ˆå‡­è¯${validCount}å¼ ï¼Œæ”¶å…¥${totalIncome}ï¼Œæˆæœ¬${totalCost}`);
        
        return {
            income: totalIncome,
            cost: totalCost,
            profit: totalIncome - totalCost,
            count: validCount
        };
    }

    // 2. [ä¿®å¤ç‰ˆ] æ‰§è¡ŒæŸç›Šç»“è½¬
    window.executeTransfer = function(period) {
        // 1. å…ˆè®¡ç®—
        const res = calculateRealProfit();

        if (res.count === 0) {
            alert("âš ï¸ ç³»ç»Ÿæœªæ£€æµ‹åˆ°ã€å·²å®¡æ ¸ã€‘æˆ–ã€å·²è®°è´¦ã€‘çš„å‡­è¯ã€‚\n\nè¯·å…ˆå»ã€å‡­è¯æŸ¥è¯¢/å®¡æ ¸ã€‘é¡µé¢å®¡æ ¸å‡­è¯ï¼Œç„¶åå†æ¥ç»“è½¬ã€‚");
            return;
        }

        const profitStr = (res.profit >= 0 ? '+' : '') + res.profit.toLocaleString('en-US', {minimumFractionDigits: 2});
        
        if (!confirm(`â“ ç¡®è®¤æ‰§è¡Œã€${period}ã€‘æŸç›Šç»“è½¬å—ï¼Ÿ\n\nğŸ“Š ç³»ç»Ÿæ£€æµ‹åˆ°ï¼š\n- æœ‰æ•ˆå‡­è¯ï¼š${res.count} å¼ \n- æ€»æ”¶å…¥ï¼š${res.income}\n- æ€»æˆæœ¬è´¹ç”¨ï¼š${res.cost}\n- æœ¬æœŸå‡€åˆ©æ¶¦ï¼š${profitStr}`)) return;

        // 2. å­˜å…¥ Session
        sessionStorage.setItem('2025-11-ProfitTransferred', 'true');
        sessionStorage.setItem('2025-11-ProfitAmount', profitStr);
        sessionStorage.setItem('2025-11-ProfitDetail', JSON.stringify(res)); // ä¿å­˜æ˜ç»†ä¾›æŸ¥çœ‹

        // 3. åˆ·æ–°é¡µé¢
        alert(`âœ… ç»“è½¬æˆåŠŸï¼\næŸç›Šç±»ç§‘ç›®ä½™é¢å·²æ¸…é›¶ï¼Œå·®é¢è½¬å…¥æœ¬å¹´åˆ©æ¶¦ã€‚`);
        loadContent('PeriodEndProfit');
    }

    // 3. [ä¿®å¤ç‰ˆ] æœˆæœ«ç»“è´¦æ£€æŸ¥ (ä¿®å¤æŒ‰é’®æ— æ³•ç‚¹å‡»)
    window.refreshClosingCheck = function() {
        const tbody = document.getElementById('checkListBody');
        if(!tbody) return; // å¦‚æœä¸åœ¨ç»“è´¦é¡µé¢ï¼Œé€€å‡º

        tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; color:#3498db;">â³ ç³»ç»Ÿæ­£åœ¨è‡ªæ£€...</td></tr>';

        setTimeout(() => {
            // è¯»å–çŠ¶æ€
            const isTransferred = sessionStorage.getItem('2025-11-ProfitTransferred') === 'true';
            
            // æ„é€ æ£€æŸ¥é¡¹çŠ¶æ€
            const statusHtml = isTransferred 
                ? '<span style="color:#27ae60; font-weight:bold;">âœ… é€šè¿‡</span>' 
                : '<span style="color:#c0392b; font-weight:bold;">âŒ å¤±è´¥</span>';
            
            const msg = isTransferred 
                ? 'æŸç›Šå·²ç»“è½¬ã€‚' 
                : 'æŸç›Šç±»ç§‘ç›®æœ‰ä½™é¢ï¼Œè¯·å…ˆæ‰§è¡Œç»“è½¬ã€‚';
            
            const action = isTransferred 
                ? '-' 
                : `<a href="javascript:void(0)" onclick="loadContent('PeriodEndProfit')" style="color:#3498db; font-weight:bold;">å»å¤„ç†</a>`;

            // æ¸²æŸ“è¡¨æ ¼
            tbody.innerHTML = `
                <tr>
                    <td>æ‰€æœ‰å‡­è¯å·²å®¡æ ¸</td>
                    <td><span style="color:#27ae60; font-weight:bold;">âœ… é€šè¿‡</span></td>
                    <td>æ— å¾…å®¡æ ¸å‡­è¯ã€‚</td>
                    <td>-</td>
                </tr>
                <tr>
                    <td>æŸç›Šç±»ç§‘ç›®ç»“è½¬</td>
                    <td>${statusHtml}</td>
                    <td>${msg}</td>
                    <td>${action}</td>
                </tr>
                <tr>
                    <td>è¯•ç®—å¹³è¡¡æ£€æŸ¥</td>
                    <td><span style="color:#27ae60; font-weight:bold;">âœ… é€šè¿‡</span></td>
                    <td>å€Ÿè´·å¹³è¡¡ã€‚</td>
                    <td>-</td>
                </tr>
            `;

            // æ§åˆ¶ä¸»æŒ‰é’® (å…³é”®ä¿®å¤)
            const btnClose = document.getElementById('btnExecuteClose');
            if (btnClose) {
                if (isTransferred) {
                    window.g_isClosingReady = true; // è®¾ç½®å…¨å±€å˜é‡
                    btnClose.disabled = false;
                    btnClose.style.backgroundColor = "#c0392b"; // å˜çº¢è¡¨ç¤ºå¯ç‚¹å‡»
                    btnClose.style.cursor = "pointer";
                    btnClose.innerText = "æ‰§è¡Œæœˆæœ«ç»“è´¦ (2025å¹´11æœŸ)";
                } else {
                    window.g_isClosingReady = false;
                    btnClose.disabled = true;
                    btnClose.style.backgroundColor = "#95a5a6";
                    btnClose.innerText = "æ— æ³•ç»“è´¦ (è¯·å…ˆå¤„ç†å¤±è´¥é¡¹)";
                }
            }
        }, 500);
    }

    // 4. [ä¿®å¤ç‰ˆ] æ‰§è¡Œç»“è´¦
    window.executeMonthEndClose = function() {
        if (!window.g_isClosingReady) {
            alert("âŒ æ£€æŸ¥æœªé€šè¿‡ï¼Œæ— æ³•ç»“è´¦ã€‚");
            return;
        }
        if (confirm("ğŸ”’ ç¡®è®¤æ‰§è¡Œæœˆæœ«ç»“è´¦å—ï¼Ÿ\n\nç»“è´¦åæ•°æ®å°†è¢«é”å®šï¼Œæ— æ³•ä¿®æ”¹ã€‚")) {
            sessionStorage.setItem('2025-11-MonthClosed', 'true');
            alert("âœ… ç»“è´¦æˆåŠŸï¼ä¼šè®¡æœŸé—´å·²åˆ‡æ¢ã€‚");
            loadContent('PeriodEndClose'); // åˆ·æ–°é¡µé¢
        }
    }

    // ==========================================================
    // â˜…â˜…â˜… ä¼šè®¡å¼•æ“æ ¸å¿ƒï¼šæ¨¡æ¿ç®¡ç†ä¸è‡ªåŠ¨ç”Ÿæˆ â˜…â˜…â˜…
    // ==========================================================

    // 1. æ˜¾ç¤º/éšè—è¡¨å•
    window.showTemplateForm = function() {
        document.getElementById('tpl-list-view').style.display = 'none';
        document.getElementById('tpl-edit-view').style.display = 'block';
    }
    window.hideTemplateForm = function() {
        document.getElementById('tpl-list-view').style.display = 'block';
        document.getElementById('tpl-edit-view').style.display = 'none';
    }

    // 2. ä¿å­˜æ¨¡æ¿
    window.saveTemplate = function() {
        const name = document.getElementById('tpl-name').value;
        const bizType = document.getElementById('tpl-bizType').value;
        const invType = document.getElementById('tpl-invType').value;

        if(!name) return alert("è¯·è¾“å…¥æ¨¡æ¿åç§°");

        const newTpl = {
            id: 'TPL_' + Math.floor(Math.random()*10000),
            name: name,
            matchRule: { bizType: bizType, invoiceType: invType },
            entries: [ // ç®€åŒ–çš„å›ºå®šç»“æ„ï¼Œå®é™…å¯åšåŠ¨æ€
                { dir: 'å€Ÿ', subject: '1122 åº”æ”¶è´¦æ¬¾', amountType: 'ä»·ç¨åˆè®¡' },
                { dir: 'è´·', subject: '6001 ä¸»è¥ä¸šåŠ¡æ”¶å…¥', amountType: 'ä¸å«ç¨é‡‘é¢' },
                { dir: 'è´·', subject: '2221 åº”äº¤ç¨è´¹-é”€é¡¹', amountType: 'ç¨é¢' }
            ],
            status: 'å¯ç”¨'
        };

        let list = JSON.parse(sessionStorage.getItem('AutoVoucherTemplates') || "[]");
        list.push(newTpl);
        sessionStorage.setItem('AutoVoucherTemplates', JSON.stringify(list));
        
        alert("âœ… æ¨¡æ¿ä¿å­˜æˆåŠŸï¼");
        loadContent('EngineTemplate'); // åˆ·æ–°
    }

    // 3. åˆ é™¤æ¨¡æ¿
    window.deleteTemplate = function(id) {
        if(!confirm("ç¡®å®šåˆ é™¤æ­¤æ¨¡æ¿å—ï¼Ÿ")) return;
        let list = JSON.parse(sessionStorage.getItem('AutoVoucherTemplates') || "[]");
        list = list.filter(t => t.id !== id);
        sessionStorage.setItem('AutoVoucherTemplates', JSON.stringify(list));
        loadContent('EngineTemplate');
    }


/** * â˜…â˜…â˜… æ ¸å¿ƒä¿®å¤ï¼šç»Ÿä¸€ä»·ç¨è®¡ç®—é€»è¾‘ (æ­£ç®—) â˜…â˜…â˜… 
     */
    window.autoGenerateVoucher = function(invoiceData) {
        console.log("--------------------------------------------------");
        console.log("ğŸ” [å¼•æ“å¯åŠ¨] å¼€å§‹ç”Ÿæˆå‡­è¯...", invoiceData);

        // 1. è¯»å–æ¨¡æ¿
        let templates = JSON.parse(sessionStorage.getItem('AutoVoucherTemplates') || "[]");
        
        // é˜²å‘†åˆå§‹åŒ–
        if (templates.length === 0) {
            console.warn("âš ï¸ æ£€æµ‹åˆ°æ¨¡æ¿åº“ä¸ºç©ºï¼Œæ­£åœ¨è‡ªåŠ¨åˆå§‹åŒ–é»˜è®¤æ¨¡æ¿...");
            templates = [{
                id: 'TPL_DEF_001',
                name: 'ç³»ç»Ÿé»˜è®¤é™†è¿æ¨¡æ¿',
                matchRule: { bizType: 'é™†è¿', invoiceType: 'ä¸“ç”¨å‘ç¥¨' },
                entries: [
                    { dir: 'å€Ÿ', subject: '1122 åº”æ”¶è´¦æ¬¾', amountType: 'ä»·ç¨åˆè®¡' },
                    { dir: 'è´·', subject: '6001 ä¸»è¥ä¸šåŠ¡æ”¶å…¥', amountType: 'ä¸å«ç¨é‡‘é¢' },
                    { dir: 'è´·', subject: '2221 åº”äº¤ç¨è´¹-é”€é¡¹', amountType: 'ç¨é¢' }
                ],
                status: 'å¯ç”¨'
            }];
            sessionStorage.setItem('AutoVoucherTemplates', JSON.stringify(templates));
        }

        // 2. å¯»æ‰¾åŒ¹é…çš„æ¨¡æ¿
        const matchedTpl = templates.find(t => {
            const bizMatch = t.matchRule.bizType === 'é€šç”¨' || 
                             (invoiceData.bizType && invoiceData.bizType.includes(t.matchRule.bizType));
            const invMatch = (invoiceData.type && invoiceData.type.includes(t.matchRule.invoiceType));
            const statusMatch = t.status === 'å¯ç”¨';
            return bizMatch && invMatch && statusMatch;
        });

        if (!matchedTpl) {
            console.warn("âŒ åŒ¹é…å¤±è´¥ï¼æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ¨¡æ¿ã€‚");
            return null; 
        }

        console.log("âœ… åŒ¹é…æˆåŠŸï¼ä½¿ç”¨æ¨¡æ¿:", matchedTpl.name);

        // ============================================================
        // 3. â˜…â˜…â˜… æ ¸å¿ƒä¿®å¤ï¼šé‡‘é¢è®¡ç®—æ”¹ä¸ºâ€œæ­£ç®—â€ (ä¸å‘ç¥¨ä¸€è‡´) â˜…â˜…â˜…
        // ============================================================
        // å‡è®¾è¾“å…¥çš„ 1200 æ˜¯ä¸å«ç¨é‡‘é¢ (Base Amount)
        const net = parseFloat(invoiceData.amountStr.replace(/,/g, '')); 
        
        // ç¨ç‡ 9% (å®é™…é¡¹ç›®åº”ä»é…ç½®è¯»å–)
        const taxRate = 0.09; 
        
        const tax = net * taxRate;      // ç¨é¢ = 1200 * 0.09 = 108
        const total = net + tax;        // æ€»é¢ = 1200 + 108 = 1308
        // ============================================================

        // 4. æ„é€ åˆ†å½•è¡Œ
        let voucherLines = [];
        matchedTpl.entries.forEach(rule => {
            let val = 0;
            // æ ¹æ®æ¨¡æ¿é…ç½®å–ä¸åŒçš„å€¼
            if (rule.amountType.includes('ä»·ç¨') || rule.amountType.includes('æ€»')) val = total;     // å– 1308
            else if (rule.amountType.includes('ä¸å«ç¨') || rule.amountType.includes('å‡€')) val = net; // å– 1200
            else if (rule.amountType.includes('ç¨')) val = tax;    // å– 108

            voucherLines.push({
                summary: `åº”æ”¶${invoiceData.client}è¿è´¹`, 
                account: rule.subject,
                debit: rule.dir === 'å€Ÿ' ? val.toFixed(2) : '',
                credit: rule.dir === 'è´·' ? val.toFixed(2) : ''
            });
        });

        // 5. ç”Ÿæˆå‡­è¯å¯¹è±¡
        const newVoucherId = "è‡ª" + new Date().getFullYear() + Math.floor(Math.random()*10000);
        const newVoucher = {
            id: newVoucherId,
            date: new Date().toISOString().slice(0,10),
            amount: total.toFixed(2), // å‡­è¯æ€»é¢åº”è¯¥æ˜¯ä»·ç¨åˆè®¡ (1308)
            user: 'ç³»ç»Ÿå¼•æ“',
            status: 'å¾…å®¡æ ¸', 
            lines: voucherLines
        };

        // 6. ä¿å­˜åˆ°å‡­è¯åº“
        let voucherList = JSON.parse(sessionStorage.getItem('ManualVouchers') || "[]");
        voucherList.unshift(newVoucher);
        sessionStorage.setItem('ManualVouchers', JSON.stringify(voucherList));

        // 7. è®°å½•æ—¥å¿—
        if (typeof addAuditLog === 'function') {
            addAuditLog({
                level: 'ç³»ç»Ÿ',
                time: new Date().toLocaleString(),
                user: 'ç³»ç»Ÿå¼•æ“ (Robot)',
                ip: 'Internal',
                module: 'ä¼šè®¡å¼•æ“',
                action: 'è‡ªåŠ¨ç”Ÿæˆå‡­è¯',
                detail: `å‡­è¯:${newVoucherId}, å…³è”å‘ç¥¨:${invoiceData.no||'N/A'}, å€Ÿæ–¹æ€»é¢:${total.toFixed(2)}`
            });
        }

        console.log(`ğŸ’¾ å‡­è¯ ${newVoucherId} å·²ä¿å­˜ã€‚`);
        return newVoucherId;
    }

    /** * â˜…â˜…â˜… æ–°å¢ï¼šå®¢æˆ·é©³å›å¯¹è´¦å• â˜…â˜…â˜…
     */
    window.rejectRecon = function(id) {
        const reason = prompt(`æ¨¡æ‹Ÿï¼šå®¢æˆ·æ‹’ç»äº†å¯¹è´¦å•ã€${id}ã€‘ã€‚\n\nè¯·è¾“å…¥é©³å›åŸå› ï¼ˆå¦‚ï¼šè¿è´¹è®¡ç®—é”™è¯¯ã€è´§ç‰©ç ´æŸæœªæŠµæ‰£ï¼‰ï¼š`);
        if (!reason) return; // ç”¨æˆ·å–æ¶ˆ

        // 1. æ›´æ–°çŠ¶æ€
        let recons = JSON.parse(sessionStorage.getItem('CustomerRecons') || "[]");
        let item = recons.find(r => r.id === id);
        
        if (item) {
            item.status = 'å·²é©³å›';
            item.rejectReason = reason; // è®°å½•åŸå› 
            sessionStorage.setItem('CustomerRecons', JSON.stringify(recons));
            
            // 2. è”åŠ¨ï¼šæŠŠå…³è”è¿å•çš„çŠ¶æ€å›é€€å—ï¼Ÿ
            // ç­–ç•¥ï¼šé€šå¸¸è¿å•çŠ¶æ€å¯ä»¥ä¿æŒâ€œå¯¹è´¦ä¸­â€ï¼Œæˆ–è€…å›é€€åˆ°â€œå·²ç»“ç®—â€ç­‰å¾…é‡æ–°ç”Ÿæˆã€‚
            // è¿™é‡Œæˆ‘ä»¬ç®€å•å¤„ç†ï¼šåªæ”¹å¯¹è´¦å•çŠ¶æ€ã€‚
            
            // 3. è®°æ—¥å¿—
            if(typeof addAuditLog === 'function') {
                addAuditLog({
                    level: 'ä¸­é£é™©',
                    time: new Date().toLocaleString(),
                    user: 'å¤–éƒ¨å®¢æˆ·',
                    module: 'å®¢æˆ·å¯¹è´¦',
                    action: 'é©³å›å¯¹è´¦å•',
                    detail: `å•å·:${id}, åŸå› :${reason}`
                });
            }

            alert(`â›” å·²é©³å›ï¼\nçŠ¶æ€å˜æ›´ä¸ºã€å·²é©³å›ã€‘ï¼Œè¯·æ ¹æ®å®¢æˆ·åé¦ˆçš„åŸå› è¿›è¡Œä¿®æ­£ã€‚`);
            loadContent('ReconCustomer');
        }
    }

    /**
     * â˜…â˜…â˜… æ–°å¢ï¼šè´¢åŠ¡ä¿®æ­£åé‡æ–°æäº¤ â˜…â˜…â˜…
     */
    window.resubmitRecon = function(id) {
        if(!confirm(`ç¡®è®¤å·²é’ˆå¯¹å®¢æˆ·åé¦ˆçš„é—®é¢˜è¿›è¡Œäº†ä¿®æ­£ï¼Œå¹¶é‡æ–°å‘é€ç»™å®¢æˆ·ç¡®è®¤å—ï¼Ÿ`)) return;

        let recons = JSON.parse(sessionStorage.getItem('CustomerRecons') || "[]");
        let item = recons.find(r => r.id === id);
        
        if (item) {
            item.status = 'å¾…å®¢æˆ·ç¡®è®¤';
            item.rejectReason = ''; // æ¸…ç©ºé©³å›åŸå› 
            sessionStorage.setItem('CustomerRecons', JSON.stringify(recons));
            
            alert("âœ… å·²é‡æ–°æäº¤ï¼ç­‰å¾…å®¢æˆ·å†æ¬¡ç¡®è®¤ã€‚");
            loadContent('ReconCustomer');
        }
    }

</script>

</body>

</html>